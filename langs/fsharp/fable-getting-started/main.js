// fable_modules/fable-library-js.4.14.0/Numeric.js
function isNumeric(x) {
  return typeof x === "number" || typeof x === "bigint" || x?.[symbol];
}
function compare(x, y) {
  if (typeof x === "number") {
    return x < y ? -1 : x > y ? 1 : 0;
  } else if (typeof x === "bigint") {
    return x < y ? -1 : x > y ? 1 : 0;
  } else {
    return x.CompareTo(y);
  }
}
function multiply(x, y) {
  if (typeof x === "number") {
    return x * y;
  } else if (typeof x === "bigint") {
    return x * BigInt(y);
  } else {
    return x[symbol]().multiply(y);
  }
}
function toFixed(x, dp) {
  if (typeof x === "number") {
    return x.toFixed(dp);
  } else if (typeof x === "bigint") {
    return x;
  } else {
    return x[symbol]().toFixed(dp);
  }
}
function toPrecision(x, sd) {
  if (typeof x === "number") {
    return x.toPrecision(sd);
  } else if (typeof x === "bigint") {
    return x;
  } else {
    return x[symbol]().toPrecision(sd);
  }
}
function toExponential(x, dp) {
  if (typeof x === "number") {
    return x.toExponential(dp);
  } else if (typeof x === "bigint") {
    return x;
  } else {
    return x[symbol]().toExponential(dp);
  }
}
function toHex(x) {
  if (typeof x === "number") {
    return (Number(x) >>> 0).toString(16);
  } else if (typeof x === "bigint") {
    return BigInt.asUintN(64, x).toString(16);
  } else {
    return x[symbol]().toHex();
  }
}
var symbol = Symbol("numeric");

// fable_modules/fable-library-js.4.14.0/Util.js
function padWithZeros(i, length) {
  return i.toString(10).padStart(length, "0");
}
class ObjectRef {
  static id(o) {
    if (!ObjectRef.idMap.has(o)) {
      ObjectRef.idMap.set(o, ++ObjectRef.count);
    }
    return ObjectRef.idMap.get(o);
  }
}
ObjectRef.idMap = new WeakMap();
ObjectRef.count = 0;
var curried = new WeakMap();

// fable_modules/fable-library-js.4.14.0/Types.js
function seqToString(self) {
  let count = 0;
  let str = "[";
  for (const x of self) {
    if (count === 0) {
      str += toString(x);
    } else if (count === 100) {
      str += "; ...";
      break;
    } else {
      str += "; " + toString(x);
    }
    count++;
  }
  return str + "]";
}
function toString(x, callStack = 0) {
  if (x != null && typeof x === "object") {
    if (typeof x.toString === "function") {
      return x.toString();
    } else if (Symbol.iterator in x) {
      return seqToString(x);
    } else {
      const cons = Object.getPrototypeOf(x)?.constructor;
      return cons === Object && callStack < 10
        ? "{ " +
            Object.entries(x)
              .map(([k, v]) => k + " = " + toString(v, callStack + 1))
              .join("\n  ") +
            " }"
        : cons?.name ?? "";
    }
  }
  return String(x);
}

// fable_modules/fable-library-js.4.14.0/Date.js
var parseRepeatToken = function (format, pos, patternChar) {
  let tokenLength = 0;
  let internalPos = pos;
  while (internalPos < format.length && format[internalPos] === patternChar) {
    internalPos++;
    tokenLength++;
  }
  return tokenLength;
};
var parseNextChar = function (format, pos) {
  if (pos >= format.length - 1) {
    return -1;
  }
  return format.charCodeAt(pos + 1);
};
var parseQuotedString = function (format, pos) {
  let beginPos = pos;
  const quoteChar = format[pos];
  let result = "";
  let foundQuote = false;
  while (pos < format.length) {
    pos++;
    const currentChar = format[pos];
    if (currentChar === quoteChar) {
      foundQuote = true;
      break;
    } else if (currentChar === "\\") {
      if (pos < format.length) {
        pos++;
        result += format[pos];
      } else {
        throw new Error("Invalid string format");
      }
    } else {
      result += currentChar;
    }
  }
  if (!foundQuote) {
    throw new Error(
      `Invalid string format could not find matching quote for ${quoteChar}`
    );
  }
  return [result, pos - beginPos + 1];
};
var dateToStringWithCustomFormat = function (date, format, utc) {
  let cursorPos = 0;
  let tokenLength = 0;
  let result = "";
  const localizedDate = utc ? DateTime(date.getTime(), 1) : date;
  while (cursorPos < format.length) {
    const token = format[cursorPos];
    switch (token) {
      case "d":
        tokenLength = parseRepeatToken(format, cursorPos, "d");
        cursorPos += tokenLength;
        switch (tokenLength) {
          case 1:
            result += localizedDate.getDate();
            break;
          case 2:
            result += padWithZeros(localizedDate.getDate(), 2);
            break;
          case 3:
            result += shortDays[dayOfWeek(localizedDate)];
            break;
          case 4:
            result += longDays[dayOfWeek(localizedDate)];
            break;
          default:
            break;
        }
        break;
      case "f":
        tokenLength = parseRepeatToken(format, cursorPos, "f");
        cursorPos += tokenLength;
        if (tokenLength <= 3) {
          const precision = 10 ** (3 - tokenLength);
          result += padWithZeros(
            Math.floor(millisecond(localizedDate) / precision),
            tokenLength
          );
        } else if (tokenLength <= 7) {
          result += ("" + millisecond(localizedDate)).padEnd(tokenLength, "0");
        }
        break;
      case "F":
        tokenLength = parseRepeatToken(format, cursorPos, "F");
        cursorPos += tokenLength;
        if (tokenLength <= 3) {
          const precision = 10 ** (3 - tokenLength);
          const value = Math.floor(millisecond(localizedDate) / precision);
          if (value != 0) {
            result += padWithZeros(value, tokenLength);
          }
        } else if (tokenLength <= 7) {
          const value = millisecond(localizedDate);
          if (value != 0) {
            result += padWithZeros(value, 3);
          }
        }
        break;
      case "g":
        tokenLength = parseRepeatToken(format, cursorPos, "g");
        cursorPos += tokenLength;
        if (tokenLength <= 2) {
          result += "A.D.";
        }
        break;
      case "h":
        tokenLength = parseRepeatToken(format, cursorPos, "h");
        cursorPos += tokenLength;
        switch (tokenLength) {
          case 1:
            result += hour(localizedDate) % 12;
            break;
          case 2:
            result += padWithZeros(hour(localizedDate) % 12, 2);
            break;
          default:
            break;
        }
        break;
      case "H":
        tokenLength = parseRepeatToken(format, cursorPos, "H");
        cursorPos += tokenLength;
        switch (tokenLength) {
          case 1:
            result += hour(localizedDate);
            break;
          case 2:
            result += padWithZeros(hour(localizedDate), 2);
            break;
          default:
            break;
        }
        break;
      case "K":
        tokenLength = parseRepeatToken(format, cursorPos, "K");
        cursorPos += tokenLength;
        switch (tokenLength) {
          case 1:
            switch (kind(localizedDate)) {
              case 1:
                result += "Z";
                break;
              case 2:
                result += dateOffsetToString(
                  localizedDate.getTimezoneOffset() * -60000
                );
                break;
              case 0:
                break;
            }
            break;
          default:
            break;
        }
        break;
      case "m":
        tokenLength = parseRepeatToken(format, cursorPos, "m");
        cursorPos += tokenLength;
        switch (tokenLength) {
          case 1:
            result += minute(localizedDate);
            break;
          case 2:
            result += padWithZeros(minute(localizedDate), 2);
            break;
          default:
            break;
        }
        break;
      case "M":
        tokenLength = parseRepeatToken(format, cursorPos, "M");
        cursorPos += tokenLength;
        switch (tokenLength) {
          case 1:
            result += month(localizedDate);
            break;
          case 2:
            result += padWithZeros(month(localizedDate), 2);
            break;
          case 3:
            result += shortMonths[month(localizedDate) - 1];
            break;
          case 4:
            result += longMonths[month(localizedDate) - 1];
            break;
          default:
            break;
        }
        break;
      case "s":
        tokenLength = parseRepeatToken(format, cursorPos, "s");
        cursorPos += tokenLength;
        switch (tokenLength) {
          case 1:
            result += second(localizedDate);
            break;
          case 2:
            result += padWithZeros(second(localizedDate), 2);
            break;
          default:
            break;
        }
        break;
      case "t":
        tokenLength = parseRepeatToken(format, cursorPos, "t");
        cursorPos += tokenLength;
        switch (tokenLength) {
          case 1:
            result += localizedDate.getHours() < 12 ? "A" : "P";
            break;
          case 2:
            result += localizedDate.getHours() < 12 ? "AM" : "PM";
            break;
          default:
            break;
        }
        break;
      case "y":
        tokenLength = parseRepeatToken(format, cursorPos, "y");
        cursorPos += tokenLength;
        switch (tokenLength) {
          case 1:
            result += localizedDate.getFullYear() % 100;
            break;
          case 2:
            result += padWithZeros(localizedDate.getFullYear() % 100, 2);
            break;
          case 3:
            result += padWithZeros(localizedDate.getFullYear(), 3);
            break;
          case 4:
            result += padWithZeros(localizedDate.getFullYear(), 4);
            break;
          case 5:
            result += padWithZeros(localizedDate.getFullYear(), 5);
            break;
          default:
            break;
        }
        break;
      case "z":
        tokenLength = parseRepeatToken(format, cursorPos, "z");
        cursorPos += tokenLength;
        let utcOffsetText = "";
        switch (kind(localizedDate)) {
          case 1:
            utcOffsetText = "+00:00";
            break;
          case 2:
            utcOffsetText = dateOffsetToString(
              localizedDate.getTimezoneOffset() * -60000
            );
            break;
          case 0:
            utcOffsetText = dateOffsetToString(
              toLocalTime(localizedDate).getTimezoneOffset() * -60000
            );
            break;
        }
        const sign = utcOffsetText[0] === "-" ? "-" : "+";
        const hours = parseInt(utcOffsetText.substring(1, 3), 10);
        const minutes = parseInt(utcOffsetText.substring(4, 6), 10);
        switch (tokenLength) {
          case 1:
            result += `${sign}${hours}`;
            break;
          case 2:
            result += `${sign}${padWithZeros(hours, 2)}`;
            break;
          default:
            result += `${sign}${padWithZeros(hours, 2)}:${padWithZeros(
              minutes,
              2
            )}`;
            break;
        }
        break;
      case ":":
        result += ":";
        cursorPos++;
        break;
      case "/":
        result += "/";
        cursorPos++;
        break;
      case "'":
      case '"':
        const [quotedString, quotedStringLenght] = parseQuotedString(
          format,
          cursorPos
        );
        result += quotedString;
        cursorPos += quotedStringLenght;
        break;
      case "%":
        const nextChar = parseNextChar(format, cursorPos);
        if (nextChar >= 0 && nextChar !== "%".charCodeAt(0)) {
          cursorPos += 2;
          result += dateToStringWithCustomFormat(
            localizedDate,
            String.fromCharCode(nextChar),
            utc
          );
        } else {
          throw new Error("Invalid format string");
        }
        break;
      case "\\":
        const nextChar2 = parseNextChar(format, cursorPos);
        if (nextChar2 >= 0) {
          cursorPos += 2;
          result += String.fromCharCode(nextChar2);
        } else {
          throw new Error("Invalid format string");
        }
        break;
      default:
        cursorPos++;
        result += token;
        break;
    }
  }
  return result;
};
function kind(value) {
  return value.kind || 0;
}
function dateOffsetToString(offset) {
  const isMinus = offset < 0;
  offset = Math.abs(offset);
  const hours = ~~(offset / 3600000);
  const minutes = (offset % 3600000) / 60000;
  return (
    (isMinus ? "-" : "+") +
    padWithZeros(hours, 2) +
    ":" +
    padWithZeros(minutes, 2)
  );
}
function dateToHalfUTCString(date, half) {
  const str = date.toISOString();
  return half === "first"
    ? str.substring(0, str.indexOf("T"))
    : str.substring(str.indexOf("T") + 1, str.length - 1);
}
var dateToISOString = function (d, utc) {
  if (utc) {
    return d.toISOString();
  } else {
    const printOffset = d.kind == null ? true : d.kind === 2;
    return (
      padWithZeros(d.getFullYear(), 4) +
      "-" +
      padWithZeros(d.getMonth() + 1, 2) +
      "-" +
      padWithZeros(d.getDate(), 2) +
      "T" +
      padWithZeros(d.getHours(), 2) +
      ":" +
      padWithZeros(d.getMinutes(), 2) +
      ":" +
      padWithZeros(d.getSeconds(), 2) +
      "." +
      padWithZeros(d.getMilliseconds(), 3) +
      (printOffset ? dateOffsetToString(d.getTimezoneOffset() * -60000) : "")
    );
  }
};
var dateToISOStringWithOffset = function (dateWithOffset, offset) {
  const str = dateWithOffset.toISOString();
  return str.substring(0, str.length - 1) + dateOffsetToString(offset);
};
var dateToStringWithOffset = function (date, format) {
  const d = new Date(date.getTime() + (date.offset ?? 0));
  if (typeof format !== "string") {
    return (
      d
        .toISOString()
        .replace(/\.\d+/, "")
        .replace(/[A-Z]|\.\d+/g, " ") + dateOffsetToString(date.offset ?? 0)
    );
  } else if (format.length === 1) {
    switch (format) {
      case "D":
      case "d":
        return dateToHalfUTCString(d, "first");
      case "T":
      case "t":
        return dateToHalfUTCString(d, "second");
      case "O":
      case "o":
        return dateToISOStringWithOffset(d, date.offset ?? 0);
      default:
        throw new Error("Unrecognized Date print format");
    }
  } else {
    return dateToStringWithCustomFormat(d, format, true);
  }
};
var dateToStringWithKind = function (date, format) {
  const utc = date.kind === 1;
  if (typeof format !== "string") {
    return utc ? date.toUTCString() : date.toLocaleString();
  } else if (format.length === 1) {
    switch (format) {
      case "D":
      case "d":
        return utc
          ? dateToHalfUTCString(date, "first")
          : date.toLocaleDateString();
      case "T":
      case "t":
        return utc
          ? dateToHalfUTCString(date, "second")
          : date.toLocaleTimeString();
      case "O":
      case "o":
        return dateToISOString(date, utc);
      default:
        throw new Error("Unrecognized Date print format");
    }
  } else {
    return dateToStringWithCustomFormat(date, format, utc);
  }
};
function toString2(date, format, _provider) {
  return date.offset != null
    ? dateToStringWithOffset(date, format)
    : dateToStringWithKind(date, format);
}
function DateTime(value, kind2) {
  const d = new Date(value);
  d.kind = (kind2 == null ? 0 : kind2) | 0;
  return d;
}
function toLocalTime(date) {
  return date.kind === 2 ? date : DateTime(date.getTime(), 2);
}
function hour(d) {
  return d.kind === 1 ? d.getUTCHours() : d.getHours();
}
function millisecond(d) {
  return d.kind === 1 ? d.getUTCMilliseconds() : d.getMilliseconds();
}
function minute(d) {
  return d.kind === 1 ? d.getUTCMinutes() : d.getMinutes();
}
function month(d) {
  return (d.kind === 1 ? d.getUTCMonth() : d.getMonth()) + 1;
}
function second(d) {
  return d.kind === 1 ? d.getUTCSeconds() : d.getSeconds();
}
function dayOfWeek(d) {
  return d.kind === 1 ? d.getUTCDay() : d.getDay();
}
var shortDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
var longDays = [
  "Sunday",
  "Monday",
  "Tuesday",
  "Wednesday",
  "Thursday",
  "Friday",
  "Saturday",
];
var shortMonths = [
  "Jan",
  "Feb",
  "Mar",
  "Apr",
  "May",
  "Jun",
  "Jul",
  "Aug",
  "Sep",
  "Oct",
  "Nov",
  "Dec",
];
var longMonths = [
  "January",
  "February",
  "March",
  "April",
  "May",
  "June",
  "July",
  "August",
  "September",
  "October",
  "November",
  "December",
];

// fable_modules/fable-library-js.4.14.0/String.js
var isLessThan = function (x, y) {
  return compare(x, y) < 0;
};
function printf(input) {
  return {
    input,
    cont: fsFormat(input),
  };
}
var continuePrint = function (cont, arg) {
  return typeof arg === "string" ? cont(arg) : arg.cont(cont);
};
function toConsole(arg) {
  return continuePrint((x) => console.log(x), arg);
}
var formatReplacement = function (rep, flags, padLength, precision, format) {
  let sign = "";
  flags = flags || "";
  format = format || "";
  if (isNumeric(rep)) {
    if (format.toLowerCase() !== "x") {
      if (isLessThan(rep, 0)) {
        rep = multiply(rep, -1);
        sign = "-";
      } else {
        if (flags.indexOf(" ") >= 0) {
          sign = " ";
        } else if (flags.indexOf("+") >= 0) {
          sign = "+";
        }
      }
    }
    precision = precision == null ? null : parseInt(precision, 10);
    switch (format) {
      case "f":
      case "F":
        precision = precision != null ? precision : 6;
        rep = toFixed(rep, precision);
        break;
      case "g":
      case "G":
        rep =
          precision != null ? toPrecision(rep, precision) : toPrecision(rep);
        break;
      case "e":
      case "E":
        rep =
          precision != null
            ? toExponential(rep, precision)
            : toExponential(rep);
        break;
      case "x":
        rep = toHex(rep);
        break;
      case "X":
        rep = toHex(rep).toUpperCase();
        break;
      default:
        rep = String(rep);
        break;
    }
  } else if (rep instanceof Date) {
    rep = toString2(rep);
  } else {
    rep = toString(rep);
  }
  padLength =
    typeof padLength === "number" ? padLength : parseInt(padLength, 10);
  if (!isNaN(padLength)) {
    const zeroFlag = flags.indexOf("0") >= 0;
    const minusFlag = flags.indexOf("-") >= 0;
    const ch = minusFlag || !zeroFlag ? " " : "0";
    if (ch === "0") {
      rep = pad(rep, padLength - sign.length, ch, minusFlag);
      rep = sign + rep;
    } else {
      rep = pad(sign + rep, padLength, ch, minusFlag);
    }
  } else {
    rep = sign + rep;
  }
  return rep;
};
var createPrinter = function (
  cont,
  _strParts,
  _matches,
  _result = "",
  padArg = -1
) {
  return (...args) => {
    let result = _result;
    const strParts = _strParts.slice();
    const matches = _matches.slice();
    for (const arg of args) {
      const [, , flags, _padLength, precision, format] = matches[0];
      let padLength = _padLength;
      if (padArg >= 0) {
        padLength = padArg;
        padArg = -1;
      } else if (padLength === "*") {
        if (arg < 0) {
          throw new Error("Non-negative number required");
        }
        padArg = arg;
        continue;
      }
      result += strParts[0];
      result += formatReplacement(arg, flags, padLength, precision, format);
      strParts.splice(0, 1);
      matches.splice(0, 1);
    }
    if (matches.length === 0) {
      result += strParts[0];
      return cont(result);
    } else {
      return createPrinter(cont, strParts, matches, result, padArg);
    }
  };
};
function fsFormat(str) {
  return (cont) => {
    fsFormatRegExp.lastIndex = 0;
    const strParts = [];
    const matches = [];
    let strIdx = 0;
    let match = fsFormatRegExp.exec(str);
    while (match) {
      const matchIndex = match.index + (match[1] || "").length;
      strParts.push(str.substring(strIdx, matchIndex).replace(/%%/g, "%"));
      matches.push(match);
      strIdx = fsFormatRegExp.lastIndex;
      fsFormatRegExp.lastIndex -= 1;
      match = fsFormatRegExp.exec(str);
    }
    if (strParts.length === 0) {
      return cont(str.replace(/%%/g, "%"));
    } else {
      strParts.push(str.substring(strIdx).replace(/%%/g, "%"));
      return createPrinter(cont, strParts, matches);
    }
  };
}
var pad = function (str, len, ch, isRight) {
  ch = ch || " ";
  len = len - str.length;
  for (let i = 0; i < len; i++) {
    str = isRight ? str + ch : ch + str;
  }
  return str;
};
var fsFormatRegExp = /(^|[^%])%([0+\- ]*)(\*|\d+)?(?:\.(\d+))?(\w)/g;

// Backend.fs.js
function hello(a, b) {
  toConsole(printf("hello, %s, %s"))(a)(b);
}
hello("mister", "interesting");
export { hello };

//# debugId=5ABCE75AC4F05AD664756e2164756e21
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiZmFibGVfbW9kdWxlcy9mYWJsZS1saWJyYXJ5LWpzLjQuMTQuMC9OdW1lcmljLmpzIiwgImZhYmxlX21vZHVsZXMvZmFibGUtbGlicmFyeS1qcy40LjE0LjAvVXRpbC5qcyIsICJmYWJsZV9tb2R1bGVzL2ZhYmxlLWxpYnJhcnktanMuNC4xNC4wL1V0aWwuanMiLCAiZmFibGVfbW9kdWxlcy9mYWJsZS1saWJyYXJ5LWpzLjQuMTQuMC9UeXBlcy5qcyIsICJmYWJsZV9tb2R1bGVzL2ZhYmxlLWxpYnJhcnktanMuNC4xNC4wL0RhdGUuanMiLCAiZmFibGVfbW9kdWxlcy9mYWJsZS1saWJyYXJ5LWpzLjQuMTQuMC9EYXRlLmpzIiwgImZhYmxlX21vZHVsZXMvZmFibGUtbGlicmFyeS1qcy40LjE0LjAvRGF0ZS5qcyIsICJmYWJsZV9tb2R1bGVzL2ZhYmxlLWxpYnJhcnktanMuNC4xNC4wL0RhdGUuanMiLCAiZmFibGVfbW9kdWxlcy9mYWJsZS1saWJyYXJ5LWpzLjQuMTQuMC9EYXRlLmpzIiwgImZhYmxlX21vZHVsZXMvZmFibGUtbGlicmFyeS1qcy40LjE0LjAvRGF0ZS5qcyIsICJmYWJsZV9tb2R1bGVzL2ZhYmxlLWxpYnJhcnktanMuNC4xNC4wL1N0cmluZy5qcyIsICJmYWJsZV9tb2R1bGVzL2ZhYmxlLWxpYnJhcnktanMuNC4xNC4wL1N0cmluZy5qcyIsICJmYWJsZV9tb2R1bGVzL2ZhYmxlLWxpYnJhcnktanMuNC4xNC4wL1N0cmluZy5qcyIsICJmYWJsZV9tb2R1bGVzL2ZhYmxlLWxpYnJhcnktanMuNC4xNC4wL1N0cmluZy5qcyIsICJmYWJsZV9tb2R1bGVzL2ZhYmxlLWxpYnJhcnktanMuNC4xNC4wL1N0cmluZy5qcyIsICJmYWJsZV9tb2R1bGVzL2ZhYmxlLWxpYnJhcnktanMuNC4xNC4wL1N0cmluZy5qcyIsICJQcm9ncmFtLmZzLmpzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWwogICAgImV4cG9ydCBjb25zdCBzeW1ib2wgPSBTeW1ib2woXCJudW1lcmljXCIpO1xuZXhwb3J0IGZ1bmN0aW9uIGlzTnVtZXJpYyh4KSB7XG4gICAgcmV0dXJuIHR5cGVvZiB4ID09PSBcIm51bWJlclwiIHx8IHR5cGVvZiB4ID09PSBcImJpZ2ludFwiIHx8IHg/LltzeW1ib2xdO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBhcmUoeCwgeSkge1xuICAgIGlmICh0eXBlb2YgeCA9PT0gXCJudW1iZXJcIikge1xuICAgICAgICByZXR1cm4geCA8IHkgPyAtMSA6ICh4ID4geSA/IDEgOiAwKTtcbiAgICB9XG4gICAgZWxzZSBpZiAodHlwZW9mIHggPT09IFwiYmlnaW50XCIpIHtcbiAgICAgICAgcmV0dXJuIHggPCB5ID8gLTEgOiAoeCA+IHkgPyAxIDogMCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4geC5Db21wYXJlVG8oeSk7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIG11bHRpcGx5KHgsIHkpIHtcbiAgICBpZiAodHlwZW9mIHggPT09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgcmV0dXJuIHggKiB5O1xuICAgIH1cbiAgICBlbHNlIGlmICh0eXBlb2YgeCA9PT0gXCJiaWdpbnRcIikge1xuICAgICAgICByZXR1cm4geCAqIEJpZ0ludCh5KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiB4W3N5bWJvbF0oKS5tdWx0aXBseSh5KTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gdG9GaXhlZCh4LCBkcCkge1xuICAgIGlmICh0eXBlb2YgeCA9PT0gXCJudW1iZXJcIikge1xuICAgICAgICByZXR1cm4geC50b0ZpeGVkKGRwKTtcbiAgICB9XG4gICAgZWxzZSBpZiAodHlwZW9mIHggPT09IFwiYmlnaW50XCIpIHtcbiAgICAgICAgcmV0dXJuIHg7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4geFtzeW1ib2xdKCkudG9GaXhlZChkcCk7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIHRvUHJlY2lzaW9uKHgsIHNkKSB7XG4gICAgaWYgKHR5cGVvZiB4ID09PSBcIm51bWJlclwiKSB7XG4gICAgICAgIHJldHVybiB4LnRvUHJlY2lzaW9uKHNkKTtcbiAgICB9XG4gICAgZWxzZSBpZiAodHlwZW9mIHggPT09IFwiYmlnaW50XCIpIHtcbiAgICAgICAgcmV0dXJuIHg7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4geFtzeW1ib2xdKCkudG9QcmVjaXNpb24oc2QpO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiB0b0V4cG9uZW50aWFsKHgsIGRwKSB7XG4gICAgaWYgKHR5cGVvZiB4ID09PSBcIm51bWJlclwiKSB7XG4gICAgICAgIHJldHVybiB4LnRvRXhwb25lbnRpYWwoZHApO1xuICAgIH1cbiAgICBlbHNlIGlmICh0eXBlb2YgeCA9PT0gXCJiaWdpbnRcIikge1xuICAgICAgICByZXR1cm4geDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiB4W3N5bWJvbF0oKS50b0V4cG9uZW50aWFsKGRwKTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gdG9IZXgoeCkge1xuICAgIGlmICh0eXBlb2YgeCA9PT0gXCJudW1iZXJcIikge1xuICAgICAgICByZXR1cm4gKE51bWJlcih4KSA+Pj4gMCkudG9TdHJpbmcoMTYpO1xuICAgIH1cbiAgICBlbHNlIGlmICh0eXBlb2YgeCA9PT0gXCJiaWdpbnRcIikge1xuICAgICAgICAvLyBUT0RPOiBwcm9wZXJseSBoYW5kbGUgb3RoZXIgYml0IHNpemVzXG4gICAgICAgIHJldHVybiBCaWdJbnQuYXNVaW50Tig2NCwgeCkudG9TdHJpbmcoMTYpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHhbc3ltYm9sXSgpLnRvSGV4KCk7XG4gICAgfVxufVxuIiwKICAiLy8gdHNsaW50OmRpc2FibGU6YmFuLXR5cGVzXG5leHBvcnQgZnVuY3Rpb24gaXNBcnJheUxpa2UoeCkge1xuICAgIHJldHVybiBBcnJheS5pc0FycmF5KHgpIHx8IEFycmF5QnVmZmVyLmlzVmlldyh4KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpc0l0ZXJhYmxlKHgpIHtcbiAgICByZXR1cm4geCAhPSBudWxsICYmIHR5cGVvZiB4ID09PSBcIm9iamVjdFwiICYmIFN5bWJvbC5pdGVyYXRvciBpbiB4O1xufVxuZXhwb3J0IGZ1bmN0aW9uIGlzRW51bWVyYWJsZSh4KSB7XG4gICAgcmV0dXJuIHggIT0gbnVsbCAmJiB0eXBlb2YgeC5HZXRFbnVtZXJhdG9yID09PSBcImZ1bmN0aW9uXCI7XG59XG5leHBvcnQgZnVuY3Rpb24gaXNDb21wYXJlcih4KSB7XG4gICAgcmV0dXJuIHggIT0gbnVsbCAmJiB0eXBlb2YgeC5Db21wYXJlID09PSBcImZ1bmN0aW9uXCI7XG59XG5leHBvcnQgZnVuY3Rpb24gaXNDb21wYXJhYmxlKHgpIHtcbiAgICByZXR1cm4geCAhPSBudWxsICYmIHR5cGVvZiB4LkNvbXBhcmVUbyA9PT0gXCJmdW5jdGlvblwiO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGlzRXF1YXRhYmxlKHgpIHtcbiAgICByZXR1cm4geCAhPSBudWxsICYmIHR5cGVvZiB4LkVxdWFscyA9PT0gXCJmdW5jdGlvblwiO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGlzSGFzaGFibGUoeCkge1xuICAgIHJldHVybiB4ICE9IG51bGwgJiYgdHlwZW9mIHguR2V0SGFzaENvZGUgPT09IFwiZnVuY3Rpb25cIjtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpc0Rpc3Bvc2FibGUoeCkge1xuICAgIHJldHVybiB4ICE9IG51bGwgJiYgdHlwZW9mIHguRGlzcG9zZSA9PT0gXCJmdW5jdGlvblwiO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGRpc3Bvc2VTYWZlKHgpIHtcbiAgICBpZiAoaXNEaXNwb3NhYmxlKHgpKSB7XG4gICAgICAgIHguRGlzcG9zZSgpO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBkZWZhdWx0T2YoKSB7XG4gICAgcmV0dXJuIG51bGw7XG59XG5leHBvcnQgZnVuY3Rpb24gc2FtZUNvbnN0cnVjdG9yKHgsIHkpIHtcbiAgICByZXR1cm4gT2JqZWN0LmdldFByb3RvdHlwZU9mKHgpPy5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHkpPy5jb25zdHJ1Y3Rvcjtcbn1cbmV4cG9ydCBjbGFzcyBFbnVtZXJhYmxlIHtcbiAgICBjb25zdHJ1Y3Rvcihlbikge1xuICAgICAgICB0aGlzLmVuID0gZW47XG4gICAgfVxuICAgIEdldEVudW1lcmF0b3IoKSB7IHJldHVybiB0aGlzLmVuOyB9XG4gICAgXCJTeXN0ZW0uQ29sbGVjdGlvbnMuSUVudW1lcmFibGUuR2V0RW51bWVyYXRvclwiKCkgeyByZXR1cm4gdGhpcy5lbjsgfVxuICAgIFtTeW1ib2wuaXRlcmF0b3JdKCkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgbmV4dCgpIHtcbiAgICAgICAgY29uc3QgaGFzTmV4dCA9IHRoaXMuZW5bXCJTeXN0ZW0uQ29sbGVjdGlvbnMuSUVudW1lcmF0b3IuTW92ZU5leHRcIl0oKTtcbiAgICAgICAgY29uc3QgY3VycmVudCA9IGhhc05leHQgPyB0aGlzLmVuW1wiU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWMuSUVudW1lcmF0b3JgMS5nZXRfQ3VycmVudFwiXSgpIDogdW5kZWZpbmVkO1xuICAgICAgICByZXR1cm4geyBkb25lOiAhaGFzTmV4dCwgdmFsdWU6IGN1cnJlbnQgfTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgRW51bWVyYXRvciB7XG4gICAgY29uc3RydWN0b3IoaXRlcikge1xuICAgICAgICB0aGlzLml0ZXIgPSBpdGVyO1xuICAgICAgICB0aGlzLmN1cnJlbnQgPSBkZWZhdWx0T2YoKTtcbiAgICB9XG4gICAgW1wiU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWMuSUVudW1lcmF0b3JgMS5nZXRfQ3VycmVudFwiXSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudDtcbiAgICB9XG4gICAgW1wiU3lzdGVtLkNvbGxlY3Rpb25zLklFbnVtZXJhdG9yLmdldF9DdXJyZW50XCJdKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50O1xuICAgIH1cbiAgICBbXCJTeXN0ZW0uQ29sbGVjdGlvbnMuSUVudW1lcmF0b3IuTW92ZU5leHRcIl0oKSB7XG4gICAgICAgIGNvbnN0IGN1ciA9IHRoaXMuaXRlci5uZXh0KCk7XG4gICAgICAgIHRoaXMuY3VycmVudCA9IGN1ci52YWx1ZTtcbiAgICAgICAgcmV0dXJuICFjdXIuZG9uZTtcbiAgICB9XG4gICAgW1wiU3lzdGVtLkNvbGxlY3Rpb25zLklFbnVtZXJhdG9yLlJlc2V0XCJdKCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJKUyBpdGVyYXRvcnMgY2Fubm90IGJlIHJlc2V0XCIpO1xuICAgIH1cbiAgICBEaXNwb3NlKCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIHRvRW51bWVyYWJsZShlKSB7XG4gICAgaWYgKGlzRW51bWVyYWJsZShlKSkge1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBuZXcgRW51bWVyYWJsZShuZXcgRW51bWVyYXRvcihlW1N5bWJvbC5pdGVyYXRvcl0oKSkpO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBnZXRFbnVtZXJhdG9yKGUpIHtcbiAgICBpZiAoaXNFbnVtZXJhYmxlKGUpKSB7XG4gICAgICAgIHJldHVybiBlLkdldEVudW1lcmF0b3IoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBuZXcgRW51bWVyYXRvcihlW1N5bWJvbC5pdGVyYXRvcl0oKSk7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIHRvSXRlcmF0b3IoZW4pIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBuZXh0KCkge1xuICAgICAgICAgICAgY29uc3QgaGFzTmV4dCA9IGVuW1wiU3lzdGVtLkNvbGxlY3Rpb25zLklFbnVtZXJhdG9yLk1vdmVOZXh0XCJdKCk7XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50ID0gaGFzTmV4dCA/IGVuW1wiU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWMuSUVudW1lcmF0b3JgMS5nZXRfQ3VycmVudFwiXSgpIDogdW5kZWZpbmVkO1xuICAgICAgICAgICAgcmV0dXJuIHsgZG9uZTogIWhhc05leHQsIHZhbHVlOiBjdXJyZW50IH07XG4gICAgICAgIH0sXG4gICAgfTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBlbnVtZXJhYmxlVG9JdGVyYXRvcihlKSB7XG4gICAgcmV0dXJuIHRvSXRlcmF0b3IodG9FbnVtZXJhYmxlKGUpLkdldEVudW1lcmF0b3IoKSk7XG59XG5leHBvcnQgY2xhc3MgQ29tcGFyZXIge1xuICAgIGNvbnN0cnVjdG9yKGYpIHtcbiAgICAgICAgdGhpcy5Db21wYXJlID0gZiB8fCBjb21wYXJlO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBjb21wYXJlckZyb21FcXVhbGl0eUNvbXBhcmVyKGNvbXBhcmVyKSB7XG4gICAgLy8gU29tZXRpbWVzIElFcXVhbGl0eUNvbXBhcmVyIGFsc28gaW1wbGVtZW50cyBJQ29tcGFyZXJcbiAgICBpZiAoaXNDb21wYXJlcihjb21wYXJlcikpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBDb21wYXJlcihjb21wYXJlci5Db21wYXJlKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBuZXcgQ29tcGFyZXIoKHgsIHkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHhoYXNoID0gY29tcGFyZXIuR2V0SGFzaENvZGUoeCk7XG4gICAgICAgICAgICBjb25zdCB5aGFzaCA9IGNvbXBhcmVyLkdldEhhc2hDb2RlKHkpO1xuICAgICAgICAgICAgaWYgKHhoYXNoID09PSB5aGFzaCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjb21wYXJlci5FcXVhbHMoeCwgeSkgPyAwIDogLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geGhhc2ggPCB5aGFzaCA/IC0xIDogMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGFzc2VydEVxdWFsKGFjdHVhbCwgZXhwZWN0ZWQsIG1zZykge1xuICAgIGlmICghZXF1YWxzKGFjdHVhbCwgZXhwZWN0ZWQpKSB7XG4gICAgICAgIHRocm93IE9iamVjdC5hc3NpZ24obmV3IEVycm9yKG1zZyB8fCBgRXhwZWN0ZWQ6ICR7ZXhwZWN0ZWR9IC0gQWN0dWFsOiAke2FjdHVhbH1gKSwge1xuICAgICAgICAgICAgYWN0dWFsLFxuICAgICAgICAgICAgZXhwZWN0ZWQsXG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBhc3NlcnROb3RFcXVhbChhY3R1YWwsIGV4cGVjdGVkLCBtc2cpIHtcbiAgICBpZiAoZXF1YWxzKGFjdHVhbCwgZXhwZWN0ZWQpKSB7XG4gICAgICAgIHRocm93IE9iamVjdC5hc3NpZ24obmV3IEVycm9yKG1zZyB8fCBgRXhwZWN0ZWQ6ICR7ZXhwZWN0ZWR9IC0gQWN0dWFsOiAke2FjdHVhbH1gKSwge1xuICAgICAgICAgICAgYWN0dWFsLFxuICAgICAgICAgICAgZXhwZWN0ZWQsXG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydCBjbGFzcyBMYXp5IHtcbiAgICBjb25zdHJ1Y3RvcihmYWN0b3J5KSB7XG4gICAgICAgIHRoaXMuZmFjdG9yeSA9IGZhY3Rvcnk7XG4gICAgICAgIHRoaXMuaXNWYWx1ZUNyZWF0ZWQgPSBmYWxzZTtcbiAgICB9XG4gICAgZ2V0IFZhbHVlKCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNWYWx1ZUNyZWF0ZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZFZhbHVlID0gdGhpcy5mYWN0b3J5KCk7XG4gICAgICAgICAgICB0aGlzLmlzVmFsdWVDcmVhdGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVkVmFsdWU7XG4gICAgfVxuICAgIGdldCBJc1ZhbHVlQ3JlYXRlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNWYWx1ZUNyZWF0ZWQ7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGxhenlGcm9tVmFsdWUodikge1xuICAgIHJldHVybiBuZXcgTGF6eSgoKSA9PiB2KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBwYWRXaXRoWmVyb3MoaSwgbGVuZ3RoKSB7XG4gICAgcmV0dXJuIGkudG9TdHJpbmcoMTApLnBhZFN0YXJ0KGxlbmd0aCwgXCIwXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHBhZExlZnRBbmRSaWdodFdpdGhaZXJvcyhpLCBsZW5ndGhMZWZ0LCBsZW5ndGhSaWdodCkge1xuICAgIHJldHVybiBpLnRvU3RyaW5nKDEwKS5wYWRTdGFydChsZW5ndGhMZWZ0LCBcIjBcIikucGFkRW5kKGxlbmd0aFJpZ2h0LCBcIjBcIik7XG59XG5leHBvcnQgZnVuY3Rpb24gZGF0ZU9mZnNldChkYXRlKSB7XG4gICAgY29uc3QgZGF0ZTEgPSBkYXRlO1xuICAgIHJldHVybiB0eXBlb2YgZGF0ZTEub2Zmc2V0ID09PSBcIm51bWJlclwiXG4gICAgICAgID8gZGF0ZTEub2Zmc2V0XG4gICAgICAgIDogKGRhdGUua2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi9cbiAgICAgICAgICAgID8gMCA6IGRhdGUuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIC02MDAwMCk7XG59XG5leHBvcnQgZnVuY3Rpb24gaW50MTZUb1N0cmluZyhpLCByYWRpeCkge1xuICAgIGkgPSBpIDwgMCAmJiByYWRpeCAhPSBudWxsICYmIHJhZGl4ICE9PSAxMCA/IDB4RkZGRiArIGkgKyAxIDogaTtcbiAgICByZXR1cm4gaS50b1N0cmluZyhyYWRpeCk7XG59XG5leHBvcnQgZnVuY3Rpb24gaW50MzJUb1N0cmluZyhpLCByYWRpeCkge1xuICAgIGkgPSBpIDwgMCAmJiByYWRpeCAhPSBudWxsICYmIHJhZGl4ICE9PSAxMCA/IDB4RkZGRkZGRkYgKyBpICsgMSA6IGk7XG4gICAgcmV0dXJuIGkudG9TdHJpbmcocmFkaXgpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGludDY0VG9TdHJpbmcoaSwgcmFkaXgpIHtcbiAgICBpID0gaSA8IDAgJiYgcmFkaXggIT0gbnVsbCAmJiByYWRpeCAhPT0gMTAgPyAweGZmZmZmZmZmZmZmZmZmZmZuICsgaSArIDFuIDogaTtcbiAgICByZXR1cm4gaS50b1N0cmluZyhyYWRpeCk7XG59XG5leHBvcnQgY2xhc3MgT2JqZWN0UmVmIHtcbiAgICBzdGF0aWMgaWQobykge1xuICAgICAgICBpZiAoIU9iamVjdFJlZi5pZE1hcC5oYXMobykpIHtcbiAgICAgICAgICAgIE9iamVjdFJlZi5pZE1hcC5zZXQobywgKytPYmplY3RSZWYuY291bnQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBPYmplY3RSZWYuaWRNYXAuZ2V0KG8pO1xuICAgIH1cbn1cbk9iamVjdFJlZi5pZE1hcCA9IG5ldyBXZWFrTWFwKCk7XG5PYmplY3RSZWYuY291bnQgPSAwO1xuZXhwb3J0IGZ1bmN0aW9uIHN0cmluZ0hhc2gocykge1xuICAgIGxldCBpID0gMDtcbiAgICBsZXQgaCA9IDUzODE7XG4gICAgY29uc3QgbGVuID0gcy5sZW5ndGg7XG4gICAgd2hpbGUgKGkgPCBsZW4pIHtcbiAgICAgICAgaCA9IChoICogMzMpIF4gcy5jaGFyQ29kZUF0KGkrKyk7XG4gICAgfVxuICAgIHJldHVybiBoO1xufVxuZXhwb3J0IGZ1bmN0aW9uIG51bWJlckhhc2goeCkge1xuICAgIHJldHVybiB4ICogMjY1NDQzNTc2MSB8IDA7XG59XG5leHBvcnQgZnVuY3Rpb24gYmlnaW50SGFzaCh4KSB7XG4gICAgcmV0dXJuIHN0cmluZ0hhc2goeC50b1N0cmluZygzMikpO1xufVxuLy8gRnJvbSBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMzc0NDk1OTRcbmV4cG9ydCBmdW5jdGlvbiBjb21iaW5lSGFzaENvZGVzKGhhc2hlcykge1xuICAgIGxldCBoMSA9IDA7XG4gICAgY29uc3QgbGVuID0gaGFzaGVzLmxlbmd0aDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGgyID0gaGFzaGVzW2ldO1xuICAgICAgICBoMSA9ICgoaDEgPDwgNSkgKyBoMSkgXiBoMjtcbiAgICB9XG4gICAgcmV0dXJuIGgxO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHBoeXNpY2FsSGFzaCh4KSB7XG4gICAgaWYgKHggPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgc3dpdGNoICh0eXBlb2YgeCkge1xuICAgICAgICBjYXNlIFwiYm9vbGVhblwiOlxuICAgICAgICAgICAgcmV0dXJuIHggPyAxIDogMDtcbiAgICAgICAgY2FzZSBcIm51bWJlclwiOlxuICAgICAgICAgICAgcmV0dXJuIG51bWJlckhhc2goeCk7XG4gICAgICAgIGNhc2UgXCJiaWdpbnRcIjpcbiAgICAgICAgICAgIHJldHVybiBiaWdpbnRIYXNoKHgpO1xuICAgICAgICBjYXNlIFwic3RyaW5nXCI6XG4gICAgICAgICAgICByZXR1cm4gc3RyaW5nSGFzaCh4KTtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBudW1iZXJIYXNoKE9iamVjdFJlZi5pZCh4KSk7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGlkZW50aXR5SGFzaCh4KSB7XG4gICAgaWYgKGlzSGFzaGFibGUoeCkpIHtcbiAgICAgICAgcmV0dXJuIHguR2V0SGFzaENvZGUoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBwaHlzaWNhbEhhc2goeCk7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGRhdGVIYXNoKHgpIHtcbiAgICByZXR1cm4geC5nZXRUaW1lKCk7XG59XG5leHBvcnQgZnVuY3Rpb24gYXJyYXlIYXNoKHgpIHtcbiAgICBjb25zdCBsZW4gPSB4Lmxlbmd0aDtcbiAgICBjb25zdCBoYXNoZXMgPSBuZXcgQXJyYXkobGVuKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIGhhc2hlc1tpXSA9IHN0cnVjdHVyYWxIYXNoKHhbaV0pO1xuICAgIH1cbiAgICByZXR1cm4gY29tYmluZUhhc2hDb2RlcyhoYXNoZXMpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHN0cnVjdHVyYWxIYXNoKHgpIHtcbiAgICBpZiAoeCA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICBzd2l0Y2ggKHR5cGVvZiB4KSB7XG4gICAgICAgIGNhc2UgXCJib29sZWFuXCI6XG4gICAgICAgICAgICByZXR1cm4geCA/IDEgOiAwO1xuICAgICAgICBjYXNlIFwibnVtYmVyXCI6XG4gICAgICAgICAgICByZXR1cm4gbnVtYmVySGFzaCh4KTtcbiAgICAgICAgY2FzZSBcImJpZ2ludFwiOlxuICAgICAgICAgICAgcmV0dXJuIGJpZ2ludEhhc2goeCk7XG4gICAgICAgIGNhc2UgXCJzdHJpbmdcIjpcbiAgICAgICAgICAgIHJldHVybiBzdHJpbmdIYXNoKHgpO1xuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICBpZiAoaXNIYXNoYWJsZSh4KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB4LkdldEhhc2hDb2RlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChpc0FycmF5TGlrZSh4KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhcnJheUhhc2goeCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh4IGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRlSGFzaCh4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKE9iamVjdC5nZXRQcm90b3R5cGVPZih4KT8uY29uc3RydWN0b3IgPT09IE9iamVjdCkge1xuICAgICAgICAgICAgICAgIC8vIFRPRE86IGNoZWNrIGNhbGwtc3RhY2sgdG8gcHJldmVudCBjeWNsaWMgb2JqZWN0cz9cbiAgICAgICAgICAgICAgICBjb25zdCBoYXNoZXMgPSBPYmplY3QudmFsdWVzKHgpLm1hcCgodikgPT4gc3RydWN0dXJhbEhhc2godikpO1xuICAgICAgICAgICAgICAgIHJldHVybiBjb21iaW5lSGFzaENvZGVzKGhhc2hlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBDbGFzc2VzIGRvbid0IGltcGxlbWVudCBHZXRIYXNoQ29kZSBieSBkZWZhdWx0LCBidXQgbXVzdCB1c2UgaWRlbnRpdHkgaGFzaGluZ1xuICAgICAgICAgICAgICAgIHJldHVybiBudW1iZXJIYXNoKE9iamVjdFJlZi5pZCh4KSk7XG4gICAgICAgICAgICAgICAgLy8gcmV0dXJuIHN0cmluZ0hhc2goU3RyaW5nKHgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cbi8vIEludGVuZGVkIGZvciBjdXN0b20gbnVtZXJpYyB0eXBlcywgbGlrZSBsb25nIG9yIGRlY2ltYWxcbmV4cG9ydCBmdW5jdGlvbiBmYXN0U3RydWN0dXJhbEhhc2goeCkge1xuICAgIHJldHVybiBzdHJpbmdIYXNoKFN0cmluZyh4KSk7XG59XG4vLyBJbnRlbmRlZCBmb3IgZGVjbGFyZWQgdHlwZXMgdGhhdCBtYXkgb3IgbWF5IG5vdCBpbXBsZW1lbnQgR2V0SGFzaENvZGVcbmV4cG9ydCBmdW5jdGlvbiBzYWZlSGFzaCh4KSB7XG4gICAgLy8gcmV0dXJuIHggPT0gbnVsbCA/IDAgOiBpc0hhc2hhYmxlKHgpID8geC5HZXRIYXNoQ29kZSgpIDogbnVtYmVySGFzaChPYmplY3RSZWYuaWQoeCkpO1xuICAgIHJldHVybiBpZGVudGl0eUhhc2goeCk7XG59XG5leHBvcnQgZnVuY3Rpb24gZXF1YWxBcnJheXNXaXRoKHgsIHksIGVxKSB7XG4gICAgaWYgKHggPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4geSA9PSBudWxsO1xuICAgIH1cbiAgICBpZiAoeSA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKHgubGVuZ3RoICE9PSB5Lmxlbmd0aCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgeC5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoIWVxKHhbaV0sIHlbaV0pKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG59XG5leHBvcnQgZnVuY3Rpb24gZXF1YWxBcnJheXMoeCwgeSkge1xuICAgIHJldHVybiBlcXVhbEFycmF5c1dpdGgoeCwgeSwgZXF1YWxzKTtcbn1cbmZ1bmN0aW9uIGVxdWFsT2JqZWN0cyh4LCB5KSB7XG4gICAgY29uc3QgeEtleXMgPSBPYmplY3Qua2V5cyh4KTtcbiAgICBjb25zdCB5S2V5cyA9IE9iamVjdC5rZXlzKHkpO1xuICAgIGlmICh4S2V5cy5sZW5ndGggIT09IHlLZXlzLmxlbmd0aCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHhLZXlzLnNvcnQoKTtcbiAgICB5S2V5cy5zb3J0KCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB4S2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoeEtleXNbaV0gIT09IHlLZXlzW2ldIHx8ICFlcXVhbHMoeFt4S2V5c1tpXV0sIHlbeUtleXNbaV1dKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHBoeXNpY2FsRXF1YWxpdHkoeCwgeSkge1xuICAgIHJldHVybiB4ID09PSB5O1xufVxuZXhwb3J0IGZ1bmN0aW9uIGVxdWFscyh4LCB5KSB7XG4gICAgaWYgKHggPT09IHkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGVsc2UgaWYgKHggPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4geSA9PSBudWxsO1xuICAgIH1cbiAgICBlbHNlIGlmICh5ID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBlbHNlIGlmIChpc0VxdWF0YWJsZSh4KSkge1xuICAgICAgICByZXR1cm4geC5FcXVhbHMoeSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGlzQXJyYXlMaWtlKHgpKSB7XG4gICAgICAgIHJldHVybiBpc0FycmF5TGlrZSh5KSAmJiBlcXVhbEFycmF5cyh4LCB5KTtcbiAgICB9XG4gICAgZWxzZSBpZiAodHlwZW9mIHggIT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBlbHNlIGlmICh4IGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgICByZXR1cm4gKHkgaW5zdGFuY2VvZiBEYXRlKSAmJiBjb21wYXJlRGF0ZXMoeCwgeSkgPT09IDA7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gT2JqZWN0LmdldFByb3RvdHlwZU9mKHgpPy5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0ICYmIGVxdWFsT2JqZWN0cyh4LCB5KTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gY29tcGFyZURhdGVzKHgsIHkpIHtcbiAgICBsZXQgeHRpbWU7XG4gICAgbGV0IHl0aW1lO1xuICAgIC8vIERhdGVUaW1lT2Zmc2V0IGFuZCBEYXRlVGltZSBkZWFscyB3aXRoIGVxdWFsaXR5IGRpZmZlcmVudGx5LlxuICAgIGlmIChcIm9mZnNldFwiIGluIHggJiYgXCJvZmZzZXRcIiBpbiB5KSB7XG4gICAgICAgIHh0aW1lID0geC5nZXRUaW1lKCk7XG4gICAgICAgIHl0aW1lID0geS5nZXRUaW1lKCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB4dGltZSA9IHguZ2V0VGltZSgpICsgZGF0ZU9mZnNldCh4KTtcbiAgICAgICAgeXRpbWUgPSB5LmdldFRpbWUoKSArIGRhdGVPZmZzZXQoeSk7XG4gICAgfVxuICAgIHJldHVybiB4dGltZSA9PT0geXRpbWUgPyAwIDogKHh0aW1lIDwgeXRpbWUgPyAtMSA6IDEpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBhcmVQcmltaXRpdmVzKHgsIHkpIHtcbiAgICByZXR1cm4geCA9PT0geSA/IDAgOiAoeCA8IHkgPyAtMSA6IDEpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBhcmVBcnJheXNXaXRoKHgsIHksIGNvbXApIHtcbiAgICBpZiAoeCA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiB5ID09IG51bGwgPyAwIDogMTtcbiAgICB9XG4gICAgaWYgKHkgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gLTE7XG4gICAgfVxuICAgIGlmICh4Lmxlbmd0aCAhPT0geS5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIHgubGVuZ3RoIDwgeS5sZW5ndGggPyAtMSA6IDE7XG4gICAgfVxuICAgIGZvciAobGV0IGkgPSAwLCBqID0gMDsgaSA8IHgubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaiA9IGNvbXAoeFtpXSwgeVtpXSk7XG4gICAgICAgIGlmIChqICE9PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gajtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gMDtcbn1cbmV4cG9ydCBmdW5jdGlvbiBjb21wYXJlQXJyYXlzKHgsIHkpIHtcbiAgICByZXR1cm4gY29tcGFyZUFycmF5c1dpdGgoeCwgeSwgY29tcGFyZSk7XG59XG5mdW5jdGlvbiBjb21wYXJlT2JqZWN0cyh4LCB5KSB7XG4gICAgY29uc3QgeEtleXMgPSBPYmplY3Qua2V5cyh4KTtcbiAgICBjb25zdCB5S2V5cyA9IE9iamVjdC5rZXlzKHkpO1xuICAgIGlmICh4S2V5cy5sZW5ndGggIT09IHlLZXlzLmxlbmd0aCkge1xuICAgICAgICByZXR1cm4geEtleXMubGVuZ3RoIDwgeUtleXMubGVuZ3RoID8gLTEgOiAxO1xuICAgIH1cbiAgICB4S2V5cy5zb3J0KCk7XG4gICAgeUtleXMuc29ydCgpO1xuICAgIGZvciAobGV0IGkgPSAwLCBqID0gMDsgaSA8IHhLZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGtleSA9IHhLZXlzW2ldO1xuICAgICAgICBpZiAoa2V5ICE9PSB5S2V5c1tpXSkge1xuICAgICAgICAgICAgcmV0dXJuIGtleSA8IHlLZXlzW2ldID8gLTEgOiAxO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaiA9IGNvbXBhcmUoeFtrZXldLCB5W2tleV0pO1xuICAgICAgICAgICAgaWYgKGogIT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gajtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gMDtcbn1cbmV4cG9ydCBmdW5jdGlvbiBjb21wYXJlKHgsIHkpIHtcbiAgICBpZiAoeCA9PT0geSkge1xuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgZWxzZSBpZiAoeCA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiB5ID09IG51bGwgPyAwIDogLTE7XG4gICAgfVxuICAgIGVsc2UgaWYgKHkgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gMTtcbiAgICB9XG4gICAgZWxzZSBpZiAoaXNDb21wYXJhYmxlKHgpKSB7XG4gICAgICAgIHJldHVybiB4LkNvbXBhcmVUbyh5KTtcbiAgICB9XG4gICAgZWxzZSBpZiAoaXNBcnJheUxpa2UoeCkpIHtcbiAgICAgICAgcmV0dXJuIGlzQXJyYXlMaWtlKHkpID8gY29tcGFyZUFycmF5cyh4LCB5KSA6IC0xO1xuICAgIH1cbiAgICBlbHNlIGlmICh0eXBlb2YgeCAhPT0gXCJvYmplY3RcIikge1xuICAgICAgICByZXR1cm4geCA8IHkgPyAtMSA6IDE7XG4gICAgfVxuICAgIGVsc2UgaWYgKHggaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICAgIHJldHVybiB5IGluc3RhbmNlb2YgRGF0ZSA/IGNvbXBhcmVEYXRlcyh4LCB5KSA6IC0xO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5nZXRQcm90b3R5cGVPZih4KT8uY29uc3RydWN0b3IgPT09IE9iamVjdCA/IGNvbXBhcmVPYmplY3RzKHgsIHkpIDogLTE7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIG1pbihjb21wYXJlciwgeCwgeSkge1xuICAgIHJldHVybiBjb21wYXJlcih4LCB5KSA8IDAgPyB4IDogeTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBtYXgoY29tcGFyZXIsIHgsIHkpIHtcbiAgICByZXR1cm4gY29tcGFyZXIoeCwgeSkgPiAwID8geCA6IHk7XG59XG5leHBvcnQgZnVuY3Rpb24gY2xhbXAoY29tcGFyZXIsIHZhbHVlLCBtaW4sIG1heCkge1xuICAgIHJldHVybiAoY29tcGFyZXIodmFsdWUsIG1pbikgPCAwKSA/IG1pbiA6IChjb21wYXJlcih2YWx1ZSwgbWF4KSA+IDApID8gbWF4IDogdmFsdWU7XG59XG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQXRvbSh2YWx1ZSkge1xuICAgIGxldCBhdG9tID0gdmFsdWU7XG4gICAgcmV0dXJuICguLi5hcmdzKSA9PiB7XG4gICAgICAgIGlmIChhcmdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGF0b207XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhdG9tID0gYXJnc1swXTtcbiAgICAgICAgfVxuICAgIH07XG59XG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlT2JqKGZpZWxkcykge1xuICAgIGNvbnN0IG9iaiA9IHt9O1xuICAgIGZvciAoY29uc3Qga3Ygb2YgZmllbGRzKSB7XG4gICAgICAgIG9ialtrdlswXV0gPSBrdlsxXTtcbiAgICB9XG4gICAgcmV0dXJuIG9iajtcbn1cbmV4cG9ydCBmdW5jdGlvbiBqc09wdGlvbnMobXV0YXRvcikge1xuICAgIGNvbnN0IG9wdHMgPSB7fTtcbiAgICBtdXRhdG9yKG9wdHMpO1xuICAgIHJldHVybiBvcHRzO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHJvdW5kKHZhbHVlLCBkaWdpdHMgPSAwKSB7XG4gICAgY29uc3QgbSA9IE1hdGgucG93KDEwLCBkaWdpdHMpO1xuICAgIGNvbnN0IG4gPSArKGRpZ2l0cyA/IHZhbHVlICogbSA6IHZhbHVlKS50b0ZpeGVkKDgpO1xuICAgIGNvbnN0IGkgPSBNYXRoLmZsb29yKG4pO1xuICAgIGNvbnN0IGYgPSBuIC0gaTtcbiAgICBjb25zdCBlID0gMWUtODtcbiAgICBjb25zdCByID0gKGYgPiAwLjUgLSBlICYmIGYgPCAwLjUgKyBlKSA/ICgoaSAlIDIgPT09IDApID8gaSA6IGkgKyAxKSA6IE1hdGgucm91bmQobik7XG4gICAgcmV0dXJuIGRpZ2l0cyA/IHIgLyBtIDogcjtcbn1cbmV4cG9ydCBmdW5jdGlvbiBzaWduKHgpIHtcbiAgICByZXR1cm4geCA+IDAgPyAxIDogeCA8IDAgPyAtMSA6IDA7XG59XG5leHBvcnQgZnVuY3Rpb24gdW5lc2NhcGVEYXRhU3RyaW5nKHMpIHtcbiAgICAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvNDQ1ODU4MC81MjQyMzZcbiAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KChzKS5yZXBsYWNlKC9cXCsvZywgXCIlMjBcIikpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGVzY2FwZURhdGFTdHJpbmcocykge1xuICAgIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQocykucmVwbGFjZSgvIS9nLCBcIiUyMVwiKVxuICAgICAgICAucmVwbGFjZSgvJy9nLCBcIiUyN1wiKVxuICAgICAgICAucmVwbGFjZSgvXFwoL2csIFwiJTI4XCIpXG4gICAgICAgIC5yZXBsYWNlKC9cXCkvZywgXCIlMjlcIilcbiAgICAgICAgLnJlcGxhY2UoL1xcKi9nLCBcIiUyQVwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBlc2NhcGVVcmlTdHJpbmcocykge1xuICAgIHJldHVybiBlbmNvZGVVUkkocyk7XG59XG4vLyBJQ29sbGVjdGlvbi5DbGVhciBhbmQgQ291bnQgbWVtYmVycyBjYW4gYmUgY2FsbGVkIG9uIEFycmF5c1xuLy8gb3IgRGljdGlvbmFyaWVzIHNvIHdlIG5lZWQgYSBydW50aW1lIGNoZWNrIChzZWUgIzExMjApXG5leHBvcnQgZnVuY3Rpb24gY291bnQoY29sKSB7XG4gICAgaWYgKGlzQXJyYXlMaWtlKGNvbCkpIHtcbiAgICAgICAgcmV0dXJuIGNvbC5sZW5ndGg7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBsZXQgY291bnQgPSAwO1xuICAgICAgICBmb3IgKGNvbnN0IF8gb2YgY29sKSB7XG4gICAgICAgICAgICBjb3VudCsrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb3VudDtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gY2xlYXIoY29sKSB7XG4gICAgaWYgKGlzQXJyYXlMaWtlKGNvbCkpIHtcbiAgICAgICAgY29sLnNwbGljZSgwKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbC5jbGVhcigpO1xuICAgIH1cbn1cbmNvbnN0IGN1cnJpZWQgPSBuZXcgV2Vha01hcCgpO1xuZXhwb3J0IGZ1bmN0aW9uIHVuY3VycnkyKGYpIHtcbiAgICBpZiAoZiA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBmMiA9IChhMSwgYTIpID0+IGYoYTEpKGEyKTtcbiAgICBjdXJyaWVkLnNldChmMiwgZik7XG4gICAgcmV0dXJuIGYyO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGN1cnJ5MihmKSB7XG4gICAgcmV0dXJuIGN1cnJpZWQuZ2V0KGYpID8/ICgoYTEpID0+IChhMikgPT4gZihhMSwgYTIpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB1bmN1cnJ5MyhmKSB7XG4gICAgaWYgKGYgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZjIgPSAoYTEsIGEyLCBhMykgPT4gZihhMSkoYTIpKGEzKTtcbiAgICBjdXJyaWVkLnNldChmMiwgZik7XG4gICAgcmV0dXJuIGYyO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGN1cnJ5MyhmKSB7XG4gICAgcmV0dXJuIGN1cnJpZWQuZ2V0KGYpXG4gICAgICAgID8/ICgoYTEpID0+IChhMikgPT4gKGEzKSA9PiBmKGExLCBhMiwgYTMpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB1bmN1cnJ5NChmKSB7XG4gICAgaWYgKGYgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZjIgPSAoYTEsIGEyLCBhMywgYTQpID0+IGYoYTEpKGEyKShhMykoYTQpO1xuICAgIGN1cnJpZWQuc2V0KGYyLCBmKTtcbiAgICByZXR1cm4gZjI7XG59XG5leHBvcnQgZnVuY3Rpb24gY3Vycnk0KGYpIHtcbiAgICByZXR1cm4gY3VycmllZC5nZXQoZilcbiAgICAgICAgPz8gKChhMSkgPT4gKGEyKSA9PiAoYTMpID0+IChhNCkgPT4gZihhMSwgYTIsIGEzLCBhNCkpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHVuY3Vycnk1KGYpIHtcbiAgICBpZiAoZiA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBmMiA9IChhMSwgYTIsIGEzLCBhNCwgYTUpID0+IGYoYTEpKGEyKShhMykoYTQpKGE1KTtcbiAgICBjdXJyaWVkLnNldChmMiwgZik7XG4gICAgcmV0dXJuIGYyO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGN1cnJ5NShmKSB7XG4gICAgcmV0dXJuIGN1cnJpZWQuZ2V0KGYpXG4gICAgICAgID8/ICgoYTEpID0+IChhMikgPT4gKGEzKSA9PiAoYTQpID0+IChhNSkgPT4gZihhMSwgYTIsIGEzLCBhNCwgYTUpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB1bmN1cnJ5NihmKSB7XG4gICAgaWYgKGYgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZjIgPSAoYTEsIGEyLCBhMywgYTQsIGE1LCBhNikgPT4gZihhMSkoYTIpKGEzKShhNCkoYTUpKGE2KTtcbiAgICBjdXJyaWVkLnNldChmMiwgZik7XG4gICAgcmV0dXJuIGYyO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGN1cnJ5NihmKSB7XG4gICAgcmV0dXJuIGN1cnJpZWQuZ2V0KGYpXG4gICAgICAgID8/ICgoYTEpID0+IChhMikgPT4gKGEzKSA9PiAoYTQpID0+IChhNSkgPT4gKGE2KSA9PiBmKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB1bmN1cnJ5NyhmKSB7XG4gICAgaWYgKGYgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZjIgPSAoYTEsIGEyLCBhMywgYTQsIGE1LCBhNiwgYTcpID0+IGYoYTEpKGEyKShhMykoYTQpKGE1KShhNikoYTcpO1xuICAgIGN1cnJpZWQuc2V0KGYyLCBmKTtcbiAgICByZXR1cm4gZjI7XG59XG5leHBvcnQgZnVuY3Rpb24gY3Vycnk3KGYpIHtcbiAgICByZXR1cm4gY3VycmllZC5nZXQoZilcbiAgICAgICAgPz8gKChhMSkgPT4gKGEyKSA9PiAoYTMpID0+IChhNCkgPT4gKGE1KSA9PiAoYTYpID0+IChhNykgPT4gZihhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNykpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHVuY3Vycnk4KGYpIHtcbiAgICBpZiAoZiA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBmMiA9IChhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgpID0+IGYoYTEpKGEyKShhMykoYTQpKGE1KShhNikoYTcpKGE4KTtcbiAgICBjdXJyaWVkLnNldChmMiwgZik7XG4gICAgcmV0dXJuIGYyO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGN1cnJ5OChmKSB7XG4gICAgcmV0dXJuIGN1cnJpZWQuZ2V0KGYpXG4gICAgICAgID8/ICgoYTEpID0+IChhMikgPT4gKGEzKSA9PiAoYTQpID0+IChhNSkgPT4gKGE2KSA9PiAoYTcpID0+IChhOCkgPT4gZihhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB1bmN1cnJ5OShmKSB7XG4gICAgaWYgKGYgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZjIgPSAoYTEsIGEyLCBhMywgYTQsIGE1LCBhNiwgYTcsIGE4LCBhOSkgPT4gZihhMSkoYTIpKGEzKShhNCkoYTUpKGE2KShhNykoYTgpKGE5KTtcbiAgICBjdXJyaWVkLnNldChmMiwgZik7XG4gICAgcmV0dXJuIGYyO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGN1cnJ5OShmKSB7XG4gICAgcmV0dXJuIGN1cnJpZWQuZ2V0KGYpXG4gICAgICAgID8/ICgoYTEpID0+IChhMikgPT4gKGEzKSA9PiAoYTQpID0+IChhNSkgPT4gKGE2KSA9PiAoYTcpID0+IChhOCkgPT4gKGE5KSA9PiBmKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTkpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB1bmN1cnJ5MTAoZikge1xuICAgIGlmIChmID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGYyID0gKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTksIGExMCkgPT4gZihhMSkoYTIpKGEzKShhNCkoYTUpKGE2KShhNykoYTgpKGE5KShhMTApO1xuICAgIGN1cnJpZWQuc2V0KGYyLCBmKTtcbiAgICByZXR1cm4gZjI7XG59XG5leHBvcnQgZnVuY3Rpb24gY3VycnkxMChmKSB7XG4gICAgcmV0dXJuIGN1cnJpZWQuZ2V0KGYpXG4gICAgICAgID8/ICgoYTEpID0+IChhMikgPT4gKGEzKSA9PiAoYTQpID0+IChhNSkgPT4gKGE2KSA9PiAoYTcpID0+IChhOCkgPT4gKGE5KSA9PiAoYTEwKSA9PiBmKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTksIGExMCkpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHVuY3VycnkxMShmKSB7XG4gICAgaWYgKGYgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZjIgPSAoYTEsIGEyLCBhMywgYTQsIGE1LCBhNiwgYTcsIGE4LCBhOSwgYTEwLCBhMTEpID0+IGYoYTEpKGEyKShhMykoYTQpKGE1KShhNikoYTcpKGE4KShhOSkoYTEwKShhMTEpO1xuICAgIGN1cnJpZWQuc2V0KGYyLCBmKTtcbiAgICByZXR1cm4gZjI7XG59XG5leHBvcnQgZnVuY3Rpb24gY3VycnkxMShmKSB7XG4gICAgcmV0dXJuIGN1cnJpZWQuZ2V0KGYpXG4gICAgICAgID8/ICgoYTEpID0+IChhMikgPT4gKGEzKSA9PiAoYTQpID0+IChhNSkgPT4gKGE2KSA9PiAoYTcpID0+IChhOCkgPT4gKGE5KSA9PiAoYTEwKSA9PiAoYTExKSA9PiBmKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTksIGExMCwgYTExKSk7XG59XG5leHBvcnQgZnVuY3Rpb24gdW5jdXJyeTEyKGYpIHtcbiAgICBpZiAoZiA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBmMiA9IChhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgsIGE5LCBhMTAsIGExMSwgYTEyKSA9PiBmKGExKShhMikoYTMpKGE0KShhNSkoYTYpKGE3KShhOCkoYTkpKGExMCkoYTExKShhMTIpO1xuICAgIGN1cnJpZWQuc2V0KGYyLCBmKTtcbiAgICByZXR1cm4gZjI7XG59XG5leHBvcnQgZnVuY3Rpb24gY3VycnkxMihmKSB7XG4gICAgcmV0dXJuIGN1cnJpZWQuZ2V0KGYpXG4gICAgICAgID8/ICgoYTEpID0+IChhMikgPT4gKGEzKSA9PiAoYTQpID0+IChhNSkgPT4gKGE2KSA9PiAoYTcpID0+IChhOCkgPT4gKGE5KSA9PiAoYTEwKSA9PiAoYTExKSA9PiAoYTEyKSA9PiBmKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTksIGExMCwgYTExLCBhMTIpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB1bmN1cnJ5MTMoZikge1xuICAgIGlmIChmID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGYyID0gKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTksIGExMCwgYTExLCBhMTIsIGExMykgPT4gZihhMSkoYTIpKGEzKShhNCkoYTUpKGE2KShhNykoYTgpKGE5KShhMTApKGExMSkoYTEyKShhMTMpO1xuICAgIGN1cnJpZWQuc2V0KGYyLCBmKTtcbiAgICByZXR1cm4gZjI7XG59XG5leHBvcnQgZnVuY3Rpb24gY3VycnkxMyhmKSB7XG4gICAgcmV0dXJuIGN1cnJpZWQuZ2V0KGYpXG4gICAgICAgID8/ICgoYTEpID0+IChhMikgPT4gKGEzKSA9PiAoYTQpID0+IChhNSkgPT4gKGE2KSA9PiAoYTcpID0+IChhOCkgPT4gKGE5KSA9PiAoYTEwKSA9PiAoYTExKSA9PiAoYTEyKSA9PiAoYTEzKSA9PiBmKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTksIGExMCwgYTExLCBhMTIsIGExMykpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHVuY3VycnkxNChmKSB7XG4gICAgaWYgKGYgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZjIgPSAoYTEsIGEyLCBhMywgYTQsIGE1LCBhNiwgYTcsIGE4LCBhOSwgYTEwLCBhMTEsIGExMiwgYTEzLCBhMTQpID0+IGYoYTEpKGEyKShhMykoYTQpKGE1KShhNikoYTcpKGE4KShhOSkoYTEwKShhMTEpKGExMikoYTEzKShhMTQpO1xuICAgIGN1cnJpZWQuc2V0KGYyLCBmKTtcbiAgICByZXR1cm4gZjI7XG59XG5leHBvcnQgZnVuY3Rpb24gY3VycnkxNChmKSB7XG4gICAgcmV0dXJuIGN1cnJpZWQuZ2V0KGYpXG4gICAgICAgID8/ICgoYTEpID0+IChhMikgPT4gKGEzKSA9PiAoYTQpID0+IChhNSkgPT4gKGE2KSA9PiAoYTcpID0+IChhOCkgPT4gKGE5KSA9PiAoYTEwKSA9PiAoYTExKSA9PiAoYTEyKSA9PiAoYTEzKSA9PiAoYTE0KSA9PiBmKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTksIGExMCwgYTExLCBhMTIsIGExMywgYTE0KSk7XG59XG5leHBvcnQgZnVuY3Rpb24gdW5jdXJyeTE1KGYpIHtcbiAgICBpZiAoZiA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBmMiA9IChhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgsIGE5LCBhMTAsIGExMSwgYTEyLCBhMTMsIGExNCwgYTE1KSA9PiBmKGExKShhMikoYTMpKGE0KShhNSkoYTYpKGE3KShhOCkoYTkpKGExMCkoYTExKShhMTIpKGExMykoYTE0KShhMTUpO1xuICAgIGN1cnJpZWQuc2V0KGYyLCBmKTtcbiAgICByZXR1cm4gZjI7XG59XG5leHBvcnQgZnVuY3Rpb24gY3VycnkxNShmKSB7XG4gICAgcmV0dXJuIGN1cnJpZWQuZ2V0KGYpXG4gICAgICAgID8/ICgoYTEpID0+IChhMikgPT4gKGEzKSA9PiAoYTQpID0+IChhNSkgPT4gKGE2KSA9PiAoYTcpID0+IChhOCkgPT4gKGE5KSA9PiAoYTEwKSA9PiAoYTExKSA9PiAoYTEyKSA9PiAoYTEzKSA9PiAoYTE0KSA9PiAoYTE1KSA9PiBmKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTksIGExMCwgYTExLCBhMTIsIGExMywgYTE0LCBhMTUpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB1bmN1cnJ5MTYoZikge1xuICAgIGlmIChmID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGYyID0gKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTksIGExMCwgYTExLCBhMTIsIGExMywgYTE0LCBhMTUsIGExNikgPT4gZihhMSkoYTIpKGEzKShhNCkoYTUpKGE2KShhNykoYTgpKGE5KShhMTApKGExMSkoYTEyKShhMTMpKGExNCkoYTE1KShhMTYpO1xuICAgIGN1cnJpZWQuc2V0KGYyLCBmKTtcbiAgICByZXR1cm4gZjI7XG59XG5leHBvcnQgZnVuY3Rpb24gY3VycnkxNihmKSB7XG4gICAgcmV0dXJuIGN1cnJpZWQuZ2V0KGYpXG4gICAgICAgID8/ICgoYTEpID0+IChhMikgPT4gKGEzKSA9PiAoYTQpID0+IChhNSkgPT4gKGE2KSA9PiAoYTcpID0+IChhOCkgPT4gKGE5KSA9PiAoYTEwKSA9PiAoYTExKSA9PiAoYTEyKSA9PiAoYTEzKSA9PiAoYTE0KSA9PiAoYTE1KSA9PiAoYTE2KSA9PiBmKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTksIGExMCwgYTExLCBhMTIsIGExMywgYTE0LCBhMTUsIGExNikpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHVuY3VycnkxNyhmKSB7XG4gICAgaWYgKGYgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZjIgPSAoYTEsIGEyLCBhMywgYTQsIGE1LCBhNiwgYTcsIGE4LCBhOSwgYTEwLCBhMTEsIGExMiwgYTEzLCBhMTQsIGExNSwgYTE2LCBhMTcpID0+IGYoYTEpKGEyKShhMykoYTQpKGE1KShhNikoYTcpKGE4KShhOSkoYTEwKShhMTEpKGExMikoYTEzKShhMTQpKGExNSkoYTE2KShhMTcpO1xuICAgIGN1cnJpZWQuc2V0KGYyLCBmKTtcbiAgICByZXR1cm4gZjI7XG59XG5leHBvcnQgZnVuY3Rpb24gY3VycnkxNyhmKSB7XG4gICAgcmV0dXJuIGN1cnJpZWQuZ2V0KGYpXG4gICAgICAgID8/ICgoYTEpID0+IChhMikgPT4gKGEzKSA9PiAoYTQpID0+IChhNSkgPT4gKGE2KSA9PiAoYTcpID0+IChhOCkgPT4gKGE5KSA9PiAoYTEwKSA9PiAoYTExKSA9PiAoYTEyKSA9PiAoYTEzKSA9PiAoYTE0KSA9PiAoYTE1KSA9PiAoYTE2KSA9PiAoYTE3KSA9PiBmKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTksIGExMCwgYTExLCBhMTIsIGExMywgYTE0LCBhMTUsIGExNiwgYTE3KSk7XG59XG5leHBvcnQgZnVuY3Rpb24gdW5jdXJyeTE4KGYpIHtcbiAgICBpZiAoZiA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBmMiA9IChhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgsIGE5LCBhMTAsIGExMSwgYTEyLCBhMTMsIGExNCwgYTE1LCBhMTYsIGExNywgYTE4KSA9PiBmKGExKShhMikoYTMpKGE0KShhNSkoYTYpKGE3KShhOCkoYTkpKGExMCkoYTExKShhMTIpKGExMykoYTE0KShhMTUpKGExNikoYTE3KShhMTgpO1xuICAgIGN1cnJpZWQuc2V0KGYyLCBmKTtcbiAgICByZXR1cm4gZjI7XG59XG5leHBvcnQgZnVuY3Rpb24gY3VycnkxOChmKSB7XG4gICAgcmV0dXJuIGN1cnJpZWQuZ2V0KGYpXG4gICAgICAgID8/ICgoYTEpID0+IChhMikgPT4gKGEzKSA9PiAoYTQpID0+IChhNSkgPT4gKGE2KSA9PiAoYTcpID0+IChhOCkgPT4gKGE5KSA9PiAoYTEwKSA9PiAoYTExKSA9PiAoYTEyKSA9PiAoYTEzKSA9PiAoYTE0KSA9PiAoYTE1KSA9PiAoYTE2KSA9PiAoYTE3KSA9PiAoYTE4KSA9PiBmKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTksIGExMCwgYTExLCBhMTIsIGExMywgYTE0LCBhMTUsIGExNiwgYTE3LCBhMTgpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB1bmN1cnJ5MTkoZikge1xuICAgIGlmIChmID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGYyID0gKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTksIGExMCwgYTExLCBhMTIsIGExMywgYTE0LCBhMTUsIGExNiwgYTE3LCBhMTgsIGExOSkgPT4gZihhMSkoYTIpKGEzKShhNCkoYTUpKGE2KShhNykoYTgpKGE5KShhMTApKGExMSkoYTEyKShhMTMpKGExNCkoYTE1KShhMTYpKGExNykoYTE4KShhMTkpO1xuICAgIGN1cnJpZWQuc2V0KGYyLCBmKTtcbiAgICByZXR1cm4gZjI7XG59XG5leHBvcnQgZnVuY3Rpb24gY3VycnkxOShmKSB7XG4gICAgcmV0dXJuIGN1cnJpZWQuZ2V0KGYpXG4gICAgICAgID8/ICgoYTEpID0+IChhMikgPT4gKGEzKSA9PiAoYTQpID0+IChhNSkgPT4gKGE2KSA9PiAoYTcpID0+IChhOCkgPT4gKGE5KSA9PiAoYTEwKSA9PiAoYTExKSA9PiAoYTEyKSA9PiAoYTEzKSA9PiAoYTE0KSA9PiAoYTE1KSA9PiAoYTE2KSA9PiAoYTE3KSA9PiAoYTE4KSA9PiAoYTE5KSA9PiBmKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTksIGExMCwgYTExLCBhMTIsIGExMywgYTE0LCBhMTUsIGExNiwgYTE3LCBhMTgsIGExOSkpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHVuY3VycnkyMChmKSB7XG4gICAgaWYgKGYgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZjIgPSAoYTEsIGEyLCBhMywgYTQsIGE1LCBhNiwgYTcsIGE4LCBhOSwgYTEwLCBhMTEsIGExMiwgYTEzLCBhMTQsIGExNSwgYTE2LCBhMTcsIGExOCwgYTE5LCBhMjApID0+IGYoYTEpKGEyKShhMykoYTQpKGE1KShhNikoYTcpKGE4KShhOSkoYTEwKShhMTEpKGExMikoYTEzKShhMTQpKGExNSkoYTE2KShhMTcpKGExOCkoYTE5KShhMjApO1xuICAgIGN1cnJpZWQuc2V0KGYyLCBmKTtcbiAgICByZXR1cm4gZjI7XG59XG5leHBvcnQgZnVuY3Rpb24gY3VycnkyMChmKSB7XG4gICAgcmV0dXJuIGN1cnJpZWQuZ2V0KGYpXG4gICAgICAgID8/ICgoYTEpID0+IChhMikgPT4gKGEzKSA9PiAoYTQpID0+IChhNSkgPT4gKGE2KSA9PiAoYTcpID0+IChhOCkgPT4gKGE5KSA9PiAoYTEwKSA9PiAoYTExKSA9PiAoYTEyKSA9PiAoYTEzKSA9PiAoYTE0KSA9PiAoYTE1KSA9PiAoYTE2KSA9PiAoYTE3KSA9PiAoYTE4KSA9PiAoYTE5KSA9PiAoYTIwKSA9PiBmKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTksIGExMCwgYTExLCBhMTIsIGExMywgYTE0LCBhMTUsIGExNiwgYTE3LCBhMTgsIGExOSwgYTIwKSk7XG59XG4vLyBNb3JlIHBlcmZvcm1hbnQgbWV0aG9kIHRvIGNvcHkgYXJyYXlzLCBzZWUgIzIzNTJcbmV4cG9ydCBmdW5jdGlvbiBjb3B5VG9BcnJheShzb3VyY2UsIHNvdXJjZUluZGV4LCB0YXJnZXQsIHRhcmdldEluZGV4LCBjb3VudCkge1xuICAgIGlmIChBcnJheUJ1ZmZlci5pc1ZpZXcoc291cmNlKSAmJiBBcnJheUJ1ZmZlci5pc1ZpZXcodGFyZ2V0KSkge1xuICAgICAgICB0YXJnZXQuc2V0KHNvdXJjZS5zdWJhcnJheShzb3VyY2VJbmRleCwgc291cmNlSW5kZXggKyBjb3VudCksIHRhcmdldEluZGV4KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7ICsraSkge1xuICAgICAgICAgICAgdGFyZ2V0W3RhcmdldEluZGV4ICsgaV0gPSBzb3VyY2Vbc291cmNlSW5kZXggKyBpXTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiIsCiAgIi8vIHRzbGludDpkaXNhYmxlOmJhbi10eXBlc1xuZXhwb3J0IGZ1bmN0aW9uIGlzQXJyYXlMaWtlKHgpIHtcbiAgICByZXR1cm4gQXJyYXkuaXNBcnJheSh4KSB8fCBBcnJheUJ1ZmZlci5pc1ZpZXcoeCk7XG59XG5leHBvcnQgZnVuY3Rpb24gaXNJdGVyYWJsZSh4KSB7XG4gICAgcmV0dXJuIHggIT0gbnVsbCAmJiB0eXBlb2YgeCA9PT0gXCJvYmplY3RcIiAmJiBTeW1ib2wuaXRlcmF0b3IgaW4geDtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpc0VudW1lcmFibGUoeCkge1xuICAgIHJldHVybiB4ICE9IG51bGwgJiYgdHlwZW9mIHguR2V0RW51bWVyYXRvciA9PT0gXCJmdW5jdGlvblwiO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGlzQ29tcGFyZXIoeCkge1xuICAgIHJldHVybiB4ICE9IG51bGwgJiYgdHlwZW9mIHguQ29tcGFyZSA9PT0gXCJmdW5jdGlvblwiO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGlzQ29tcGFyYWJsZSh4KSB7XG4gICAgcmV0dXJuIHggIT0gbnVsbCAmJiB0eXBlb2YgeC5Db21wYXJlVG8gPT09IFwiZnVuY3Rpb25cIjtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpc0VxdWF0YWJsZSh4KSB7XG4gICAgcmV0dXJuIHggIT0gbnVsbCAmJiB0eXBlb2YgeC5FcXVhbHMgPT09IFwiZnVuY3Rpb25cIjtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpc0hhc2hhYmxlKHgpIHtcbiAgICByZXR1cm4geCAhPSBudWxsICYmIHR5cGVvZiB4LkdldEhhc2hDb2RlID09PSBcImZ1bmN0aW9uXCI7XG59XG5leHBvcnQgZnVuY3Rpb24gaXNEaXNwb3NhYmxlKHgpIHtcbiAgICByZXR1cm4geCAhPSBudWxsICYmIHR5cGVvZiB4LkRpc3Bvc2UgPT09IFwiZnVuY3Rpb25cIjtcbn1cbmV4cG9ydCBmdW5jdGlvbiBkaXNwb3NlU2FmZSh4KSB7XG4gICAgaWYgKGlzRGlzcG9zYWJsZSh4KSkge1xuICAgICAgICB4LkRpc3Bvc2UoKTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gZGVmYXVsdE9mKCkge1xuICAgIHJldHVybiBudWxsO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHNhbWVDb25zdHJ1Y3Rvcih4LCB5KSB7XG4gICAgcmV0dXJuIE9iamVjdC5nZXRQcm90b3R5cGVPZih4KT8uY29uc3RydWN0b3IgPT09IE9iamVjdC5nZXRQcm90b3R5cGVPZih5KT8uY29uc3RydWN0b3I7XG59XG5leHBvcnQgY2xhc3MgRW51bWVyYWJsZSB7XG4gICAgY29uc3RydWN0b3IoZW4pIHtcbiAgICAgICAgdGhpcy5lbiA9IGVuO1xuICAgIH1cbiAgICBHZXRFbnVtZXJhdG9yKCkgeyByZXR1cm4gdGhpcy5lbjsgfVxuICAgIFwiU3lzdGVtLkNvbGxlY3Rpb25zLklFbnVtZXJhYmxlLkdldEVudW1lcmF0b3JcIigpIHsgcmV0dXJuIHRoaXMuZW47IH1cbiAgICBbU3ltYm9sLml0ZXJhdG9yXSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIG5leHQoKSB7XG4gICAgICAgIGNvbnN0IGhhc05leHQgPSB0aGlzLmVuW1wiU3lzdGVtLkNvbGxlY3Rpb25zLklFbnVtZXJhdG9yLk1vdmVOZXh0XCJdKCk7XG4gICAgICAgIGNvbnN0IGN1cnJlbnQgPSBoYXNOZXh0ID8gdGhpcy5lbltcIlN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLklFbnVtZXJhdG9yYDEuZ2V0X0N1cnJlbnRcIl0oKSA6IHVuZGVmaW5lZDtcbiAgICAgICAgcmV0dXJuIHsgZG9uZTogIWhhc05leHQsIHZhbHVlOiBjdXJyZW50IH07XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIEVudW1lcmF0b3Ige1xuICAgIGNvbnN0cnVjdG9yKGl0ZXIpIHtcbiAgICAgICAgdGhpcy5pdGVyID0gaXRlcjtcbiAgICAgICAgdGhpcy5jdXJyZW50ID0gZGVmYXVsdE9mKCk7XG4gICAgfVxuICAgIFtcIlN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLklFbnVtZXJhdG9yYDEuZ2V0X0N1cnJlbnRcIl0oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnQ7XG4gICAgfVxuICAgIFtcIlN5c3RlbS5Db2xsZWN0aW9ucy5JRW51bWVyYXRvci5nZXRfQ3VycmVudFwiXSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudDtcbiAgICB9XG4gICAgW1wiU3lzdGVtLkNvbGxlY3Rpb25zLklFbnVtZXJhdG9yLk1vdmVOZXh0XCJdKCkge1xuICAgICAgICBjb25zdCBjdXIgPSB0aGlzLml0ZXIubmV4dCgpO1xuICAgICAgICB0aGlzLmN1cnJlbnQgPSBjdXIudmFsdWU7XG4gICAgICAgIHJldHVybiAhY3VyLmRvbmU7XG4gICAgfVxuICAgIFtcIlN5c3RlbS5Db2xsZWN0aW9ucy5JRW51bWVyYXRvci5SZXNldFwiXSgpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSlMgaXRlcmF0b3JzIGNhbm5vdCBiZSByZXNldFwiKTtcbiAgICB9XG4gICAgRGlzcG9zZSgpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiB0b0VudW1lcmFibGUoZSkge1xuICAgIGlmIChpc0VudW1lcmFibGUoZSkpIHtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gbmV3IEVudW1lcmFibGUobmV3IEVudW1lcmF0b3IoZVtTeW1ib2wuaXRlcmF0b3JdKCkpKTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gZ2V0RW51bWVyYXRvcihlKSB7XG4gICAgaWYgKGlzRW51bWVyYWJsZShlKSkge1xuICAgICAgICByZXR1cm4gZS5HZXRFbnVtZXJhdG9yKCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gbmV3IEVudW1lcmF0b3IoZVtTeW1ib2wuaXRlcmF0b3JdKCkpO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiB0b0l0ZXJhdG9yKGVuKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgbmV4dCgpIHtcbiAgICAgICAgICAgIGNvbnN0IGhhc05leHQgPSBlbltcIlN5c3RlbS5Db2xsZWN0aW9ucy5JRW51bWVyYXRvci5Nb3ZlTmV4dFwiXSgpO1xuICAgICAgICAgICAgY29uc3QgY3VycmVudCA9IGhhc05leHQgPyBlbltcIlN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLklFbnVtZXJhdG9yYDEuZ2V0X0N1cnJlbnRcIl0oKSA6IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHJldHVybiB7IGRvbmU6ICFoYXNOZXh0LCB2YWx1ZTogY3VycmVudCB9O1xuICAgICAgICB9LFxuICAgIH07XG59XG5leHBvcnQgZnVuY3Rpb24gZW51bWVyYWJsZVRvSXRlcmF0b3IoZSkge1xuICAgIHJldHVybiB0b0l0ZXJhdG9yKHRvRW51bWVyYWJsZShlKS5HZXRFbnVtZXJhdG9yKCkpO1xufVxuZXhwb3J0IGNsYXNzIENvbXBhcmVyIHtcbiAgICBjb25zdHJ1Y3RvcihmKSB7XG4gICAgICAgIHRoaXMuQ29tcGFyZSA9IGYgfHwgY29tcGFyZTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gY29tcGFyZXJGcm9tRXF1YWxpdHlDb21wYXJlcihjb21wYXJlcikge1xuICAgIC8vIFNvbWV0aW1lcyBJRXF1YWxpdHlDb21wYXJlciBhbHNvIGltcGxlbWVudHMgSUNvbXBhcmVyXG4gICAgaWYgKGlzQ29tcGFyZXIoY29tcGFyZXIpKSB7XG4gICAgICAgIHJldHVybiBuZXcgQ29tcGFyZXIoY29tcGFyZXIuQ29tcGFyZSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gbmV3IENvbXBhcmVyKCh4LCB5KSA9PiB7XG4gICAgICAgICAgICBjb25zdCB4aGFzaCA9IGNvbXBhcmVyLkdldEhhc2hDb2RlKHgpO1xuICAgICAgICAgICAgY29uc3QgeWhhc2ggPSBjb21wYXJlci5HZXRIYXNoQ29kZSh5KTtcbiAgICAgICAgICAgIGlmICh4aGFzaCA9PT0geWhhc2gpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29tcGFyZXIuRXF1YWxzKHgsIHkpID8gMCA6IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHhoYXNoIDwgeWhhc2ggPyAtMSA6IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBhc3NlcnRFcXVhbChhY3R1YWwsIGV4cGVjdGVkLCBtc2cpIHtcbiAgICBpZiAoIWVxdWFscyhhY3R1YWwsIGV4cGVjdGVkKSkge1xuICAgICAgICB0aHJvdyBPYmplY3QuYXNzaWduKG5ldyBFcnJvcihtc2cgfHwgYEV4cGVjdGVkOiAke2V4cGVjdGVkfSAtIEFjdHVhbDogJHthY3R1YWx9YCksIHtcbiAgICAgICAgICAgIGFjdHVhbCxcbiAgICAgICAgICAgIGV4cGVjdGVkLFxuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gYXNzZXJ0Tm90RXF1YWwoYWN0dWFsLCBleHBlY3RlZCwgbXNnKSB7XG4gICAgaWYgKGVxdWFscyhhY3R1YWwsIGV4cGVjdGVkKSkge1xuICAgICAgICB0aHJvdyBPYmplY3QuYXNzaWduKG5ldyBFcnJvcihtc2cgfHwgYEV4cGVjdGVkOiAke2V4cGVjdGVkfSAtIEFjdHVhbDogJHthY3R1YWx9YCksIHtcbiAgICAgICAgICAgIGFjdHVhbCxcbiAgICAgICAgICAgIGV4cGVjdGVkLFxuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgTGF6eSB7XG4gICAgY29uc3RydWN0b3IoZmFjdG9yeSkge1xuICAgICAgICB0aGlzLmZhY3RvcnkgPSBmYWN0b3J5O1xuICAgICAgICB0aGlzLmlzVmFsdWVDcmVhdGVkID0gZmFsc2U7XG4gICAgfVxuICAgIGdldCBWYWx1ZSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzVmFsdWVDcmVhdGVkKSB7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWRWYWx1ZSA9IHRoaXMuZmFjdG9yeSgpO1xuICAgICAgICAgICAgdGhpcy5pc1ZhbHVlQ3JlYXRlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlZFZhbHVlO1xuICAgIH1cbiAgICBnZXQgSXNWYWx1ZUNyZWF0ZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzVmFsdWVDcmVhdGVkO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBsYXp5RnJvbVZhbHVlKHYpIHtcbiAgICByZXR1cm4gbmV3IExhenkoKCkgPT4gdik7XG59XG5leHBvcnQgZnVuY3Rpb24gcGFkV2l0aFplcm9zKGksIGxlbmd0aCkge1xuICAgIHJldHVybiBpLnRvU3RyaW5nKDEwKS5wYWRTdGFydChsZW5ndGgsIFwiMFwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBwYWRMZWZ0QW5kUmlnaHRXaXRoWmVyb3MoaSwgbGVuZ3RoTGVmdCwgbGVuZ3RoUmlnaHQpIHtcbiAgICByZXR1cm4gaS50b1N0cmluZygxMCkucGFkU3RhcnQobGVuZ3RoTGVmdCwgXCIwXCIpLnBhZEVuZChsZW5ndGhSaWdodCwgXCIwXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGRhdGVPZmZzZXQoZGF0ZSkge1xuICAgIGNvbnN0IGRhdGUxID0gZGF0ZTtcbiAgICByZXR1cm4gdHlwZW9mIGRhdGUxLm9mZnNldCA9PT0gXCJudW1iZXJcIlxuICAgICAgICA/IGRhdGUxLm9mZnNldFxuICAgICAgICA6IChkYXRlLmtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovXG4gICAgICAgICAgICA/IDAgOiBkYXRlLmdldFRpbWV6b25lT2Zmc2V0KCkgKiAtNjAwMDApO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGludDE2VG9TdHJpbmcoaSwgcmFkaXgpIHtcbiAgICBpID0gaSA8IDAgJiYgcmFkaXggIT0gbnVsbCAmJiByYWRpeCAhPT0gMTAgPyAweEZGRkYgKyBpICsgMSA6IGk7XG4gICAgcmV0dXJuIGkudG9TdHJpbmcocmFkaXgpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGludDMyVG9TdHJpbmcoaSwgcmFkaXgpIHtcbiAgICBpID0gaSA8IDAgJiYgcmFkaXggIT0gbnVsbCAmJiByYWRpeCAhPT0gMTAgPyAweEZGRkZGRkZGICsgaSArIDEgOiBpO1xuICAgIHJldHVybiBpLnRvU3RyaW5nKHJhZGl4KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpbnQ2NFRvU3RyaW5nKGksIHJhZGl4KSB7XG4gICAgaSA9IGkgPCAwICYmIHJhZGl4ICE9IG51bGwgJiYgcmFkaXggIT09IDEwID8gMHhmZmZmZmZmZmZmZmZmZmZmbiArIGkgKyAxbiA6IGk7XG4gICAgcmV0dXJuIGkudG9TdHJpbmcocmFkaXgpO1xufVxuZXhwb3J0IGNsYXNzIE9iamVjdFJlZiB7XG4gICAgc3RhdGljIGlkKG8pIHtcbiAgICAgICAgaWYgKCFPYmplY3RSZWYuaWRNYXAuaGFzKG8pKSB7XG4gICAgICAgICAgICBPYmplY3RSZWYuaWRNYXAuc2V0KG8sICsrT2JqZWN0UmVmLmNvdW50KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gT2JqZWN0UmVmLmlkTWFwLmdldChvKTtcbiAgICB9XG59XG5PYmplY3RSZWYuaWRNYXAgPSBuZXcgV2Vha01hcCgpO1xuT2JqZWN0UmVmLmNvdW50ID0gMDtcbmV4cG9ydCBmdW5jdGlvbiBzdHJpbmdIYXNoKHMpIHtcbiAgICBsZXQgaSA9IDA7XG4gICAgbGV0IGggPSA1MzgxO1xuICAgIGNvbnN0IGxlbiA9IHMubGVuZ3RoO1xuICAgIHdoaWxlIChpIDwgbGVuKSB7XG4gICAgICAgIGggPSAoaCAqIDMzKSBeIHMuY2hhckNvZGVBdChpKyspO1xuICAgIH1cbiAgICByZXR1cm4gaDtcbn1cbmV4cG9ydCBmdW5jdGlvbiBudW1iZXJIYXNoKHgpIHtcbiAgICByZXR1cm4geCAqIDI2NTQ0MzU3NjEgfCAwO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGJpZ2ludEhhc2goeCkge1xuICAgIHJldHVybiBzdHJpbmdIYXNoKHgudG9TdHJpbmcoMzIpKTtcbn1cbi8vIEZyb20gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9hLzM3NDQ5NTk0XG5leHBvcnQgZnVuY3Rpb24gY29tYmluZUhhc2hDb2RlcyhoYXNoZXMpIHtcbiAgICBsZXQgaDEgPSAwO1xuICAgIGNvbnN0IGxlbiA9IGhhc2hlcy5sZW5ndGg7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICBjb25zdCBoMiA9IGhhc2hlc1tpXTtcbiAgICAgICAgaDEgPSAoKGgxIDw8IDUpICsgaDEpIF4gaDI7XG4gICAgfVxuICAgIHJldHVybiBoMTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBwaHlzaWNhbEhhc2goeCkge1xuICAgIGlmICh4ID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIHN3aXRjaCAodHlwZW9mIHgpIHtcbiAgICAgICAgY2FzZSBcImJvb2xlYW5cIjpcbiAgICAgICAgICAgIHJldHVybiB4ID8gMSA6IDA7XG4gICAgICAgIGNhc2UgXCJudW1iZXJcIjpcbiAgICAgICAgICAgIHJldHVybiBudW1iZXJIYXNoKHgpO1xuICAgICAgICBjYXNlIFwiYmlnaW50XCI6XG4gICAgICAgICAgICByZXR1cm4gYmlnaW50SGFzaCh4KTtcbiAgICAgICAgY2FzZSBcInN0cmluZ1wiOlxuICAgICAgICAgICAgcmV0dXJuIHN0cmluZ0hhc2goeCk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gbnVtYmVySGFzaChPYmplY3RSZWYuaWQoeCkpO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBpZGVudGl0eUhhc2goeCkge1xuICAgIGlmIChpc0hhc2hhYmxlKHgpKSB7XG4gICAgICAgIHJldHVybiB4LkdldEhhc2hDb2RlKCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gcGh5c2ljYWxIYXNoKHgpO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBkYXRlSGFzaCh4KSB7XG4gICAgcmV0dXJuIHguZ2V0VGltZSgpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGFycmF5SGFzaCh4KSB7XG4gICAgY29uc3QgbGVuID0geC5sZW5ndGg7XG4gICAgY29uc3QgaGFzaGVzID0gbmV3IEFycmF5KGxlbik7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICBoYXNoZXNbaV0gPSBzdHJ1Y3R1cmFsSGFzaCh4W2ldKTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbWJpbmVIYXNoQ29kZXMoaGFzaGVzKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBzdHJ1Y3R1cmFsSGFzaCh4KSB7XG4gICAgaWYgKHggPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgc3dpdGNoICh0eXBlb2YgeCkge1xuICAgICAgICBjYXNlIFwiYm9vbGVhblwiOlxuICAgICAgICAgICAgcmV0dXJuIHggPyAxIDogMDtcbiAgICAgICAgY2FzZSBcIm51bWJlclwiOlxuICAgICAgICAgICAgcmV0dXJuIG51bWJlckhhc2goeCk7XG4gICAgICAgIGNhc2UgXCJiaWdpbnRcIjpcbiAgICAgICAgICAgIHJldHVybiBiaWdpbnRIYXNoKHgpO1xuICAgICAgICBjYXNlIFwic3RyaW5nXCI6XG4gICAgICAgICAgICByZXR1cm4gc3RyaW5nSGFzaCh4KTtcbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgICAgaWYgKGlzSGFzaGFibGUoeCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geC5HZXRIYXNoQ29kZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoaXNBcnJheUxpa2UoeCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXJyYXlIYXNoKHgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoeCBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZUhhc2goeCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChPYmplY3QuZ2V0UHJvdG90eXBlT2YoeCk/LmNvbnN0cnVjdG9yID09PSBPYmplY3QpIHtcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBjaGVjayBjYWxsLXN0YWNrIHRvIHByZXZlbnQgY3ljbGljIG9iamVjdHM/XG4gICAgICAgICAgICAgICAgY29uc3QgaGFzaGVzID0gT2JqZWN0LnZhbHVlcyh4KS5tYXAoKHYpID0+IHN0cnVjdHVyYWxIYXNoKHYpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29tYmluZUhhc2hDb2RlcyhoYXNoZXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gQ2xhc3NlcyBkb24ndCBpbXBsZW1lbnQgR2V0SGFzaENvZGUgYnkgZGVmYXVsdCwgYnV0IG11c3QgdXNlIGlkZW50aXR5IGhhc2hpbmdcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtYmVySGFzaChPYmplY3RSZWYuaWQoeCkpO1xuICAgICAgICAgICAgICAgIC8vIHJldHVybiBzdHJpbmdIYXNoKFN0cmluZyh4KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG4vLyBJbnRlbmRlZCBmb3IgY3VzdG9tIG51bWVyaWMgdHlwZXMsIGxpa2UgbG9uZyBvciBkZWNpbWFsXG5leHBvcnQgZnVuY3Rpb24gZmFzdFN0cnVjdHVyYWxIYXNoKHgpIHtcbiAgICByZXR1cm4gc3RyaW5nSGFzaChTdHJpbmcoeCkpO1xufVxuLy8gSW50ZW5kZWQgZm9yIGRlY2xhcmVkIHR5cGVzIHRoYXQgbWF5IG9yIG1heSBub3QgaW1wbGVtZW50IEdldEhhc2hDb2RlXG5leHBvcnQgZnVuY3Rpb24gc2FmZUhhc2goeCkge1xuICAgIC8vIHJldHVybiB4ID09IG51bGwgPyAwIDogaXNIYXNoYWJsZSh4KSA/IHguR2V0SGFzaENvZGUoKSA6IG51bWJlckhhc2goT2JqZWN0UmVmLmlkKHgpKTtcbiAgICByZXR1cm4gaWRlbnRpdHlIYXNoKHgpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGVxdWFsQXJyYXlzV2l0aCh4LCB5LCBlcSkge1xuICAgIGlmICh4ID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHkgPT0gbnVsbDtcbiAgICB9XG4gICAgaWYgKHkgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmICh4Lmxlbmd0aCAhPT0geS5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHgubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKCFlcSh4W2ldLCB5W2ldKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGVxdWFsQXJyYXlzKHgsIHkpIHtcbiAgICByZXR1cm4gZXF1YWxBcnJheXNXaXRoKHgsIHksIGVxdWFscyk7XG59XG5mdW5jdGlvbiBlcXVhbE9iamVjdHMoeCwgeSkge1xuICAgIGNvbnN0IHhLZXlzID0gT2JqZWN0LmtleXMoeCk7XG4gICAgY29uc3QgeUtleXMgPSBPYmplY3Qua2V5cyh5KTtcbiAgICBpZiAoeEtleXMubGVuZ3RoICE9PSB5S2V5cy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB4S2V5cy5zb3J0KCk7XG4gICAgeUtleXMuc29ydCgpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgeEtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKHhLZXlzW2ldICE9PSB5S2V5c1tpXSB8fCAhZXF1YWxzKHhbeEtleXNbaV1dLCB5W3lLZXlzW2ldXSkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBwaHlzaWNhbEVxdWFsaXR5KHgsIHkpIHtcbiAgICByZXR1cm4geCA9PT0geTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBlcXVhbHMoeCwgeSkge1xuICAgIGlmICh4ID09PSB5KSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBlbHNlIGlmICh4ID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHkgPT0gbnVsbDtcbiAgICB9XG4gICAgZWxzZSBpZiAoeSA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZWxzZSBpZiAoaXNFcXVhdGFibGUoeCkpIHtcbiAgICAgICAgcmV0dXJuIHguRXF1YWxzKHkpO1xuICAgIH1cbiAgICBlbHNlIGlmIChpc0FycmF5TGlrZSh4KSkge1xuICAgICAgICByZXR1cm4gaXNBcnJheUxpa2UoeSkgJiYgZXF1YWxBcnJheXMoeCwgeSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHR5cGVvZiB4ICE9PSBcIm9iamVjdFwiKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZWxzZSBpZiAoeCBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgICAgcmV0dXJuICh5IGluc3RhbmNlb2YgRGF0ZSkgJiYgY29tcGFyZURhdGVzKHgsIHkpID09PSAwO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5nZXRQcm90b3R5cGVPZih4KT8uY29uc3RydWN0b3IgPT09IE9iamVjdCAmJiBlcXVhbE9iamVjdHMoeCwgeSk7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBhcmVEYXRlcyh4LCB5KSB7XG4gICAgbGV0IHh0aW1lO1xuICAgIGxldCB5dGltZTtcbiAgICAvLyBEYXRlVGltZU9mZnNldCBhbmQgRGF0ZVRpbWUgZGVhbHMgd2l0aCBlcXVhbGl0eSBkaWZmZXJlbnRseS5cbiAgICBpZiAoXCJvZmZzZXRcIiBpbiB4ICYmIFwib2Zmc2V0XCIgaW4geSkge1xuICAgICAgICB4dGltZSA9IHguZ2V0VGltZSgpO1xuICAgICAgICB5dGltZSA9IHkuZ2V0VGltZSgpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgeHRpbWUgPSB4LmdldFRpbWUoKSArIGRhdGVPZmZzZXQoeCk7XG4gICAgICAgIHl0aW1lID0geS5nZXRUaW1lKCkgKyBkYXRlT2Zmc2V0KHkpO1xuICAgIH1cbiAgICByZXR1cm4geHRpbWUgPT09IHl0aW1lID8gMCA6ICh4dGltZSA8IHl0aW1lID8gLTEgOiAxKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBjb21wYXJlUHJpbWl0aXZlcyh4LCB5KSB7XG4gICAgcmV0dXJuIHggPT09IHkgPyAwIDogKHggPCB5ID8gLTEgOiAxKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBjb21wYXJlQXJyYXlzV2l0aCh4LCB5LCBjb21wKSB7XG4gICAgaWYgKHggPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4geSA9PSBudWxsID8gMCA6IDE7XG4gICAgfVxuICAgIGlmICh5ID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIH1cbiAgICBpZiAoeC5sZW5ndGggIT09IHkubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiB4Lmxlbmd0aCA8IHkubGVuZ3RoID8gLTEgOiAxO1xuICAgIH1cbiAgICBmb3IgKGxldCBpID0gMCwgaiA9IDA7IGkgPCB4Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGogPSBjb21wKHhbaV0sIHlbaV0pO1xuICAgICAgICBpZiAoaiAhPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGo7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIDA7XG59XG5leHBvcnQgZnVuY3Rpb24gY29tcGFyZUFycmF5cyh4LCB5KSB7XG4gICAgcmV0dXJuIGNvbXBhcmVBcnJheXNXaXRoKHgsIHksIGNvbXBhcmUpO1xufVxuZnVuY3Rpb24gY29tcGFyZU9iamVjdHMoeCwgeSkge1xuICAgIGNvbnN0IHhLZXlzID0gT2JqZWN0LmtleXMoeCk7XG4gICAgY29uc3QgeUtleXMgPSBPYmplY3Qua2V5cyh5KTtcbiAgICBpZiAoeEtleXMubGVuZ3RoICE9PSB5S2V5cy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIHhLZXlzLmxlbmd0aCA8IHlLZXlzLmxlbmd0aCA/IC0xIDogMTtcbiAgICB9XG4gICAgeEtleXMuc29ydCgpO1xuICAgIHlLZXlzLnNvcnQoKTtcbiAgICBmb3IgKGxldCBpID0gMCwgaiA9IDA7IGkgPCB4S2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBrZXkgPSB4S2V5c1tpXTtcbiAgICAgICAgaWYgKGtleSAhPT0geUtleXNbaV0pIHtcbiAgICAgICAgICAgIHJldHVybiBrZXkgPCB5S2V5c1tpXSA/IC0xIDogMTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGogPSBjb21wYXJlKHhba2V5XSwgeVtrZXldKTtcbiAgICAgICAgICAgIGlmIChqICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGo7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIDA7XG59XG5leHBvcnQgZnVuY3Rpb24gY29tcGFyZSh4LCB5KSB7XG4gICAgaWYgKHggPT09IHkpIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIGVsc2UgaWYgKHggPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4geSA9PSBudWxsID8gMCA6IC0xO1xuICAgIH1cbiAgICBlbHNlIGlmICh5ID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIDE7XG4gICAgfVxuICAgIGVsc2UgaWYgKGlzQ29tcGFyYWJsZSh4KSkge1xuICAgICAgICByZXR1cm4geC5Db21wYXJlVG8oeSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGlzQXJyYXlMaWtlKHgpKSB7XG4gICAgICAgIHJldHVybiBpc0FycmF5TGlrZSh5KSA/IGNvbXBhcmVBcnJheXMoeCwgeSkgOiAtMTtcbiAgICB9XG4gICAgZWxzZSBpZiAodHlwZW9mIHggIT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgcmV0dXJuIHggPCB5ID8gLTEgOiAxO1xuICAgIH1cbiAgICBlbHNlIGlmICh4IGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgICByZXR1cm4geSBpbnN0YW5jZW9mIERhdGUgPyBjb21wYXJlRGF0ZXMoeCwgeSkgOiAtMTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBPYmplY3QuZ2V0UHJvdG90eXBlT2YoeCk/LmNvbnN0cnVjdG9yID09PSBPYmplY3QgPyBjb21wYXJlT2JqZWN0cyh4LCB5KSA6IC0xO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBtaW4oY29tcGFyZXIsIHgsIHkpIHtcbiAgICByZXR1cm4gY29tcGFyZXIoeCwgeSkgPCAwID8geCA6IHk7XG59XG5leHBvcnQgZnVuY3Rpb24gbWF4KGNvbXBhcmVyLCB4LCB5KSB7XG4gICAgcmV0dXJuIGNvbXBhcmVyKHgsIHkpID4gMCA/IHggOiB5O1xufVxuZXhwb3J0IGZ1bmN0aW9uIGNsYW1wKGNvbXBhcmVyLCB2YWx1ZSwgbWluLCBtYXgpIHtcbiAgICByZXR1cm4gKGNvbXBhcmVyKHZhbHVlLCBtaW4pIDwgMCkgPyBtaW4gOiAoY29tcGFyZXIodmFsdWUsIG1heCkgPiAwKSA/IG1heCA6IHZhbHVlO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUF0b20odmFsdWUpIHtcbiAgICBsZXQgYXRvbSA9IHZhbHVlO1xuICAgIHJldHVybiAoLi4uYXJncykgPT4ge1xuICAgICAgICBpZiAoYXJncy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBhdG9tO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYXRvbSA9IGFyZ3NbMF07XG4gICAgICAgIH1cbiAgICB9O1xufVxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU9iaihmaWVsZHMpIHtcbiAgICBjb25zdCBvYmogPSB7fTtcbiAgICBmb3IgKGNvbnN0IGt2IG9mIGZpZWxkcykge1xuICAgICAgICBvYmpba3ZbMF1dID0ga3ZbMV07XG4gICAgfVxuICAgIHJldHVybiBvYmo7XG59XG5leHBvcnQgZnVuY3Rpb24ganNPcHRpb25zKG11dGF0b3IpIHtcbiAgICBjb25zdCBvcHRzID0ge307XG4gICAgbXV0YXRvcihvcHRzKTtcbiAgICByZXR1cm4gb3B0cztcbn1cbmV4cG9ydCBmdW5jdGlvbiByb3VuZCh2YWx1ZSwgZGlnaXRzID0gMCkge1xuICAgIGNvbnN0IG0gPSBNYXRoLnBvdygxMCwgZGlnaXRzKTtcbiAgICBjb25zdCBuID0gKyhkaWdpdHMgPyB2YWx1ZSAqIG0gOiB2YWx1ZSkudG9GaXhlZCg4KTtcbiAgICBjb25zdCBpID0gTWF0aC5mbG9vcihuKTtcbiAgICBjb25zdCBmID0gbiAtIGk7XG4gICAgY29uc3QgZSA9IDFlLTg7XG4gICAgY29uc3QgciA9IChmID4gMC41IC0gZSAmJiBmIDwgMC41ICsgZSkgPyAoKGkgJSAyID09PSAwKSA/IGkgOiBpICsgMSkgOiBNYXRoLnJvdW5kKG4pO1xuICAgIHJldHVybiBkaWdpdHMgPyByIC8gbSA6IHI7XG59XG5leHBvcnQgZnVuY3Rpb24gc2lnbih4KSB7XG4gICAgcmV0dXJuIHggPiAwID8gMSA6IHggPCAwID8gLTEgOiAwO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHVuZXNjYXBlRGF0YVN0cmluZyhzKSB7XG4gICAgLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9hLzQ0NTg1ODAvNTI0MjM2XG4gICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudCgocykucmVwbGFjZSgvXFwrL2csIFwiJTIwXCIpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBlc2NhcGVEYXRhU3RyaW5nKHMpIHtcbiAgICByZXR1cm4gZW5jb2RlVVJJQ29tcG9uZW50KHMpLnJlcGxhY2UoLyEvZywgXCIlMjFcIilcbiAgICAgICAgLnJlcGxhY2UoLycvZywgXCIlMjdcIilcbiAgICAgICAgLnJlcGxhY2UoL1xcKC9nLCBcIiUyOFwiKVxuICAgICAgICAucmVwbGFjZSgvXFwpL2csIFwiJTI5XCIpXG4gICAgICAgIC5yZXBsYWNlKC9cXCovZywgXCIlMkFcIik7XG59XG5leHBvcnQgZnVuY3Rpb24gZXNjYXBlVXJpU3RyaW5nKHMpIHtcbiAgICByZXR1cm4gZW5jb2RlVVJJKHMpO1xufVxuLy8gSUNvbGxlY3Rpb24uQ2xlYXIgYW5kIENvdW50IG1lbWJlcnMgY2FuIGJlIGNhbGxlZCBvbiBBcnJheXNcbi8vIG9yIERpY3Rpb25hcmllcyBzbyB3ZSBuZWVkIGEgcnVudGltZSBjaGVjayAoc2VlICMxMTIwKVxuZXhwb3J0IGZ1bmN0aW9uIGNvdW50KGNvbCkge1xuICAgIGlmIChpc0FycmF5TGlrZShjb2wpKSB7XG4gICAgICAgIHJldHVybiBjb2wubGVuZ3RoO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgbGV0IGNvdW50ID0gMDtcbiAgICAgICAgZm9yIChjb25zdCBfIG9mIGNvbCkge1xuICAgICAgICAgICAgY291bnQrKztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY291bnQ7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGNsZWFyKGNvbCkge1xuICAgIGlmIChpc0FycmF5TGlrZShjb2wpKSB7XG4gICAgICAgIGNvbC5zcGxpY2UoMCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjb2wuY2xlYXIoKTtcbiAgICB9XG59XG5jb25zdCBjdXJyaWVkID0gbmV3IFdlYWtNYXAoKTtcbmV4cG9ydCBmdW5jdGlvbiB1bmN1cnJ5MihmKSB7XG4gICAgaWYgKGYgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZjIgPSAoYTEsIGEyKSA9PiBmKGExKShhMik7XG4gICAgY3VycmllZC5zZXQoZjIsIGYpO1xuICAgIHJldHVybiBmMjtcbn1cbmV4cG9ydCBmdW5jdGlvbiBjdXJyeTIoZikge1xuICAgIHJldHVybiBjdXJyaWVkLmdldChmKSA/PyAoKGExKSA9PiAoYTIpID0+IGYoYTEsIGEyKSk7XG59XG5leHBvcnQgZnVuY3Rpb24gdW5jdXJyeTMoZikge1xuICAgIGlmIChmID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGYyID0gKGExLCBhMiwgYTMpID0+IGYoYTEpKGEyKShhMyk7XG4gICAgY3VycmllZC5zZXQoZjIsIGYpO1xuICAgIHJldHVybiBmMjtcbn1cbmV4cG9ydCBmdW5jdGlvbiBjdXJyeTMoZikge1xuICAgIHJldHVybiBjdXJyaWVkLmdldChmKVxuICAgICAgICA/PyAoKGExKSA9PiAoYTIpID0+IChhMykgPT4gZihhMSwgYTIsIGEzKSk7XG59XG5leHBvcnQgZnVuY3Rpb24gdW5jdXJyeTQoZikge1xuICAgIGlmIChmID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGYyID0gKGExLCBhMiwgYTMsIGE0KSA9PiBmKGExKShhMikoYTMpKGE0KTtcbiAgICBjdXJyaWVkLnNldChmMiwgZik7XG4gICAgcmV0dXJuIGYyO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGN1cnJ5NChmKSB7XG4gICAgcmV0dXJuIGN1cnJpZWQuZ2V0KGYpXG4gICAgICAgID8/ICgoYTEpID0+IChhMikgPT4gKGEzKSA9PiAoYTQpID0+IGYoYTEsIGEyLCBhMywgYTQpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB1bmN1cnJ5NShmKSB7XG4gICAgaWYgKGYgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZjIgPSAoYTEsIGEyLCBhMywgYTQsIGE1KSA9PiBmKGExKShhMikoYTMpKGE0KShhNSk7XG4gICAgY3VycmllZC5zZXQoZjIsIGYpO1xuICAgIHJldHVybiBmMjtcbn1cbmV4cG9ydCBmdW5jdGlvbiBjdXJyeTUoZikge1xuICAgIHJldHVybiBjdXJyaWVkLmdldChmKVxuICAgICAgICA/PyAoKGExKSA9PiAoYTIpID0+IChhMykgPT4gKGE0KSA9PiAoYTUpID0+IGYoYTEsIGEyLCBhMywgYTQsIGE1KSk7XG59XG5leHBvcnQgZnVuY3Rpb24gdW5jdXJyeTYoZikge1xuICAgIGlmIChmID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGYyID0gKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYpID0+IGYoYTEpKGEyKShhMykoYTQpKGE1KShhNik7XG4gICAgY3VycmllZC5zZXQoZjIsIGYpO1xuICAgIHJldHVybiBmMjtcbn1cbmV4cG9ydCBmdW5jdGlvbiBjdXJyeTYoZikge1xuICAgIHJldHVybiBjdXJyaWVkLmdldChmKVxuICAgICAgICA/PyAoKGExKSA9PiAoYTIpID0+IChhMykgPT4gKGE0KSA9PiAoYTUpID0+IChhNikgPT4gZihhMSwgYTIsIGEzLCBhNCwgYTUsIGE2KSk7XG59XG5leHBvcnQgZnVuY3Rpb24gdW5jdXJyeTcoZikge1xuICAgIGlmIChmID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGYyID0gKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3KSA9PiBmKGExKShhMikoYTMpKGE0KShhNSkoYTYpKGE3KTtcbiAgICBjdXJyaWVkLnNldChmMiwgZik7XG4gICAgcmV0dXJuIGYyO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGN1cnJ5NyhmKSB7XG4gICAgcmV0dXJuIGN1cnJpZWQuZ2V0KGYpXG4gICAgICAgID8/ICgoYTEpID0+IChhMikgPT4gKGEzKSA9PiAoYTQpID0+IChhNSkgPT4gKGE2KSA9PiAoYTcpID0+IGYoYTEsIGEyLCBhMywgYTQsIGE1LCBhNiwgYTcpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB1bmN1cnJ5OChmKSB7XG4gICAgaWYgKGYgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZjIgPSAoYTEsIGEyLCBhMywgYTQsIGE1LCBhNiwgYTcsIGE4KSA9PiBmKGExKShhMikoYTMpKGE0KShhNSkoYTYpKGE3KShhOCk7XG4gICAgY3VycmllZC5zZXQoZjIsIGYpO1xuICAgIHJldHVybiBmMjtcbn1cbmV4cG9ydCBmdW5jdGlvbiBjdXJyeTgoZikge1xuICAgIHJldHVybiBjdXJyaWVkLmdldChmKVxuICAgICAgICA/PyAoKGExKSA9PiAoYTIpID0+IChhMykgPT4gKGE0KSA9PiAoYTUpID0+IChhNikgPT4gKGE3KSA9PiAoYTgpID0+IGYoYTEsIGEyLCBhMywgYTQsIGE1LCBhNiwgYTcsIGE4KSk7XG59XG5leHBvcnQgZnVuY3Rpb24gdW5jdXJyeTkoZikge1xuICAgIGlmIChmID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGYyID0gKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTkpID0+IGYoYTEpKGEyKShhMykoYTQpKGE1KShhNikoYTcpKGE4KShhOSk7XG4gICAgY3VycmllZC5zZXQoZjIsIGYpO1xuICAgIHJldHVybiBmMjtcbn1cbmV4cG9ydCBmdW5jdGlvbiBjdXJyeTkoZikge1xuICAgIHJldHVybiBjdXJyaWVkLmdldChmKVxuICAgICAgICA/PyAoKGExKSA9PiAoYTIpID0+IChhMykgPT4gKGE0KSA9PiAoYTUpID0+IChhNikgPT4gKGE3KSA9PiAoYTgpID0+IChhOSkgPT4gZihhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgsIGE5KSk7XG59XG5leHBvcnQgZnVuY3Rpb24gdW5jdXJyeTEwKGYpIHtcbiAgICBpZiAoZiA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBmMiA9IChhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgsIGE5LCBhMTApID0+IGYoYTEpKGEyKShhMykoYTQpKGE1KShhNikoYTcpKGE4KShhOSkoYTEwKTtcbiAgICBjdXJyaWVkLnNldChmMiwgZik7XG4gICAgcmV0dXJuIGYyO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGN1cnJ5MTAoZikge1xuICAgIHJldHVybiBjdXJyaWVkLmdldChmKVxuICAgICAgICA/PyAoKGExKSA9PiAoYTIpID0+IChhMykgPT4gKGE0KSA9PiAoYTUpID0+IChhNikgPT4gKGE3KSA9PiAoYTgpID0+IChhOSkgPT4gKGExMCkgPT4gZihhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgsIGE5LCBhMTApKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB1bmN1cnJ5MTEoZikge1xuICAgIGlmIChmID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGYyID0gKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTksIGExMCwgYTExKSA9PiBmKGExKShhMikoYTMpKGE0KShhNSkoYTYpKGE3KShhOCkoYTkpKGExMCkoYTExKTtcbiAgICBjdXJyaWVkLnNldChmMiwgZik7XG4gICAgcmV0dXJuIGYyO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGN1cnJ5MTEoZikge1xuICAgIHJldHVybiBjdXJyaWVkLmdldChmKVxuICAgICAgICA/PyAoKGExKSA9PiAoYTIpID0+IChhMykgPT4gKGE0KSA9PiAoYTUpID0+IChhNikgPT4gKGE3KSA9PiAoYTgpID0+IChhOSkgPT4gKGExMCkgPT4gKGExMSkgPT4gZihhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgsIGE5LCBhMTAsIGExMSkpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHVuY3VycnkxMihmKSB7XG4gICAgaWYgKGYgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZjIgPSAoYTEsIGEyLCBhMywgYTQsIGE1LCBhNiwgYTcsIGE4LCBhOSwgYTEwLCBhMTEsIGExMikgPT4gZihhMSkoYTIpKGEzKShhNCkoYTUpKGE2KShhNykoYTgpKGE5KShhMTApKGExMSkoYTEyKTtcbiAgICBjdXJyaWVkLnNldChmMiwgZik7XG4gICAgcmV0dXJuIGYyO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGN1cnJ5MTIoZikge1xuICAgIHJldHVybiBjdXJyaWVkLmdldChmKVxuICAgICAgICA/PyAoKGExKSA9PiAoYTIpID0+IChhMykgPT4gKGE0KSA9PiAoYTUpID0+IChhNikgPT4gKGE3KSA9PiAoYTgpID0+IChhOSkgPT4gKGExMCkgPT4gKGExMSkgPT4gKGExMikgPT4gZihhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgsIGE5LCBhMTAsIGExMSwgYTEyKSk7XG59XG5leHBvcnQgZnVuY3Rpb24gdW5jdXJyeTEzKGYpIHtcbiAgICBpZiAoZiA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBmMiA9IChhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgsIGE5LCBhMTAsIGExMSwgYTEyLCBhMTMpID0+IGYoYTEpKGEyKShhMykoYTQpKGE1KShhNikoYTcpKGE4KShhOSkoYTEwKShhMTEpKGExMikoYTEzKTtcbiAgICBjdXJyaWVkLnNldChmMiwgZik7XG4gICAgcmV0dXJuIGYyO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGN1cnJ5MTMoZikge1xuICAgIHJldHVybiBjdXJyaWVkLmdldChmKVxuICAgICAgICA/PyAoKGExKSA9PiAoYTIpID0+IChhMykgPT4gKGE0KSA9PiAoYTUpID0+IChhNikgPT4gKGE3KSA9PiAoYTgpID0+IChhOSkgPT4gKGExMCkgPT4gKGExMSkgPT4gKGExMikgPT4gKGExMykgPT4gZihhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgsIGE5LCBhMTAsIGExMSwgYTEyLCBhMTMpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB1bmN1cnJ5MTQoZikge1xuICAgIGlmIChmID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGYyID0gKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTksIGExMCwgYTExLCBhMTIsIGExMywgYTE0KSA9PiBmKGExKShhMikoYTMpKGE0KShhNSkoYTYpKGE3KShhOCkoYTkpKGExMCkoYTExKShhMTIpKGExMykoYTE0KTtcbiAgICBjdXJyaWVkLnNldChmMiwgZik7XG4gICAgcmV0dXJuIGYyO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGN1cnJ5MTQoZikge1xuICAgIHJldHVybiBjdXJyaWVkLmdldChmKVxuICAgICAgICA/PyAoKGExKSA9PiAoYTIpID0+IChhMykgPT4gKGE0KSA9PiAoYTUpID0+IChhNikgPT4gKGE3KSA9PiAoYTgpID0+IChhOSkgPT4gKGExMCkgPT4gKGExMSkgPT4gKGExMikgPT4gKGExMykgPT4gKGExNCkgPT4gZihhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgsIGE5LCBhMTAsIGExMSwgYTEyLCBhMTMsIGExNCkpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHVuY3VycnkxNShmKSB7XG4gICAgaWYgKGYgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZjIgPSAoYTEsIGEyLCBhMywgYTQsIGE1LCBhNiwgYTcsIGE4LCBhOSwgYTEwLCBhMTEsIGExMiwgYTEzLCBhMTQsIGExNSkgPT4gZihhMSkoYTIpKGEzKShhNCkoYTUpKGE2KShhNykoYTgpKGE5KShhMTApKGExMSkoYTEyKShhMTMpKGExNCkoYTE1KTtcbiAgICBjdXJyaWVkLnNldChmMiwgZik7XG4gICAgcmV0dXJuIGYyO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGN1cnJ5MTUoZikge1xuICAgIHJldHVybiBjdXJyaWVkLmdldChmKVxuICAgICAgICA/PyAoKGExKSA9PiAoYTIpID0+IChhMykgPT4gKGE0KSA9PiAoYTUpID0+IChhNikgPT4gKGE3KSA9PiAoYTgpID0+IChhOSkgPT4gKGExMCkgPT4gKGExMSkgPT4gKGExMikgPT4gKGExMykgPT4gKGExNCkgPT4gKGExNSkgPT4gZihhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgsIGE5LCBhMTAsIGExMSwgYTEyLCBhMTMsIGExNCwgYTE1KSk7XG59XG5leHBvcnQgZnVuY3Rpb24gdW5jdXJyeTE2KGYpIHtcbiAgICBpZiAoZiA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBmMiA9IChhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgsIGE5LCBhMTAsIGExMSwgYTEyLCBhMTMsIGExNCwgYTE1LCBhMTYpID0+IGYoYTEpKGEyKShhMykoYTQpKGE1KShhNikoYTcpKGE4KShhOSkoYTEwKShhMTEpKGExMikoYTEzKShhMTQpKGExNSkoYTE2KTtcbiAgICBjdXJyaWVkLnNldChmMiwgZik7XG4gICAgcmV0dXJuIGYyO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGN1cnJ5MTYoZikge1xuICAgIHJldHVybiBjdXJyaWVkLmdldChmKVxuICAgICAgICA/PyAoKGExKSA9PiAoYTIpID0+IChhMykgPT4gKGE0KSA9PiAoYTUpID0+IChhNikgPT4gKGE3KSA9PiAoYTgpID0+IChhOSkgPT4gKGExMCkgPT4gKGExMSkgPT4gKGExMikgPT4gKGExMykgPT4gKGExNCkgPT4gKGExNSkgPT4gKGExNikgPT4gZihhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgsIGE5LCBhMTAsIGExMSwgYTEyLCBhMTMsIGExNCwgYTE1LCBhMTYpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB1bmN1cnJ5MTcoZikge1xuICAgIGlmIChmID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGYyID0gKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTksIGExMCwgYTExLCBhMTIsIGExMywgYTE0LCBhMTUsIGExNiwgYTE3KSA9PiBmKGExKShhMikoYTMpKGE0KShhNSkoYTYpKGE3KShhOCkoYTkpKGExMCkoYTExKShhMTIpKGExMykoYTE0KShhMTUpKGExNikoYTE3KTtcbiAgICBjdXJyaWVkLnNldChmMiwgZik7XG4gICAgcmV0dXJuIGYyO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGN1cnJ5MTcoZikge1xuICAgIHJldHVybiBjdXJyaWVkLmdldChmKVxuICAgICAgICA/PyAoKGExKSA9PiAoYTIpID0+IChhMykgPT4gKGE0KSA9PiAoYTUpID0+IChhNikgPT4gKGE3KSA9PiAoYTgpID0+IChhOSkgPT4gKGExMCkgPT4gKGExMSkgPT4gKGExMikgPT4gKGExMykgPT4gKGExNCkgPT4gKGExNSkgPT4gKGExNikgPT4gKGExNykgPT4gZihhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgsIGE5LCBhMTAsIGExMSwgYTEyLCBhMTMsIGExNCwgYTE1LCBhMTYsIGExNykpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHVuY3VycnkxOChmKSB7XG4gICAgaWYgKGYgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZjIgPSAoYTEsIGEyLCBhMywgYTQsIGE1LCBhNiwgYTcsIGE4LCBhOSwgYTEwLCBhMTEsIGExMiwgYTEzLCBhMTQsIGExNSwgYTE2LCBhMTcsIGExOCkgPT4gZihhMSkoYTIpKGEzKShhNCkoYTUpKGE2KShhNykoYTgpKGE5KShhMTApKGExMSkoYTEyKShhMTMpKGExNCkoYTE1KShhMTYpKGExNykoYTE4KTtcbiAgICBjdXJyaWVkLnNldChmMiwgZik7XG4gICAgcmV0dXJuIGYyO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGN1cnJ5MTgoZikge1xuICAgIHJldHVybiBjdXJyaWVkLmdldChmKVxuICAgICAgICA/PyAoKGExKSA9PiAoYTIpID0+IChhMykgPT4gKGE0KSA9PiAoYTUpID0+IChhNikgPT4gKGE3KSA9PiAoYTgpID0+IChhOSkgPT4gKGExMCkgPT4gKGExMSkgPT4gKGExMikgPT4gKGExMykgPT4gKGExNCkgPT4gKGExNSkgPT4gKGExNikgPT4gKGExNykgPT4gKGExOCkgPT4gZihhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgsIGE5LCBhMTAsIGExMSwgYTEyLCBhMTMsIGExNCwgYTE1LCBhMTYsIGExNywgYTE4KSk7XG59XG5leHBvcnQgZnVuY3Rpb24gdW5jdXJyeTE5KGYpIHtcbiAgICBpZiAoZiA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBmMiA9IChhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgsIGE5LCBhMTAsIGExMSwgYTEyLCBhMTMsIGExNCwgYTE1LCBhMTYsIGExNywgYTE4LCBhMTkpID0+IGYoYTEpKGEyKShhMykoYTQpKGE1KShhNikoYTcpKGE4KShhOSkoYTEwKShhMTEpKGExMikoYTEzKShhMTQpKGExNSkoYTE2KShhMTcpKGExOCkoYTE5KTtcbiAgICBjdXJyaWVkLnNldChmMiwgZik7XG4gICAgcmV0dXJuIGYyO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGN1cnJ5MTkoZikge1xuICAgIHJldHVybiBjdXJyaWVkLmdldChmKVxuICAgICAgICA/PyAoKGExKSA9PiAoYTIpID0+IChhMykgPT4gKGE0KSA9PiAoYTUpID0+IChhNikgPT4gKGE3KSA9PiAoYTgpID0+IChhOSkgPT4gKGExMCkgPT4gKGExMSkgPT4gKGExMikgPT4gKGExMykgPT4gKGExNCkgPT4gKGExNSkgPT4gKGExNikgPT4gKGExNykgPT4gKGExOCkgPT4gKGExOSkgPT4gZihhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgsIGE5LCBhMTAsIGExMSwgYTEyLCBhMTMsIGExNCwgYTE1LCBhMTYsIGExNywgYTE4LCBhMTkpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB1bmN1cnJ5MjAoZikge1xuICAgIGlmIChmID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGYyID0gKGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTksIGExMCwgYTExLCBhMTIsIGExMywgYTE0LCBhMTUsIGExNiwgYTE3LCBhMTgsIGExOSwgYTIwKSA9PiBmKGExKShhMikoYTMpKGE0KShhNSkoYTYpKGE3KShhOCkoYTkpKGExMCkoYTExKShhMTIpKGExMykoYTE0KShhMTUpKGExNikoYTE3KShhMTgpKGExOSkoYTIwKTtcbiAgICBjdXJyaWVkLnNldChmMiwgZik7XG4gICAgcmV0dXJuIGYyO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGN1cnJ5MjAoZikge1xuICAgIHJldHVybiBjdXJyaWVkLmdldChmKVxuICAgICAgICA/PyAoKGExKSA9PiAoYTIpID0+IChhMykgPT4gKGE0KSA9PiAoYTUpID0+IChhNikgPT4gKGE3KSA9PiAoYTgpID0+IChhOSkgPT4gKGExMCkgPT4gKGExMSkgPT4gKGExMikgPT4gKGExMykgPT4gKGExNCkgPT4gKGExNSkgPT4gKGExNikgPT4gKGExNykgPT4gKGExOCkgPT4gKGExOSkgPT4gKGEyMCkgPT4gZihhMSwgYTIsIGEzLCBhNCwgYTUsIGE2LCBhNywgYTgsIGE5LCBhMTAsIGExMSwgYTEyLCBhMTMsIGExNCwgYTE1LCBhMTYsIGExNywgYTE4LCBhMTksIGEyMCkpO1xufVxuLy8gTW9yZSBwZXJmb3JtYW50IG1ldGhvZCB0byBjb3B5IGFycmF5cywgc2VlICMyMzUyXG5leHBvcnQgZnVuY3Rpb24gY29weVRvQXJyYXkoc291cmNlLCBzb3VyY2VJbmRleCwgdGFyZ2V0LCB0YXJnZXRJbmRleCwgY291bnQpIHtcbiAgICBpZiAoQXJyYXlCdWZmZXIuaXNWaWV3KHNvdXJjZSkgJiYgQXJyYXlCdWZmZXIuaXNWaWV3KHRhcmdldCkpIHtcbiAgICAgICAgdGFyZ2V0LnNldChzb3VyY2Uuc3ViYXJyYXkoc291cmNlSW5kZXgsIHNvdXJjZUluZGV4ICsgY291bnQpLCB0YXJnZXRJbmRleCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyArK2kpIHtcbiAgICAgICAgICAgIHRhcmdldFt0YXJnZXRJbmRleCArIGldID0gc291cmNlW3NvdXJjZUluZGV4ICsgaV07XG4gICAgICAgIH1cbiAgICB9XG59XG4iLAogICJpbXBvcnQgeyBjb21iaW5lSGFzaENvZGVzLCBjb21wYXJlLCBjb21wYXJlQXJyYXlzLCBlcXVhbEFycmF5cywgZXF1YWxzLCBzYW1lQ29uc3RydWN0b3IsIG51bWJlckhhc2gsIHN0cnVjdHVyYWxIYXNoIH0gZnJvbSBcIi4vVXRpbC5qc1wiO1xuZXhwb3J0IGZ1bmN0aW9uIHNlcVRvU3RyaW5nKHNlbGYpIHtcbiAgICBsZXQgY291bnQgPSAwO1xuICAgIGxldCBzdHIgPSBcIltcIjtcbiAgICBmb3IgKGNvbnN0IHggb2Ygc2VsZikge1xuICAgICAgICBpZiAoY291bnQgPT09IDApIHtcbiAgICAgICAgICAgIHN0ciArPSB0b1N0cmluZyh4KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb3VudCA9PT0gMTAwKSB7XG4gICAgICAgICAgICBzdHIgKz0gXCI7IC4uLlwiO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzdHIgKz0gXCI7IFwiICsgdG9TdHJpbmcoeCk7XG4gICAgICAgIH1cbiAgICAgICAgY291bnQrKztcbiAgICB9XG4gICAgcmV0dXJuIHN0ciArIFwiXVwiO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvU3RyaW5nKHgsIGNhbGxTdGFjayA9IDApIHtcbiAgICBpZiAoeCAhPSBudWxsICYmIHR5cGVvZiB4ID09PSBcIm9iamVjdFwiKSB7XG4gICAgICAgIGlmICh0eXBlb2YgeC50b1N0cmluZyA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICByZXR1cm4geC50b1N0cmluZygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKFN5bWJvbC5pdGVyYXRvciBpbiB4KSB7XG4gICAgICAgICAgICByZXR1cm4gc2VxVG9TdHJpbmcoeCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7IC8vIFRPRE86IERhdGU/XG4gICAgICAgICAgICBjb25zdCBjb25zID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHgpPy5jb25zdHJ1Y3RvcjtcbiAgICAgICAgICAgIHJldHVybiBjb25zID09PSBPYmplY3QgJiYgY2FsbFN0YWNrIDwgMTBcbiAgICAgICAgICAgICAgICAvLyBTYW1lIGZvcm1hdCBhcyByZWNvcmRUb1N0cmluZ1xuICAgICAgICAgICAgICAgID8gXCJ7IFwiICsgT2JqZWN0LmVudHJpZXMoeCkubWFwKChbaywgdl0pID0+IGsgKyBcIiA9IFwiICsgdG9TdHJpbmcodiwgY2FsbFN0YWNrICsgMSkpLmpvaW4oXCJcXG4gIFwiKSArIFwiIH1cIlxuICAgICAgICAgICAgICAgIDogY29ucz8ubmFtZSA/PyBcIlwiO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBTdHJpbmcoeCk7XG59XG5leHBvcnQgZnVuY3Rpb24gdW5pb25Ub1N0cmluZyhuYW1lLCBmaWVsZHMpIHtcbiAgICBpZiAoZmllbGRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gbmFtZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGxldCBmaWVsZFN0cjtcbiAgICAgICAgbGV0IHdpdGhQYXJlbnMgPSB0cnVlO1xuICAgICAgICBpZiAoZmllbGRzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgZmllbGRTdHIgPSB0b1N0cmluZyhmaWVsZHNbMF0pO1xuICAgICAgICAgICAgd2l0aFBhcmVucyA9IGZpZWxkU3RyLmluZGV4T2YoXCIgXCIpID49IDA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBmaWVsZFN0ciA9IGZpZWxkcy5tYXAoKHgpID0+IHRvU3RyaW5nKHgpKS5qb2luKFwiLCBcIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5hbWUgKyAod2l0aFBhcmVucyA/IFwiIChcIiA6IFwiIFwiKSArIGZpZWxkU3RyICsgKHdpdGhQYXJlbnMgPyBcIilcIiA6IFwiXCIpO1xuICAgIH1cbn1cbmV4cG9ydCBjbGFzcyBVbmlvbiB7XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNhc2VzKClbdGhpcy50YWddO1xuICAgIH1cbiAgICB0b0pTT04oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZpZWxkcy5sZW5ndGggPT09IDAgPyB0aGlzLm5hbWUgOiBbdGhpcy5uYW1lXS5jb25jYXQodGhpcy5maWVsZHMpO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIHVuaW9uVG9TdHJpbmcodGhpcy5uYW1lLCB0aGlzLmZpZWxkcyk7XG4gICAgfVxuICAgIEdldEhhc2hDb2RlKCkge1xuICAgICAgICBjb25zdCBoYXNoZXMgPSB0aGlzLmZpZWxkcy5tYXAoKHgpID0+IHN0cnVjdHVyYWxIYXNoKHgpKTtcbiAgICAgICAgaGFzaGVzLnNwbGljZSgwLCAwLCBudW1iZXJIYXNoKHRoaXMudGFnKSk7XG4gICAgICAgIHJldHVybiBjb21iaW5lSGFzaENvZGVzKGhhc2hlcyk7XG4gICAgfVxuICAgIEVxdWFscyhvdGhlcikge1xuICAgICAgICBpZiAodGhpcyA9PT0gb3RoZXIpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCFzYW1lQ29uc3RydWN0b3IodGhpcywgb3RoZXIpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy50YWcgPT09IG90aGVyLnRhZykge1xuICAgICAgICAgICAgcmV0dXJuIGVxdWFsQXJyYXlzKHRoaXMuZmllbGRzLCBvdGhlci5maWVsZHMpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIENvbXBhcmVUbyhvdGhlcikge1xuICAgICAgICBpZiAodGhpcyA9PT0gb3RoZXIpIHtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCFzYW1lQ29uc3RydWN0b3IodGhpcywgb3RoZXIpKSB7XG4gICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy50YWcgPT09IG90aGVyLnRhZykge1xuICAgICAgICAgICAgcmV0dXJuIGNvbXBhcmVBcnJheXModGhpcy5maWVsZHMsIG90aGVyLmZpZWxkcyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy50YWcgPCBvdGhlci50YWcgPyAtMSA6IDE7XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiByZWNvcmRUb0pTT04oc2VsZikge1xuICAgIGNvbnN0IG8gPSB7fTtcbiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoc2VsZik7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIG9ba2V5c1tpXV0gPSBzZWxmW2tleXNbaV1dO1xuICAgIH1cbiAgICByZXR1cm4gbztcbn1cbmZ1bmN0aW9uIHJlY29yZFRvU3RyaW5nKHNlbGYpIHtcbiAgICByZXR1cm4gXCJ7IFwiICsgT2JqZWN0LmVudHJpZXMoc2VsZikubWFwKChbaywgdl0pID0+IGsgKyBcIiA9IFwiICsgdG9TdHJpbmcodikpLmpvaW4oXCJcXG4gIFwiKSArIFwiIH1cIjtcbn1cbmZ1bmN0aW9uIHJlY29yZEdldEhhc2hDb2RlKHNlbGYpIHtcbiAgICBjb25zdCBoYXNoZXMgPSBPYmplY3QudmFsdWVzKHNlbGYpLm1hcCgodikgPT4gc3RydWN0dXJhbEhhc2godikpO1xuICAgIHJldHVybiBjb21iaW5lSGFzaENvZGVzKGhhc2hlcyk7XG59XG5mdW5jdGlvbiByZWNvcmRFcXVhbHMoc2VsZiwgb3RoZXIpIHtcbiAgICBpZiAoc2VsZiA9PT0gb3RoZXIpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGVsc2UgaWYgKCFzYW1lQ29uc3RydWN0b3Ioc2VsZiwgb3RoZXIpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IHRoaXNOYW1lcyA9IE9iamVjdC5rZXlzKHNlbGYpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXNOYW1lcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKCFlcXVhbHMoc2VsZlt0aGlzTmFtZXNbaV1dLCBvdGhlclt0aGlzTmFtZXNbaV1dKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG59XG5mdW5jdGlvbiByZWNvcmRDb21wYXJlVG8oc2VsZiwgb3RoZXIpIHtcbiAgICBpZiAoc2VsZiA9PT0gb3RoZXIpIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIGVsc2UgaWYgKCFzYW1lQ29uc3RydWN0b3Ioc2VsZiwgb3RoZXIpKSB7XG4gICAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IHRoaXNOYW1lcyA9IE9iamVjdC5rZXlzKHNlbGYpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXNOYW1lcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gY29tcGFyZShzZWxmW3RoaXNOYW1lc1tpXV0sIG90aGVyW3RoaXNOYW1lc1tpXV0pO1xuICAgICAgICAgICAgaWYgKHJlc3VsdCAhPT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIFJlY29yZCB7XG4gICAgdG9KU09OKCkgeyByZXR1cm4gcmVjb3JkVG9KU09OKHRoaXMpOyB9XG4gICAgdG9TdHJpbmcoKSB7IHJldHVybiByZWNvcmRUb1N0cmluZyh0aGlzKTsgfVxuICAgIEdldEhhc2hDb2RlKCkgeyByZXR1cm4gcmVjb3JkR2V0SGFzaENvZGUodGhpcyk7IH1cbiAgICBFcXVhbHMob3RoZXIpIHsgcmV0dXJuIHJlY29yZEVxdWFscyh0aGlzLCBvdGhlcik7IH1cbiAgICBDb21wYXJlVG8ob3RoZXIpIHsgcmV0dXJuIHJlY29yZENvbXBhcmVUbyh0aGlzLCBvdGhlcik7IH1cbn1cbmV4cG9ydCBjbGFzcyBGU2hhcnBSZWYge1xuICAgIGdldCBjb250ZW50cygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0dGVyKCk7XG4gICAgfVxuICAgIHNldCBjb250ZW50cyh2KSB7XG4gICAgICAgIHRoaXMuc2V0dGVyKHYpO1xuICAgIH1cbiAgICBjb25zdHJ1Y3Rvcihjb250ZW50c09yR2V0dGVyLCBzZXR0ZXIpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBzZXR0ZXIgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgdGhpcy5nZXR0ZXIgPSBjb250ZW50c09yR2V0dGVyO1xuICAgICAgICAgICAgdGhpcy5zZXR0ZXIgPSBzZXR0ZXI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmdldHRlciA9ICgpID0+IGNvbnRlbnRzT3JHZXR0ZXI7XG4gICAgICAgICAgICB0aGlzLnNldHRlciA9ICh2KSA9PiB7IGNvbnRlbnRzT3JHZXR0ZXIgPSB2OyB9O1xuICAgICAgICB9XG4gICAgfVxufVxuLy8gRVhDRVBUSU9OU1xuLy8gRXhjZXB0aW9uIGlzIGludGVudGlvbmFsbHkgbm90IGRlcml2ZWQgZnJvbSBFcnJvciwgZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnMgKHNlZSAjMjE2MClcbmV4cG9ydCBjbGFzcyBFeGNlcHRpb24ge1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UpIHtcbiAgICAgICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gaXNFeGNlcHRpb24oeCkge1xuICAgIHJldHVybiB4IGluc3RhbmNlb2YgRXhjZXB0aW9uIHx8IHggaW5zdGFuY2VvZiBFcnJvcjtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpc1Byb21pc2UoeCkge1xuICAgIHJldHVybiB4IGluc3RhbmNlb2YgUHJvbWlzZTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBlbnN1cmVFcnJvck9yRXhjZXB0aW9uKGUpIHtcbiAgICAvLyBFeGNlcHRpb25hbGx5IGFkbWl0dGluZyBwcm9taXNlcyBhcyBlcnJvcnMgZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBSZWFjdC5zdXNwZW5zZSAoc2VlICMzMjk4KVxuICAgIHJldHVybiAoaXNFeGNlcHRpb24oZSkgfHwgaXNQcm9taXNlKGUpKSA/IGUgOiBuZXcgRXJyb3IoU3RyaW5nKGUpKTtcbn1cbmV4cG9ydCBjbGFzcyBGU2hhcnBFeGNlcHRpb24gZXh0ZW5kcyBFeGNlcHRpb24ge1xuICAgIHRvSlNPTigpIHsgcmV0dXJuIHJlY29yZFRvSlNPTih0aGlzKTsgfVxuICAgIHRvU3RyaW5nKCkgeyByZXR1cm4gcmVjb3JkVG9TdHJpbmcodGhpcyk7IH1cbiAgICBHZXRIYXNoQ29kZSgpIHsgcmV0dXJuIHJlY29yZEdldEhhc2hDb2RlKHRoaXMpOyB9XG4gICAgRXF1YWxzKG90aGVyKSB7IHJldHVybiByZWNvcmRFcXVhbHModGhpcywgb3RoZXIpOyB9XG4gICAgQ29tcGFyZVRvKG90aGVyKSB7IHJldHVybiByZWNvcmRDb21wYXJlVG8odGhpcywgb3RoZXIpOyB9XG59XG5leHBvcnQgY2xhc3MgTWF0Y2hGYWlsdXJlRXhjZXB0aW9uIGV4dGVuZHMgRlNoYXJwRXhjZXB0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihhcmcxLCBhcmcyLCBhcmczKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuYXJnMSA9IGFyZzE7XG4gICAgICAgIHRoaXMuYXJnMiA9IGFyZzIgfCAwO1xuICAgICAgICB0aGlzLmFyZzMgPSBhcmczIHwgMDtcbiAgICAgICAgdGhpcy5tZXNzYWdlID0gXCJUaGUgbWF0Y2ggY2FzZXMgd2VyZSBpbmNvbXBsZXRlXCI7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIEF0dHJpYnV0ZSB7XG59XG4iLAogICIvKipcbiAqIERhdGVUaW1lT2Zmc2V0IGZ1bmN0aW9ucy5cbiAqXG4gKiBOb3RlOiBEYXRlIGluc3RhbmNlcyBhcmUgYWx3YXlzIERhdGVPYmplY3RzIGluIGxvY2FsXG4gKiB0aW1lem9uZSAoYmVjYXVzZSBKUyBkYXRlcyBhcmUgYWxsIGtpbmRzIG9mIG1lc3NlZCB1cCkuXG4gKiBBIGxvY2FsIGRhdGUgcmV0dXJucyBVVEMgZXBvY2ggd2hlbiBgLmdldFRpbWUoKWAgaXMgY2FsbGVkLlxuICpcbiAqIEJhc2ljYWxseTsgaW52YXJpYW50OiBkYXRlLmdldFRpbWUoKSBhbHdheXMgcmV0dXJuIFVUQyB0aW1lLlxuICovXG5pbXBvcnQgeyB0b0ludDY0LCB0b0Zsb2F0NjQgfSBmcm9tIFwiLi9CaWdJbnQuanNcIjtcbmltcG9ydCB7IGNvbXBhcmVEYXRlcywgZGF0ZU9mZnNldCwgcGFkV2l0aFplcm9zIH0gZnJvbSBcIi4vVXRpbC5qc1wiO1xuY29uc3Qgc2hvcnREYXlzID0gW1xuICAgIFwiU3VuXCIsIFwiTW9uXCIsIFwiVHVlXCIsIFwiV2VkXCIsIFwiVGh1XCIsIFwiRnJpXCIsIFwiU2F0XCJcbl07XG5jb25zdCBsb25nRGF5cyA9IFtcbiAgICBcIlN1bmRheVwiLCBcIk1vbmRheVwiLCBcIlR1ZXNkYXlcIiwgXCJXZWRuZXNkYXlcIiwgXCJUaHVyc2RheVwiLCBcIkZyaWRheVwiLCBcIlNhdHVyZGF5XCJcbl07XG5jb25zdCBzaG9ydE1vbnRocyA9IFtcbiAgICBcIkphblwiLCBcIkZlYlwiLCBcIk1hclwiLCBcIkFwclwiLCBcIk1heVwiLCBcIkp1blwiLCBcIkp1bFwiLCBcIkF1Z1wiLCBcIlNlcFwiLCBcIk9jdFwiLCBcIk5vdlwiLCBcIkRlY1wiXG5dO1xuY29uc3QgbG9uZ01vbnRocyA9IFtcbiAgICBcIkphbnVhcnlcIiwgXCJGZWJydWFyeVwiLCBcIk1hcmNoXCIsIFwiQXByaWxcIiwgXCJNYXlcIiwgXCJKdW5lXCIsIFwiSnVseVwiLCBcIkF1Z3VzdFwiLCBcIlNlcHRlbWJlclwiLCBcIk9jdG9iZXJcIiwgXCJOb3ZlbWJlclwiLCBcIkRlY2VtYmVyXCJcbl07XG5mdW5jdGlvbiBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgcG9zLCBwYXR0ZXJuQ2hhcikge1xuICAgIGxldCB0b2tlbkxlbmd0aCA9IDA7XG4gICAgbGV0IGludGVybmFsUG9zID0gcG9zO1xuICAgIHdoaWxlIChpbnRlcm5hbFBvcyA8IGZvcm1hdC5sZW5ndGggJiYgZm9ybWF0W2ludGVybmFsUG9zXSA9PT0gcGF0dGVybkNoYXIpIHtcbiAgICAgICAgaW50ZXJuYWxQb3MrKztcbiAgICAgICAgdG9rZW5MZW5ndGgrKztcbiAgICB9XG4gICAgcmV0dXJuIHRva2VuTGVuZ3RoO1xufVxuZnVuY3Rpb24gcGFyc2VOZXh0Q2hhcihmb3JtYXQsIHBvcykge1xuICAgIGlmIChwb3MgPj0gZm9ybWF0Lmxlbmd0aCAtIDEpIHtcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIH1cbiAgICByZXR1cm4gZm9ybWF0LmNoYXJDb2RlQXQocG9zICsgMSk7XG59XG5mdW5jdGlvbiBwYXJzZVF1b3RlZFN0cmluZyhmb3JtYXQsIHBvcykge1xuICAgIGxldCBiZWdpblBvcyA9IHBvcztcbiAgICAvLyBHZXQgdGhlIGNoYXJhY3RlciB1c2VkIHRvIHF1b3RlIHRoZSBzdHJpbmdcbiAgICBjb25zdCBxdW90ZUNoYXIgPSBmb3JtYXRbcG9zXTtcbiAgICBsZXQgcmVzdWx0ID0gXCJcIjtcbiAgICBsZXQgZm91bmRRdW90ZSA9IGZhbHNlO1xuICAgIHdoaWxlIChwb3MgPCBmb3JtYXQubGVuZ3RoKSB7XG4gICAgICAgIHBvcysrO1xuICAgICAgICBjb25zdCBjdXJyZW50Q2hhciA9IGZvcm1hdFtwb3NdO1xuICAgICAgICBpZiAoY3VycmVudENoYXIgPT09IHF1b3RlQ2hhcikge1xuICAgICAgICAgICAgZm91bmRRdW90ZSA9IHRydWU7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjdXJyZW50Q2hhciA9PT0gXCJcXFxcXCIpIHtcbiAgICAgICAgICAgIGlmIChwb3MgPCBmb3JtYXQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcG9zKys7XG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IGZvcm1hdFtwb3NdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBtZWFucyB0aGF0ICdcXCcgaXMgdGhlIGxhc3QgY2hhcmFjdGVyIGluIHRoZSBzdHJpbmcuXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBzdHJpbmcgZm9ybWF0XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0ICs9IGN1cnJlbnRDaGFyO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmICghZm91bmRRdW90ZSkge1xuICAgICAgICAvLyBXZSBjb3VsZCBub3QgZmluZCB0aGUgbWF0Y2hpbmcgcXVvdGVcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHN0cmluZyBmb3JtYXQgY291bGQgbm90IGZpbmQgbWF0Y2hpbmcgcXVvdGUgZm9yICR7cXVvdGVDaGFyfWApO1xuICAgIH1cbiAgICByZXR1cm4gW3Jlc3VsdCwgcG9zIC0gYmVnaW5Qb3MgKyAxXTtcbn1cbmZ1bmN0aW9uIGRhdGVUb1N0cmluZ1dpdGhDdXN0b21Gb3JtYXQoZGF0ZSwgZm9ybWF0LCB1dGMpIHtcbiAgICBsZXQgY3Vyc29yUG9zID0gMDtcbiAgICBsZXQgdG9rZW5MZW5ndGggPSAwO1xuICAgIGxldCByZXN1bHQgPSBcIlwiO1xuICAgIGNvbnN0IGxvY2FsaXplZERhdGUgPSB1dGMgPyBEYXRlVGltZShkYXRlLmdldFRpbWUoKSwgMSAvKiBEYXRlS2luZC5VVEMgKi8pIDogZGF0ZTtcbiAgICB3aGlsZSAoY3Vyc29yUG9zIDwgZm9ybWF0Lmxlbmd0aCkge1xuICAgICAgICBjb25zdCB0b2tlbiA9IGZvcm1hdFtjdXJzb3JQb3NdO1xuICAgICAgICBzd2l0Y2ggKHRva2VuKSB7XG4gICAgICAgICAgICBjYXNlIFwiZFwiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJkXCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRva2VuTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBsb2NhbGl6ZWREYXRlLmdldERhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKGxvY2FsaXplZERhdGUuZ2V0RGF0ZSgpLCAyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gc2hvcnREYXlzW2RheU9mV2Vlayhsb2NhbGl6ZWREYXRlKV07XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGxvbmdEYXlzW2RheU9mV2Vlayhsb2NhbGl6ZWREYXRlKV07XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJmXCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcImZcIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmICh0b2tlbkxlbmd0aCA8PSAzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByZWNpc2lvbiA9IDEwICoqICgzIC0gdG9rZW5MZW5ndGgpO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKE1hdGguZmxvb3IobWlsbGlzZWNvbmQobG9jYWxpemVkRGF0ZSkgLyBwcmVjaXNpb24pLCB0b2tlbkxlbmd0aCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRva2VuTGVuZ3RoIDw9IDcpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSmF2YVNjcmlwdCBEYXRlIG9ubHkgc3VwcG9ydCBwcmVjaXNpb24gdG8gdGhlIG1pbGxpc2Vjb25kXG4gICAgICAgICAgICAgICAgICAgIC8vIHNvIHdlIGZpbGwgdGhlIHJlc3Qgb2YgdGhlIHByZWNpc2lvbiB3aXRoIDAgYXMgaWYgdGhlIGRhdGUgZGlkbid0IGhhdmVcbiAgICAgICAgICAgICAgICAgICAgLy8gbWlsbGlzZWNvbmRzIHByb3ZpZGVkIHRvIGl0LlxuICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIHRvIGhhdmUgdGhlIHNhbWUgYmVoYXZpb3IgYXMgLk5FVCB3aGVuIGRvaW5nOlxuICAgICAgICAgICAgICAgICAgICAvLyBEYXRlVGltZSgxLCAyLCAzLCA0LCA1LCA2LCBEYXRlVGltZUtpbmQuVXRjKS5Ub1N0cmluZyhcImZmZmZmXCIpID0+IDAwMDAwXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAoXCJcIiArIG1pbGxpc2Vjb25kKGxvY2FsaXplZERhdGUpKS5wYWRFbmQodG9rZW5MZW5ndGgsIFwiMFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiRlwiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJGXCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBpZiAodG9rZW5MZW5ndGggPD0gMykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcmVjaXNpb24gPSAxMCAqKiAoMyAtIHRva2VuTGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBNYXRoLmZsb29yKG1pbGxpc2Vjb25kKGxvY2FsaXplZERhdGUpIC8gcHJlY2lzaW9uKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3ModmFsdWUsIHRva2VuTGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0b2tlbkxlbmd0aCA8PSA3KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEphdmFTY3JpcHQgRGF0ZSBvbmx5IHN1cHBvcnQgcHJlY2lzaW9uIHRvIHRoZSBtaWxsaXNlY29uZFxuICAgICAgICAgICAgICAgICAgICAvLyBzbyB3ZSBjYW4ndCBnbyBiZXlvbmQgdGhhdC5cbiAgICAgICAgICAgICAgICAgICAgLy8gV2UgYWxzbyBuZWVkIHRvIHBhZCBzdGFydCB3aXRoIDAgaWYgdGhlIHZhbHVlIGlzIG5vdCAwXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gbWlsbGlzZWNvbmQobG9jYWxpemVkRGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKHZhbHVlLCAzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJnXCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcImdcIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmICh0b2tlbkxlbmd0aCA8PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBcIkEuRC5cIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiaFwiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJoXCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRva2VuTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBob3VyKGxvY2FsaXplZERhdGUpICUgMTI7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyhob3VyKGxvY2FsaXplZERhdGUpICUgMTIsIDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiSFwiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJIXCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRva2VuTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBob3VyKGxvY2FsaXplZERhdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3MoaG91cihsb2NhbGl6ZWREYXRlKSwgMik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJLXCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcIktcIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodG9rZW5MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChraW5kKGxvY2FsaXplZERhdGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxIC8qIERhdGVLaW5kLlVUQyAqLzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IFwiWlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDIgLyogRGF0ZUtpbmQuTG9jYWwgKi86XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBkYXRlT2Zmc2V0VG9TdHJpbmcobG9jYWxpemVkRGF0ZS5nZXRUaW1lem9uZU9mZnNldCgpICogLTYwMDAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwIC8qIERhdGVLaW5kLlVuc3BlY2lmaWVkICovOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIm1cIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwibVwiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0b2tlbkxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gbWludXRlKGxvY2FsaXplZERhdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3MobWludXRlKGxvY2FsaXplZERhdGUpLCAyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIk1cIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwiTVwiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0b2tlbkxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gbW9udGgobG9jYWxpemVkRGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyhtb250aChsb2NhbGl6ZWREYXRlKSwgMik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHNob3J0TW9udGhzW21vbnRoKGxvY2FsaXplZERhdGUpIC0gMV07XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGxvbmdNb250aHNbbW9udGgobG9jYWxpemVkRGF0ZSkgLSAxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInNcIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwic1wiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0b2tlbkxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gc2Vjb25kKGxvY2FsaXplZERhdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3Moc2Vjb25kKGxvY2FsaXplZERhdGUpLCAyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInRcIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwidFwiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0b2tlbkxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gbG9jYWxpemVkRGF0ZS5nZXRIb3VycygpIDwgMTIgPyBcIkFcIiA6IFwiUFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBsb2NhbGl6ZWREYXRlLmdldEhvdXJzKCkgPCAxMiA/IFwiQU1cIiA6IFwiUE1cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInlcIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwieVwiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0b2tlbkxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gbG9jYWxpemVkRGF0ZS5nZXRGdWxsWWVhcigpICUgMTAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3MobG9jYWxpemVkRGF0ZS5nZXRGdWxsWWVhcigpICUgMTAwLCAyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKGxvY2FsaXplZERhdGUuZ2V0RnVsbFllYXIoKSwgMyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyhsb2NhbGl6ZWREYXRlLmdldEZ1bGxZZWFyKCksIDQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3MobG9jYWxpemVkRGF0ZS5nZXRGdWxsWWVhcigpLCA1KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInpcIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwielwiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgbGV0IHV0Y09mZnNldFRleHQgPSBcIlwiO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoa2luZChsb2NhbGl6ZWREYXRlKSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDEgLyogRGF0ZUtpbmQuVVRDICovOlxuICAgICAgICAgICAgICAgICAgICAgICAgdXRjT2Zmc2V0VGV4dCA9IFwiKzAwOjAwXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyIC8qIERhdGVLaW5kLkxvY2FsICovOlxuICAgICAgICAgICAgICAgICAgICAgICAgdXRjT2Zmc2V0VGV4dCA9IGRhdGVPZmZzZXRUb1N0cmluZyhsb2NhbGl6ZWREYXRlLmdldFRpbWV6b25lT2Zmc2V0KCkgKiAtNjAwMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMCAvKiBEYXRlS2luZC5VbnNwZWNpZmllZCAqLzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHV0Y09mZnNldFRleHQgPSBkYXRlT2Zmc2V0VG9TdHJpbmcodG9Mb2NhbFRpbWUobG9jYWxpemVkRGF0ZSkuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIC02MDAwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3Qgc2lnbiA9IHV0Y09mZnNldFRleHRbMF0gPT09IFwiLVwiID8gXCItXCIgOiBcIitcIjtcbiAgICAgICAgICAgICAgICBjb25zdCBob3VycyA9IHBhcnNlSW50KHV0Y09mZnNldFRleHQuc3Vic3RyaW5nKDEsIDMpLCAxMCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbWludXRlcyA9IHBhcnNlSW50KHV0Y09mZnNldFRleHQuc3Vic3RyaW5nKDQsIDYpLCAxMCk7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0b2tlbkxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gYCR7c2lnbn0ke2hvdXJzfWA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGAke3NpZ259JHtwYWRXaXRoWmVyb3MoaG91cnMsIDIpfWA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBgJHtzaWdufSR7cGFkV2l0aFplcm9zKGhvdXJzLCAyKX06JHtwYWRXaXRoWmVyb3MobWludXRlcywgMil9YDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCI6XCI6XG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IFwiOlwiO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcysrO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIi9cIjpcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gXCIvXCI7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zKys7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiJ1wiOlxuICAgICAgICAgICAgY2FzZSAnXCInOlxuICAgICAgICAgICAgICAgIGNvbnN0IFtxdW90ZWRTdHJpbmcsIHF1b3RlZFN0cmluZ0xlbmdodF0gPSBwYXJzZVF1b3RlZFN0cmluZyhmb3JtYXQsIGN1cnNvclBvcyk7XG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IHF1b3RlZFN0cmluZztcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gcXVvdGVkU3RyaW5nTGVuZ2h0O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIiVcIjpcbiAgICAgICAgICAgICAgICBjb25zdCBuZXh0Q2hhciA9IHBhcnNlTmV4dENoYXIoZm9ybWF0LCBjdXJzb3JQb3MpO1xuICAgICAgICAgICAgICAgIGlmIChuZXh0Q2hhciA+PSAwICYmIG5leHRDaGFyICE9PSBcIiVcIi5jaGFyQ29kZUF0KDApKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSAyO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gZGF0ZVRvU3RyaW5nV2l0aEN1c3RvbUZvcm1hdChsb2NhbGl6ZWREYXRlLCBTdHJpbmcuZnJvbUNoYXJDb2RlKG5leHRDaGFyKSwgdXRjKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgZm9ybWF0IHN0cmluZ1wiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiXFxcXFwiOlxuICAgICAgICAgICAgICAgIGNvbnN0IG5leHRDaGFyMiA9IHBhcnNlTmV4dENoYXIoZm9ybWF0LCBjdXJzb3JQb3MpO1xuICAgICAgICAgICAgICAgIGlmIChuZXh0Q2hhcjIgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gMjtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUobmV4dENoYXIyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgZm9ybWF0IHN0cmluZ1wiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGN1cnNvclBvcysrO1xuICAgICAgICAgICAgICAgIHJlc3VsdCArPSB0b2tlbjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xufVxuZXhwb3J0IGZ1bmN0aW9uIGtpbmQodmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWUua2luZCB8fCAwO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHVuaXhFcG9jaE1pbGxpc2Vjb25kc1RvVGlja3MobXMsIG9mZnNldCkge1xuICAgIHJldHVybiB0b0ludDY0KCgoQmlnSW50KG1zKSArIDYyMTM1NTk2ODAwMDAwbikgKyBCaWdJbnQob2Zmc2V0KSkgKiAxMDAwMG4pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRpY2tzVG9Vbml4RXBvY2hNaWxsaXNlY29uZHModGlja3MpIHtcbiAgICByZXR1cm4gTnVtYmVyKCgoQmlnSW50KHRpY2tzKSAvIDEwMDAwbikgLSA2MjEzNTU5NjgwMDAwMG4pKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBkYXRlT2Zmc2V0VG9TdHJpbmcob2Zmc2V0KSB7XG4gICAgY29uc3QgaXNNaW51cyA9IG9mZnNldCA8IDA7XG4gICAgb2Zmc2V0ID0gTWF0aC5hYnMob2Zmc2V0KTtcbiAgICBjb25zdCBob3VycyA9IH5+KG9mZnNldCAvIDM2MDAwMDApO1xuICAgIGNvbnN0IG1pbnV0ZXMgPSAob2Zmc2V0ICUgMzYwMDAwMCkgLyA2MDAwMDtcbiAgICByZXR1cm4gKGlzTWludXMgPyBcIi1cIiA6IFwiK1wiKSArXG4gICAgICAgIHBhZFdpdGhaZXJvcyhob3VycywgMikgKyBcIjpcIiArXG4gICAgICAgIHBhZFdpdGhaZXJvcyhtaW51dGVzLCAyKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBkYXRlVG9IYWxmVVRDU3RyaW5nKGRhdGUsIGhhbGYpIHtcbiAgICBjb25zdCBzdHIgPSBkYXRlLnRvSVNPU3RyaW5nKCk7XG4gICAgcmV0dXJuIGhhbGYgPT09IFwiZmlyc3RcIlxuICAgICAgICA/IHN0ci5zdWJzdHJpbmcoMCwgc3RyLmluZGV4T2YoXCJUXCIpKVxuICAgICAgICA6IHN0ci5zdWJzdHJpbmcoc3RyLmluZGV4T2YoXCJUXCIpICsgMSwgc3RyLmxlbmd0aCAtIDEpO1xufVxuZnVuY3Rpb24gZGF0ZVRvSVNPU3RyaW5nKGQsIHV0Yykge1xuICAgIGlmICh1dGMpIHtcbiAgICAgICAgcmV0dXJuIGQudG9JU09TdHJpbmcoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIEpTIERhdGUgaXMgYWx3YXlzIGxvY2FsXG4gICAgICAgIGNvbnN0IHByaW50T2Zmc2V0ID0gZC5raW5kID09IG51bGwgPyB0cnVlIDogZC5raW5kID09PSAyIC8qIERhdGVLaW5kLkxvY2FsICovO1xuICAgICAgICByZXR1cm4gcGFkV2l0aFplcm9zKGQuZ2V0RnVsbFllYXIoKSwgNCkgKyBcIi1cIiArXG4gICAgICAgICAgICBwYWRXaXRoWmVyb3MoZC5nZXRNb250aCgpICsgMSwgMikgKyBcIi1cIiArXG4gICAgICAgICAgICBwYWRXaXRoWmVyb3MoZC5nZXREYXRlKCksIDIpICsgXCJUXCIgK1xuICAgICAgICAgICAgcGFkV2l0aFplcm9zKGQuZ2V0SG91cnMoKSwgMikgKyBcIjpcIiArXG4gICAgICAgICAgICBwYWRXaXRoWmVyb3MoZC5nZXRNaW51dGVzKCksIDIpICsgXCI6XCIgK1xuICAgICAgICAgICAgcGFkV2l0aFplcm9zKGQuZ2V0U2Vjb25kcygpLCAyKSArIFwiLlwiICtcbiAgICAgICAgICAgIHBhZFdpdGhaZXJvcyhkLmdldE1pbGxpc2Vjb25kcygpLCAzKSArXG4gICAgICAgICAgICAocHJpbnRPZmZzZXQgPyBkYXRlT2Zmc2V0VG9TdHJpbmcoZC5nZXRUaW1lem9uZU9mZnNldCgpICogLTYwMDAwKSA6IFwiXCIpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGRhdGVUb0lTT1N0cmluZ1dpdGhPZmZzZXQoZGF0ZVdpdGhPZmZzZXQsIG9mZnNldCkge1xuICAgIGNvbnN0IHN0ciA9IGRhdGVXaXRoT2Zmc2V0LnRvSVNPU3RyaW5nKCk7XG4gICAgcmV0dXJuIHN0ci5zdWJzdHJpbmcoMCwgc3RyLmxlbmd0aCAtIDEpICsgZGF0ZU9mZnNldFRvU3RyaW5nKG9mZnNldCk7XG59XG5mdW5jdGlvbiBkYXRlVG9TdHJpbmdXaXRoT2Zmc2V0KGRhdGUsIGZvcm1hdCkge1xuICAgIGNvbnN0IGQgPSBuZXcgRGF0ZShkYXRlLmdldFRpbWUoKSArIChkYXRlLm9mZnNldCA/PyAwKSk7XG4gICAgaWYgKHR5cGVvZiBmb3JtYXQgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgcmV0dXJuIGQudG9JU09TdHJpbmcoKS5yZXBsYWNlKC9cXC5cXGQrLywgXCJcIikucmVwbGFjZSgvW0EtWl18XFwuXFxkKy9nLCBcIiBcIikgKyBkYXRlT2Zmc2V0VG9TdHJpbmcoKGRhdGUub2Zmc2V0ID8/IDApKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoZm9ybWF0Lmxlbmd0aCA9PT0gMSkge1xuICAgICAgICBzd2l0Y2ggKGZvcm1hdCkge1xuICAgICAgICAgICAgY2FzZSBcIkRcIjpcbiAgICAgICAgICAgIGNhc2UgXCJkXCI6IHJldHVybiBkYXRlVG9IYWxmVVRDU3RyaW5nKGQsIFwiZmlyc3RcIik7XG4gICAgICAgICAgICBjYXNlIFwiVFwiOlxuICAgICAgICAgICAgY2FzZSBcInRcIjogcmV0dXJuIGRhdGVUb0hhbGZVVENTdHJpbmcoZCwgXCJzZWNvbmRcIik7XG4gICAgICAgICAgICBjYXNlIFwiT1wiOlxuICAgICAgICAgICAgY2FzZSBcIm9cIjogcmV0dXJuIGRhdGVUb0lTT1N0cmluZ1dpdGhPZmZzZXQoZCwgKGRhdGUub2Zmc2V0ID8/IDApKTtcbiAgICAgICAgICAgIGRlZmF1bHQ6IHRocm93IG5ldyBFcnJvcihcIlVucmVjb2duaXplZCBEYXRlIHByaW50IGZvcm1hdFwiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGRhdGVUb1N0cmluZ1dpdGhDdXN0b21Gb3JtYXQoZCwgZm9ybWF0LCB0cnVlKTtcbiAgICB9XG59XG5mdW5jdGlvbiBkYXRlVG9TdHJpbmdXaXRoS2luZChkYXRlLCBmb3JtYXQpIHtcbiAgICBjb25zdCB1dGMgPSBkYXRlLmtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovO1xuICAgIGlmICh0eXBlb2YgZm9ybWF0ICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHJldHVybiB1dGMgPyBkYXRlLnRvVVRDU3RyaW5nKCkgOiBkYXRlLnRvTG9jYWxlU3RyaW5nKCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGZvcm1hdC5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgc3dpdGNoIChmb3JtYXQpIHtcbiAgICAgICAgICAgIGNhc2UgXCJEXCI6XG4gICAgICAgICAgICBjYXNlIFwiZFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiB1dGMgPyBkYXRlVG9IYWxmVVRDU3RyaW5nKGRhdGUsIFwiZmlyc3RcIikgOiBkYXRlLnRvTG9jYWxlRGF0ZVN0cmluZygpO1xuICAgICAgICAgICAgY2FzZSBcIlRcIjpcbiAgICAgICAgICAgIGNhc2UgXCJ0XCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHV0YyA/IGRhdGVUb0hhbGZVVENTdHJpbmcoZGF0ZSwgXCJzZWNvbmRcIikgOiBkYXRlLnRvTG9jYWxlVGltZVN0cmluZygpO1xuICAgICAgICAgICAgY2FzZSBcIk9cIjpcbiAgICAgICAgICAgIGNhc2UgXCJvXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGVUb0lTT1N0cmluZyhkYXRlLCB1dGMpO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbnJlY29nbml6ZWQgRGF0ZSBwcmludCBmb3JtYXRcIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBkYXRlVG9TdHJpbmdXaXRoQ3VzdG9tRm9ybWF0KGRhdGUsIGZvcm1hdCwgdXRjKTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gdG9TdHJpbmcoZGF0ZSwgZm9ybWF0LCBfcHJvdmlkZXIpIHtcbiAgICByZXR1cm4gZGF0ZS5vZmZzZXQgIT0gbnVsbFxuICAgICAgICA/IGRhdGVUb1N0cmluZ1dpdGhPZmZzZXQoZGF0ZSwgZm9ybWF0KVxuICAgICAgICA6IGRhdGVUb1N0cmluZ1dpdGhLaW5kKGRhdGUsIGZvcm1hdCk7XG59XG5leHBvcnQgZnVuY3Rpb24gRGF0ZVRpbWUodmFsdWUsIGtpbmQpIHtcbiAgICBjb25zdCBkID0gbmV3IERhdGUodmFsdWUpO1xuICAgIGQua2luZCA9IChraW5kID09IG51bGwgPyAwIC8qIERhdGVLaW5kLlVuc3BlY2lmaWVkICovIDoga2luZCkgfCAwO1xuICAgIHJldHVybiBkO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGZyb21UaWNrcyh0aWNrcywga2luZCkge1xuICAgIGtpbmQgPSBraW5kICE9IG51bGwgPyBraW5kIDogMiAvKiBEYXRlS2luZC5Mb2NhbCAqLzsgLy8gYmV0dGVyIGRlZmF1bHQgdGhhbiBVbnNwZWNpZmllZFxuICAgIGxldCBkYXRlID0gRGF0ZVRpbWUodGlja3NUb1VuaXhFcG9jaE1pbGxpc2Vjb25kcyh0aWNrcyksIGtpbmQpO1xuICAgIC8vIFRpY2tzIGFyZSBsb2NhbCB0byBvZmZzZXQgKGluIHRoaXMgY2FzZSwgZWl0aGVyIFVUQyBvciBMb2NhbC9Vbmtub3duKS5cbiAgICAvLyBJZiBraW5kIGlzIGFueXRoaW5nIGJ1dCBVVEMsIHRoYXQgbWVhbnMgdGhhdCB0aGUgdGljayBudW1iZXIgd2FzIG5vdFxuICAgIC8vIGluIHV0YywgdGh1cyBnZXRUaW1lKCkgY2Fubm90IHJldHVybiBVVEMsIGFuZCBuZWVkcyB0byBiZSBzaGlmdGVkLlxuICAgIGlmIChraW5kICE9PSAxIC8qIERhdGVLaW5kLlVUQyAqLykge1xuICAgICAgICBkYXRlID0gRGF0ZVRpbWUoZGF0ZS5nZXRUaW1lKCkgLSBkYXRlT2Zmc2V0KGRhdGUpLCBraW5kKTtcbiAgICB9XG4gICAgcmV0dXJuIGRhdGU7XG59XG5leHBvcnQgZnVuY3Rpb24gZnJvbURhdGVUaW1lT2Zmc2V0KGRhdGUsIGtpbmQpIHtcbiAgICBzd2l0Y2ggKGtpbmQpIHtcbiAgICAgICAgY2FzZSAxIC8qIERhdGVLaW5kLlVUQyAqLzogcmV0dXJuIERhdGVUaW1lKGRhdGUuZ2V0VGltZSgpLCAxIC8qIERhdGVLaW5kLlVUQyAqLyk7XG4gICAgICAgIGNhc2UgMiAvKiBEYXRlS2luZC5Mb2NhbCAqLzogcmV0dXJuIERhdGVUaW1lKGRhdGUuZ2V0VGltZSgpLCAyIC8qIERhdGVLaW5kLkxvY2FsICovKTtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGNvbnN0IGQgPSBEYXRlVGltZShkYXRlLmdldFRpbWUoKSArIChkYXRlLm9mZnNldCA/PyAwKSwga2luZCk7XG4gICAgICAgICAgICByZXR1cm4gRGF0ZVRpbWUoZC5nZXRUaW1lKCkgLSBkYXRlT2Zmc2V0KGQpLCBraW5kKTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gZ2V0VGlja3MoZGF0ZSkge1xuICAgIHJldHVybiB1bml4RXBvY2hNaWxsaXNlY29uZHNUb1RpY2tzKGRhdGUuZ2V0VGltZSgpLCBkYXRlT2Zmc2V0KGRhdGUpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBtaW5WYWx1ZSgpIHtcbiAgICAvLyBUaGlzIGlzIFwiMDAwMS0wMS0wMVQwMDowMDowMC4wMDBaXCIsIGFjdHVhbCBKUyBtaW4gdmFsdWUgaXMgLTg2NDAwMDAwMDAwMDAwMDBcbiAgICByZXR1cm4gRGF0ZVRpbWUoLTYyMTM1NTk2ODAwMDAwLCAwIC8qIERhdGVLaW5kLlVuc3BlY2lmaWVkICovKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBtYXhWYWx1ZSgpIHtcbiAgICAvLyBUaGlzIGlzIFwiOTk5OS0xMi0zMVQyMzo1OTo1OS45OTlaXCIsIGFjdHVhbCBKUyBtYXggdmFsdWUgaXMgODY0MDAwMDAwMDAwMDAwMFxuICAgIHJldHVybiBEYXRlVGltZSgyNTM0MDIzMDA3OTk5OTksIDAgLyogRGF0ZUtpbmQuVW5zcGVjaWZpZWQgKi8pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlUmF3KGlucHV0KSB7XG4gICAgZnVuY3Rpb24gZmFpbCgpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgc3RyaW5nIGlzIG5vdCBhIHZhbGlkIERhdGU6ICR7aW5wdXR9YCk7XG4gICAgfVxuICAgIGlmIChpbnB1dCA9PSBudWxsIHx8IGlucHV0LnRyaW0oKSA9PT0gXCJcIikge1xuICAgICAgICBmYWlsKCk7XG4gICAgfVxuICAgIC8vIElTTyBkYXRlcyB3aXRob3V0IFRaIGFyZSBwYXJzZWQgYXMgVVRDLiBBZGRpbmcgdGltZSB3aXRob3V0IFRaIGtlZXBzIHRoZW0gbG9jYWwuXG4gICAgaWYgKGlucHV0Lmxlbmd0aCA9PT0gMTAgJiYgaW5wdXRbNF0gPT09IFwiLVwiICYmIGlucHV0WzddID09PSBcIi1cIikge1xuICAgICAgICBpbnB1dCArPSBcIlQwMDowMDowMFwiO1xuICAgIH1cbiAgICBsZXQgZGF0ZSA9IG5ldyBEYXRlKGlucHV0KTtcbiAgICBsZXQgb2Zmc2V0ID0gbnVsbDtcbiAgICBpZiAoaXNOYU4oZGF0ZS5nZXRUaW1lKCkpKSB7XG4gICAgICAgIC8vIFRyeSB0byBjaGVjayBzdHJpbmdzIEpTIERhdGUgY2Fubm90IHBhcnNlIChzZWUgIzEwNDUsICMxNDIyKVxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXG4gICAgICAgIGNvbnN0IG0gPSAvXlxccyooXFxkK1teXFx3XFxzOl1cXGQrW15cXHdcXHM6XVxcZCspP1xccyooXFxkKzpcXGQrKD86OlxcZCsoPzpcXC5cXGQrKT8pPyk/XFxzKihbQWFQcF1bTW1dKT9cXHMqKFp8WystXShbMDFdP1xcZCk6PyhbMC01XT9cXGQpPyk/XFxzKiQvLmV4ZWMoaW5wdXQpO1xuICAgICAgICBpZiAobSAhPSBudWxsKSB7XG4gICAgICAgICAgICBsZXQgYmFzZURhdGU7XG4gICAgICAgICAgICBsZXQgdGltZUluU2Vjb25kcyA9IDA7XG4gICAgICAgICAgICBpZiAobVsyXSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGltZVBhcnRzID0gbVsyXS5zcGxpdChcIjpcIik7XG4gICAgICAgICAgICAgICAgY29uc3QgaG91clBhcnQgPSBwYXJzZUludCh0aW1lUGFydHNbMF0sIDEwKTtcbiAgICAgICAgICAgICAgICB0aW1lSW5TZWNvbmRzID1cbiAgICAgICAgICAgICAgICAgICAgaG91clBhcnQgKiAzNjAwICtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlSW50KHRpbWVQYXJ0c1sxXSB8fCBcIjBcIiwgMTApICogNjAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VGbG9hdCh0aW1lUGFydHNbMl0gfHwgXCIwXCIpO1xuICAgICAgICAgICAgICAgIGlmIChtWzNdICE9IG51bGwgJiYgbVszXS50b1VwcGVyQ2FzZSgpID09PSBcIlBNXCIgJiYgaG91clBhcnQgPCAxMikge1xuICAgICAgICAgICAgICAgICAgICB0aW1lSW5TZWNvbmRzICs9IDcyMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobVs0XSAhPSBudWxsKSB7IC8vIFRoZXJlJ3MgYW4gb2Zmc2V0LCBwYXJzZSBhcyBVVENcbiAgICAgICAgICAgICAgICBpZiAobVsxXSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGJhc2VEYXRlID0gbmV3IERhdGUobVsxXSArIFwiIFVUQ1wiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGQgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICBiYXNlRGF0ZSA9IG5ldyBEYXRlKGQuZ2V0VVRDRnVsbFllYXIoKSArIFwiL1wiICsgKGQuZ2V0VVRDTW9udGgoKSArIDEpICsgXCIvXCIgKyBkLmdldFVUQ0RhdGUoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChtWzRdID09PSBcIlpcIikge1xuICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSBcIlpcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBvZmZzZXRJbk1pbnV0ZXMgPSBwYXJzZUludChtWzVdLCAxMCkgKiA2MCArIHBhcnNlSW50KG1bNl0gfHwgXCIwXCIsIDEwKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1bNF1bMF0gPT09IFwiLVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXRJbk1pbnV0ZXMgKj0gLTE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0SW5NaW51dGVzO1xuICAgICAgICAgICAgICAgICAgICB0aW1lSW5TZWNvbmRzIC09IG9mZnNldEluTWludXRlcyAqIDYwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChtWzFdICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgYmFzZURhdGUgPSBuZXcgRGF0ZShtWzFdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGQgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICBiYXNlRGF0ZSA9IG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSArIFwiL1wiICsgKGQuZ2V0TW9udGgoKSArIDEpICsgXCIvXCIgKyBkLmdldERhdGUoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGF0ZSA9IG5ldyBEYXRlKGJhc2VEYXRlLmdldFRpbWUoKSArIHRpbWVJblNlY29uZHMgKiAxMDAwKTtcbiAgICAgICAgICAgIC8vIGNvcnJlY3QgZm9yIGRheWxpZ2h0IHNhdmluZ3MgdGltZVxuICAgICAgICAgICAgZGF0ZSA9IG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpICsgKGRhdGUuZ2V0VGltZXpvbmVPZmZzZXQoKSAtIGJhc2VEYXRlLmdldFRpbWV6b25lT2Zmc2V0KCkpICogNjAwMDApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZmFpbCgpO1xuICAgICAgICB9XG4gICAgICAgIC8vIENoZWNrIGFnYWluIHRoZSBkYXRlIGlzIHZhbGlkIGFmdGVyIHRyYW5zZm9ybWF0aW9ucywgc2VlICMyMjI5XG4gICAgICAgIGlmIChpc05hTihkYXRlLmdldFRpbWUoKSkpIHtcbiAgICAgICAgICAgIGZhaWwoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gW2RhdGUsIG9mZnNldF07XG59XG5leHBvcnQgZnVuY3Rpb24gcGFyc2Uoc3RyLCBkZXRlY3RVVEMgPSBmYWxzZSkge1xuICAgIGNvbnN0IFtkYXRlLCBvZmZzZXRdID0gcGFyc2VSYXcoc3RyKTtcbiAgICAvLyAuTkVUIGFsd2F5cyBwYXJzZXMgRGF0ZVRpbWUgYXMgTG9jYWwgaWYgdGhlcmUncyBvZmZzZXQgaW5mbyAoZXZlbiBcIlpcIilcbiAgICAvLyBOZXd0b25zb2Z0Lkpzb24gdXNlcyBVVEMgaWYgdGhlIG9mZnNldCBpcyBcIlpcIlxuICAgIGNvbnN0IGtpbmQgPSBvZmZzZXQgIT0gbnVsbFxuICAgICAgICA/IChkZXRlY3RVVEMgJiYgb2Zmc2V0ID09PSBcIlpcIiA/IDEgLyogRGF0ZUtpbmQuVVRDICovIDogMiAvKiBEYXRlS2luZC5Mb2NhbCAqLylcbiAgICAgICAgOiAwIC8qIERhdGVLaW5kLlVuc3BlY2lmaWVkICovO1xuICAgIHJldHVybiBEYXRlVGltZShkYXRlLmdldFRpbWUoKSwga2luZCk7XG59XG5leHBvcnQgZnVuY3Rpb24gdHJ5UGFyc2UodiwgZGVmVmFsdWUpIHtcbiAgICB0cnkge1xuICAgICAgICBkZWZWYWx1ZS5jb250ZW50cyA9IHBhcnNlKHYpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgY2F0Y2ggKF9lcnIpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGUoeWVhciwgbW9udGgsIGRheSwgaCA9IDAsIG0gPSAwLCBzID0gMCwgbXMgPSAwLCBraW5kKSB7XG4gICAgY29uc3QgZGF0ZSA9IGtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovXG4gICAgICAgID8gbmV3IERhdGUoRGF0ZS5VVEMoeWVhciwgbW9udGggLSAxLCBkYXksIGgsIG0sIHMsIG1zKSlcbiAgICAgICAgOiBuZXcgRGF0ZSh5ZWFyLCBtb250aCAtIDEsIGRheSwgaCwgbSwgcywgbXMpO1xuICAgIGlmICh5ZWFyIDw9IDk5KSB7XG4gICAgICAgIGlmIChraW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqLykge1xuICAgICAgICAgICAgZGF0ZS5zZXRVVENGdWxsWWVhcih5ZWFyLCBtb250aCAtIDEsIGRheSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBkYXRlLnNldEZ1bGxZZWFyKHllYXIsIG1vbnRoIC0gMSwgZGF5KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBkYXRlVmFsdWUgPSBkYXRlLmdldFRpbWUoKTtcbiAgICBpZiAoaXNOYU4oZGF0ZVZhbHVlKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgcGFyYW1ldGVycyBkZXNjcmliZSBhbiB1bnJlcHJlc2VudGFibGUgRGF0ZS5cIik7XG4gICAgfVxuICAgIHJldHVybiBEYXRlVGltZShkYXRlVmFsdWUsIGtpbmQpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIG5vdygpIHtcbiAgICByZXR1cm4gRGF0ZVRpbWUoRGF0ZS5ub3coKSwgMiAvKiBEYXRlS2luZC5Mb2NhbCAqLyk7XG59XG5leHBvcnQgZnVuY3Rpb24gdXRjTm93KCkge1xuICAgIHJldHVybiBEYXRlVGltZShEYXRlLm5vdygpLCAxIC8qIERhdGVLaW5kLlVUQyAqLyk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9kYXkoKSB7XG4gICAgcmV0dXJuIGRhdGUobm93KCkpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGlzTGVhcFllYXIoeWVhcikge1xuICAgIHJldHVybiB5ZWFyICUgNCA9PT0gMCAmJiB5ZWFyICUgMTAwICE9PSAwIHx8IHllYXIgJSA0MDAgPT09IDA7XG59XG5leHBvcnQgZnVuY3Rpb24gZGF5c0luTW9udGgoeWVhciwgbW9udGgpIHtcbiAgICByZXR1cm4gbW9udGggPT09IDJcbiAgICAgICAgPyAoaXNMZWFwWWVhcih5ZWFyKSA/IDI5IDogMjgpXG4gICAgICAgIDogKG1vbnRoID49IDggPyAobW9udGggJSAyID09PSAwID8gMzEgOiAzMCkgOiAobW9udGggJSAyID09PSAwID8gMzAgOiAzMSkpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvVW5pdmVyc2FsVGltZShkYXRlKSB7XG4gICAgcmV0dXJuIGRhdGUua2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi8gPyBkYXRlIDogRGF0ZVRpbWUoZGF0ZS5nZXRUaW1lKCksIDEgLyogRGF0ZUtpbmQuVVRDICovKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b0xvY2FsVGltZShkYXRlKSB7XG4gICAgcmV0dXJuIGRhdGUua2luZCA9PT0gMiAvKiBEYXRlS2luZC5Mb2NhbCAqLyA/IGRhdGUgOiBEYXRlVGltZShkYXRlLmdldFRpbWUoKSwgMiAvKiBEYXRlS2luZC5Mb2NhbCAqLyk7XG59XG5leHBvcnQgZnVuY3Rpb24gc3BlY2lmeUtpbmQoZCwga2luZCkge1xuICAgIHJldHVybiBjcmVhdGUoeWVhcihkKSwgbW9udGgoZCksIGRheShkKSwgaG91cihkKSwgbWludXRlKGQpLCBzZWNvbmQoZCksIG1pbGxpc2Vjb25kKGQpLCBraW5kKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0aW1lT2ZEYXkoZCkge1xuICAgIHJldHVybiBob3VyKGQpICogMzYwMDAwMFxuICAgICAgICArIG1pbnV0ZShkKSAqIDYwMDAwXG4gICAgICAgICsgc2Vjb25kKGQpICogMTAwMFxuICAgICAgICArIG1pbGxpc2Vjb25kKGQpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGRhdGUoZCkge1xuICAgIHJldHVybiBjcmVhdGUoeWVhcihkKSwgbW9udGgoZCksIGRheShkKSwgMCwgMCwgMCwgMCwgZC5raW5kKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBkYXkoZCkge1xuICAgIHJldHVybiBkLmtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovID8gZC5nZXRVVENEYXRlKCkgOiBkLmdldERhdGUoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBob3VyKGQpIHtcbiAgICByZXR1cm4gZC5raW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqLyA/IGQuZ2V0VVRDSG91cnMoKSA6IGQuZ2V0SG91cnMoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBtaWxsaXNlY29uZChkKSB7XG4gICAgcmV0dXJuIGQua2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi8gPyBkLmdldFVUQ01pbGxpc2Vjb25kcygpIDogZC5nZXRNaWxsaXNlY29uZHMoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBtaW51dGUoZCkge1xuICAgIHJldHVybiBkLmtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovID8gZC5nZXRVVENNaW51dGVzKCkgOiBkLmdldE1pbnV0ZXMoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBtb250aChkKSB7XG4gICAgcmV0dXJuIChkLmtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovID8gZC5nZXRVVENNb250aCgpIDogZC5nZXRNb250aCgpKSArIDE7XG59XG5leHBvcnQgZnVuY3Rpb24gc2Vjb25kKGQpIHtcbiAgICByZXR1cm4gZC5raW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqLyA/IGQuZ2V0VVRDU2Vjb25kcygpIDogZC5nZXRTZWNvbmRzKCk7XG59XG5leHBvcnQgZnVuY3Rpb24geWVhcihkKSB7XG4gICAgcmV0dXJuIGQua2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi8gPyBkLmdldFVUQ0Z1bGxZZWFyKCkgOiBkLmdldEZ1bGxZZWFyKCk7XG59XG5leHBvcnQgZnVuY3Rpb24gZGF5T2ZXZWVrKGQpIHtcbiAgICByZXR1cm4gZC5raW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqLyA/IGQuZ2V0VVRDRGF5KCkgOiBkLmdldERheSgpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGRheU9mWWVhcihkKSB7XG4gICAgY29uc3QgX3llYXIgPSB5ZWFyKGQpO1xuICAgIGNvbnN0IF9tb250aCA9IG1vbnRoKGQpO1xuICAgIGxldCBfZGF5ID0gZGF5KGQpO1xuICAgIGZvciAobGV0IGkgPSAxOyBpIDwgX21vbnRoOyBpKyspIHtcbiAgICAgICAgX2RheSArPSBkYXlzSW5Nb250aChfeWVhciwgaSk7XG4gICAgfVxuICAgIHJldHVybiBfZGF5O1xufVxuZXhwb3J0IGZ1bmN0aW9uIGFkZChkLCB0cykge1xuICAgIGNvbnN0IG5ld0RhdGUgPSBEYXRlVGltZShkLmdldFRpbWUoKSArIHRzLCBkLmtpbmQpO1xuICAgIGlmIChkLmtpbmQgPT09IDIgLyogRGF0ZUtpbmQuTG9jYWwgKi8pIHtcbiAgICAgICAgY29uc3Qgb2xkVHpPZmZzZXQgPSBkLmdldFRpbWV6b25lT2Zmc2V0KCk7XG4gICAgICAgIGNvbnN0IG5ld1R6T2Zmc2V0ID0gbmV3RGF0ZS5nZXRUaW1lem9uZU9mZnNldCgpO1xuICAgICAgICByZXR1cm4gb2xkVHpPZmZzZXQgIT09IG5ld1R6T2Zmc2V0XG4gICAgICAgICAgICA/IERhdGVUaW1lKG5ld0RhdGUuZ2V0VGltZSgpICsgKG5ld1R6T2Zmc2V0IC0gb2xkVHpPZmZzZXQpICogNjAwMDAsIGQua2luZClcbiAgICAgICAgICAgIDogbmV3RGF0ZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBuZXdEYXRlO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBhZGREYXlzKGQsIHYpIHtcbiAgICByZXR1cm4gYWRkKGQsIHYgKiA4NjQwMDAwMCk7XG59XG5leHBvcnQgZnVuY3Rpb24gYWRkSG91cnMoZCwgdikge1xuICAgIHJldHVybiBhZGQoZCwgdiAqIDM2MDAwMDApO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGFkZE1pbnV0ZXMoZCwgdikge1xuICAgIHJldHVybiBhZGQoZCwgdiAqIDYwMDAwKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBhZGRTZWNvbmRzKGQsIHYpIHtcbiAgICByZXR1cm4gYWRkKGQsIHYgKiAxMDAwKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBhZGRNaWxsaXNlY29uZHMoZCwgdikge1xuICAgIHJldHVybiBhZGQoZCwgdik7XG59XG5leHBvcnQgZnVuY3Rpb24gYWRkVGlja3MoZCwgdikge1xuICAgIHJldHVybiBhZGQoZCwgdG9GbG9hdDY0KHYgLyAxMDAwMG4pKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBhZGRZZWFycyhkLCB2KSB7XG4gICAgY29uc3QgbmV3TW9udGggPSBtb250aChkKTtcbiAgICBjb25zdCBuZXdZZWFyID0geWVhcihkKSArIHY7XG4gICAgY29uc3QgX2RheXNJbk1vbnRoID0gZGF5c0luTW9udGgobmV3WWVhciwgbmV3TW9udGgpO1xuICAgIGNvbnN0IG5ld0RheSA9IE1hdGgubWluKF9kYXlzSW5Nb250aCwgZGF5KGQpKTtcbiAgICByZXR1cm4gY3JlYXRlKG5ld1llYXIsIG5ld01vbnRoLCBuZXdEYXksIGhvdXIoZCksIG1pbnV0ZShkKSwgc2Vjb25kKGQpLCBtaWxsaXNlY29uZChkKSwgZC5raW5kKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBhZGRNb250aHMoZCwgdikge1xuICAgIGxldCBuZXdNb250aCA9IG1vbnRoKGQpICsgdjtcbiAgICBsZXQgbmV3TW9udGhfID0gMDtcbiAgICBsZXQgeWVhck9mZnNldCA9IDA7XG4gICAgaWYgKG5ld01vbnRoID4gMTIpIHtcbiAgICAgICAgbmV3TW9udGhfID0gbmV3TW9udGggJSAxMjtcbiAgICAgICAgeWVhck9mZnNldCA9IE1hdGguZmxvb3IobmV3TW9udGggLyAxMik7XG4gICAgICAgIG5ld01vbnRoID0gbmV3TW9udGhfO1xuICAgIH1cbiAgICBlbHNlIGlmIChuZXdNb250aCA8IDEpIHtcbiAgICAgICAgbmV3TW9udGhfID0gMTIgKyBuZXdNb250aCAlIDEyO1xuICAgICAgICB5ZWFyT2Zmc2V0ID0gTWF0aC5mbG9vcihuZXdNb250aCAvIDEyKSArIChuZXdNb250aF8gPT09IDEyID8gLTEgOiAwKTtcbiAgICAgICAgbmV3TW9udGggPSBuZXdNb250aF87XG4gICAgfVxuICAgIGNvbnN0IG5ld1llYXIgPSB5ZWFyKGQpICsgeWVhck9mZnNldDtcbiAgICBjb25zdCBfZGF5c0luTW9udGggPSBkYXlzSW5Nb250aChuZXdZZWFyLCBuZXdNb250aCk7XG4gICAgY29uc3QgbmV3RGF5ID0gTWF0aC5taW4oX2RheXNJbk1vbnRoLCBkYXkoZCkpO1xuICAgIHJldHVybiBjcmVhdGUobmV3WWVhciwgbmV3TW9udGgsIG5ld0RheSwgaG91cihkKSwgbWludXRlKGQpLCBzZWNvbmQoZCksIG1pbGxpc2Vjb25kKGQpLCBkLmtpbmQpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHN1YnRyYWN0KGQsIHRoYXQpIHtcbiAgICByZXR1cm4gdHlwZW9mIHRoYXQgPT09IFwibnVtYmVyXCJcbiAgICAgICAgPyBhZGQoZCwgLXRoYXQpXG4gICAgICAgIDogZC5nZXRUaW1lKCkgLSB0aGF0LmdldFRpbWUoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b0xvbmdEYXRlU3RyaW5nKGQpIHtcbiAgICByZXR1cm4gZC50b0RhdGVTdHJpbmcoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b1Nob3J0RGF0ZVN0cmluZyhkKSB7XG4gICAgcmV0dXJuIGQudG9Mb2NhbGVEYXRlU3RyaW5nKCk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9Mb25nVGltZVN0cmluZyhkKSB7XG4gICAgcmV0dXJuIGQudG9Mb2NhbGVUaW1lU3RyaW5nKCk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9TaG9ydFRpbWVTdHJpbmcoZCkge1xuICAgIHJldHVybiBkLnRvTG9jYWxlVGltZVN0cmluZygpLnJlcGxhY2UoLzpcXGRcXGQoPyE6KS8sIFwiXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGVxdWFscyhkMSwgZDIpIHtcbiAgICByZXR1cm4gZDEuZ2V0VGltZSgpID09PSBkMi5nZXRUaW1lKCk7XG59XG5leHBvcnQgY29uc3QgY29tcGFyZSA9IGNvbXBhcmVEYXRlcztcbmV4cG9ydCBjb25zdCBjb21wYXJlVG8gPSBjb21wYXJlRGF0ZXM7XG5leHBvcnQgZnVuY3Rpb24gb3BfQWRkaXRpb24oeCwgeSkge1xuICAgIHJldHVybiBhZGQoeCwgeSk7XG59XG5leHBvcnQgZnVuY3Rpb24gb3BfU3VidHJhY3Rpb24oeCwgeSkge1xuICAgIHJldHVybiBzdWJ0cmFjdCh4LCB5KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpc0RheWxpZ2h0U2F2aW5nVGltZSh4KSB7XG4gICAgY29uc3QgamFuID0gbmV3IERhdGUoeC5nZXRGdWxsWWVhcigpLCAwLCAxKTtcbiAgICBjb25zdCBqdWwgPSBuZXcgRGF0ZSh4LmdldEZ1bGxZZWFyKCksIDYsIDEpO1xuICAgIHJldHVybiBpc0RTVChqYW4uZ2V0VGltZXpvbmVPZmZzZXQoKSwganVsLmdldFRpbWV6b25lT2Zmc2V0KCksIHguZ2V0VGltZXpvbmVPZmZzZXQoKSk7XG59XG5mdW5jdGlvbiBpc0RTVChqYW5PZmZzZXQsIGp1bE9mZnNldCwgdE9mZnNldCkge1xuICAgIHJldHVybiBNYXRoLm1pbihqYW5PZmZzZXQsIGp1bE9mZnNldCkgPT09IHRPZmZzZXQ7XG59XG5leHBvcnQgZGVmYXVsdCBEYXRlVGltZTtcbiIsCiAgIi8qKlxuICogRGF0ZVRpbWVPZmZzZXQgZnVuY3Rpb25zLlxuICpcbiAqIE5vdGU6IERhdGUgaW5zdGFuY2VzIGFyZSBhbHdheXMgRGF0ZU9iamVjdHMgaW4gbG9jYWxcbiAqIHRpbWV6b25lIChiZWNhdXNlIEpTIGRhdGVzIGFyZSBhbGwga2luZHMgb2YgbWVzc2VkIHVwKS5cbiAqIEEgbG9jYWwgZGF0ZSByZXR1cm5zIFVUQyBlcG9jaCB3aGVuIGAuZ2V0VGltZSgpYCBpcyBjYWxsZWQuXG4gKlxuICogQmFzaWNhbGx5OyBpbnZhcmlhbnQ6IGRhdGUuZ2V0VGltZSgpIGFsd2F5cyByZXR1cm4gVVRDIHRpbWUuXG4gKi9cbmltcG9ydCB7IHRvSW50NjQsIHRvRmxvYXQ2NCB9IGZyb20gXCIuL0JpZ0ludC5qc1wiO1xuaW1wb3J0IHsgY29tcGFyZURhdGVzLCBkYXRlT2Zmc2V0LCBwYWRXaXRoWmVyb3MgfSBmcm9tIFwiLi9VdGlsLmpzXCI7XG5jb25zdCBzaG9ydERheXMgPSBbXG4gICAgXCJTdW5cIiwgXCJNb25cIiwgXCJUdWVcIiwgXCJXZWRcIiwgXCJUaHVcIiwgXCJGcmlcIiwgXCJTYXRcIlxuXTtcbmNvbnN0IGxvbmdEYXlzID0gW1xuICAgIFwiU3VuZGF5XCIsIFwiTW9uZGF5XCIsIFwiVHVlc2RheVwiLCBcIldlZG5lc2RheVwiLCBcIlRodXJzZGF5XCIsIFwiRnJpZGF5XCIsIFwiU2F0dXJkYXlcIlxuXTtcbmNvbnN0IHNob3J0TW9udGhzID0gW1xuICAgIFwiSmFuXCIsIFwiRmViXCIsIFwiTWFyXCIsIFwiQXByXCIsIFwiTWF5XCIsIFwiSnVuXCIsIFwiSnVsXCIsIFwiQXVnXCIsIFwiU2VwXCIsIFwiT2N0XCIsIFwiTm92XCIsIFwiRGVjXCJcbl07XG5jb25zdCBsb25nTW9udGhzID0gW1xuICAgIFwiSmFudWFyeVwiLCBcIkZlYnJ1YXJ5XCIsIFwiTWFyY2hcIiwgXCJBcHJpbFwiLCBcIk1heVwiLCBcIkp1bmVcIiwgXCJKdWx5XCIsIFwiQXVndXN0XCIsIFwiU2VwdGVtYmVyXCIsIFwiT2N0b2JlclwiLCBcIk5vdmVtYmVyXCIsIFwiRGVjZW1iZXJcIlxuXTtcbmZ1bmN0aW9uIHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBwb3MsIHBhdHRlcm5DaGFyKSB7XG4gICAgbGV0IHRva2VuTGVuZ3RoID0gMDtcbiAgICBsZXQgaW50ZXJuYWxQb3MgPSBwb3M7XG4gICAgd2hpbGUgKGludGVybmFsUG9zIDwgZm9ybWF0Lmxlbmd0aCAmJiBmb3JtYXRbaW50ZXJuYWxQb3NdID09PSBwYXR0ZXJuQ2hhcikge1xuICAgICAgICBpbnRlcm5hbFBvcysrO1xuICAgICAgICB0b2tlbkxlbmd0aCsrO1xuICAgIH1cbiAgICByZXR1cm4gdG9rZW5MZW5ndGg7XG59XG5mdW5jdGlvbiBwYXJzZU5leHRDaGFyKGZvcm1hdCwgcG9zKSB7XG4gICAgaWYgKHBvcyA+PSBmb3JtYXQubGVuZ3RoIC0gMSkge1xuICAgICAgICByZXR1cm4gLTE7XG4gICAgfVxuICAgIHJldHVybiBmb3JtYXQuY2hhckNvZGVBdChwb3MgKyAxKTtcbn1cbmZ1bmN0aW9uIHBhcnNlUXVvdGVkU3RyaW5nKGZvcm1hdCwgcG9zKSB7XG4gICAgbGV0IGJlZ2luUG9zID0gcG9zO1xuICAgIC8vIEdldCB0aGUgY2hhcmFjdGVyIHVzZWQgdG8gcXVvdGUgdGhlIHN0cmluZ1xuICAgIGNvbnN0IHF1b3RlQ2hhciA9IGZvcm1hdFtwb3NdO1xuICAgIGxldCByZXN1bHQgPSBcIlwiO1xuICAgIGxldCBmb3VuZFF1b3RlID0gZmFsc2U7XG4gICAgd2hpbGUgKHBvcyA8IGZvcm1hdC5sZW5ndGgpIHtcbiAgICAgICAgcG9zKys7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRDaGFyID0gZm9ybWF0W3Bvc107XG4gICAgICAgIGlmIChjdXJyZW50Q2hhciA9PT0gcXVvdGVDaGFyKSB7XG4gICAgICAgICAgICBmb3VuZFF1b3RlID0gdHJ1ZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGN1cnJlbnRDaGFyID09PSBcIlxcXFxcIikge1xuICAgICAgICAgICAgaWYgKHBvcyA8IGZvcm1hdC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBwb3MrKztcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gZm9ybWF0W3Bvc107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBUaGlzIG1lYW5zIHRoYXQgJ1xcJyBpcyB0aGUgbGFzdCBjaGFyYWN0ZXIgaW4gdGhlIHN0cmluZy5cbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHN0cmluZyBmb3JtYXRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQgKz0gY3VycmVudENoYXI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKCFmb3VuZFF1b3RlKSB7XG4gICAgICAgIC8vIFdlIGNvdWxkIG5vdCBmaW5kIHRoZSBtYXRjaGluZyBxdW90ZVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgc3RyaW5nIGZvcm1hdCBjb3VsZCBub3QgZmluZCBtYXRjaGluZyBxdW90ZSBmb3IgJHtxdW90ZUNoYXJ9YCk7XG4gICAgfVxuICAgIHJldHVybiBbcmVzdWx0LCBwb3MgLSBiZWdpblBvcyArIDFdO1xufVxuZnVuY3Rpb24gZGF0ZVRvU3RyaW5nV2l0aEN1c3RvbUZvcm1hdChkYXRlLCBmb3JtYXQsIHV0Yykge1xuICAgIGxldCBjdXJzb3JQb3MgPSAwO1xuICAgIGxldCB0b2tlbkxlbmd0aCA9IDA7XG4gICAgbGV0IHJlc3VsdCA9IFwiXCI7XG4gICAgY29uc3QgbG9jYWxpemVkRGF0ZSA9IHV0YyA/IERhdGVUaW1lKGRhdGUuZ2V0VGltZSgpLCAxIC8qIERhdGVLaW5kLlVUQyAqLykgOiBkYXRlO1xuICAgIHdoaWxlIChjdXJzb3JQb3MgPCBmb3JtYXQubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IHRva2VuID0gZm9ybWF0W2N1cnNvclBvc107XG4gICAgICAgIHN3aXRjaCAodG9rZW4pIHtcbiAgICAgICAgICAgIGNhc2UgXCJkXCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcImRcIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodG9rZW5MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGxvY2FsaXplZERhdGUuZ2V0RGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3MobG9jYWxpemVkRGF0ZS5nZXREYXRlKCksIDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBzaG9ydERheXNbZGF5T2ZXZWVrKGxvY2FsaXplZERhdGUpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gbG9uZ0RheXNbZGF5T2ZXZWVrKGxvY2FsaXplZERhdGUpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImZcIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwiZlwiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgaWYgKHRva2VuTGVuZ3RoIDw9IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJlY2lzaW9uID0gMTAgKiogKDMgLSB0b2tlbkxlbmd0aCk7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3MoTWF0aC5mbG9vcihtaWxsaXNlY29uZChsb2NhbGl6ZWREYXRlKSAvIHByZWNpc2lvbiksIHRva2VuTGVuZ3RoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodG9rZW5MZW5ndGggPD0gNykge1xuICAgICAgICAgICAgICAgICAgICAvLyBKYXZhU2NyaXB0IERhdGUgb25seSBzdXBwb3J0IHByZWNpc2lvbiB0byB0aGUgbWlsbGlzZWNvbmRcbiAgICAgICAgICAgICAgICAgICAgLy8gc28gd2UgZmlsbCB0aGUgcmVzdCBvZiB0aGUgcHJlY2lzaW9uIHdpdGggMCBhcyBpZiB0aGUgZGF0ZSBkaWRuJ3QgaGF2ZVxuICAgICAgICAgICAgICAgICAgICAvLyBtaWxsaXNlY29uZHMgcHJvdmlkZWQgdG8gaXQuXG4gICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdG8gaGF2ZSB0aGUgc2FtZSBiZWhhdmlvciBhcyAuTkVUIHdoZW4gZG9pbmc6XG4gICAgICAgICAgICAgICAgICAgIC8vIERhdGVUaW1lKDEsIDIsIDMsIDQsIDUsIDYsIERhdGVUaW1lS2luZC5VdGMpLlRvU3RyaW5nKFwiZmZmZmZcIikgPT4gMDAwMDBcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IChcIlwiICsgbWlsbGlzZWNvbmQobG9jYWxpemVkRGF0ZSkpLnBhZEVuZCh0b2tlbkxlbmd0aCwgXCIwXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJGXCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcIkZcIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmICh0b2tlbkxlbmd0aCA8PSAzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByZWNpc2lvbiA9IDEwICoqICgzIC0gdG9rZW5MZW5ndGgpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IE1hdGguZmxvb3IobWlsbGlzZWNvbmQobG9jYWxpemVkRGF0ZSkgLyBwcmVjaXNpb24pO1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyh2YWx1ZSwgdG9rZW5MZW5ndGgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRva2VuTGVuZ3RoIDw9IDcpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSmF2YVNjcmlwdCBEYXRlIG9ubHkgc3VwcG9ydCBwcmVjaXNpb24gdG8gdGhlIG1pbGxpc2Vjb25kXG4gICAgICAgICAgICAgICAgICAgIC8vIHNvIHdlIGNhbid0IGdvIGJleW9uZCB0aGF0LlxuICAgICAgICAgICAgICAgICAgICAvLyBXZSBhbHNvIG5lZWQgdG8gcGFkIHN0YXJ0IHdpdGggMCBpZiB0aGUgdmFsdWUgaXMgbm90IDBcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBtaWxsaXNlY29uZChsb2NhbGl6ZWREYXRlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3ModmFsdWUsIDMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImdcIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwiZ1wiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgaWYgKHRva2VuTGVuZ3RoIDw9IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IFwiQS5ELlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJoXCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcImhcIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodG9rZW5MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGhvdXIobG9jYWxpemVkRGF0ZSkgJSAxMjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKGhvdXIobG9jYWxpemVkRGF0ZSkgJSAxMiwgMik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJIXCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcIkhcIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodG9rZW5MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGhvdXIobG9jYWxpemVkRGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyhob3VyKGxvY2FsaXplZERhdGUpLCAyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIktcIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwiS1wiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0b2tlbkxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGtpbmQobG9jYWxpemVkRGF0ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEgLyogRGF0ZUtpbmQuVVRDICovOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gXCJaXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMiAvKiBEYXRlS2luZC5Mb2NhbCAqLzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGRhdGVPZmZzZXRUb1N0cmluZyhsb2NhbGl6ZWREYXRlLmdldFRpbWV6b25lT2Zmc2V0KCkgKiAtNjAwMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDAgLyogRGF0ZUtpbmQuVW5zcGVjaWZpZWQgKi86XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwibVwiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJtXCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRva2VuTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBtaW51dGUobG9jYWxpemVkRGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyhtaW51dGUobG9jYWxpemVkRGF0ZSksIDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiTVwiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJNXCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRva2VuTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBtb250aChsb2NhbGl6ZWREYXRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKG1vbnRoKGxvY2FsaXplZERhdGUpLCAyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gc2hvcnRNb250aHNbbW9udGgobG9jYWxpemVkRGF0ZSkgLSAxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gbG9uZ01vbnRoc1ttb250aChsb2NhbGl6ZWREYXRlKSAtIDFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwic1wiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJzXCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRva2VuTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBzZWNvbmQobG9jYWxpemVkRGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyhzZWNvbmQobG9jYWxpemVkRGF0ZSksIDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwidFwiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJ0XCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRva2VuTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBsb2NhbGl6ZWREYXRlLmdldEhvdXJzKCkgPCAxMiA/IFwiQVwiIDogXCJQXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGxvY2FsaXplZERhdGUuZ2V0SG91cnMoKSA8IDEyID8gXCJBTVwiIDogXCJQTVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwieVwiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJ5XCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRva2VuTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBsb2NhbGl6ZWREYXRlLmdldEZ1bGxZZWFyKCkgJSAxMDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyhsb2NhbGl6ZWREYXRlLmdldEZ1bGxZZWFyKCkgJSAxMDAsIDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3MobG9jYWxpemVkRGF0ZS5nZXRGdWxsWWVhcigpLCAzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKGxvY2FsaXplZERhdGUuZ2V0RnVsbFllYXIoKSwgNCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyhsb2NhbGl6ZWREYXRlLmdldEZ1bGxZZWFyKCksIDUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwielwiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJ6XCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBsZXQgdXRjT2Zmc2V0VGV4dCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChraW5kKGxvY2FsaXplZERhdGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMSAvKiBEYXRlS2luZC5VVEMgKi86XG4gICAgICAgICAgICAgICAgICAgICAgICB1dGNPZmZzZXRUZXh0ID0gXCIrMDA6MDBcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDIgLyogRGF0ZUtpbmQuTG9jYWwgKi86XG4gICAgICAgICAgICAgICAgICAgICAgICB1dGNPZmZzZXRUZXh0ID0gZGF0ZU9mZnNldFRvU3RyaW5nKGxvY2FsaXplZERhdGUuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIC02MDAwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwIC8qIERhdGVLaW5kLlVuc3BlY2lmaWVkICovOlxuICAgICAgICAgICAgICAgICAgICAgICAgdXRjT2Zmc2V0VGV4dCA9IGRhdGVPZmZzZXRUb1N0cmluZyh0b0xvY2FsVGltZShsb2NhbGl6ZWREYXRlKS5nZXRUaW1lem9uZU9mZnNldCgpICogLTYwMDAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBzaWduID0gdXRjT2Zmc2V0VGV4dFswXSA9PT0gXCItXCIgPyBcIi1cIiA6IFwiK1wiO1xuICAgICAgICAgICAgICAgIGNvbnN0IGhvdXJzID0gcGFyc2VJbnQodXRjT2Zmc2V0VGV4dC5zdWJzdHJpbmcoMSwgMyksIDEwKTtcbiAgICAgICAgICAgICAgICBjb25zdCBtaW51dGVzID0gcGFyc2VJbnQodXRjT2Zmc2V0VGV4dC5zdWJzdHJpbmcoNCwgNiksIDEwKTtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRva2VuTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBgJHtzaWdufSR7aG91cnN9YDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gYCR7c2lnbn0ke3BhZFdpdGhaZXJvcyhob3VycywgMil9YDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGAke3NpZ259JHtwYWRXaXRoWmVyb3MoaG91cnMsIDIpfToke3BhZFdpdGhaZXJvcyhtaW51dGVzLCAyKX1gO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIjpcIjpcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gXCI6XCI7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zKys7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiL1wiOlxuICAgICAgICAgICAgICAgIHJlc3VsdCArPSBcIi9cIjtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MrKztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCInXCI6XG4gICAgICAgICAgICBjYXNlICdcIic6XG4gICAgICAgICAgICAgICAgY29uc3QgW3F1b3RlZFN0cmluZywgcXVvdGVkU3RyaW5nTGVuZ2h0XSA9IHBhcnNlUXVvdGVkU3RyaW5nKGZvcm1hdCwgY3Vyc29yUG9zKTtcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gcXVvdGVkU3RyaW5nO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSBxdW90ZWRTdHJpbmdMZW5naHQ7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiJVwiOlxuICAgICAgICAgICAgICAgIGNvbnN0IG5leHRDaGFyID0gcGFyc2VOZXh0Q2hhcihmb3JtYXQsIGN1cnNvclBvcyk7XG4gICAgICAgICAgICAgICAgaWYgKG5leHRDaGFyID49IDAgJiYgbmV4dENoYXIgIT09IFwiJVwiLmNoYXJDb2RlQXQoMCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IDI7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBkYXRlVG9TdHJpbmdXaXRoQ3VzdG9tRm9ybWF0KGxvY2FsaXplZERhdGUsIFN0cmluZy5mcm9tQ2hhckNvZGUobmV4dENoYXIpLCB1dGMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBmb3JtYXQgc3RyaW5nXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJcXFxcXCI6XG4gICAgICAgICAgICAgICAgY29uc3QgbmV4dENoYXIyID0gcGFyc2VOZXh0Q2hhcihmb3JtYXQsIGN1cnNvclBvcyk7XG4gICAgICAgICAgICAgICAgaWYgKG5leHRDaGFyMiA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSAyO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShuZXh0Q2hhcjIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBmb3JtYXQgc3RyaW5nXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zKys7XG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IHRva2VuO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG5leHBvcnQgZnVuY3Rpb24ga2luZCh2YWx1ZSkge1xuICAgIHJldHVybiB2YWx1ZS5raW5kIHx8IDA7XG59XG5leHBvcnQgZnVuY3Rpb24gdW5peEVwb2NoTWlsbGlzZWNvbmRzVG9UaWNrcyhtcywgb2Zmc2V0KSB7XG4gICAgcmV0dXJuIHRvSW50NjQoKChCaWdJbnQobXMpICsgNjIxMzU1OTY4MDAwMDBuKSArIEJpZ0ludChvZmZzZXQpKSAqIDEwMDAwbik7XG59XG5leHBvcnQgZnVuY3Rpb24gdGlja3NUb1VuaXhFcG9jaE1pbGxpc2Vjb25kcyh0aWNrcykge1xuICAgIHJldHVybiBOdW1iZXIoKChCaWdJbnQodGlja3MpIC8gMTAwMDBuKSAtIDYyMTM1NTk2ODAwMDAwbikpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGRhdGVPZmZzZXRUb1N0cmluZyhvZmZzZXQpIHtcbiAgICBjb25zdCBpc01pbnVzID0gb2Zmc2V0IDwgMDtcbiAgICBvZmZzZXQgPSBNYXRoLmFicyhvZmZzZXQpO1xuICAgIGNvbnN0IGhvdXJzID0gfn4ob2Zmc2V0IC8gMzYwMDAwMCk7XG4gICAgY29uc3QgbWludXRlcyA9IChvZmZzZXQgJSAzNjAwMDAwKSAvIDYwMDAwO1xuICAgIHJldHVybiAoaXNNaW51cyA/IFwiLVwiIDogXCIrXCIpICtcbiAgICAgICAgcGFkV2l0aFplcm9zKGhvdXJzLCAyKSArIFwiOlwiICtcbiAgICAgICAgcGFkV2l0aFplcm9zKG1pbnV0ZXMsIDIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGRhdGVUb0hhbGZVVENTdHJpbmcoZGF0ZSwgaGFsZikge1xuICAgIGNvbnN0IHN0ciA9IGRhdGUudG9JU09TdHJpbmcoKTtcbiAgICByZXR1cm4gaGFsZiA9PT0gXCJmaXJzdFwiXG4gICAgICAgID8gc3RyLnN1YnN0cmluZygwLCBzdHIuaW5kZXhPZihcIlRcIikpXG4gICAgICAgIDogc3RyLnN1YnN0cmluZyhzdHIuaW5kZXhPZihcIlRcIikgKyAxLCBzdHIubGVuZ3RoIC0gMSk7XG59XG5mdW5jdGlvbiBkYXRlVG9JU09TdHJpbmcoZCwgdXRjKSB7XG4gICAgaWYgKHV0Yykge1xuICAgICAgICByZXR1cm4gZC50b0lTT1N0cmluZygpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gSlMgRGF0ZSBpcyBhbHdheXMgbG9jYWxcbiAgICAgICAgY29uc3QgcHJpbnRPZmZzZXQgPSBkLmtpbmQgPT0gbnVsbCA/IHRydWUgOiBkLmtpbmQgPT09IDIgLyogRGF0ZUtpbmQuTG9jYWwgKi87XG4gICAgICAgIHJldHVybiBwYWRXaXRoWmVyb3MoZC5nZXRGdWxsWWVhcigpLCA0KSArIFwiLVwiICtcbiAgICAgICAgICAgIHBhZFdpdGhaZXJvcyhkLmdldE1vbnRoKCkgKyAxLCAyKSArIFwiLVwiICtcbiAgICAgICAgICAgIHBhZFdpdGhaZXJvcyhkLmdldERhdGUoKSwgMikgKyBcIlRcIiArXG4gICAgICAgICAgICBwYWRXaXRoWmVyb3MoZC5nZXRIb3VycygpLCAyKSArIFwiOlwiICtcbiAgICAgICAgICAgIHBhZFdpdGhaZXJvcyhkLmdldE1pbnV0ZXMoKSwgMikgKyBcIjpcIiArXG4gICAgICAgICAgICBwYWRXaXRoWmVyb3MoZC5nZXRTZWNvbmRzKCksIDIpICsgXCIuXCIgK1xuICAgICAgICAgICAgcGFkV2l0aFplcm9zKGQuZ2V0TWlsbGlzZWNvbmRzKCksIDMpICtcbiAgICAgICAgICAgIChwcmludE9mZnNldCA/IGRhdGVPZmZzZXRUb1N0cmluZyhkLmdldFRpbWV6b25lT2Zmc2V0KCkgKiAtNjAwMDApIDogXCJcIik7XG4gICAgfVxufVxuZnVuY3Rpb24gZGF0ZVRvSVNPU3RyaW5nV2l0aE9mZnNldChkYXRlV2l0aE9mZnNldCwgb2Zmc2V0KSB7XG4gICAgY29uc3Qgc3RyID0gZGF0ZVdpdGhPZmZzZXQudG9JU09TdHJpbmcoKTtcbiAgICByZXR1cm4gc3RyLnN1YnN0cmluZygwLCBzdHIubGVuZ3RoIC0gMSkgKyBkYXRlT2Zmc2V0VG9TdHJpbmcob2Zmc2V0KTtcbn1cbmZ1bmN0aW9uIGRhdGVUb1N0cmluZ1dpdGhPZmZzZXQoZGF0ZSwgZm9ybWF0KSB7XG4gICAgY29uc3QgZCA9IG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpICsgKGRhdGUub2Zmc2V0ID8/IDApKTtcbiAgICBpZiAodHlwZW9mIGZvcm1hdCAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICByZXR1cm4gZC50b0lTT1N0cmluZygpLnJlcGxhY2UoL1xcLlxcZCsvLCBcIlwiKS5yZXBsYWNlKC9bQS1aXXxcXC5cXGQrL2csIFwiIFwiKSArIGRhdGVPZmZzZXRUb1N0cmluZygoZGF0ZS5vZmZzZXQgPz8gMCkpO1xuICAgIH1cbiAgICBlbHNlIGlmIChmb3JtYXQubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIHN3aXRjaCAoZm9ybWF0KSB7XG4gICAgICAgICAgICBjYXNlIFwiRFwiOlxuICAgICAgICAgICAgY2FzZSBcImRcIjogcmV0dXJuIGRhdGVUb0hhbGZVVENTdHJpbmcoZCwgXCJmaXJzdFwiKTtcbiAgICAgICAgICAgIGNhc2UgXCJUXCI6XG4gICAgICAgICAgICBjYXNlIFwidFwiOiByZXR1cm4gZGF0ZVRvSGFsZlVUQ1N0cmluZyhkLCBcInNlY29uZFwiKTtcbiAgICAgICAgICAgIGNhc2UgXCJPXCI6XG4gICAgICAgICAgICBjYXNlIFwib1wiOiByZXR1cm4gZGF0ZVRvSVNPU3RyaW5nV2l0aE9mZnNldChkLCAoZGF0ZS5vZmZzZXQgPz8gMCkpO1xuICAgICAgICAgICAgZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKFwiVW5yZWNvZ25pemVkIERhdGUgcHJpbnQgZm9ybWF0XCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gZGF0ZVRvU3RyaW5nV2l0aEN1c3RvbUZvcm1hdChkLCBmb3JtYXQsIHRydWUpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGRhdGVUb1N0cmluZ1dpdGhLaW5kKGRhdGUsIGZvcm1hdCkge1xuICAgIGNvbnN0IHV0YyA9IGRhdGUua2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi87XG4gICAgaWYgKHR5cGVvZiBmb3JtYXQgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgcmV0dXJuIHV0YyA/IGRhdGUudG9VVENTdHJpbmcoKSA6IGRhdGUudG9Mb2NhbGVTdHJpbmcoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoZm9ybWF0Lmxlbmd0aCA9PT0gMSkge1xuICAgICAgICBzd2l0Y2ggKGZvcm1hdCkge1xuICAgICAgICAgICAgY2FzZSBcIkRcIjpcbiAgICAgICAgICAgIGNhc2UgXCJkXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHV0YyA/IGRhdGVUb0hhbGZVVENTdHJpbmcoZGF0ZSwgXCJmaXJzdFwiKSA6IGRhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKCk7XG4gICAgICAgICAgICBjYXNlIFwiVFwiOlxuICAgICAgICAgICAgY2FzZSBcInRcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gdXRjID8gZGF0ZVRvSGFsZlVUQ1N0cmluZyhkYXRlLCBcInNlY29uZFwiKSA6IGRhdGUudG9Mb2NhbGVUaW1lU3RyaW5nKCk7XG4gICAgICAgICAgICBjYXNlIFwiT1wiOlxuICAgICAgICAgICAgY2FzZSBcIm9cIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZVRvSVNPU3RyaW5nKGRhdGUsIHV0Yyk7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVucmVjb2duaXplZCBEYXRlIHByaW50IGZvcm1hdFwiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGRhdGVUb1N0cmluZ1dpdGhDdXN0b21Gb3JtYXQoZGF0ZSwgZm9ybWF0LCB1dGMpO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiB0b1N0cmluZyhkYXRlLCBmb3JtYXQsIF9wcm92aWRlcikge1xuICAgIHJldHVybiBkYXRlLm9mZnNldCAhPSBudWxsXG4gICAgICAgID8gZGF0ZVRvU3RyaW5nV2l0aE9mZnNldChkYXRlLCBmb3JtYXQpXG4gICAgICAgIDogZGF0ZVRvU3RyaW5nV2l0aEtpbmQoZGF0ZSwgZm9ybWF0KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBEYXRlVGltZSh2YWx1ZSwga2luZCkge1xuICAgIGNvbnN0IGQgPSBuZXcgRGF0ZSh2YWx1ZSk7XG4gICAgZC5raW5kID0gKGtpbmQgPT0gbnVsbCA/IDAgLyogRGF0ZUtpbmQuVW5zcGVjaWZpZWQgKi8gOiBraW5kKSB8IDA7XG4gICAgcmV0dXJuIGQ7XG59XG5leHBvcnQgZnVuY3Rpb24gZnJvbVRpY2tzKHRpY2tzLCBraW5kKSB7XG4gICAga2luZCA9IGtpbmQgIT0gbnVsbCA/IGtpbmQgOiAyIC8qIERhdGVLaW5kLkxvY2FsICovOyAvLyBiZXR0ZXIgZGVmYXVsdCB0aGFuIFVuc3BlY2lmaWVkXG4gICAgbGV0IGRhdGUgPSBEYXRlVGltZSh0aWNrc1RvVW5peEVwb2NoTWlsbGlzZWNvbmRzKHRpY2tzKSwga2luZCk7XG4gICAgLy8gVGlja3MgYXJlIGxvY2FsIHRvIG9mZnNldCAoaW4gdGhpcyBjYXNlLCBlaXRoZXIgVVRDIG9yIExvY2FsL1Vua25vd24pLlxuICAgIC8vIElmIGtpbmQgaXMgYW55dGhpbmcgYnV0IFVUQywgdGhhdCBtZWFucyB0aGF0IHRoZSB0aWNrIG51bWJlciB3YXMgbm90XG4gICAgLy8gaW4gdXRjLCB0aHVzIGdldFRpbWUoKSBjYW5ub3QgcmV0dXJuIFVUQywgYW5kIG5lZWRzIHRvIGJlIHNoaWZ0ZWQuXG4gICAgaWYgKGtpbmQgIT09IDEgLyogRGF0ZUtpbmQuVVRDICovKSB7XG4gICAgICAgIGRhdGUgPSBEYXRlVGltZShkYXRlLmdldFRpbWUoKSAtIGRhdGVPZmZzZXQoZGF0ZSksIGtpbmQpO1xuICAgIH1cbiAgICByZXR1cm4gZGF0ZTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBmcm9tRGF0ZVRpbWVPZmZzZXQoZGF0ZSwga2luZCkge1xuICAgIHN3aXRjaCAoa2luZCkge1xuICAgICAgICBjYXNlIDEgLyogRGF0ZUtpbmQuVVRDICovOiByZXR1cm4gRGF0ZVRpbWUoZGF0ZS5nZXRUaW1lKCksIDEgLyogRGF0ZUtpbmQuVVRDICovKTtcbiAgICAgICAgY2FzZSAyIC8qIERhdGVLaW5kLkxvY2FsICovOiByZXR1cm4gRGF0ZVRpbWUoZGF0ZS5nZXRUaW1lKCksIDIgLyogRGF0ZUtpbmQuTG9jYWwgKi8pO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgY29uc3QgZCA9IERhdGVUaW1lKGRhdGUuZ2V0VGltZSgpICsgKGRhdGUub2Zmc2V0ID8/IDApLCBraW5kKTtcbiAgICAgICAgICAgIHJldHVybiBEYXRlVGltZShkLmdldFRpbWUoKSAtIGRhdGVPZmZzZXQoZCksIGtpbmQpO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBnZXRUaWNrcyhkYXRlKSB7XG4gICAgcmV0dXJuIHVuaXhFcG9jaE1pbGxpc2Vjb25kc1RvVGlja3MoZGF0ZS5nZXRUaW1lKCksIGRhdGVPZmZzZXQoZGF0ZSkpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIG1pblZhbHVlKCkge1xuICAgIC8vIFRoaXMgaXMgXCIwMDAxLTAxLTAxVDAwOjAwOjAwLjAwMFpcIiwgYWN0dWFsIEpTIG1pbiB2YWx1ZSBpcyAtODY0MDAwMDAwMDAwMDAwMFxuICAgIHJldHVybiBEYXRlVGltZSgtNjIxMzU1OTY4MDAwMDAsIDAgLyogRGF0ZUtpbmQuVW5zcGVjaWZpZWQgKi8pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIG1heFZhbHVlKCkge1xuICAgIC8vIFRoaXMgaXMgXCI5OTk5LTEyLTMxVDIzOjU5OjU5Ljk5OVpcIiwgYWN0dWFsIEpTIG1heCB2YWx1ZSBpcyA4NjQwMDAwMDAwMDAwMDAwXG4gICAgcmV0dXJuIERhdGVUaW1lKDI1MzQwMjMwMDc5OTk5OSwgMCAvKiBEYXRlS2luZC5VbnNwZWNpZmllZCAqLyk7XG59XG5leHBvcnQgZnVuY3Rpb24gcGFyc2VSYXcoaW5wdXQpIHtcbiAgICBmdW5jdGlvbiBmYWlsKCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBzdHJpbmcgaXMgbm90IGEgdmFsaWQgRGF0ZTogJHtpbnB1dH1gKTtcbiAgICB9XG4gICAgaWYgKGlucHV0ID09IG51bGwgfHwgaW5wdXQudHJpbSgpID09PSBcIlwiKSB7XG4gICAgICAgIGZhaWwoKTtcbiAgICB9XG4gICAgLy8gSVNPIGRhdGVzIHdpdGhvdXQgVFogYXJlIHBhcnNlZCBhcyBVVEMuIEFkZGluZyB0aW1lIHdpdGhvdXQgVFoga2VlcHMgdGhlbSBsb2NhbC5cbiAgICBpZiAoaW5wdXQubGVuZ3RoID09PSAxMCAmJiBpbnB1dFs0XSA9PT0gXCItXCIgJiYgaW5wdXRbN10gPT09IFwiLVwiKSB7XG4gICAgICAgIGlucHV0ICs9IFwiVDAwOjAwOjAwXCI7XG4gICAgfVxuICAgIGxldCBkYXRlID0gbmV3IERhdGUoaW5wdXQpO1xuICAgIGxldCBvZmZzZXQgPSBudWxsO1xuICAgIGlmIChpc05hTihkYXRlLmdldFRpbWUoKSkpIHtcbiAgICAgICAgLy8gVHJ5IHRvIGNoZWNrIHN0cmluZ3MgSlMgRGF0ZSBjYW5ub3QgcGFyc2UgKHNlZSAjMTA0NSwgIzE0MjIpXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtbGluZS1sZW5ndGhcbiAgICAgICAgY29uc3QgbSA9IC9eXFxzKihcXGQrW15cXHdcXHM6XVxcZCtbXlxcd1xcczpdXFxkKyk/XFxzKihcXGQrOlxcZCsoPzo6XFxkKyg/OlxcLlxcZCspPyk/KT9cXHMqKFtBYVBwXVtNbV0pP1xccyooWnxbKy1dKFswMV0/XFxkKTo/KFswLTVdP1xcZCk/KT9cXHMqJC8uZXhlYyhpbnB1dCk7XG4gICAgICAgIGlmIChtICE9IG51bGwpIHtcbiAgICAgICAgICAgIGxldCBiYXNlRGF0ZTtcbiAgICAgICAgICAgIGxldCB0aW1lSW5TZWNvbmRzID0gMDtcbiAgICAgICAgICAgIGlmIChtWzJdICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0aW1lUGFydHMgPSBtWzJdLnNwbGl0KFwiOlwiKTtcbiAgICAgICAgICAgICAgICBjb25zdCBob3VyUGFydCA9IHBhcnNlSW50KHRpbWVQYXJ0c1swXSwgMTApO1xuICAgICAgICAgICAgICAgIHRpbWVJblNlY29uZHMgPVxuICAgICAgICAgICAgICAgICAgICBob3VyUGFydCAqIDM2MDAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VJbnQodGltZVBhcnRzWzFdIHx8IFwiMFwiLCAxMCkgKiA2MCArXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUZsb2F0KHRpbWVQYXJ0c1syXSB8fCBcIjBcIik7XG4gICAgICAgICAgICAgICAgaWYgKG1bM10gIT0gbnVsbCAmJiBtWzNdLnRvVXBwZXJDYXNlKCkgPT09IFwiUE1cIiAmJiBob3VyUGFydCA8IDEyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRpbWVJblNlY29uZHMgKz0gNzIwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChtWzRdICE9IG51bGwpIHsgLy8gVGhlcmUncyBhbiBvZmZzZXQsIHBhcnNlIGFzIFVUQ1xuICAgICAgICAgICAgICAgIGlmIChtWzFdICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgYmFzZURhdGUgPSBuZXcgRGF0ZShtWzFdICsgXCIgVVRDXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZCA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIGJhc2VEYXRlID0gbmV3IERhdGUoZC5nZXRVVENGdWxsWWVhcigpICsgXCIvXCIgKyAoZC5nZXRVVENNb250aCgpICsgMSkgKyBcIi9cIiArIGQuZ2V0VVRDRGF0ZSgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG1bNF0gPT09IFwiWlwiKSB7XG4gICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IFwiWlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IG9mZnNldEluTWludXRlcyA9IHBhcnNlSW50KG1bNV0sIDEwKSAqIDYwICsgcGFyc2VJbnQobVs2XSB8fCBcIjBcIiwgMTApO1xuICAgICAgICAgICAgICAgICAgICBpZiAobVs0XVswXSA9PT0gXCItXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldEluTWludXRlcyAqPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSBvZmZzZXRJbk1pbnV0ZXM7XG4gICAgICAgICAgICAgICAgICAgIHRpbWVJblNlY29uZHMgLT0gb2Zmc2V0SW5NaW51dGVzICogNjA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKG1bMV0gIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBiYXNlRGF0ZSA9IG5ldyBEYXRlKG1bMV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZCA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIGJhc2VEYXRlID0gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpICsgXCIvXCIgKyAoZC5nZXRNb250aCgpICsgMSkgKyBcIi9cIiArIGQuZ2V0RGF0ZSgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkYXRlID0gbmV3IERhdGUoYmFzZURhdGUuZ2V0VGltZSgpICsgdGltZUluU2Vjb25kcyAqIDEwMDApO1xuICAgICAgICAgICAgLy8gY29ycmVjdCBmb3IgZGF5bGlnaHQgc2F2aW5ncyB0aW1lXG4gICAgICAgICAgICBkYXRlID0gbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkgKyAoZGF0ZS5nZXRUaW1lem9uZU9mZnNldCgpIC0gYmFzZURhdGUuZ2V0VGltZXpvbmVPZmZzZXQoKSkgKiA2MDAwMCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBmYWlsKCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ2hlY2sgYWdhaW4gdGhlIGRhdGUgaXMgdmFsaWQgYWZ0ZXIgdHJhbnNmb3JtYXRpb25zLCBzZWUgIzIyMjlcbiAgICAgICAgaWYgKGlzTmFOKGRhdGUuZ2V0VGltZSgpKSkge1xuICAgICAgICAgICAgZmFpbCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBbZGF0ZSwgb2Zmc2V0XTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZShzdHIsIGRldGVjdFVUQyA9IGZhbHNlKSB7XG4gICAgY29uc3QgW2RhdGUsIG9mZnNldF0gPSBwYXJzZVJhdyhzdHIpO1xuICAgIC8vIC5ORVQgYWx3YXlzIHBhcnNlcyBEYXRlVGltZSBhcyBMb2NhbCBpZiB0aGVyZSdzIG9mZnNldCBpbmZvIChldmVuIFwiWlwiKVxuICAgIC8vIE5ld3RvbnNvZnQuSnNvbiB1c2VzIFVUQyBpZiB0aGUgb2Zmc2V0IGlzIFwiWlwiXG4gICAgY29uc3Qga2luZCA9IG9mZnNldCAhPSBudWxsXG4gICAgICAgID8gKGRldGVjdFVUQyAmJiBvZmZzZXQgPT09IFwiWlwiID8gMSAvKiBEYXRlS2luZC5VVEMgKi8gOiAyIC8qIERhdGVLaW5kLkxvY2FsICovKVxuICAgICAgICA6IDAgLyogRGF0ZUtpbmQuVW5zcGVjaWZpZWQgKi87XG4gICAgcmV0dXJuIERhdGVUaW1lKGRhdGUuZ2V0VGltZSgpLCBraW5kKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0cnlQYXJzZSh2LCBkZWZWYWx1ZSkge1xuICAgIHRyeSB7XG4gICAgICAgIGRlZlZhbHVlLmNvbnRlbnRzID0gcGFyc2Uodik7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBjYXRjaCAoX2Vycikge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZSh5ZWFyLCBtb250aCwgZGF5LCBoID0gMCwgbSA9IDAsIHMgPSAwLCBtcyA9IDAsIGtpbmQpIHtcbiAgICBjb25zdCBkYXRlID0ga2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi9cbiAgICAgICAgPyBuZXcgRGF0ZShEYXRlLlVUQyh5ZWFyLCBtb250aCAtIDEsIGRheSwgaCwgbSwgcywgbXMpKVxuICAgICAgICA6IG5ldyBEYXRlKHllYXIsIG1vbnRoIC0gMSwgZGF5LCBoLCBtLCBzLCBtcyk7XG4gICAgaWYgKHllYXIgPD0gOTkpIHtcbiAgICAgICAgaWYgKGtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovKSB7XG4gICAgICAgICAgICBkYXRlLnNldFVUQ0Z1bGxZZWFyKHllYXIsIG1vbnRoIC0gMSwgZGF5KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGRhdGUuc2V0RnVsbFllYXIoeWVhciwgbW9udGggLSAxLCBkYXkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGRhdGVWYWx1ZSA9IGRhdGUuZ2V0VGltZSgpO1xuICAgIGlmIChpc05hTihkYXRlVmFsdWUpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoZSBwYXJhbWV0ZXJzIGRlc2NyaWJlIGFuIHVucmVwcmVzZW50YWJsZSBEYXRlLlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIERhdGVUaW1lKGRhdGVWYWx1ZSwga2luZCk7XG59XG5leHBvcnQgZnVuY3Rpb24gbm93KCkge1xuICAgIHJldHVybiBEYXRlVGltZShEYXRlLm5vdygpLCAyIC8qIERhdGVLaW5kLkxvY2FsICovKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB1dGNOb3coKSB7XG4gICAgcmV0dXJuIERhdGVUaW1lKERhdGUubm93KCksIDEgLyogRGF0ZUtpbmQuVVRDICovKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b2RheSgpIHtcbiAgICByZXR1cm4gZGF0ZShub3coKSk7XG59XG5leHBvcnQgZnVuY3Rpb24gaXNMZWFwWWVhcih5ZWFyKSB7XG4gICAgcmV0dXJuIHllYXIgJSA0ID09PSAwICYmIHllYXIgJSAxMDAgIT09IDAgfHwgeWVhciAlIDQwMCA9PT0gMDtcbn1cbmV4cG9ydCBmdW5jdGlvbiBkYXlzSW5Nb250aCh5ZWFyLCBtb250aCkge1xuICAgIHJldHVybiBtb250aCA9PT0gMlxuICAgICAgICA/IChpc0xlYXBZZWFyKHllYXIpID8gMjkgOiAyOClcbiAgICAgICAgOiAobW9udGggPj0gOCA/IChtb250aCAlIDIgPT09IDAgPyAzMSA6IDMwKSA6IChtb250aCAlIDIgPT09IDAgPyAzMCA6IDMxKSk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9Vbml2ZXJzYWxUaW1lKGRhdGUpIHtcbiAgICByZXR1cm4gZGF0ZS5raW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqLyA/IGRhdGUgOiBEYXRlVGltZShkYXRlLmdldFRpbWUoKSwgMSAvKiBEYXRlS2luZC5VVEMgKi8pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvTG9jYWxUaW1lKGRhdGUpIHtcbiAgICByZXR1cm4gZGF0ZS5raW5kID09PSAyIC8qIERhdGVLaW5kLkxvY2FsICovID8gZGF0ZSA6IERhdGVUaW1lKGRhdGUuZ2V0VGltZSgpLCAyIC8qIERhdGVLaW5kLkxvY2FsICovKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBzcGVjaWZ5S2luZChkLCBraW5kKSB7XG4gICAgcmV0dXJuIGNyZWF0ZSh5ZWFyKGQpLCBtb250aChkKSwgZGF5KGQpLCBob3VyKGQpLCBtaW51dGUoZCksIHNlY29uZChkKSwgbWlsbGlzZWNvbmQoZCksIGtpbmQpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRpbWVPZkRheShkKSB7XG4gICAgcmV0dXJuIGhvdXIoZCkgKiAzNjAwMDAwXG4gICAgICAgICsgbWludXRlKGQpICogNjAwMDBcbiAgICAgICAgKyBzZWNvbmQoZCkgKiAxMDAwXG4gICAgICAgICsgbWlsbGlzZWNvbmQoZCk7XG59XG5leHBvcnQgZnVuY3Rpb24gZGF0ZShkKSB7XG4gICAgcmV0dXJuIGNyZWF0ZSh5ZWFyKGQpLCBtb250aChkKSwgZGF5KGQpLCAwLCAwLCAwLCAwLCBkLmtpbmQpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGRheShkKSB7XG4gICAgcmV0dXJuIGQua2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi8gPyBkLmdldFVUQ0RhdGUoKSA6IGQuZ2V0RGF0ZSgpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGhvdXIoZCkge1xuICAgIHJldHVybiBkLmtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovID8gZC5nZXRVVENIb3VycygpIDogZC5nZXRIb3VycygpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIG1pbGxpc2Vjb25kKGQpIHtcbiAgICByZXR1cm4gZC5raW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqLyA/IGQuZ2V0VVRDTWlsbGlzZWNvbmRzKCkgOiBkLmdldE1pbGxpc2Vjb25kcygpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIG1pbnV0ZShkKSB7XG4gICAgcmV0dXJuIGQua2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi8gPyBkLmdldFVUQ01pbnV0ZXMoKSA6IGQuZ2V0TWludXRlcygpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIG1vbnRoKGQpIHtcbiAgICByZXR1cm4gKGQua2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi8gPyBkLmdldFVUQ01vbnRoKCkgOiBkLmdldE1vbnRoKCkpICsgMTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBzZWNvbmQoZCkge1xuICAgIHJldHVybiBkLmtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovID8gZC5nZXRVVENTZWNvbmRzKCkgOiBkLmdldFNlY29uZHMoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB5ZWFyKGQpIHtcbiAgICByZXR1cm4gZC5raW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqLyA/IGQuZ2V0VVRDRnVsbFllYXIoKSA6IGQuZ2V0RnVsbFllYXIoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBkYXlPZldlZWsoZCkge1xuICAgIHJldHVybiBkLmtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovID8gZC5nZXRVVENEYXkoKSA6IGQuZ2V0RGF5KCk7XG59XG5leHBvcnQgZnVuY3Rpb24gZGF5T2ZZZWFyKGQpIHtcbiAgICBjb25zdCBfeWVhciA9IHllYXIoZCk7XG4gICAgY29uc3QgX21vbnRoID0gbW9udGgoZCk7XG4gICAgbGV0IF9kYXkgPSBkYXkoZCk7XG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPCBfbW9udGg7IGkrKykge1xuICAgICAgICBfZGF5ICs9IGRheXNJbk1vbnRoKF95ZWFyLCBpKTtcbiAgICB9XG4gICAgcmV0dXJuIF9kYXk7XG59XG5leHBvcnQgZnVuY3Rpb24gYWRkKGQsIHRzKSB7XG4gICAgY29uc3QgbmV3RGF0ZSA9IERhdGVUaW1lKGQuZ2V0VGltZSgpICsgdHMsIGQua2luZCk7XG4gICAgaWYgKGQua2luZCA9PT0gMiAvKiBEYXRlS2luZC5Mb2NhbCAqLykge1xuICAgICAgICBjb25zdCBvbGRUek9mZnNldCA9IGQuZ2V0VGltZXpvbmVPZmZzZXQoKTtcbiAgICAgICAgY29uc3QgbmV3VHpPZmZzZXQgPSBuZXdEYXRlLmdldFRpbWV6b25lT2Zmc2V0KCk7XG4gICAgICAgIHJldHVybiBvbGRUek9mZnNldCAhPT0gbmV3VHpPZmZzZXRcbiAgICAgICAgICAgID8gRGF0ZVRpbWUobmV3RGF0ZS5nZXRUaW1lKCkgKyAobmV3VHpPZmZzZXQgLSBvbGRUek9mZnNldCkgKiA2MDAwMCwgZC5raW5kKVxuICAgICAgICAgICAgOiBuZXdEYXRlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG5ld0RhdGU7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGFkZERheXMoZCwgdikge1xuICAgIHJldHVybiBhZGQoZCwgdiAqIDg2NDAwMDAwKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBhZGRIb3VycyhkLCB2KSB7XG4gICAgcmV0dXJuIGFkZChkLCB2ICogMzYwMDAwMCk7XG59XG5leHBvcnQgZnVuY3Rpb24gYWRkTWludXRlcyhkLCB2KSB7XG4gICAgcmV0dXJuIGFkZChkLCB2ICogNjAwMDApO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGFkZFNlY29uZHMoZCwgdikge1xuICAgIHJldHVybiBhZGQoZCwgdiAqIDEwMDApO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGFkZE1pbGxpc2Vjb25kcyhkLCB2KSB7XG4gICAgcmV0dXJuIGFkZChkLCB2KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBhZGRUaWNrcyhkLCB2KSB7XG4gICAgcmV0dXJuIGFkZChkLCB0b0Zsb2F0NjQodiAvIDEwMDAwbikpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGFkZFllYXJzKGQsIHYpIHtcbiAgICBjb25zdCBuZXdNb250aCA9IG1vbnRoKGQpO1xuICAgIGNvbnN0IG5ld1llYXIgPSB5ZWFyKGQpICsgdjtcbiAgICBjb25zdCBfZGF5c0luTW9udGggPSBkYXlzSW5Nb250aChuZXdZZWFyLCBuZXdNb250aCk7XG4gICAgY29uc3QgbmV3RGF5ID0gTWF0aC5taW4oX2RheXNJbk1vbnRoLCBkYXkoZCkpO1xuICAgIHJldHVybiBjcmVhdGUobmV3WWVhciwgbmV3TW9udGgsIG5ld0RheSwgaG91cihkKSwgbWludXRlKGQpLCBzZWNvbmQoZCksIG1pbGxpc2Vjb25kKGQpLCBkLmtpbmQpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGFkZE1vbnRocyhkLCB2KSB7XG4gICAgbGV0IG5ld01vbnRoID0gbW9udGgoZCkgKyB2O1xuICAgIGxldCBuZXdNb250aF8gPSAwO1xuICAgIGxldCB5ZWFyT2Zmc2V0ID0gMDtcbiAgICBpZiAobmV3TW9udGggPiAxMikge1xuICAgICAgICBuZXdNb250aF8gPSBuZXdNb250aCAlIDEyO1xuICAgICAgICB5ZWFyT2Zmc2V0ID0gTWF0aC5mbG9vcihuZXdNb250aCAvIDEyKTtcbiAgICAgICAgbmV3TW9udGggPSBuZXdNb250aF87XG4gICAgfVxuICAgIGVsc2UgaWYgKG5ld01vbnRoIDwgMSkge1xuICAgICAgICBuZXdNb250aF8gPSAxMiArIG5ld01vbnRoICUgMTI7XG4gICAgICAgIHllYXJPZmZzZXQgPSBNYXRoLmZsb29yKG5ld01vbnRoIC8gMTIpICsgKG5ld01vbnRoXyA9PT0gMTIgPyAtMSA6IDApO1xuICAgICAgICBuZXdNb250aCA9IG5ld01vbnRoXztcbiAgICB9XG4gICAgY29uc3QgbmV3WWVhciA9IHllYXIoZCkgKyB5ZWFyT2Zmc2V0O1xuICAgIGNvbnN0IF9kYXlzSW5Nb250aCA9IGRheXNJbk1vbnRoKG5ld1llYXIsIG5ld01vbnRoKTtcbiAgICBjb25zdCBuZXdEYXkgPSBNYXRoLm1pbihfZGF5c0luTW9udGgsIGRheShkKSk7XG4gICAgcmV0dXJuIGNyZWF0ZShuZXdZZWFyLCBuZXdNb250aCwgbmV3RGF5LCBob3VyKGQpLCBtaW51dGUoZCksIHNlY29uZChkKSwgbWlsbGlzZWNvbmQoZCksIGQua2luZCk7XG59XG5leHBvcnQgZnVuY3Rpb24gc3VidHJhY3QoZCwgdGhhdCkge1xuICAgIHJldHVybiB0eXBlb2YgdGhhdCA9PT0gXCJudW1iZXJcIlxuICAgICAgICA/IGFkZChkLCAtdGhhdClcbiAgICAgICAgOiBkLmdldFRpbWUoKSAtIHRoYXQuZ2V0VGltZSgpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvTG9uZ0RhdGVTdHJpbmcoZCkge1xuICAgIHJldHVybiBkLnRvRGF0ZVN0cmluZygpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvU2hvcnREYXRlU3RyaW5nKGQpIHtcbiAgICByZXR1cm4gZC50b0xvY2FsZURhdGVTdHJpbmcoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b0xvbmdUaW1lU3RyaW5nKGQpIHtcbiAgICByZXR1cm4gZC50b0xvY2FsZVRpbWVTdHJpbmcoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b1Nob3J0VGltZVN0cmluZyhkKSB7XG4gICAgcmV0dXJuIGQudG9Mb2NhbGVUaW1lU3RyaW5nKCkucmVwbGFjZSgvOlxcZFxcZCg/ITopLywgXCJcIik7XG59XG5leHBvcnQgZnVuY3Rpb24gZXF1YWxzKGQxLCBkMikge1xuICAgIHJldHVybiBkMS5nZXRUaW1lKCkgPT09IGQyLmdldFRpbWUoKTtcbn1cbmV4cG9ydCBjb25zdCBjb21wYXJlID0gY29tcGFyZURhdGVzO1xuZXhwb3J0IGNvbnN0IGNvbXBhcmVUbyA9IGNvbXBhcmVEYXRlcztcbmV4cG9ydCBmdW5jdGlvbiBvcF9BZGRpdGlvbih4LCB5KSB7XG4gICAgcmV0dXJuIGFkZCh4LCB5KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBvcF9TdWJ0cmFjdGlvbih4LCB5KSB7XG4gICAgcmV0dXJuIHN1YnRyYWN0KHgsIHkpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGlzRGF5bGlnaHRTYXZpbmdUaW1lKHgpIHtcbiAgICBjb25zdCBqYW4gPSBuZXcgRGF0ZSh4LmdldEZ1bGxZZWFyKCksIDAsIDEpO1xuICAgIGNvbnN0IGp1bCA9IG5ldyBEYXRlKHguZ2V0RnVsbFllYXIoKSwgNiwgMSk7XG4gICAgcmV0dXJuIGlzRFNUKGphbi5nZXRUaW1lem9uZU9mZnNldCgpLCBqdWwuZ2V0VGltZXpvbmVPZmZzZXQoKSwgeC5nZXRUaW1lem9uZU9mZnNldCgpKTtcbn1cbmZ1bmN0aW9uIGlzRFNUKGphbk9mZnNldCwganVsT2Zmc2V0LCB0T2Zmc2V0KSB7XG4gICAgcmV0dXJuIE1hdGgubWluKGphbk9mZnNldCwganVsT2Zmc2V0KSA9PT0gdE9mZnNldDtcbn1cbmV4cG9ydCBkZWZhdWx0IERhdGVUaW1lO1xuIiwKICAiLyoqXG4gKiBEYXRlVGltZU9mZnNldCBmdW5jdGlvbnMuXG4gKlxuICogTm90ZTogRGF0ZSBpbnN0YW5jZXMgYXJlIGFsd2F5cyBEYXRlT2JqZWN0cyBpbiBsb2NhbFxuICogdGltZXpvbmUgKGJlY2F1c2UgSlMgZGF0ZXMgYXJlIGFsbCBraW5kcyBvZiBtZXNzZWQgdXApLlxuICogQSBsb2NhbCBkYXRlIHJldHVybnMgVVRDIGVwb2NoIHdoZW4gYC5nZXRUaW1lKClgIGlzIGNhbGxlZC5cbiAqXG4gKiBCYXNpY2FsbHk7IGludmFyaWFudDogZGF0ZS5nZXRUaW1lKCkgYWx3YXlzIHJldHVybiBVVEMgdGltZS5cbiAqL1xuaW1wb3J0IHsgdG9JbnQ2NCwgdG9GbG9hdDY0IH0gZnJvbSBcIi4vQmlnSW50LmpzXCI7XG5pbXBvcnQgeyBjb21wYXJlRGF0ZXMsIGRhdGVPZmZzZXQsIHBhZFdpdGhaZXJvcyB9IGZyb20gXCIuL1V0aWwuanNcIjtcbmNvbnN0IHNob3J0RGF5cyA9IFtcbiAgICBcIlN1blwiLCBcIk1vblwiLCBcIlR1ZVwiLCBcIldlZFwiLCBcIlRodVwiLCBcIkZyaVwiLCBcIlNhdFwiXG5dO1xuY29uc3QgbG9uZ0RheXMgPSBbXG4gICAgXCJTdW5kYXlcIiwgXCJNb25kYXlcIiwgXCJUdWVzZGF5XCIsIFwiV2VkbmVzZGF5XCIsIFwiVGh1cnNkYXlcIiwgXCJGcmlkYXlcIiwgXCJTYXR1cmRheVwiXG5dO1xuY29uc3Qgc2hvcnRNb250aHMgPSBbXG4gICAgXCJKYW5cIiwgXCJGZWJcIiwgXCJNYXJcIiwgXCJBcHJcIiwgXCJNYXlcIiwgXCJKdW5cIiwgXCJKdWxcIiwgXCJBdWdcIiwgXCJTZXBcIiwgXCJPY3RcIiwgXCJOb3ZcIiwgXCJEZWNcIlxuXTtcbmNvbnN0IGxvbmdNb250aHMgPSBbXG4gICAgXCJKYW51YXJ5XCIsIFwiRmVicnVhcnlcIiwgXCJNYXJjaFwiLCBcIkFwcmlsXCIsIFwiTWF5XCIsIFwiSnVuZVwiLCBcIkp1bHlcIiwgXCJBdWd1c3RcIiwgXCJTZXB0ZW1iZXJcIiwgXCJPY3RvYmVyXCIsIFwiTm92ZW1iZXJcIiwgXCJEZWNlbWJlclwiXG5dO1xuZnVuY3Rpb24gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIHBvcywgcGF0dGVybkNoYXIpIHtcbiAgICBsZXQgdG9rZW5MZW5ndGggPSAwO1xuICAgIGxldCBpbnRlcm5hbFBvcyA9IHBvcztcbiAgICB3aGlsZSAoaW50ZXJuYWxQb3MgPCBmb3JtYXQubGVuZ3RoICYmIGZvcm1hdFtpbnRlcm5hbFBvc10gPT09IHBhdHRlcm5DaGFyKSB7XG4gICAgICAgIGludGVybmFsUG9zKys7XG4gICAgICAgIHRva2VuTGVuZ3RoKys7XG4gICAgfVxuICAgIHJldHVybiB0b2tlbkxlbmd0aDtcbn1cbmZ1bmN0aW9uIHBhcnNlTmV4dENoYXIoZm9ybWF0LCBwb3MpIHtcbiAgICBpZiAocG9zID49IGZvcm1hdC5sZW5ndGggLSAxKSB7XG4gICAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gICAgcmV0dXJuIGZvcm1hdC5jaGFyQ29kZUF0KHBvcyArIDEpO1xufVxuZnVuY3Rpb24gcGFyc2VRdW90ZWRTdHJpbmcoZm9ybWF0LCBwb3MpIHtcbiAgICBsZXQgYmVnaW5Qb3MgPSBwb3M7XG4gICAgLy8gR2V0IHRoZSBjaGFyYWN0ZXIgdXNlZCB0byBxdW90ZSB0aGUgc3RyaW5nXG4gICAgY29uc3QgcXVvdGVDaGFyID0gZm9ybWF0W3Bvc107XG4gICAgbGV0IHJlc3VsdCA9IFwiXCI7XG4gICAgbGV0IGZvdW5kUXVvdGUgPSBmYWxzZTtcbiAgICB3aGlsZSAocG9zIDwgZm9ybWF0Lmxlbmd0aCkge1xuICAgICAgICBwb3MrKztcbiAgICAgICAgY29uc3QgY3VycmVudENoYXIgPSBmb3JtYXRbcG9zXTtcbiAgICAgICAgaWYgKGN1cnJlbnRDaGFyID09PSBxdW90ZUNoYXIpIHtcbiAgICAgICAgICAgIGZvdW5kUXVvdGUgPSB0cnVlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY3VycmVudENoYXIgPT09IFwiXFxcXFwiKSB7XG4gICAgICAgICAgICBpZiAocG9zIDwgZm9ybWF0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHBvcysrO1xuICAgICAgICAgICAgICAgIHJlc3VsdCArPSBmb3JtYXRbcG9zXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFRoaXMgbWVhbnMgdGhhdCAnXFwnIGlzIHRoZSBsYXN0IGNoYXJhY3RlciBpbiB0aGUgc3RyaW5nLlxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgc3RyaW5nIGZvcm1hdFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJlc3VsdCArPSBjdXJyZW50Q2hhcjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoIWZvdW5kUXVvdGUpIHtcbiAgICAgICAgLy8gV2UgY291bGQgbm90IGZpbmQgdGhlIG1hdGNoaW5nIHF1b3RlXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBzdHJpbmcgZm9ybWF0IGNvdWxkIG5vdCBmaW5kIG1hdGNoaW5nIHF1b3RlIGZvciAke3F1b3RlQ2hhcn1gKTtcbiAgICB9XG4gICAgcmV0dXJuIFtyZXN1bHQsIHBvcyAtIGJlZ2luUG9zICsgMV07XG59XG5mdW5jdGlvbiBkYXRlVG9TdHJpbmdXaXRoQ3VzdG9tRm9ybWF0KGRhdGUsIGZvcm1hdCwgdXRjKSB7XG4gICAgbGV0IGN1cnNvclBvcyA9IDA7XG4gICAgbGV0IHRva2VuTGVuZ3RoID0gMDtcbiAgICBsZXQgcmVzdWx0ID0gXCJcIjtcbiAgICBjb25zdCBsb2NhbGl6ZWREYXRlID0gdXRjID8gRGF0ZVRpbWUoZGF0ZS5nZXRUaW1lKCksIDEgLyogRGF0ZUtpbmQuVVRDICovKSA6IGRhdGU7XG4gICAgd2hpbGUgKGN1cnNvclBvcyA8IGZvcm1hdC5sZW5ndGgpIHtcbiAgICAgICAgY29uc3QgdG9rZW4gPSBmb3JtYXRbY3Vyc29yUG9zXTtcbiAgICAgICAgc3dpdGNoICh0b2tlbikge1xuICAgICAgICAgICAgY2FzZSBcImRcIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwiZFwiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0b2tlbkxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gbG9jYWxpemVkRGF0ZS5nZXREYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyhsb2NhbGl6ZWREYXRlLmdldERhdGUoKSwgMik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHNob3J0RGF5c1tkYXlPZldlZWsobG9jYWxpemVkRGF0ZSldO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBsb25nRGF5c1tkYXlPZldlZWsobG9jYWxpemVkRGF0ZSldO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZlwiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJmXCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBpZiAodG9rZW5MZW5ndGggPD0gMykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcmVjaXNpb24gPSAxMCAqKiAoMyAtIHRva2VuTGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyhNYXRoLmZsb29yKG1pbGxpc2Vjb25kKGxvY2FsaXplZERhdGUpIC8gcHJlY2lzaW9uKSwgdG9rZW5MZW5ndGgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0b2tlbkxlbmd0aCA8PSA3KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEphdmFTY3JpcHQgRGF0ZSBvbmx5IHN1cHBvcnQgcHJlY2lzaW9uIHRvIHRoZSBtaWxsaXNlY29uZFxuICAgICAgICAgICAgICAgICAgICAvLyBzbyB3ZSBmaWxsIHRoZSByZXN0IG9mIHRoZSBwcmVjaXNpb24gd2l0aCAwIGFzIGlmIHRoZSBkYXRlIGRpZG4ndCBoYXZlXG4gICAgICAgICAgICAgICAgICAgIC8vIG1pbGxpc2Vjb25kcyBwcm92aWRlZCB0byBpdC5cbiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyB0byBoYXZlIHRoZSBzYW1lIGJlaGF2aW9yIGFzIC5ORVQgd2hlbiBkb2luZzpcbiAgICAgICAgICAgICAgICAgICAgLy8gRGF0ZVRpbWUoMSwgMiwgMywgNCwgNSwgNiwgRGF0ZVRpbWVLaW5kLlV0YykuVG9TdHJpbmcoXCJmZmZmZlwiKSA9PiAwMDAwMFxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gKFwiXCIgKyBtaWxsaXNlY29uZChsb2NhbGl6ZWREYXRlKSkucGFkRW5kKHRva2VuTGVuZ3RoLCBcIjBcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIkZcIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwiRlwiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgaWYgKHRva2VuTGVuZ3RoIDw9IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJlY2lzaW9uID0gMTAgKiogKDMgLSB0b2tlbkxlbmd0aCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gTWF0aC5mbG9vcihtaWxsaXNlY29uZChsb2NhbGl6ZWREYXRlKSAvIHByZWNpc2lvbik7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKHZhbHVlLCB0b2tlbkxlbmd0aCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodG9rZW5MZW5ndGggPD0gNykge1xuICAgICAgICAgICAgICAgICAgICAvLyBKYXZhU2NyaXB0IERhdGUgb25seSBzdXBwb3J0IHByZWNpc2lvbiB0byB0aGUgbWlsbGlzZWNvbmRcbiAgICAgICAgICAgICAgICAgICAgLy8gc28gd2UgY2FuJ3QgZ28gYmV5b25kIHRoYXQuXG4gICAgICAgICAgICAgICAgICAgIC8vIFdlIGFsc28gbmVlZCB0byBwYWQgc3RhcnQgd2l0aCAwIGlmIHRoZSB2YWx1ZSBpcyBub3QgMFxuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IG1pbGxpc2Vjb25kKGxvY2FsaXplZERhdGUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyh2YWx1ZSwgMyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZ1wiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJnXCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBpZiAodG9rZW5MZW5ndGggPD0gMikge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gXCJBLkQuXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImhcIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwiaFwiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0b2tlbkxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gaG91cihsb2NhbGl6ZWREYXRlKSAlIDEyO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3MoaG91cihsb2NhbGl6ZWREYXRlKSAlIDEyLCAyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIkhcIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwiSFwiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0b2tlbkxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gaG91cihsb2NhbGl6ZWREYXRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKGhvdXIobG9jYWxpemVkRGF0ZSksIDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiS1wiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJLXCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRva2VuTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoa2luZChsb2NhbGl6ZWREYXRlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMSAvKiBEYXRlS2luZC5VVEMgKi86XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBcIlpcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyIC8qIERhdGVLaW5kLkxvY2FsICovOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gZGF0ZU9mZnNldFRvU3RyaW5nKGxvY2FsaXplZERhdGUuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIC02MDAwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMCAvKiBEYXRlS2luZC5VbnNwZWNpZmllZCAqLzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJtXCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcIm1cIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodG9rZW5MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IG1pbnV0ZShsb2NhbGl6ZWREYXRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKG1pbnV0ZShsb2NhbGl6ZWREYXRlKSwgMik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJNXCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcIk1cIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodG9rZW5MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IG1vbnRoKGxvY2FsaXplZERhdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3MobW9udGgobG9jYWxpemVkRGF0ZSksIDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBzaG9ydE1vbnRoc1ttb250aChsb2NhbGl6ZWREYXRlKSAtIDFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBsb25nTW9udGhzW21vbnRoKGxvY2FsaXplZERhdGUpIC0gMV07XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJzXCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcInNcIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodG9rZW5MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHNlY29uZChsb2NhbGl6ZWREYXRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKHNlY29uZChsb2NhbGl6ZWREYXRlKSwgMik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJ0XCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcInRcIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodG9rZW5MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGxvY2FsaXplZERhdGUuZ2V0SG91cnMoKSA8IDEyID8gXCJBXCIgOiBcIlBcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gbG9jYWxpemVkRGF0ZS5nZXRIb3VycygpIDwgMTIgPyBcIkFNXCIgOiBcIlBNXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJ5XCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcInlcIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodG9rZW5MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGxvY2FsaXplZERhdGUuZ2V0RnVsbFllYXIoKSAlIDEwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKGxvY2FsaXplZERhdGUuZ2V0RnVsbFllYXIoKSAlIDEwMCwgMik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyhsb2NhbGl6ZWREYXRlLmdldEZ1bGxZZWFyKCksIDMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3MobG9jYWxpemVkRGF0ZS5nZXRGdWxsWWVhcigpLCA0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKGxvY2FsaXplZERhdGUuZ2V0RnVsbFllYXIoKSwgNSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJ6XCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcInpcIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIGxldCB1dGNPZmZzZXRUZXh0ID0gXCJcIjtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGtpbmQobG9jYWxpemVkRGF0ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxIC8qIERhdGVLaW5kLlVUQyAqLzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHV0Y09mZnNldFRleHQgPSBcIiswMDowMFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMiAvKiBEYXRlS2luZC5Mb2NhbCAqLzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHV0Y09mZnNldFRleHQgPSBkYXRlT2Zmc2V0VG9TdHJpbmcobG9jYWxpemVkRGF0ZS5nZXRUaW1lem9uZU9mZnNldCgpICogLTYwMDAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDAgLyogRGF0ZUtpbmQuVW5zcGVjaWZpZWQgKi86XG4gICAgICAgICAgICAgICAgICAgICAgICB1dGNPZmZzZXRUZXh0ID0gZGF0ZU9mZnNldFRvU3RyaW5nKHRvTG9jYWxUaW1lKGxvY2FsaXplZERhdGUpLmdldFRpbWV6b25lT2Zmc2V0KCkgKiAtNjAwMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHNpZ24gPSB1dGNPZmZzZXRUZXh0WzBdID09PSBcIi1cIiA/IFwiLVwiIDogXCIrXCI7XG4gICAgICAgICAgICAgICAgY29uc3QgaG91cnMgPSBwYXJzZUludCh1dGNPZmZzZXRUZXh0LnN1YnN0cmluZygxLCAzKSwgMTApO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1pbnV0ZXMgPSBwYXJzZUludCh1dGNPZmZzZXRUZXh0LnN1YnN0cmluZyg0LCA2KSwgMTApO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodG9rZW5MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGAke3NpZ259JHtob3Vyc31gO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBgJHtzaWdufSR7cGFkV2l0aFplcm9zKGhvdXJzLCAyKX1gO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gYCR7c2lnbn0ke3BhZFdpdGhaZXJvcyhob3VycywgMil9OiR7cGFkV2l0aFplcm9zKG1pbnV0ZXMsIDIpfWA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiOlwiOlxuICAgICAgICAgICAgICAgIHJlc3VsdCArPSBcIjpcIjtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MrKztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCIvXCI6XG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IFwiL1wiO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcysrO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIidcIjpcbiAgICAgICAgICAgIGNhc2UgJ1wiJzpcbiAgICAgICAgICAgICAgICBjb25zdCBbcXVvdGVkU3RyaW5nLCBxdW90ZWRTdHJpbmdMZW5naHRdID0gcGFyc2VRdW90ZWRTdHJpbmcoZm9ybWF0LCBjdXJzb3JQb3MpO1xuICAgICAgICAgICAgICAgIHJlc3VsdCArPSBxdW90ZWRTdHJpbmc7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHF1b3RlZFN0cmluZ0xlbmdodDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCIlXCI6XG4gICAgICAgICAgICAgICAgY29uc3QgbmV4dENoYXIgPSBwYXJzZU5leHRDaGFyKGZvcm1hdCwgY3Vyc29yUG9zKTtcbiAgICAgICAgICAgICAgICBpZiAobmV4dENoYXIgPj0gMCAmJiBuZXh0Q2hhciAhPT0gXCIlXCIuY2hhckNvZGVBdCgwKSkge1xuICAgICAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gMjtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGRhdGVUb1N0cmluZ1dpdGhDdXN0b21Gb3JtYXQobG9jYWxpemVkRGF0ZSwgU3RyaW5nLmZyb21DaGFyQ29kZShuZXh0Q2hhciksIHV0Yyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGZvcm1hdCBzdHJpbmdcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIlxcXFxcIjpcbiAgICAgICAgICAgICAgICBjb25zdCBuZXh0Q2hhcjIgPSBwYXJzZU5leHRDaGFyKGZvcm1hdCwgY3Vyc29yUG9zKTtcbiAgICAgICAgICAgICAgICBpZiAobmV4dENoYXIyID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IDI7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKG5leHRDaGFyMik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGZvcm1hdCBzdHJpbmdcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MrKztcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gdG9rZW47XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cbmV4cG9ydCBmdW5jdGlvbiBraW5kKHZhbHVlKSB7XG4gICAgcmV0dXJuIHZhbHVlLmtpbmQgfHwgMDtcbn1cbmV4cG9ydCBmdW5jdGlvbiB1bml4RXBvY2hNaWxsaXNlY29uZHNUb1RpY2tzKG1zLCBvZmZzZXQpIHtcbiAgICByZXR1cm4gdG9JbnQ2NCgoKEJpZ0ludChtcykgKyA2MjEzNTU5NjgwMDAwMG4pICsgQmlnSW50KG9mZnNldCkpICogMTAwMDBuKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0aWNrc1RvVW5peEVwb2NoTWlsbGlzZWNvbmRzKHRpY2tzKSB7XG4gICAgcmV0dXJuIE51bWJlcigoKEJpZ0ludCh0aWNrcykgLyAxMDAwMG4pIC0gNjIxMzU1OTY4MDAwMDBuKSk7XG59XG5leHBvcnQgZnVuY3Rpb24gZGF0ZU9mZnNldFRvU3RyaW5nKG9mZnNldCkge1xuICAgIGNvbnN0IGlzTWludXMgPSBvZmZzZXQgPCAwO1xuICAgIG9mZnNldCA9IE1hdGguYWJzKG9mZnNldCk7XG4gICAgY29uc3QgaG91cnMgPSB+fihvZmZzZXQgLyAzNjAwMDAwKTtcbiAgICBjb25zdCBtaW51dGVzID0gKG9mZnNldCAlIDM2MDAwMDApIC8gNjAwMDA7XG4gICAgcmV0dXJuIChpc01pbnVzID8gXCItXCIgOiBcIitcIikgK1xuICAgICAgICBwYWRXaXRoWmVyb3MoaG91cnMsIDIpICsgXCI6XCIgK1xuICAgICAgICBwYWRXaXRoWmVyb3MobWludXRlcywgMik7XG59XG5leHBvcnQgZnVuY3Rpb24gZGF0ZVRvSGFsZlVUQ1N0cmluZyhkYXRlLCBoYWxmKSB7XG4gICAgY29uc3Qgc3RyID0gZGF0ZS50b0lTT1N0cmluZygpO1xuICAgIHJldHVybiBoYWxmID09PSBcImZpcnN0XCJcbiAgICAgICAgPyBzdHIuc3Vic3RyaW5nKDAsIHN0ci5pbmRleE9mKFwiVFwiKSlcbiAgICAgICAgOiBzdHIuc3Vic3RyaW5nKHN0ci5pbmRleE9mKFwiVFwiKSArIDEsIHN0ci5sZW5ndGggLSAxKTtcbn1cbmZ1bmN0aW9uIGRhdGVUb0lTT1N0cmluZyhkLCB1dGMpIHtcbiAgICBpZiAodXRjKSB7XG4gICAgICAgIHJldHVybiBkLnRvSVNPU3RyaW5nKCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyBKUyBEYXRlIGlzIGFsd2F5cyBsb2NhbFxuICAgICAgICBjb25zdCBwcmludE9mZnNldCA9IGQua2luZCA9PSBudWxsID8gdHJ1ZSA6IGQua2luZCA9PT0gMiAvKiBEYXRlS2luZC5Mb2NhbCAqLztcbiAgICAgICAgcmV0dXJuIHBhZFdpdGhaZXJvcyhkLmdldEZ1bGxZZWFyKCksIDQpICsgXCItXCIgK1xuICAgICAgICAgICAgcGFkV2l0aFplcm9zKGQuZ2V0TW9udGgoKSArIDEsIDIpICsgXCItXCIgK1xuICAgICAgICAgICAgcGFkV2l0aFplcm9zKGQuZ2V0RGF0ZSgpLCAyKSArIFwiVFwiICtcbiAgICAgICAgICAgIHBhZFdpdGhaZXJvcyhkLmdldEhvdXJzKCksIDIpICsgXCI6XCIgK1xuICAgICAgICAgICAgcGFkV2l0aFplcm9zKGQuZ2V0TWludXRlcygpLCAyKSArIFwiOlwiICtcbiAgICAgICAgICAgIHBhZFdpdGhaZXJvcyhkLmdldFNlY29uZHMoKSwgMikgKyBcIi5cIiArXG4gICAgICAgICAgICBwYWRXaXRoWmVyb3MoZC5nZXRNaWxsaXNlY29uZHMoKSwgMykgK1xuICAgICAgICAgICAgKHByaW50T2Zmc2V0ID8gZGF0ZU9mZnNldFRvU3RyaW5nKGQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIC02MDAwMCkgOiBcIlwiKTtcbiAgICB9XG59XG5mdW5jdGlvbiBkYXRlVG9JU09TdHJpbmdXaXRoT2Zmc2V0KGRhdGVXaXRoT2Zmc2V0LCBvZmZzZXQpIHtcbiAgICBjb25zdCBzdHIgPSBkYXRlV2l0aE9mZnNldC50b0lTT1N0cmluZygpO1xuICAgIHJldHVybiBzdHIuc3Vic3RyaW5nKDAsIHN0ci5sZW5ndGggLSAxKSArIGRhdGVPZmZzZXRUb1N0cmluZyhvZmZzZXQpO1xufVxuZnVuY3Rpb24gZGF0ZVRvU3RyaW5nV2l0aE9mZnNldChkYXRlLCBmb3JtYXQpIHtcbiAgICBjb25zdCBkID0gbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkgKyAoZGF0ZS5vZmZzZXQgPz8gMCkpO1xuICAgIGlmICh0eXBlb2YgZm9ybWF0ICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHJldHVybiBkLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgvXFwuXFxkKy8sIFwiXCIpLnJlcGxhY2UoL1tBLVpdfFxcLlxcZCsvZywgXCIgXCIpICsgZGF0ZU9mZnNldFRvU3RyaW5nKChkYXRlLm9mZnNldCA/PyAwKSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGZvcm1hdC5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgc3dpdGNoIChmb3JtYXQpIHtcbiAgICAgICAgICAgIGNhc2UgXCJEXCI6XG4gICAgICAgICAgICBjYXNlIFwiZFwiOiByZXR1cm4gZGF0ZVRvSGFsZlVUQ1N0cmluZyhkLCBcImZpcnN0XCIpO1xuICAgICAgICAgICAgY2FzZSBcIlRcIjpcbiAgICAgICAgICAgIGNhc2UgXCJ0XCI6IHJldHVybiBkYXRlVG9IYWxmVVRDU3RyaW5nKGQsIFwic2Vjb25kXCIpO1xuICAgICAgICAgICAgY2FzZSBcIk9cIjpcbiAgICAgICAgICAgIGNhc2UgXCJvXCI6IHJldHVybiBkYXRlVG9JU09TdHJpbmdXaXRoT2Zmc2V0KGQsIChkYXRlLm9mZnNldCA/PyAwKSk7XG4gICAgICAgICAgICBkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoXCJVbnJlY29nbml6ZWQgRGF0ZSBwcmludCBmb3JtYXRcIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBkYXRlVG9TdHJpbmdXaXRoQ3VzdG9tRm9ybWF0KGQsIGZvcm1hdCwgdHJ1ZSk7XG4gICAgfVxufVxuZnVuY3Rpb24gZGF0ZVRvU3RyaW5nV2l0aEtpbmQoZGF0ZSwgZm9ybWF0KSB7XG4gICAgY29uc3QgdXRjID0gZGF0ZS5raW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqLztcbiAgICBpZiAodHlwZW9mIGZvcm1hdCAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICByZXR1cm4gdXRjID8gZGF0ZS50b1VUQ1N0cmluZygpIDogZGF0ZS50b0xvY2FsZVN0cmluZygpO1xuICAgIH1cbiAgICBlbHNlIGlmIChmb3JtYXQubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIHN3aXRjaCAoZm9ybWF0KSB7XG4gICAgICAgICAgICBjYXNlIFwiRFwiOlxuICAgICAgICAgICAgY2FzZSBcImRcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gdXRjID8gZGF0ZVRvSGFsZlVUQ1N0cmluZyhkYXRlLCBcImZpcnN0XCIpIDogZGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoKTtcbiAgICAgICAgICAgIGNhc2UgXCJUXCI6XG4gICAgICAgICAgICBjYXNlIFwidFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiB1dGMgPyBkYXRlVG9IYWxmVVRDU3RyaW5nKGRhdGUsIFwic2Vjb25kXCIpIDogZGF0ZS50b0xvY2FsZVRpbWVTdHJpbmcoKTtcbiAgICAgICAgICAgIGNhc2UgXCJPXCI6XG4gICAgICAgICAgICBjYXNlIFwib1wiOlxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRlVG9JU09TdHJpbmcoZGF0ZSwgdXRjKTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5yZWNvZ25pemVkIERhdGUgcHJpbnQgZm9ybWF0XCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gZGF0ZVRvU3RyaW5nV2l0aEN1c3RvbUZvcm1hdChkYXRlLCBmb3JtYXQsIHV0Yyk7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIHRvU3RyaW5nKGRhdGUsIGZvcm1hdCwgX3Byb3ZpZGVyKSB7XG4gICAgcmV0dXJuIGRhdGUub2Zmc2V0ICE9IG51bGxcbiAgICAgICAgPyBkYXRlVG9TdHJpbmdXaXRoT2Zmc2V0KGRhdGUsIGZvcm1hdClcbiAgICAgICAgOiBkYXRlVG9TdHJpbmdXaXRoS2luZChkYXRlLCBmb3JtYXQpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIERhdGVUaW1lKHZhbHVlLCBraW5kKSB7XG4gICAgY29uc3QgZCA9IG5ldyBEYXRlKHZhbHVlKTtcbiAgICBkLmtpbmQgPSAoa2luZCA9PSBudWxsID8gMCAvKiBEYXRlS2luZC5VbnNwZWNpZmllZCAqLyA6IGtpbmQpIHwgMDtcbiAgICByZXR1cm4gZDtcbn1cbmV4cG9ydCBmdW5jdGlvbiBmcm9tVGlja3ModGlja3MsIGtpbmQpIHtcbiAgICBraW5kID0ga2luZCAhPSBudWxsID8ga2luZCA6IDIgLyogRGF0ZUtpbmQuTG9jYWwgKi87IC8vIGJldHRlciBkZWZhdWx0IHRoYW4gVW5zcGVjaWZpZWRcbiAgICBsZXQgZGF0ZSA9IERhdGVUaW1lKHRpY2tzVG9Vbml4RXBvY2hNaWxsaXNlY29uZHModGlja3MpLCBraW5kKTtcbiAgICAvLyBUaWNrcyBhcmUgbG9jYWwgdG8gb2Zmc2V0IChpbiB0aGlzIGNhc2UsIGVpdGhlciBVVEMgb3IgTG9jYWwvVW5rbm93bikuXG4gICAgLy8gSWYga2luZCBpcyBhbnl0aGluZyBidXQgVVRDLCB0aGF0IG1lYW5zIHRoYXQgdGhlIHRpY2sgbnVtYmVyIHdhcyBub3RcbiAgICAvLyBpbiB1dGMsIHRodXMgZ2V0VGltZSgpIGNhbm5vdCByZXR1cm4gVVRDLCBhbmQgbmVlZHMgdG8gYmUgc2hpZnRlZC5cbiAgICBpZiAoa2luZCAhPT0gMSAvKiBEYXRlS2luZC5VVEMgKi8pIHtcbiAgICAgICAgZGF0ZSA9IERhdGVUaW1lKGRhdGUuZ2V0VGltZSgpIC0gZGF0ZU9mZnNldChkYXRlKSwga2luZCk7XG4gICAgfVxuICAgIHJldHVybiBkYXRlO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGZyb21EYXRlVGltZU9mZnNldChkYXRlLCBraW5kKSB7XG4gICAgc3dpdGNoIChraW5kKSB7XG4gICAgICAgIGNhc2UgMSAvKiBEYXRlS2luZC5VVEMgKi86IHJldHVybiBEYXRlVGltZShkYXRlLmdldFRpbWUoKSwgMSAvKiBEYXRlS2luZC5VVEMgKi8pO1xuICAgICAgICBjYXNlIDIgLyogRGF0ZUtpbmQuTG9jYWwgKi86IHJldHVybiBEYXRlVGltZShkYXRlLmdldFRpbWUoKSwgMiAvKiBEYXRlS2luZC5Mb2NhbCAqLyk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBjb25zdCBkID0gRGF0ZVRpbWUoZGF0ZS5nZXRUaW1lKCkgKyAoZGF0ZS5vZmZzZXQgPz8gMCksIGtpbmQpO1xuICAgICAgICAgICAgcmV0dXJuIERhdGVUaW1lKGQuZ2V0VGltZSgpIC0gZGF0ZU9mZnNldChkKSwga2luZCk7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGdldFRpY2tzKGRhdGUpIHtcbiAgICByZXR1cm4gdW5peEVwb2NoTWlsbGlzZWNvbmRzVG9UaWNrcyhkYXRlLmdldFRpbWUoKSwgZGF0ZU9mZnNldChkYXRlKSk7XG59XG5leHBvcnQgZnVuY3Rpb24gbWluVmFsdWUoKSB7XG4gICAgLy8gVGhpcyBpcyBcIjAwMDEtMDEtMDFUMDA6MDA6MDAuMDAwWlwiLCBhY3R1YWwgSlMgbWluIHZhbHVlIGlzIC04NjQwMDAwMDAwMDAwMDAwXG4gICAgcmV0dXJuIERhdGVUaW1lKC02MjEzNTU5NjgwMDAwMCwgMCAvKiBEYXRlS2luZC5VbnNwZWNpZmllZCAqLyk7XG59XG5leHBvcnQgZnVuY3Rpb24gbWF4VmFsdWUoKSB7XG4gICAgLy8gVGhpcyBpcyBcIjk5OTktMTItMzFUMjM6NTk6NTkuOTk5WlwiLCBhY3R1YWwgSlMgbWF4IHZhbHVlIGlzIDg2NDAwMDAwMDAwMDAwMDBcbiAgICByZXR1cm4gRGF0ZVRpbWUoMjUzNDAyMzAwNzk5OTk5LCAwIC8qIERhdGVLaW5kLlVuc3BlY2lmaWVkICovKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZVJhdyhpbnB1dCkge1xuICAgIGZ1bmN0aW9uIGZhaWwoKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIHN0cmluZyBpcyBub3QgYSB2YWxpZCBEYXRlOiAke2lucHV0fWApO1xuICAgIH1cbiAgICBpZiAoaW5wdXQgPT0gbnVsbCB8fCBpbnB1dC50cmltKCkgPT09IFwiXCIpIHtcbiAgICAgICAgZmFpbCgpO1xuICAgIH1cbiAgICAvLyBJU08gZGF0ZXMgd2l0aG91dCBUWiBhcmUgcGFyc2VkIGFzIFVUQy4gQWRkaW5nIHRpbWUgd2l0aG91dCBUWiBrZWVwcyB0aGVtIGxvY2FsLlxuICAgIGlmIChpbnB1dC5sZW5ndGggPT09IDEwICYmIGlucHV0WzRdID09PSBcIi1cIiAmJiBpbnB1dFs3XSA9PT0gXCItXCIpIHtcbiAgICAgICAgaW5wdXQgKz0gXCJUMDA6MDA6MDBcIjtcbiAgICB9XG4gICAgbGV0IGRhdGUgPSBuZXcgRGF0ZShpbnB1dCk7XG4gICAgbGV0IG9mZnNldCA9IG51bGw7XG4gICAgaWYgKGlzTmFOKGRhdGUuZ2V0VGltZSgpKSkge1xuICAgICAgICAvLyBUcnkgdG8gY2hlY2sgc3RyaW5ncyBKUyBEYXRlIGNhbm5vdCBwYXJzZSAoc2VlICMxMDQ1LCAjMTQyMilcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aFxuICAgICAgICBjb25zdCBtID0gL15cXHMqKFxcZCtbXlxcd1xcczpdXFxkK1teXFx3XFxzOl1cXGQrKT9cXHMqKFxcZCs6XFxkKyg/OjpcXGQrKD86XFwuXFxkKyk/KT8pP1xccyooW0FhUHBdW01tXSk/XFxzKihafFsrLV0oWzAxXT9cXGQpOj8oWzAtNV0/XFxkKT8pP1xccyokLy5leGVjKGlucHV0KTtcbiAgICAgICAgaWYgKG0gIT0gbnVsbCkge1xuICAgICAgICAgICAgbGV0IGJhc2VEYXRlO1xuICAgICAgICAgICAgbGV0IHRpbWVJblNlY29uZHMgPSAwO1xuICAgICAgICAgICAgaWYgKG1bMl0gIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVQYXJ0cyA9IG1bMl0uc3BsaXQoXCI6XCIpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGhvdXJQYXJ0ID0gcGFyc2VJbnQodGltZVBhcnRzWzBdLCAxMCk7XG4gICAgICAgICAgICAgICAgdGltZUluU2Vjb25kcyA9XG4gICAgICAgICAgICAgICAgICAgIGhvdXJQYXJ0ICogMzYwMCArXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUludCh0aW1lUGFydHNbMV0gfHwgXCIwXCIsIDEwKSAqIDYwICtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQodGltZVBhcnRzWzJdIHx8IFwiMFwiKTtcbiAgICAgICAgICAgICAgICBpZiAobVszXSAhPSBudWxsICYmIG1bM10udG9VcHBlckNhc2UoKSA9PT0gXCJQTVwiICYmIGhvdXJQYXJ0IDwgMTIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGltZUluU2Vjb25kcyArPSA3MjA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG1bNF0gIT0gbnVsbCkgeyAvLyBUaGVyZSdzIGFuIG9mZnNldCwgcGFyc2UgYXMgVVRDXG4gICAgICAgICAgICAgICAgaWYgKG1bMV0gIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBiYXNlRGF0ZSA9IG5ldyBEYXRlKG1bMV0gKyBcIiBVVENcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgYmFzZURhdGUgPSBuZXcgRGF0ZShkLmdldFVUQ0Z1bGxZZWFyKCkgKyBcIi9cIiArIChkLmdldFVUQ01vbnRoKCkgKyAxKSArIFwiL1wiICsgZC5nZXRVVENEYXRlKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobVs0XSA9PT0gXCJaXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gXCJaXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsZXQgb2Zmc2V0SW5NaW51dGVzID0gcGFyc2VJbnQobVs1XSwgMTApICogNjAgKyBwYXJzZUludChtWzZdIHx8IFwiMFwiLCAxMCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtWzRdWzBdID09PSBcIi1cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0SW5NaW51dGVzICo9IC0xO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IG9mZnNldEluTWludXRlcztcbiAgICAgICAgICAgICAgICAgICAgdGltZUluU2Vjb25kcyAtPSBvZmZzZXRJbk1pbnV0ZXMgKiA2MDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAobVsxXSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGJhc2VEYXRlID0gbmV3IERhdGUobVsxXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgYmFzZURhdGUgPSBuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCkgKyBcIi9cIiArIChkLmdldE1vbnRoKCkgKyAxKSArIFwiL1wiICsgZC5nZXREYXRlKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRhdGUgPSBuZXcgRGF0ZShiYXNlRGF0ZS5nZXRUaW1lKCkgKyB0aW1lSW5TZWNvbmRzICogMTAwMCk7XG4gICAgICAgICAgICAvLyBjb3JyZWN0IGZvciBkYXlsaWdodCBzYXZpbmdzIHRpbWVcbiAgICAgICAgICAgIGRhdGUgPSBuZXcgRGF0ZShkYXRlLmdldFRpbWUoKSArIChkYXRlLmdldFRpbWV6b25lT2Zmc2V0KCkgLSBiYXNlRGF0ZS5nZXRUaW1lem9uZU9mZnNldCgpKSAqIDYwMDAwKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGZhaWwoKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBDaGVjayBhZ2FpbiB0aGUgZGF0ZSBpcyB2YWxpZCBhZnRlciB0cmFuc2Zvcm1hdGlvbnMsIHNlZSAjMjIyOVxuICAgICAgICBpZiAoaXNOYU4oZGF0ZS5nZXRUaW1lKCkpKSB7XG4gICAgICAgICAgICBmYWlsKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIFtkYXRlLCBvZmZzZXRdO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlKHN0ciwgZGV0ZWN0VVRDID0gZmFsc2UpIHtcbiAgICBjb25zdCBbZGF0ZSwgb2Zmc2V0XSA9IHBhcnNlUmF3KHN0cik7XG4gICAgLy8gLk5FVCBhbHdheXMgcGFyc2VzIERhdGVUaW1lIGFzIExvY2FsIGlmIHRoZXJlJ3Mgb2Zmc2V0IGluZm8gKGV2ZW4gXCJaXCIpXG4gICAgLy8gTmV3dG9uc29mdC5Kc29uIHVzZXMgVVRDIGlmIHRoZSBvZmZzZXQgaXMgXCJaXCJcbiAgICBjb25zdCBraW5kID0gb2Zmc2V0ICE9IG51bGxcbiAgICAgICAgPyAoZGV0ZWN0VVRDICYmIG9mZnNldCA9PT0gXCJaXCIgPyAxIC8qIERhdGVLaW5kLlVUQyAqLyA6IDIgLyogRGF0ZUtpbmQuTG9jYWwgKi8pXG4gICAgICAgIDogMCAvKiBEYXRlS2luZC5VbnNwZWNpZmllZCAqLztcbiAgICByZXR1cm4gRGF0ZVRpbWUoZGF0ZS5nZXRUaW1lKCksIGtpbmQpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRyeVBhcnNlKHYsIGRlZlZhbHVlKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgZGVmVmFsdWUuY29udGVudHMgPSBwYXJzZSh2KTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGNhdGNoIChfZXJyKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlKHllYXIsIG1vbnRoLCBkYXksIGggPSAwLCBtID0gMCwgcyA9IDAsIG1zID0gMCwga2luZCkge1xuICAgIGNvbnN0IGRhdGUgPSBraW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqL1xuICAgICAgICA/IG5ldyBEYXRlKERhdGUuVVRDKHllYXIsIG1vbnRoIC0gMSwgZGF5LCBoLCBtLCBzLCBtcykpXG4gICAgICAgIDogbmV3IERhdGUoeWVhciwgbW9udGggLSAxLCBkYXksIGgsIG0sIHMsIG1zKTtcbiAgICBpZiAoeWVhciA8PSA5OSkge1xuICAgICAgICBpZiAoa2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi8pIHtcbiAgICAgICAgICAgIGRhdGUuc2V0VVRDRnVsbFllYXIoeWVhciwgbW9udGggLSAxLCBkYXkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZGF0ZS5zZXRGdWxsWWVhcih5ZWFyLCBtb250aCAtIDEsIGRheSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgZGF0ZVZhbHVlID0gZGF0ZS5nZXRUaW1lKCk7XG4gICAgaWYgKGlzTmFOKGRhdGVWYWx1ZSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlIHBhcmFtZXRlcnMgZGVzY3JpYmUgYW4gdW5yZXByZXNlbnRhYmxlIERhdGUuXCIpO1xuICAgIH1cbiAgICByZXR1cm4gRGF0ZVRpbWUoZGF0ZVZhbHVlLCBraW5kKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBub3coKSB7XG4gICAgcmV0dXJuIERhdGVUaW1lKERhdGUubm93KCksIDIgLyogRGF0ZUtpbmQuTG9jYWwgKi8pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHV0Y05vdygpIHtcbiAgICByZXR1cm4gRGF0ZVRpbWUoRGF0ZS5ub3coKSwgMSAvKiBEYXRlS2luZC5VVEMgKi8pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvZGF5KCkge1xuICAgIHJldHVybiBkYXRlKG5vdygpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpc0xlYXBZZWFyKHllYXIpIHtcbiAgICByZXR1cm4geWVhciAlIDQgPT09IDAgJiYgeWVhciAlIDEwMCAhPT0gMCB8fCB5ZWFyICUgNDAwID09PSAwO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGRheXNJbk1vbnRoKHllYXIsIG1vbnRoKSB7XG4gICAgcmV0dXJuIG1vbnRoID09PSAyXG4gICAgICAgID8gKGlzTGVhcFllYXIoeWVhcikgPyAyOSA6IDI4KVxuICAgICAgICA6IChtb250aCA+PSA4ID8gKG1vbnRoICUgMiA9PT0gMCA/IDMxIDogMzApIDogKG1vbnRoICUgMiA9PT0gMCA/IDMwIDogMzEpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b1VuaXZlcnNhbFRpbWUoZGF0ZSkge1xuICAgIHJldHVybiBkYXRlLmtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovID8gZGF0ZSA6IERhdGVUaW1lKGRhdGUuZ2V0VGltZSgpLCAxIC8qIERhdGVLaW5kLlVUQyAqLyk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9Mb2NhbFRpbWUoZGF0ZSkge1xuICAgIHJldHVybiBkYXRlLmtpbmQgPT09IDIgLyogRGF0ZUtpbmQuTG9jYWwgKi8gPyBkYXRlIDogRGF0ZVRpbWUoZGF0ZS5nZXRUaW1lKCksIDIgLyogRGF0ZUtpbmQuTG9jYWwgKi8pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHNwZWNpZnlLaW5kKGQsIGtpbmQpIHtcbiAgICByZXR1cm4gY3JlYXRlKHllYXIoZCksIG1vbnRoKGQpLCBkYXkoZCksIGhvdXIoZCksIG1pbnV0ZShkKSwgc2Vjb25kKGQpLCBtaWxsaXNlY29uZChkKSwga2luZCk7XG59XG5leHBvcnQgZnVuY3Rpb24gdGltZU9mRGF5KGQpIHtcbiAgICByZXR1cm4gaG91cihkKSAqIDM2MDAwMDBcbiAgICAgICAgKyBtaW51dGUoZCkgKiA2MDAwMFxuICAgICAgICArIHNlY29uZChkKSAqIDEwMDBcbiAgICAgICAgKyBtaWxsaXNlY29uZChkKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBkYXRlKGQpIHtcbiAgICByZXR1cm4gY3JlYXRlKHllYXIoZCksIG1vbnRoKGQpLCBkYXkoZCksIDAsIDAsIDAsIDAsIGQua2luZCk7XG59XG5leHBvcnQgZnVuY3Rpb24gZGF5KGQpIHtcbiAgICByZXR1cm4gZC5raW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqLyA/IGQuZ2V0VVRDRGF0ZSgpIDogZC5nZXREYXRlKCk7XG59XG5leHBvcnQgZnVuY3Rpb24gaG91cihkKSB7XG4gICAgcmV0dXJuIGQua2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi8gPyBkLmdldFVUQ0hvdXJzKCkgOiBkLmdldEhvdXJzKCk7XG59XG5leHBvcnQgZnVuY3Rpb24gbWlsbGlzZWNvbmQoZCkge1xuICAgIHJldHVybiBkLmtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovID8gZC5nZXRVVENNaWxsaXNlY29uZHMoKSA6IGQuZ2V0TWlsbGlzZWNvbmRzKCk7XG59XG5leHBvcnQgZnVuY3Rpb24gbWludXRlKGQpIHtcbiAgICByZXR1cm4gZC5raW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqLyA/IGQuZ2V0VVRDTWludXRlcygpIDogZC5nZXRNaW51dGVzKCk7XG59XG5leHBvcnQgZnVuY3Rpb24gbW9udGgoZCkge1xuICAgIHJldHVybiAoZC5raW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqLyA/IGQuZ2V0VVRDTW9udGgoKSA6IGQuZ2V0TW9udGgoKSkgKyAxO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHNlY29uZChkKSB7XG4gICAgcmV0dXJuIGQua2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi8gPyBkLmdldFVUQ1NlY29uZHMoKSA6IGQuZ2V0U2Vjb25kcygpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHllYXIoZCkge1xuICAgIHJldHVybiBkLmtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovID8gZC5nZXRVVENGdWxsWWVhcigpIDogZC5nZXRGdWxsWWVhcigpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGRheU9mV2VlayhkKSB7XG4gICAgcmV0dXJuIGQua2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi8gPyBkLmdldFVUQ0RheSgpIDogZC5nZXREYXkoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBkYXlPZlllYXIoZCkge1xuICAgIGNvbnN0IF95ZWFyID0geWVhcihkKTtcbiAgICBjb25zdCBfbW9udGggPSBtb250aChkKTtcbiAgICBsZXQgX2RheSA9IGRheShkKTtcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IF9tb250aDsgaSsrKSB7XG4gICAgICAgIF9kYXkgKz0gZGF5c0luTW9udGgoX3llYXIsIGkpO1xuICAgIH1cbiAgICByZXR1cm4gX2RheTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBhZGQoZCwgdHMpIHtcbiAgICBjb25zdCBuZXdEYXRlID0gRGF0ZVRpbWUoZC5nZXRUaW1lKCkgKyB0cywgZC5raW5kKTtcbiAgICBpZiAoZC5raW5kID09PSAyIC8qIERhdGVLaW5kLkxvY2FsICovKSB7XG4gICAgICAgIGNvbnN0IG9sZFR6T2Zmc2V0ID0gZC5nZXRUaW1lem9uZU9mZnNldCgpO1xuICAgICAgICBjb25zdCBuZXdUek9mZnNldCA9IG5ld0RhdGUuZ2V0VGltZXpvbmVPZmZzZXQoKTtcbiAgICAgICAgcmV0dXJuIG9sZFR6T2Zmc2V0ICE9PSBuZXdUek9mZnNldFxuICAgICAgICAgICAgPyBEYXRlVGltZShuZXdEYXRlLmdldFRpbWUoKSArIChuZXdUek9mZnNldCAtIG9sZFR6T2Zmc2V0KSAqIDYwMDAwLCBkLmtpbmQpXG4gICAgICAgICAgICA6IG5ld0RhdGU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gbmV3RGF0ZTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gYWRkRGF5cyhkLCB2KSB7XG4gICAgcmV0dXJuIGFkZChkLCB2ICogODY0MDAwMDApO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGFkZEhvdXJzKGQsIHYpIHtcbiAgICByZXR1cm4gYWRkKGQsIHYgKiAzNjAwMDAwKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBhZGRNaW51dGVzKGQsIHYpIHtcbiAgICByZXR1cm4gYWRkKGQsIHYgKiA2MDAwMCk7XG59XG5leHBvcnQgZnVuY3Rpb24gYWRkU2Vjb25kcyhkLCB2KSB7XG4gICAgcmV0dXJuIGFkZChkLCB2ICogMTAwMCk7XG59XG5leHBvcnQgZnVuY3Rpb24gYWRkTWlsbGlzZWNvbmRzKGQsIHYpIHtcbiAgICByZXR1cm4gYWRkKGQsIHYpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGFkZFRpY2tzKGQsIHYpIHtcbiAgICByZXR1cm4gYWRkKGQsIHRvRmxvYXQ2NCh2IC8gMTAwMDBuKSk7XG59XG5leHBvcnQgZnVuY3Rpb24gYWRkWWVhcnMoZCwgdikge1xuICAgIGNvbnN0IG5ld01vbnRoID0gbW9udGgoZCk7XG4gICAgY29uc3QgbmV3WWVhciA9IHllYXIoZCkgKyB2O1xuICAgIGNvbnN0IF9kYXlzSW5Nb250aCA9IGRheXNJbk1vbnRoKG5ld1llYXIsIG5ld01vbnRoKTtcbiAgICBjb25zdCBuZXdEYXkgPSBNYXRoLm1pbihfZGF5c0luTW9udGgsIGRheShkKSk7XG4gICAgcmV0dXJuIGNyZWF0ZShuZXdZZWFyLCBuZXdNb250aCwgbmV3RGF5LCBob3VyKGQpLCBtaW51dGUoZCksIHNlY29uZChkKSwgbWlsbGlzZWNvbmQoZCksIGQua2luZCk7XG59XG5leHBvcnQgZnVuY3Rpb24gYWRkTW9udGhzKGQsIHYpIHtcbiAgICBsZXQgbmV3TW9udGggPSBtb250aChkKSArIHY7XG4gICAgbGV0IG5ld01vbnRoXyA9IDA7XG4gICAgbGV0IHllYXJPZmZzZXQgPSAwO1xuICAgIGlmIChuZXdNb250aCA+IDEyKSB7XG4gICAgICAgIG5ld01vbnRoXyA9IG5ld01vbnRoICUgMTI7XG4gICAgICAgIHllYXJPZmZzZXQgPSBNYXRoLmZsb29yKG5ld01vbnRoIC8gMTIpO1xuICAgICAgICBuZXdNb250aCA9IG5ld01vbnRoXztcbiAgICB9XG4gICAgZWxzZSBpZiAobmV3TW9udGggPCAxKSB7XG4gICAgICAgIG5ld01vbnRoXyA9IDEyICsgbmV3TW9udGggJSAxMjtcbiAgICAgICAgeWVhck9mZnNldCA9IE1hdGguZmxvb3IobmV3TW9udGggLyAxMikgKyAobmV3TW9udGhfID09PSAxMiA/IC0xIDogMCk7XG4gICAgICAgIG5ld01vbnRoID0gbmV3TW9udGhfO1xuICAgIH1cbiAgICBjb25zdCBuZXdZZWFyID0geWVhcihkKSArIHllYXJPZmZzZXQ7XG4gICAgY29uc3QgX2RheXNJbk1vbnRoID0gZGF5c0luTW9udGgobmV3WWVhciwgbmV3TW9udGgpO1xuICAgIGNvbnN0IG5ld0RheSA9IE1hdGgubWluKF9kYXlzSW5Nb250aCwgZGF5KGQpKTtcbiAgICByZXR1cm4gY3JlYXRlKG5ld1llYXIsIG5ld01vbnRoLCBuZXdEYXksIGhvdXIoZCksIG1pbnV0ZShkKSwgc2Vjb25kKGQpLCBtaWxsaXNlY29uZChkKSwgZC5raW5kKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBzdWJ0cmFjdChkLCB0aGF0KSB7XG4gICAgcmV0dXJuIHR5cGVvZiB0aGF0ID09PSBcIm51bWJlclwiXG4gICAgICAgID8gYWRkKGQsIC10aGF0KVxuICAgICAgICA6IGQuZ2V0VGltZSgpIC0gdGhhdC5nZXRUaW1lKCk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9Mb25nRGF0ZVN0cmluZyhkKSB7XG4gICAgcmV0dXJuIGQudG9EYXRlU3RyaW5nKCk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9TaG9ydERhdGVTdHJpbmcoZCkge1xuICAgIHJldHVybiBkLnRvTG9jYWxlRGF0ZVN0cmluZygpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvTG9uZ1RpbWVTdHJpbmcoZCkge1xuICAgIHJldHVybiBkLnRvTG9jYWxlVGltZVN0cmluZygpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvU2hvcnRUaW1lU3RyaW5nKGQpIHtcbiAgICByZXR1cm4gZC50b0xvY2FsZVRpbWVTdHJpbmcoKS5yZXBsYWNlKC86XFxkXFxkKD8hOikvLCBcIlwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBlcXVhbHMoZDEsIGQyKSB7XG4gICAgcmV0dXJuIGQxLmdldFRpbWUoKSA9PT0gZDIuZ2V0VGltZSgpO1xufVxuZXhwb3J0IGNvbnN0IGNvbXBhcmUgPSBjb21wYXJlRGF0ZXM7XG5leHBvcnQgY29uc3QgY29tcGFyZVRvID0gY29tcGFyZURhdGVzO1xuZXhwb3J0IGZ1bmN0aW9uIG9wX0FkZGl0aW9uKHgsIHkpIHtcbiAgICByZXR1cm4gYWRkKHgsIHkpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIG9wX1N1YnRyYWN0aW9uKHgsIHkpIHtcbiAgICByZXR1cm4gc3VidHJhY3QoeCwgeSk7XG59XG5leHBvcnQgZnVuY3Rpb24gaXNEYXlsaWdodFNhdmluZ1RpbWUoeCkge1xuICAgIGNvbnN0IGphbiA9IG5ldyBEYXRlKHguZ2V0RnVsbFllYXIoKSwgMCwgMSk7XG4gICAgY29uc3QganVsID0gbmV3IERhdGUoeC5nZXRGdWxsWWVhcigpLCA2LCAxKTtcbiAgICByZXR1cm4gaXNEU1QoamFuLmdldFRpbWV6b25lT2Zmc2V0KCksIGp1bC5nZXRUaW1lem9uZU9mZnNldCgpLCB4LmdldFRpbWV6b25lT2Zmc2V0KCkpO1xufVxuZnVuY3Rpb24gaXNEU1QoamFuT2Zmc2V0LCBqdWxPZmZzZXQsIHRPZmZzZXQpIHtcbiAgICByZXR1cm4gTWF0aC5taW4oamFuT2Zmc2V0LCBqdWxPZmZzZXQpID09PSB0T2Zmc2V0O1xufVxuZXhwb3J0IGRlZmF1bHQgRGF0ZVRpbWU7XG4iLAogICIvKipcbiAqIERhdGVUaW1lT2Zmc2V0IGZ1bmN0aW9ucy5cbiAqXG4gKiBOb3RlOiBEYXRlIGluc3RhbmNlcyBhcmUgYWx3YXlzIERhdGVPYmplY3RzIGluIGxvY2FsXG4gKiB0aW1lem9uZSAoYmVjYXVzZSBKUyBkYXRlcyBhcmUgYWxsIGtpbmRzIG9mIG1lc3NlZCB1cCkuXG4gKiBBIGxvY2FsIGRhdGUgcmV0dXJucyBVVEMgZXBvY2ggd2hlbiBgLmdldFRpbWUoKWAgaXMgY2FsbGVkLlxuICpcbiAqIEJhc2ljYWxseTsgaW52YXJpYW50OiBkYXRlLmdldFRpbWUoKSBhbHdheXMgcmV0dXJuIFVUQyB0aW1lLlxuICovXG5pbXBvcnQgeyB0b0ludDY0LCB0b0Zsb2F0NjQgfSBmcm9tIFwiLi9CaWdJbnQuanNcIjtcbmltcG9ydCB7IGNvbXBhcmVEYXRlcywgZGF0ZU9mZnNldCwgcGFkV2l0aFplcm9zIH0gZnJvbSBcIi4vVXRpbC5qc1wiO1xuY29uc3Qgc2hvcnREYXlzID0gW1xuICAgIFwiU3VuXCIsIFwiTW9uXCIsIFwiVHVlXCIsIFwiV2VkXCIsIFwiVGh1XCIsIFwiRnJpXCIsIFwiU2F0XCJcbl07XG5jb25zdCBsb25nRGF5cyA9IFtcbiAgICBcIlN1bmRheVwiLCBcIk1vbmRheVwiLCBcIlR1ZXNkYXlcIiwgXCJXZWRuZXNkYXlcIiwgXCJUaHVyc2RheVwiLCBcIkZyaWRheVwiLCBcIlNhdHVyZGF5XCJcbl07XG5jb25zdCBzaG9ydE1vbnRocyA9IFtcbiAgICBcIkphblwiLCBcIkZlYlwiLCBcIk1hclwiLCBcIkFwclwiLCBcIk1heVwiLCBcIkp1blwiLCBcIkp1bFwiLCBcIkF1Z1wiLCBcIlNlcFwiLCBcIk9jdFwiLCBcIk5vdlwiLCBcIkRlY1wiXG5dO1xuY29uc3QgbG9uZ01vbnRocyA9IFtcbiAgICBcIkphbnVhcnlcIiwgXCJGZWJydWFyeVwiLCBcIk1hcmNoXCIsIFwiQXByaWxcIiwgXCJNYXlcIiwgXCJKdW5lXCIsIFwiSnVseVwiLCBcIkF1Z3VzdFwiLCBcIlNlcHRlbWJlclwiLCBcIk9jdG9iZXJcIiwgXCJOb3ZlbWJlclwiLCBcIkRlY2VtYmVyXCJcbl07XG5mdW5jdGlvbiBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgcG9zLCBwYXR0ZXJuQ2hhcikge1xuICAgIGxldCB0b2tlbkxlbmd0aCA9IDA7XG4gICAgbGV0IGludGVybmFsUG9zID0gcG9zO1xuICAgIHdoaWxlIChpbnRlcm5hbFBvcyA8IGZvcm1hdC5sZW5ndGggJiYgZm9ybWF0W2ludGVybmFsUG9zXSA9PT0gcGF0dGVybkNoYXIpIHtcbiAgICAgICAgaW50ZXJuYWxQb3MrKztcbiAgICAgICAgdG9rZW5MZW5ndGgrKztcbiAgICB9XG4gICAgcmV0dXJuIHRva2VuTGVuZ3RoO1xufVxuZnVuY3Rpb24gcGFyc2VOZXh0Q2hhcihmb3JtYXQsIHBvcykge1xuICAgIGlmIChwb3MgPj0gZm9ybWF0Lmxlbmd0aCAtIDEpIHtcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIH1cbiAgICByZXR1cm4gZm9ybWF0LmNoYXJDb2RlQXQocG9zICsgMSk7XG59XG5mdW5jdGlvbiBwYXJzZVF1b3RlZFN0cmluZyhmb3JtYXQsIHBvcykge1xuICAgIGxldCBiZWdpblBvcyA9IHBvcztcbiAgICAvLyBHZXQgdGhlIGNoYXJhY3RlciB1c2VkIHRvIHF1b3RlIHRoZSBzdHJpbmdcbiAgICBjb25zdCBxdW90ZUNoYXIgPSBmb3JtYXRbcG9zXTtcbiAgICBsZXQgcmVzdWx0ID0gXCJcIjtcbiAgICBsZXQgZm91bmRRdW90ZSA9IGZhbHNlO1xuICAgIHdoaWxlIChwb3MgPCBmb3JtYXQubGVuZ3RoKSB7XG4gICAgICAgIHBvcysrO1xuICAgICAgICBjb25zdCBjdXJyZW50Q2hhciA9IGZvcm1hdFtwb3NdO1xuICAgICAgICBpZiAoY3VycmVudENoYXIgPT09IHF1b3RlQ2hhcikge1xuICAgICAgICAgICAgZm91bmRRdW90ZSA9IHRydWU7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjdXJyZW50Q2hhciA9PT0gXCJcXFxcXCIpIHtcbiAgICAgICAgICAgIGlmIChwb3MgPCBmb3JtYXQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcG9zKys7XG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IGZvcm1hdFtwb3NdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBtZWFucyB0aGF0ICdcXCcgaXMgdGhlIGxhc3QgY2hhcmFjdGVyIGluIHRoZSBzdHJpbmcuXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBzdHJpbmcgZm9ybWF0XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0ICs9IGN1cnJlbnRDaGFyO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmICghZm91bmRRdW90ZSkge1xuICAgICAgICAvLyBXZSBjb3VsZCBub3QgZmluZCB0aGUgbWF0Y2hpbmcgcXVvdGVcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHN0cmluZyBmb3JtYXQgY291bGQgbm90IGZpbmQgbWF0Y2hpbmcgcXVvdGUgZm9yICR7cXVvdGVDaGFyfWApO1xuICAgIH1cbiAgICByZXR1cm4gW3Jlc3VsdCwgcG9zIC0gYmVnaW5Qb3MgKyAxXTtcbn1cbmZ1bmN0aW9uIGRhdGVUb1N0cmluZ1dpdGhDdXN0b21Gb3JtYXQoZGF0ZSwgZm9ybWF0LCB1dGMpIHtcbiAgICBsZXQgY3Vyc29yUG9zID0gMDtcbiAgICBsZXQgdG9rZW5MZW5ndGggPSAwO1xuICAgIGxldCByZXN1bHQgPSBcIlwiO1xuICAgIGNvbnN0IGxvY2FsaXplZERhdGUgPSB1dGMgPyBEYXRlVGltZShkYXRlLmdldFRpbWUoKSwgMSAvKiBEYXRlS2luZC5VVEMgKi8pIDogZGF0ZTtcbiAgICB3aGlsZSAoY3Vyc29yUG9zIDwgZm9ybWF0Lmxlbmd0aCkge1xuICAgICAgICBjb25zdCB0b2tlbiA9IGZvcm1hdFtjdXJzb3JQb3NdO1xuICAgICAgICBzd2l0Y2ggKHRva2VuKSB7XG4gICAgICAgICAgICBjYXNlIFwiZFwiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJkXCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRva2VuTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBsb2NhbGl6ZWREYXRlLmdldERhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKGxvY2FsaXplZERhdGUuZ2V0RGF0ZSgpLCAyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gc2hvcnREYXlzW2RheU9mV2Vlayhsb2NhbGl6ZWREYXRlKV07XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGxvbmdEYXlzW2RheU9mV2Vlayhsb2NhbGl6ZWREYXRlKV07XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJmXCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcImZcIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmICh0b2tlbkxlbmd0aCA8PSAzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByZWNpc2lvbiA9IDEwICoqICgzIC0gdG9rZW5MZW5ndGgpO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKE1hdGguZmxvb3IobWlsbGlzZWNvbmQobG9jYWxpemVkRGF0ZSkgLyBwcmVjaXNpb24pLCB0b2tlbkxlbmd0aCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRva2VuTGVuZ3RoIDw9IDcpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSmF2YVNjcmlwdCBEYXRlIG9ubHkgc3VwcG9ydCBwcmVjaXNpb24gdG8gdGhlIG1pbGxpc2Vjb25kXG4gICAgICAgICAgICAgICAgICAgIC8vIHNvIHdlIGZpbGwgdGhlIHJlc3Qgb2YgdGhlIHByZWNpc2lvbiB3aXRoIDAgYXMgaWYgdGhlIGRhdGUgZGlkbid0IGhhdmVcbiAgICAgICAgICAgICAgICAgICAgLy8gbWlsbGlzZWNvbmRzIHByb3ZpZGVkIHRvIGl0LlxuICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIHRvIGhhdmUgdGhlIHNhbWUgYmVoYXZpb3IgYXMgLk5FVCB3aGVuIGRvaW5nOlxuICAgICAgICAgICAgICAgICAgICAvLyBEYXRlVGltZSgxLCAyLCAzLCA0LCA1LCA2LCBEYXRlVGltZUtpbmQuVXRjKS5Ub1N0cmluZyhcImZmZmZmXCIpID0+IDAwMDAwXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAoXCJcIiArIG1pbGxpc2Vjb25kKGxvY2FsaXplZERhdGUpKS5wYWRFbmQodG9rZW5MZW5ndGgsIFwiMFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiRlwiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJGXCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBpZiAodG9rZW5MZW5ndGggPD0gMykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcmVjaXNpb24gPSAxMCAqKiAoMyAtIHRva2VuTGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBNYXRoLmZsb29yKG1pbGxpc2Vjb25kKGxvY2FsaXplZERhdGUpIC8gcHJlY2lzaW9uKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3ModmFsdWUsIHRva2VuTGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0b2tlbkxlbmd0aCA8PSA3KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEphdmFTY3JpcHQgRGF0ZSBvbmx5IHN1cHBvcnQgcHJlY2lzaW9uIHRvIHRoZSBtaWxsaXNlY29uZFxuICAgICAgICAgICAgICAgICAgICAvLyBzbyB3ZSBjYW4ndCBnbyBiZXlvbmQgdGhhdC5cbiAgICAgICAgICAgICAgICAgICAgLy8gV2UgYWxzbyBuZWVkIHRvIHBhZCBzdGFydCB3aXRoIDAgaWYgdGhlIHZhbHVlIGlzIG5vdCAwXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gbWlsbGlzZWNvbmQobG9jYWxpemVkRGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKHZhbHVlLCAzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJnXCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcImdcIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmICh0b2tlbkxlbmd0aCA8PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBcIkEuRC5cIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiaFwiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJoXCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRva2VuTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBob3VyKGxvY2FsaXplZERhdGUpICUgMTI7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyhob3VyKGxvY2FsaXplZERhdGUpICUgMTIsIDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiSFwiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJIXCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRva2VuTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBob3VyKGxvY2FsaXplZERhdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3MoaG91cihsb2NhbGl6ZWREYXRlKSwgMik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJLXCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcIktcIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodG9rZW5MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChraW5kKGxvY2FsaXplZERhdGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxIC8qIERhdGVLaW5kLlVUQyAqLzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IFwiWlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDIgLyogRGF0ZUtpbmQuTG9jYWwgKi86XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBkYXRlT2Zmc2V0VG9TdHJpbmcobG9jYWxpemVkRGF0ZS5nZXRUaW1lem9uZU9mZnNldCgpICogLTYwMDAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwIC8qIERhdGVLaW5kLlVuc3BlY2lmaWVkICovOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIm1cIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwibVwiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0b2tlbkxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gbWludXRlKGxvY2FsaXplZERhdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3MobWludXRlKGxvY2FsaXplZERhdGUpLCAyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIk1cIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwiTVwiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0b2tlbkxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gbW9udGgobG9jYWxpemVkRGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyhtb250aChsb2NhbGl6ZWREYXRlKSwgMik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHNob3J0TW9udGhzW21vbnRoKGxvY2FsaXplZERhdGUpIC0gMV07XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGxvbmdNb250aHNbbW9udGgobG9jYWxpemVkRGF0ZSkgLSAxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInNcIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwic1wiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0b2tlbkxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gc2Vjb25kKGxvY2FsaXplZERhdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3Moc2Vjb25kKGxvY2FsaXplZERhdGUpLCAyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInRcIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwidFwiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0b2tlbkxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gbG9jYWxpemVkRGF0ZS5nZXRIb3VycygpIDwgMTIgPyBcIkFcIiA6IFwiUFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBsb2NhbGl6ZWREYXRlLmdldEhvdXJzKCkgPCAxMiA/IFwiQU1cIiA6IFwiUE1cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInlcIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwieVwiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0b2tlbkxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gbG9jYWxpemVkRGF0ZS5nZXRGdWxsWWVhcigpICUgMTAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3MobG9jYWxpemVkRGF0ZS5nZXRGdWxsWWVhcigpICUgMTAwLCAyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKGxvY2FsaXplZERhdGUuZ2V0RnVsbFllYXIoKSwgMyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyhsb2NhbGl6ZWREYXRlLmdldEZ1bGxZZWFyKCksIDQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3MobG9jYWxpemVkRGF0ZS5nZXRGdWxsWWVhcigpLCA1KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInpcIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwielwiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgbGV0IHV0Y09mZnNldFRleHQgPSBcIlwiO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoa2luZChsb2NhbGl6ZWREYXRlKSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDEgLyogRGF0ZUtpbmQuVVRDICovOlxuICAgICAgICAgICAgICAgICAgICAgICAgdXRjT2Zmc2V0VGV4dCA9IFwiKzAwOjAwXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyIC8qIERhdGVLaW5kLkxvY2FsICovOlxuICAgICAgICAgICAgICAgICAgICAgICAgdXRjT2Zmc2V0VGV4dCA9IGRhdGVPZmZzZXRUb1N0cmluZyhsb2NhbGl6ZWREYXRlLmdldFRpbWV6b25lT2Zmc2V0KCkgKiAtNjAwMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMCAvKiBEYXRlS2luZC5VbnNwZWNpZmllZCAqLzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHV0Y09mZnNldFRleHQgPSBkYXRlT2Zmc2V0VG9TdHJpbmcodG9Mb2NhbFRpbWUobG9jYWxpemVkRGF0ZSkuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIC02MDAwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3Qgc2lnbiA9IHV0Y09mZnNldFRleHRbMF0gPT09IFwiLVwiID8gXCItXCIgOiBcIitcIjtcbiAgICAgICAgICAgICAgICBjb25zdCBob3VycyA9IHBhcnNlSW50KHV0Y09mZnNldFRleHQuc3Vic3RyaW5nKDEsIDMpLCAxMCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbWludXRlcyA9IHBhcnNlSW50KHV0Y09mZnNldFRleHQuc3Vic3RyaW5nKDQsIDYpLCAxMCk7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0b2tlbkxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gYCR7c2lnbn0ke2hvdXJzfWA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGAke3NpZ259JHtwYWRXaXRoWmVyb3MoaG91cnMsIDIpfWA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBgJHtzaWdufSR7cGFkV2l0aFplcm9zKGhvdXJzLCAyKX06JHtwYWRXaXRoWmVyb3MobWludXRlcywgMil9YDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCI6XCI6XG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IFwiOlwiO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcysrO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIi9cIjpcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gXCIvXCI7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zKys7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiJ1wiOlxuICAgICAgICAgICAgY2FzZSAnXCInOlxuICAgICAgICAgICAgICAgIGNvbnN0IFtxdW90ZWRTdHJpbmcsIHF1b3RlZFN0cmluZ0xlbmdodF0gPSBwYXJzZVF1b3RlZFN0cmluZyhmb3JtYXQsIGN1cnNvclBvcyk7XG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IHF1b3RlZFN0cmluZztcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gcXVvdGVkU3RyaW5nTGVuZ2h0O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIiVcIjpcbiAgICAgICAgICAgICAgICBjb25zdCBuZXh0Q2hhciA9IHBhcnNlTmV4dENoYXIoZm9ybWF0LCBjdXJzb3JQb3MpO1xuICAgICAgICAgICAgICAgIGlmIChuZXh0Q2hhciA+PSAwICYmIG5leHRDaGFyICE9PSBcIiVcIi5jaGFyQ29kZUF0KDApKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSAyO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gZGF0ZVRvU3RyaW5nV2l0aEN1c3RvbUZvcm1hdChsb2NhbGl6ZWREYXRlLCBTdHJpbmcuZnJvbUNoYXJDb2RlKG5leHRDaGFyKSwgdXRjKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgZm9ybWF0IHN0cmluZ1wiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiXFxcXFwiOlxuICAgICAgICAgICAgICAgIGNvbnN0IG5leHRDaGFyMiA9IHBhcnNlTmV4dENoYXIoZm9ybWF0LCBjdXJzb3JQb3MpO1xuICAgICAgICAgICAgICAgIGlmIChuZXh0Q2hhcjIgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gMjtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUobmV4dENoYXIyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgZm9ybWF0IHN0cmluZ1wiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGN1cnNvclBvcysrO1xuICAgICAgICAgICAgICAgIHJlc3VsdCArPSB0b2tlbjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xufVxuZXhwb3J0IGZ1bmN0aW9uIGtpbmQodmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWUua2luZCB8fCAwO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHVuaXhFcG9jaE1pbGxpc2Vjb25kc1RvVGlja3MobXMsIG9mZnNldCkge1xuICAgIHJldHVybiB0b0ludDY0KCgoQmlnSW50KG1zKSArIDYyMTM1NTk2ODAwMDAwbikgKyBCaWdJbnQob2Zmc2V0KSkgKiAxMDAwMG4pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRpY2tzVG9Vbml4RXBvY2hNaWxsaXNlY29uZHModGlja3MpIHtcbiAgICByZXR1cm4gTnVtYmVyKCgoQmlnSW50KHRpY2tzKSAvIDEwMDAwbikgLSA2MjEzNTU5NjgwMDAwMG4pKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBkYXRlT2Zmc2V0VG9TdHJpbmcob2Zmc2V0KSB7XG4gICAgY29uc3QgaXNNaW51cyA9IG9mZnNldCA8IDA7XG4gICAgb2Zmc2V0ID0gTWF0aC5hYnMob2Zmc2V0KTtcbiAgICBjb25zdCBob3VycyA9IH5+KG9mZnNldCAvIDM2MDAwMDApO1xuICAgIGNvbnN0IG1pbnV0ZXMgPSAob2Zmc2V0ICUgMzYwMDAwMCkgLyA2MDAwMDtcbiAgICByZXR1cm4gKGlzTWludXMgPyBcIi1cIiA6IFwiK1wiKSArXG4gICAgICAgIHBhZFdpdGhaZXJvcyhob3VycywgMikgKyBcIjpcIiArXG4gICAgICAgIHBhZFdpdGhaZXJvcyhtaW51dGVzLCAyKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBkYXRlVG9IYWxmVVRDU3RyaW5nKGRhdGUsIGhhbGYpIHtcbiAgICBjb25zdCBzdHIgPSBkYXRlLnRvSVNPU3RyaW5nKCk7XG4gICAgcmV0dXJuIGhhbGYgPT09IFwiZmlyc3RcIlxuICAgICAgICA/IHN0ci5zdWJzdHJpbmcoMCwgc3RyLmluZGV4T2YoXCJUXCIpKVxuICAgICAgICA6IHN0ci5zdWJzdHJpbmcoc3RyLmluZGV4T2YoXCJUXCIpICsgMSwgc3RyLmxlbmd0aCAtIDEpO1xufVxuZnVuY3Rpb24gZGF0ZVRvSVNPU3RyaW5nKGQsIHV0Yykge1xuICAgIGlmICh1dGMpIHtcbiAgICAgICAgcmV0dXJuIGQudG9JU09TdHJpbmcoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIEpTIERhdGUgaXMgYWx3YXlzIGxvY2FsXG4gICAgICAgIGNvbnN0IHByaW50T2Zmc2V0ID0gZC5raW5kID09IG51bGwgPyB0cnVlIDogZC5raW5kID09PSAyIC8qIERhdGVLaW5kLkxvY2FsICovO1xuICAgICAgICByZXR1cm4gcGFkV2l0aFplcm9zKGQuZ2V0RnVsbFllYXIoKSwgNCkgKyBcIi1cIiArXG4gICAgICAgICAgICBwYWRXaXRoWmVyb3MoZC5nZXRNb250aCgpICsgMSwgMikgKyBcIi1cIiArXG4gICAgICAgICAgICBwYWRXaXRoWmVyb3MoZC5nZXREYXRlKCksIDIpICsgXCJUXCIgK1xuICAgICAgICAgICAgcGFkV2l0aFplcm9zKGQuZ2V0SG91cnMoKSwgMikgKyBcIjpcIiArXG4gICAgICAgICAgICBwYWRXaXRoWmVyb3MoZC5nZXRNaW51dGVzKCksIDIpICsgXCI6XCIgK1xuICAgICAgICAgICAgcGFkV2l0aFplcm9zKGQuZ2V0U2Vjb25kcygpLCAyKSArIFwiLlwiICtcbiAgICAgICAgICAgIHBhZFdpdGhaZXJvcyhkLmdldE1pbGxpc2Vjb25kcygpLCAzKSArXG4gICAgICAgICAgICAocHJpbnRPZmZzZXQgPyBkYXRlT2Zmc2V0VG9TdHJpbmcoZC5nZXRUaW1lem9uZU9mZnNldCgpICogLTYwMDAwKSA6IFwiXCIpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGRhdGVUb0lTT1N0cmluZ1dpdGhPZmZzZXQoZGF0ZVdpdGhPZmZzZXQsIG9mZnNldCkge1xuICAgIGNvbnN0IHN0ciA9IGRhdGVXaXRoT2Zmc2V0LnRvSVNPU3RyaW5nKCk7XG4gICAgcmV0dXJuIHN0ci5zdWJzdHJpbmcoMCwgc3RyLmxlbmd0aCAtIDEpICsgZGF0ZU9mZnNldFRvU3RyaW5nKG9mZnNldCk7XG59XG5mdW5jdGlvbiBkYXRlVG9TdHJpbmdXaXRoT2Zmc2V0KGRhdGUsIGZvcm1hdCkge1xuICAgIGNvbnN0IGQgPSBuZXcgRGF0ZShkYXRlLmdldFRpbWUoKSArIChkYXRlLm9mZnNldCA/PyAwKSk7XG4gICAgaWYgKHR5cGVvZiBmb3JtYXQgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgcmV0dXJuIGQudG9JU09TdHJpbmcoKS5yZXBsYWNlKC9cXC5cXGQrLywgXCJcIikucmVwbGFjZSgvW0EtWl18XFwuXFxkKy9nLCBcIiBcIikgKyBkYXRlT2Zmc2V0VG9TdHJpbmcoKGRhdGUub2Zmc2V0ID8/IDApKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoZm9ybWF0Lmxlbmd0aCA9PT0gMSkge1xuICAgICAgICBzd2l0Y2ggKGZvcm1hdCkge1xuICAgICAgICAgICAgY2FzZSBcIkRcIjpcbiAgICAgICAgICAgIGNhc2UgXCJkXCI6IHJldHVybiBkYXRlVG9IYWxmVVRDU3RyaW5nKGQsIFwiZmlyc3RcIik7XG4gICAgICAgICAgICBjYXNlIFwiVFwiOlxuICAgICAgICAgICAgY2FzZSBcInRcIjogcmV0dXJuIGRhdGVUb0hhbGZVVENTdHJpbmcoZCwgXCJzZWNvbmRcIik7XG4gICAgICAgICAgICBjYXNlIFwiT1wiOlxuICAgICAgICAgICAgY2FzZSBcIm9cIjogcmV0dXJuIGRhdGVUb0lTT1N0cmluZ1dpdGhPZmZzZXQoZCwgKGRhdGUub2Zmc2V0ID8/IDApKTtcbiAgICAgICAgICAgIGRlZmF1bHQ6IHRocm93IG5ldyBFcnJvcihcIlVucmVjb2duaXplZCBEYXRlIHByaW50IGZvcm1hdFwiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGRhdGVUb1N0cmluZ1dpdGhDdXN0b21Gb3JtYXQoZCwgZm9ybWF0LCB0cnVlKTtcbiAgICB9XG59XG5mdW5jdGlvbiBkYXRlVG9TdHJpbmdXaXRoS2luZChkYXRlLCBmb3JtYXQpIHtcbiAgICBjb25zdCB1dGMgPSBkYXRlLmtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovO1xuICAgIGlmICh0eXBlb2YgZm9ybWF0ICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHJldHVybiB1dGMgPyBkYXRlLnRvVVRDU3RyaW5nKCkgOiBkYXRlLnRvTG9jYWxlU3RyaW5nKCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGZvcm1hdC5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgc3dpdGNoIChmb3JtYXQpIHtcbiAgICAgICAgICAgIGNhc2UgXCJEXCI6XG4gICAgICAgICAgICBjYXNlIFwiZFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiB1dGMgPyBkYXRlVG9IYWxmVVRDU3RyaW5nKGRhdGUsIFwiZmlyc3RcIikgOiBkYXRlLnRvTG9jYWxlRGF0ZVN0cmluZygpO1xuICAgICAgICAgICAgY2FzZSBcIlRcIjpcbiAgICAgICAgICAgIGNhc2UgXCJ0XCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHV0YyA/IGRhdGVUb0hhbGZVVENTdHJpbmcoZGF0ZSwgXCJzZWNvbmRcIikgOiBkYXRlLnRvTG9jYWxlVGltZVN0cmluZygpO1xuICAgICAgICAgICAgY2FzZSBcIk9cIjpcbiAgICAgICAgICAgIGNhc2UgXCJvXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGVUb0lTT1N0cmluZyhkYXRlLCB1dGMpO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbnJlY29nbml6ZWQgRGF0ZSBwcmludCBmb3JtYXRcIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBkYXRlVG9TdHJpbmdXaXRoQ3VzdG9tRm9ybWF0KGRhdGUsIGZvcm1hdCwgdXRjKTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gdG9TdHJpbmcoZGF0ZSwgZm9ybWF0LCBfcHJvdmlkZXIpIHtcbiAgICByZXR1cm4gZGF0ZS5vZmZzZXQgIT0gbnVsbFxuICAgICAgICA/IGRhdGVUb1N0cmluZ1dpdGhPZmZzZXQoZGF0ZSwgZm9ybWF0KVxuICAgICAgICA6IGRhdGVUb1N0cmluZ1dpdGhLaW5kKGRhdGUsIGZvcm1hdCk7XG59XG5leHBvcnQgZnVuY3Rpb24gRGF0ZVRpbWUodmFsdWUsIGtpbmQpIHtcbiAgICBjb25zdCBkID0gbmV3IERhdGUodmFsdWUpO1xuICAgIGQua2luZCA9IChraW5kID09IG51bGwgPyAwIC8qIERhdGVLaW5kLlVuc3BlY2lmaWVkICovIDoga2luZCkgfCAwO1xuICAgIHJldHVybiBkO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGZyb21UaWNrcyh0aWNrcywga2luZCkge1xuICAgIGtpbmQgPSBraW5kICE9IG51bGwgPyBraW5kIDogMiAvKiBEYXRlS2luZC5Mb2NhbCAqLzsgLy8gYmV0dGVyIGRlZmF1bHQgdGhhbiBVbnNwZWNpZmllZFxuICAgIGxldCBkYXRlID0gRGF0ZVRpbWUodGlja3NUb1VuaXhFcG9jaE1pbGxpc2Vjb25kcyh0aWNrcyksIGtpbmQpO1xuICAgIC8vIFRpY2tzIGFyZSBsb2NhbCB0byBvZmZzZXQgKGluIHRoaXMgY2FzZSwgZWl0aGVyIFVUQyBvciBMb2NhbC9Vbmtub3duKS5cbiAgICAvLyBJZiBraW5kIGlzIGFueXRoaW5nIGJ1dCBVVEMsIHRoYXQgbWVhbnMgdGhhdCB0aGUgdGljayBudW1iZXIgd2FzIG5vdFxuICAgIC8vIGluIHV0YywgdGh1cyBnZXRUaW1lKCkgY2Fubm90IHJldHVybiBVVEMsIGFuZCBuZWVkcyB0byBiZSBzaGlmdGVkLlxuICAgIGlmIChraW5kICE9PSAxIC8qIERhdGVLaW5kLlVUQyAqLykge1xuICAgICAgICBkYXRlID0gRGF0ZVRpbWUoZGF0ZS5nZXRUaW1lKCkgLSBkYXRlT2Zmc2V0KGRhdGUpLCBraW5kKTtcbiAgICB9XG4gICAgcmV0dXJuIGRhdGU7XG59XG5leHBvcnQgZnVuY3Rpb24gZnJvbURhdGVUaW1lT2Zmc2V0KGRhdGUsIGtpbmQpIHtcbiAgICBzd2l0Y2ggKGtpbmQpIHtcbiAgICAgICAgY2FzZSAxIC8qIERhdGVLaW5kLlVUQyAqLzogcmV0dXJuIERhdGVUaW1lKGRhdGUuZ2V0VGltZSgpLCAxIC8qIERhdGVLaW5kLlVUQyAqLyk7XG4gICAgICAgIGNhc2UgMiAvKiBEYXRlS2luZC5Mb2NhbCAqLzogcmV0dXJuIERhdGVUaW1lKGRhdGUuZ2V0VGltZSgpLCAyIC8qIERhdGVLaW5kLkxvY2FsICovKTtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGNvbnN0IGQgPSBEYXRlVGltZShkYXRlLmdldFRpbWUoKSArIChkYXRlLm9mZnNldCA/PyAwKSwga2luZCk7XG4gICAgICAgICAgICByZXR1cm4gRGF0ZVRpbWUoZC5nZXRUaW1lKCkgLSBkYXRlT2Zmc2V0KGQpLCBraW5kKTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gZ2V0VGlja3MoZGF0ZSkge1xuICAgIHJldHVybiB1bml4RXBvY2hNaWxsaXNlY29uZHNUb1RpY2tzKGRhdGUuZ2V0VGltZSgpLCBkYXRlT2Zmc2V0KGRhdGUpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBtaW5WYWx1ZSgpIHtcbiAgICAvLyBUaGlzIGlzIFwiMDAwMS0wMS0wMVQwMDowMDowMC4wMDBaXCIsIGFjdHVhbCBKUyBtaW4gdmFsdWUgaXMgLTg2NDAwMDAwMDAwMDAwMDBcbiAgICByZXR1cm4gRGF0ZVRpbWUoLTYyMTM1NTk2ODAwMDAwLCAwIC8qIERhdGVLaW5kLlVuc3BlY2lmaWVkICovKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBtYXhWYWx1ZSgpIHtcbiAgICAvLyBUaGlzIGlzIFwiOTk5OS0xMi0zMVQyMzo1OTo1OS45OTlaXCIsIGFjdHVhbCBKUyBtYXggdmFsdWUgaXMgODY0MDAwMDAwMDAwMDAwMFxuICAgIHJldHVybiBEYXRlVGltZSgyNTM0MDIzMDA3OTk5OTksIDAgLyogRGF0ZUtpbmQuVW5zcGVjaWZpZWQgKi8pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlUmF3KGlucHV0KSB7XG4gICAgZnVuY3Rpb24gZmFpbCgpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgc3RyaW5nIGlzIG5vdCBhIHZhbGlkIERhdGU6ICR7aW5wdXR9YCk7XG4gICAgfVxuICAgIGlmIChpbnB1dCA9PSBudWxsIHx8IGlucHV0LnRyaW0oKSA9PT0gXCJcIikge1xuICAgICAgICBmYWlsKCk7XG4gICAgfVxuICAgIC8vIElTTyBkYXRlcyB3aXRob3V0IFRaIGFyZSBwYXJzZWQgYXMgVVRDLiBBZGRpbmcgdGltZSB3aXRob3V0IFRaIGtlZXBzIHRoZW0gbG9jYWwuXG4gICAgaWYgKGlucHV0Lmxlbmd0aCA9PT0gMTAgJiYgaW5wdXRbNF0gPT09IFwiLVwiICYmIGlucHV0WzddID09PSBcIi1cIikge1xuICAgICAgICBpbnB1dCArPSBcIlQwMDowMDowMFwiO1xuICAgIH1cbiAgICBsZXQgZGF0ZSA9IG5ldyBEYXRlKGlucHV0KTtcbiAgICBsZXQgb2Zmc2V0ID0gbnVsbDtcbiAgICBpZiAoaXNOYU4oZGF0ZS5nZXRUaW1lKCkpKSB7XG4gICAgICAgIC8vIFRyeSB0byBjaGVjayBzdHJpbmdzIEpTIERhdGUgY2Fubm90IHBhcnNlIChzZWUgIzEwNDUsICMxNDIyKVxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXG4gICAgICAgIGNvbnN0IG0gPSAvXlxccyooXFxkK1teXFx3XFxzOl1cXGQrW15cXHdcXHM6XVxcZCspP1xccyooXFxkKzpcXGQrKD86OlxcZCsoPzpcXC5cXGQrKT8pPyk/XFxzKihbQWFQcF1bTW1dKT9cXHMqKFp8WystXShbMDFdP1xcZCk6PyhbMC01XT9cXGQpPyk/XFxzKiQvLmV4ZWMoaW5wdXQpO1xuICAgICAgICBpZiAobSAhPSBudWxsKSB7XG4gICAgICAgICAgICBsZXQgYmFzZURhdGU7XG4gICAgICAgICAgICBsZXQgdGltZUluU2Vjb25kcyA9IDA7XG4gICAgICAgICAgICBpZiAobVsyXSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGltZVBhcnRzID0gbVsyXS5zcGxpdChcIjpcIik7XG4gICAgICAgICAgICAgICAgY29uc3QgaG91clBhcnQgPSBwYXJzZUludCh0aW1lUGFydHNbMF0sIDEwKTtcbiAgICAgICAgICAgICAgICB0aW1lSW5TZWNvbmRzID1cbiAgICAgICAgICAgICAgICAgICAgaG91clBhcnQgKiAzNjAwICtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlSW50KHRpbWVQYXJ0c1sxXSB8fCBcIjBcIiwgMTApICogNjAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VGbG9hdCh0aW1lUGFydHNbMl0gfHwgXCIwXCIpO1xuICAgICAgICAgICAgICAgIGlmIChtWzNdICE9IG51bGwgJiYgbVszXS50b1VwcGVyQ2FzZSgpID09PSBcIlBNXCIgJiYgaG91clBhcnQgPCAxMikge1xuICAgICAgICAgICAgICAgICAgICB0aW1lSW5TZWNvbmRzICs9IDcyMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobVs0XSAhPSBudWxsKSB7IC8vIFRoZXJlJ3MgYW4gb2Zmc2V0LCBwYXJzZSBhcyBVVENcbiAgICAgICAgICAgICAgICBpZiAobVsxXSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGJhc2VEYXRlID0gbmV3IERhdGUobVsxXSArIFwiIFVUQ1wiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGQgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICBiYXNlRGF0ZSA9IG5ldyBEYXRlKGQuZ2V0VVRDRnVsbFllYXIoKSArIFwiL1wiICsgKGQuZ2V0VVRDTW9udGgoKSArIDEpICsgXCIvXCIgKyBkLmdldFVUQ0RhdGUoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChtWzRdID09PSBcIlpcIikge1xuICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSBcIlpcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBvZmZzZXRJbk1pbnV0ZXMgPSBwYXJzZUludChtWzVdLCAxMCkgKiA2MCArIHBhcnNlSW50KG1bNl0gfHwgXCIwXCIsIDEwKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1bNF1bMF0gPT09IFwiLVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXRJbk1pbnV0ZXMgKj0gLTE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0SW5NaW51dGVzO1xuICAgICAgICAgICAgICAgICAgICB0aW1lSW5TZWNvbmRzIC09IG9mZnNldEluTWludXRlcyAqIDYwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChtWzFdICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgYmFzZURhdGUgPSBuZXcgRGF0ZShtWzFdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGQgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICBiYXNlRGF0ZSA9IG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSArIFwiL1wiICsgKGQuZ2V0TW9udGgoKSArIDEpICsgXCIvXCIgKyBkLmdldERhdGUoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGF0ZSA9IG5ldyBEYXRlKGJhc2VEYXRlLmdldFRpbWUoKSArIHRpbWVJblNlY29uZHMgKiAxMDAwKTtcbiAgICAgICAgICAgIC8vIGNvcnJlY3QgZm9yIGRheWxpZ2h0IHNhdmluZ3MgdGltZVxuICAgICAgICAgICAgZGF0ZSA9IG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpICsgKGRhdGUuZ2V0VGltZXpvbmVPZmZzZXQoKSAtIGJhc2VEYXRlLmdldFRpbWV6b25lT2Zmc2V0KCkpICogNjAwMDApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZmFpbCgpO1xuICAgICAgICB9XG4gICAgICAgIC8vIENoZWNrIGFnYWluIHRoZSBkYXRlIGlzIHZhbGlkIGFmdGVyIHRyYW5zZm9ybWF0aW9ucywgc2VlICMyMjI5XG4gICAgICAgIGlmIChpc05hTihkYXRlLmdldFRpbWUoKSkpIHtcbiAgICAgICAgICAgIGZhaWwoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gW2RhdGUsIG9mZnNldF07XG59XG5leHBvcnQgZnVuY3Rpb24gcGFyc2Uoc3RyLCBkZXRlY3RVVEMgPSBmYWxzZSkge1xuICAgIGNvbnN0IFtkYXRlLCBvZmZzZXRdID0gcGFyc2VSYXcoc3RyKTtcbiAgICAvLyAuTkVUIGFsd2F5cyBwYXJzZXMgRGF0ZVRpbWUgYXMgTG9jYWwgaWYgdGhlcmUncyBvZmZzZXQgaW5mbyAoZXZlbiBcIlpcIilcbiAgICAvLyBOZXd0b25zb2Z0Lkpzb24gdXNlcyBVVEMgaWYgdGhlIG9mZnNldCBpcyBcIlpcIlxuICAgIGNvbnN0IGtpbmQgPSBvZmZzZXQgIT0gbnVsbFxuICAgICAgICA/IChkZXRlY3RVVEMgJiYgb2Zmc2V0ID09PSBcIlpcIiA/IDEgLyogRGF0ZUtpbmQuVVRDICovIDogMiAvKiBEYXRlS2luZC5Mb2NhbCAqLylcbiAgICAgICAgOiAwIC8qIERhdGVLaW5kLlVuc3BlY2lmaWVkICovO1xuICAgIHJldHVybiBEYXRlVGltZShkYXRlLmdldFRpbWUoKSwga2luZCk7XG59XG5leHBvcnQgZnVuY3Rpb24gdHJ5UGFyc2UodiwgZGVmVmFsdWUpIHtcbiAgICB0cnkge1xuICAgICAgICBkZWZWYWx1ZS5jb250ZW50cyA9IHBhcnNlKHYpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgY2F0Y2ggKF9lcnIpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGUoeWVhciwgbW9udGgsIGRheSwgaCA9IDAsIG0gPSAwLCBzID0gMCwgbXMgPSAwLCBraW5kKSB7XG4gICAgY29uc3QgZGF0ZSA9IGtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovXG4gICAgICAgID8gbmV3IERhdGUoRGF0ZS5VVEMoeWVhciwgbW9udGggLSAxLCBkYXksIGgsIG0sIHMsIG1zKSlcbiAgICAgICAgOiBuZXcgRGF0ZSh5ZWFyLCBtb250aCAtIDEsIGRheSwgaCwgbSwgcywgbXMpO1xuICAgIGlmICh5ZWFyIDw9IDk5KSB7XG4gICAgICAgIGlmIChraW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqLykge1xuICAgICAgICAgICAgZGF0ZS5zZXRVVENGdWxsWWVhcih5ZWFyLCBtb250aCAtIDEsIGRheSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBkYXRlLnNldEZ1bGxZZWFyKHllYXIsIG1vbnRoIC0gMSwgZGF5KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBkYXRlVmFsdWUgPSBkYXRlLmdldFRpbWUoKTtcbiAgICBpZiAoaXNOYU4oZGF0ZVZhbHVlKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgcGFyYW1ldGVycyBkZXNjcmliZSBhbiB1bnJlcHJlc2VudGFibGUgRGF0ZS5cIik7XG4gICAgfVxuICAgIHJldHVybiBEYXRlVGltZShkYXRlVmFsdWUsIGtpbmQpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIG5vdygpIHtcbiAgICByZXR1cm4gRGF0ZVRpbWUoRGF0ZS5ub3coKSwgMiAvKiBEYXRlS2luZC5Mb2NhbCAqLyk7XG59XG5leHBvcnQgZnVuY3Rpb24gdXRjTm93KCkge1xuICAgIHJldHVybiBEYXRlVGltZShEYXRlLm5vdygpLCAxIC8qIERhdGVLaW5kLlVUQyAqLyk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9kYXkoKSB7XG4gICAgcmV0dXJuIGRhdGUobm93KCkpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGlzTGVhcFllYXIoeWVhcikge1xuICAgIHJldHVybiB5ZWFyICUgNCA9PT0gMCAmJiB5ZWFyICUgMTAwICE9PSAwIHx8IHllYXIgJSA0MDAgPT09IDA7XG59XG5leHBvcnQgZnVuY3Rpb24gZGF5c0luTW9udGgoeWVhciwgbW9udGgpIHtcbiAgICByZXR1cm4gbW9udGggPT09IDJcbiAgICAgICAgPyAoaXNMZWFwWWVhcih5ZWFyKSA/IDI5IDogMjgpXG4gICAgICAgIDogKG1vbnRoID49IDggPyAobW9udGggJSAyID09PSAwID8gMzEgOiAzMCkgOiAobW9udGggJSAyID09PSAwID8gMzAgOiAzMSkpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvVW5pdmVyc2FsVGltZShkYXRlKSB7XG4gICAgcmV0dXJuIGRhdGUua2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi8gPyBkYXRlIDogRGF0ZVRpbWUoZGF0ZS5nZXRUaW1lKCksIDEgLyogRGF0ZUtpbmQuVVRDICovKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b0xvY2FsVGltZShkYXRlKSB7XG4gICAgcmV0dXJuIGRhdGUua2luZCA9PT0gMiAvKiBEYXRlS2luZC5Mb2NhbCAqLyA/IGRhdGUgOiBEYXRlVGltZShkYXRlLmdldFRpbWUoKSwgMiAvKiBEYXRlS2luZC5Mb2NhbCAqLyk7XG59XG5leHBvcnQgZnVuY3Rpb24gc3BlY2lmeUtpbmQoZCwga2luZCkge1xuICAgIHJldHVybiBjcmVhdGUoeWVhcihkKSwgbW9udGgoZCksIGRheShkKSwgaG91cihkKSwgbWludXRlKGQpLCBzZWNvbmQoZCksIG1pbGxpc2Vjb25kKGQpLCBraW5kKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0aW1lT2ZEYXkoZCkge1xuICAgIHJldHVybiBob3VyKGQpICogMzYwMDAwMFxuICAgICAgICArIG1pbnV0ZShkKSAqIDYwMDAwXG4gICAgICAgICsgc2Vjb25kKGQpICogMTAwMFxuICAgICAgICArIG1pbGxpc2Vjb25kKGQpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGRhdGUoZCkge1xuICAgIHJldHVybiBjcmVhdGUoeWVhcihkKSwgbW9udGgoZCksIGRheShkKSwgMCwgMCwgMCwgMCwgZC5raW5kKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBkYXkoZCkge1xuICAgIHJldHVybiBkLmtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovID8gZC5nZXRVVENEYXRlKCkgOiBkLmdldERhdGUoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBob3VyKGQpIHtcbiAgICByZXR1cm4gZC5raW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqLyA/IGQuZ2V0VVRDSG91cnMoKSA6IGQuZ2V0SG91cnMoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBtaWxsaXNlY29uZChkKSB7XG4gICAgcmV0dXJuIGQua2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi8gPyBkLmdldFVUQ01pbGxpc2Vjb25kcygpIDogZC5nZXRNaWxsaXNlY29uZHMoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBtaW51dGUoZCkge1xuICAgIHJldHVybiBkLmtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovID8gZC5nZXRVVENNaW51dGVzKCkgOiBkLmdldE1pbnV0ZXMoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBtb250aChkKSB7XG4gICAgcmV0dXJuIChkLmtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovID8gZC5nZXRVVENNb250aCgpIDogZC5nZXRNb250aCgpKSArIDE7XG59XG5leHBvcnQgZnVuY3Rpb24gc2Vjb25kKGQpIHtcbiAgICByZXR1cm4gZC5raW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqLyA/IGQuZ2V0VVRDU2Vjb25kcygpIDogZC5nZXRTZWNvbmRzKCk7XG59XG5leHBvcnQgZnVuY3Rpb24geWVhcihkKSB7XG4gICAgcmV0dXJuIGQua2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi8gPyBkLmdldFVUQ0Z1bGxZZWFyKCkgOiBkLmdldEZ1bGxZZWFyKCk7XG59XG5leHBvcnQgZnVuY3Rpb24gZGF5T2ZXZWVrKGQpIHtcbiAgICByZXR1cm4gZC5raW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqLyA/IGQuZ2V0VVRDRGF5KCkgOiBkLmdldERheSgpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGRheU9mWWVhcihkKSB7XG4gICAgY29uc3QgX3llYXIgPSB5ZWFyKGQpO1xuICAgIGNvbnN0IF9tb250aCA9IG1vbnRoKGQpO1xuICAgIGxldCBfZGF5ID0gZGF5KGQpO1xuICAgIGZvciAobGV0IGkgPSAxOyBpIDwgX21vbnRoOyBpKyspIHtcbiAgICAgICAgX2RheSArPSBkYXlzSW5Nb250aChfeWVhciwgaSk7XG4gICAgfVxuICAgIHJldHVybiBfZGF5O1xufVxuZXhwb3J0IGZ1bmN0aW9uIGFkZChkLCB0cykge1xuICAgIGNvbnN0IG5ld0RhdGUgPSBEYXRlVGltZShkLmdldFRpbWUoKSArIHRzLCBkLmtpbmQpO1xuICAgIGlmIChkLmtpbmQgPT09IDIgLyogRGF0ZUtpbmQuTG9jYWwgKi8pIHtcbiAgICAgICAgY29uc3Qgb2xkVHpPZmZzZXQgPSBkLmdldFRpbWV6b25lT2Zmc2V0KCk7XG4gICAgICAgIGNvbnN0IG5ld1R6T2Zmc2V0ID0gbmV3RGF0ZS5nZXRUaW1lem9uZU9mZnNldCgpO1xuICAgICAgICByZXR1cm4gb2xkVHpPZmZzZXQgIT09IG5ld1R6T2Zmc2V0XG4gICAgICAgICAgICA/IERhdGVUaW1lKG5ld0RhdGUuZ2V0VGltZSgpICsgKG5ld1R6T2Zmc2V0IC0gb2xkVHpPZmZzZXQpICogNjAwMDAsIGQua2luZClcbiAgICAgICAgICAgIDogbmV3RGF0ZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBuZXdEYXRlO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBhZGREYXlzKGQsIHYpIHtcbiAgICByZXR1cm4gYWRkKGQsIHYgKiA4NjQwMDAwMCk7XG59XG5leHBvcnQgZnVuY3Rpb24gYWRkSG91cnMoZCwgdikge1xuICAgIHJldHVybiBhZGQoZCwgdiAqIDM2MDAwMDApO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGFkZE1pbnV0ZXMoZCwgdikge1xuICAgIHJldHVybiBhZGQoZCwgdiAqIDYwMDAwKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBhZGRTZWNvbmRzKGQsIHYpIHtcbiAgICByZXR1cm4gYWRkKGQsIHYgKiAxMDAwKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBhZGRNaWxsaXNlY29uZHMoZCwgdikge1xuICAgIHJldHVybiBhZGQoZCwgdik7XG59XG5leHBvcnQgZnVuY3Rpb24gYWRkVGlja3MoZCwgdikge1xuICAgIHJldHVybiBhZGQoZCwgdG9GbG9hdDY0KHYgLyAxMDAwMG4pKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBhZGRZZWFycyhkLCB2KSB7XG4gICAgY29uc3QgbmV3TW9udGggPSBtb250aChkKTtcbiAgICBjb25zdCBuZXdZZWFyID0geWVhcihkKSArIHY7XG4gICAgY29uc3QgX2RheXNJbk1vbnRoID0gZGF5c0luTW9udGgobmV3WWVhciwgbmV3TW9udGgpO1xuICAgIGNvbnN0IG5ld0RheSA9IE1hdGgubWluKF9kYXlzSW5Nb250aCwgZGF5KGQpKTtcbiAgICByZXR1cm4gY3JlYXRlKG5ld1llYXIsIG5ld01vbnRoLCBuZXdEYXksIGhvdXIoZCksIG1pbnV0ZShkKSwgc2Vjb25kKGQpLCBtaWxsaXNlY29uZChkKSwgZC5raW5kKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBhZGRNb250aHMoZCwgdikge1xuICAgIGxldCBuZXdNb250aCA9IG1vbnRoKGQpICsgdjtcbiAgICBsZXQgbmV3TW9udGhfID0gMDtcbiAgICBsZXQgeWVhck9mZnNldCA9IDA7XG4gICAgaWYgKG5ld01vbnRoID4gMTIpIHtcbiAgICAgICAgbmV3TW9udGhfID0gbmV3TW9udGggJSAxMjtcbiAgICAgICAgeWVhck9mZnNldCA9IE1hdGguZmxvb3IobmV3TW9udGggLyAxMik7XG4gICAgICAgIG5ld01vbnRoID0gbmV3TW9udGhfO1xuICAgIH1cbiAgICBlbHNlIGlmIChuZXdNb250aCA8IDEpIHtcbiAgICAgICAgbmV3TW9udGhfID0gMTIgKyBuZXdNb250aCAlIDEyO1xuICAgICAgICB5ZWFyT2Zmc2V0ID0gTWF0aC5mbG9vcihuZXdNb250aCAvIDEyKSArIChuZXdNb250aF8gPT09IDEyID8gLTEgOiAwKTtcbiAgICAgICAgbmV3TW9udGggPSBuZXdNb250aF87XG4gICAgfVxuICAgIGNvbnN0IG5ld1llYXIgPSB5ZWFyKGQpICsgeWVhck9mZnNldDtcbiAgICBjb25zdCBfZGF5c0luTW9udGggPSBkYXlzSW5Nb250aChuZXdZZWFyLCBuZXdNb250aCk7XG4gICAgY29uc3QgbmV3RGF5ID0gTWF0aC5taW4oX2RheXNJbk1vbnRoLCBkYXkoZCkpO1xuICAgIHJldHVybiBjcmVhdGUobmV3WWVhciwgbmV3TW9udGgsIG5ld0RheSwgaG91cihkKSwgbWludXRlKGQpLCBzZWNvbmQoZCksIG1pbGxpc2Vjb25kKGQpLCBkLmtpbmQpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHN1YnRyYWN0KGQsIHRoYXQpIHtcbiAgICByZXR1cm4gdHlwZW9mIHRoYXQgPT09IFwibnVtYmVyXCJcbiAgICAgICAgPyBhZGQoZCwgLXRoYXQpXG4gICAgICAgIDogZC5nZXRUaW1lKCkgLSB0aGF0LmdldFRpbWUoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b0xvbmdEYXRlU3RyaW5nKGQpIHtcbiAgICByZXR1cm4gZC50b0RhdGVTdHJpbmcoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b1Nob3J0RGF0ZVN0cmluZyhkKSB7XG4gICAgcmV0dXJuIGQudG9Mb2NhbGVEYXRlU3RyaW5nKCk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9Mb25nVGltZVN0cmluZyhkKSB7XG4gICAgcmV0dXJuIGQudG9Mb2NhbGVUaW1lU3RyaW5nKCk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9TaG9ydFRpbWVTdHJpbmcoZCkge1xuICAgIHJldHVybiBkLnRvTG9jYWxlVGltZVN0cmluZygpLnJlcGxhY2UoLzpcXGRcXGQoPyE6KS8sIFwiXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGVxdWFscyhkMSwgZDIpIHtcbiAgICByZXR1cm4gZDEuZ2V0VGltZSgpID09PSBkMi5nZXRUaW1lKCk7XG59XG5leHBvcnQgY29uc3QgY29tcGFyZSA9IGNvbXBhcmVEYXRlcztcbmV4cG9ydCBjb25zdCBjb21wYXJlVG8gPSBjb21wYXJlRGF0ZXM7XG5leHBvcnQgZnVuY3Rpb24gb3BfQWRkaXRpb24oeCwgeSkge1xuICAgIHJldHVybiBhZGQoeCwgeSk7XG59XG5leHBvcnQgZnVuY3Rpb24gb3BfU3VidHJhY3Rpb24oeCwgeSkge1xuICAgIHJldHVybiBzdWJ0cmFjdCh4LCB5KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpc0RheWxpZ2h0U2F2aW5nVGltZSh4KSB7XG4gICAgY29uc3QgamFuID0gbmV3IERhdGUoeC5nZXRGdWxsWWVhcigpLCAwLCAxKTtcbiAgICBjb25zdCBqdWwgPSBuZXcgRGF0ZSh4LmdldEZ1bGxZZWFyKCksIDYsIDEpO1xuICAgIHJldHVybiBpc0RTVChqYW4uZ2V0VGltZXpvbmVPZmZzZXQoKSwganVsLmdldFRpbWV6b25lT2Zmc2V0KCksIHguZ2V0VGltZXpvbmVPZmZzZXQoKSk7XG59XG5mdW5jdGlvbiBpc0RTVChqYW5PZmZzZXQsIGp1bE9mZnNldCwgdE9mZnNldCkge1xuICAgIHJldHVybiBNYXRoLm1pbihqYW5PZmZzZXQsIGp1bE9mZnNldCkgPT09IHRPZmZzZXQ7XG59XG5leHBvcnQgZGVmYXVsdCBEYXRlVGltZTtcbiIsCiAgIi8qKlxuICogRGF0ZVRpbWVPZmZzZXQgZnVuY3Rpb25zLlxuICpcbiAqIE5vdGU6IERhdGUgaW5zdGFuY2VzIGFyZSBhbHdheXMgRGF0ZU9iamVjdHMgaW4gbG9jYWxcbiAqIHRpbWV6b25lIChiZWNhdXNlIEpTIGRhdGVzIGFyZSBhbGwga2luZHMgb2YgbWVzc2VkIHVwKS5cbiAqIEEgbG9jYWwgZGF0ZSByZXR1cm5zIFVUQyBlcG9jaCB3aGVuIGAuZ2V0VGltZSgpYCBpcyBjYWxsZWQuXG4gKlxuICogQmFzaWNhbGx5OyBpbnZhcmlhbnQ6IGRhdGUuZ2V0VGltZSgpIGFsd2F5cyByZXR1cm4gVVRDIHRpbWUuXG4gKi9cbmltcG9ydCB7IHRvSW50NjQsIHRvRmxvYXQ2NCB9IGZyb20gXCIuL0JpZ0ludC5qc1wiO1xuaW1wb3J0IHsgY29tcGFyZURhdGVzLCBkYXRlT2Zmc2V0LCBwYWRXaXRoWmVyb3MgfSBmcm9tIFwiLi9VdGlsLmpzXCI7XG5jb25zdCBzaG9ydERheXMgPSBbXG4gICAgXCJTdW5cIiwgXCJNb25cIiwgXCJUdWVcIiwgXCJXZWRcIiwgXCJUaHVcIiwgXCJGcmlcIiwgXCJTYXRcIlxuXTtcbmNvbnN0IGxvbmdEYXlzID0gW1xuICAgIFwiU3VuZGF5XCIsIFwiTW9uZGF5XCIsIFwiVHVlc2RheVwiLCBcIldlZG5lc2RheVwiLCBcIlRodXJzZGF5XCIsIFwiRnJpZGF5XCIsIFwiU2F0dXJkYXlcIlxuXTtcbmNvbnN0IHNob3J0TW9udGhzID0gW1xuICAgIFwiSmFuXCIsIFwiRmViXCIsIFwiTWFyXCIsIFwiQXByXCIsIFwiTWF5XCIsIFwiSnVuXCIsIFwiSnVsXCIsIFwiQXVnXCIsIFwiU2VwXCIsIFwiT2N0XCIsIFwiTm92XCIsIFwiRGVjXCJcbl07XG5jb25zdCBsb25nTW9udGhzID0gW1xuICAgIFwiSmFudWFyeVwiLCBcIkZlYnJ1YXJ5XCIsIFwiTWFyY2hcIiwgXCJBcHJpbFwiLCBcIk1heVwiLCBcIkp1bmVcIiwgXCJKdWx5XCIsIFwiQXVndXN0XCIsIFwiU2VwdGVtYmVyXCIsIFwiT2N0b2JlclwiLCBcIk5vdmVtYmVyXCIsIFwiRGVjZW1iZXJcIlxuXTtcbmZ1bmN0aW9uIHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBwb3MsIHBhdHRlcm5DaGFyKSB7XG4gICAgbGV0IHRva2VuTGVuZ3RoID0gMDtcbiAgICBsZXQgaW50ZXJuYWxQb3MgPSBwb3M7XG4gICAgd2hpbGUgKGludGVybmFsUG9zIDwgZm9ybWF0Lmxlbmd0aCAmJiBmb3JtYXRbaW50ZXJuYWxQb3NdID09PSBwYXR0ZXJuQ2hhcikge1xuICAgICAgICBpbnRlcm5hbFBvcysrO1xuICAgICAgICB0b2tlbkxlbmd0aCsrO1xuICAgIH1cbiAgICByZXR1cm4gdG9rZW5MZW5ndGg7XG59XG5mdW5jdGlvbiBwYXJzZU5leHRDaGFyKGZvcm1hdCwgcG9zKSB7XG4gICAgaWYgKHBvcyA+PSBmb3JtYXQubGVuZ3RoIC0gMSkge1xuICAgICAgICByZXR1cm4gLTE7XG4gICAgfVxuICAgIHJldHVybiBmb3JtYXQuY2hhckNvZGVBdChwb3MgKyAxKTtcbn1cbmZ1bmN0aW9uIHBhcnNlUXVvdGVkU3RyaW5nKGZvcm1hdCwgcG9zKSB7XG4gICAgbGV0IGJlZ2luUG9zID0gcG9zO1xuICAgIC8vIEdldCB0aGUgY2hhcmFjdGVyIHVzZWQgdG8gcXVvdGUgdGhlIHN0cmluZ1xuICAgIGNvbnN0IHF1b3RlQ2hhciA9IGZvcm1hdFtwb3NdO1xuICAgIGxldCByZXN1bHQgPSBcIlwiO1xuICAgIGxldCBmb3VuZFF1b3RlID0gZmFsc2U7XG4gICAgd2hpbGUgKHBvcyA8IGZvcm1hdC5sZW5ndGgpIHtcbiAgICAgICAgcG9zKys7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRDaGFyID0gZm9ybWF0W3Bvc107XG4gICAgICAgIGlmIChjdXJyZW50Q2hhciA9PT0gcXVvdGVDaGFyKSB7XG4gICAgICAgICAgICBmb3VuZFF1b3RlID0gdHJ1ZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGN1cnJlbnRDaGFyID09PSBcIlxcXFxcIikge1xuICAgICAgICAgICAgaWYgKHBvcyA8IGZvcm1hdC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBwb3MrKztcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gZm9ybWF0W3Bvc107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBUaGlzIG1lYW5zIHRoYXQgJ1xcJyBpcyB0aGUgbGFzdCBjaGFyYWN0ZXIgaW4gdGhlIHN0cmluZy5cbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHN0cmluZyBmb3JtYXRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQgKz0gY3VycmVudENoYXI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKCFmb3VuZFF1b3RlKSB7XG4gICAgICAgIC8vIFdlIGNvdWxkIG5vdCBmaW5kIHRoZSBtYXRjaGluZyBxdW90ZVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgc3RyaW5nIGZvcm1hdCBjb3VsZCBub3QgZmluZCBtYXRjaGluZyBxdW90ZSBmb3IgJHtxdW90ZUNoYXJ9YCk7XG4gICAgfVxuICAgIHJldHVybiBbcmVzdWx0LCBwb3MgLSBiZWdpblBvcyArIDFdO1xufVxuZnVuY3Rpb24gZGF0ZVRvU3RyaW5nV2l0aEN1c3RvbUZvcm1hdChkYXRlLCBmb3JtYXQsIHV0Yykge1xuICAgIGxldCBjdXJzb3JQb3MgPSAwO1xuICAgIGxldCB0b2tlbkxlbmd0aCA9IDA7XG4gICAgbGV0IHJlc3VsdCA9IFwiXCI7XG4gICAgY29uc3QgbG9jYWxpemVkRGF0ZSA9IHV0YyA/IERhdGVUaW1lKGRhdGUuZ2V0VGltZSgpLCAxIC8qIERhdGVLaW5kLlVUQyAqLykgOiBkYXRlO1xuICAgIHdoaWxlIChjdXJzb3JQb3MgPCBmb3JtYXQubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IHRva2VuID0gZm9ybWF0W2N1cnNvclBvc107XG4gICAgICAgIHN3aXRjaCAodG9rZW4pIHtcbiAgICAgICAgICAgIGNhc2UgXCJkXCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcImRcIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodG9rZW5MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGxvY2FsaXplZERhdGUuZ2V0RGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3MobG9jYWxpemVkRGF0ZS5nZXREYXRlKCksIDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBzaG9ydERheXNbZGF5T2ZXZWVrKGxvY2FsaXplZERhdGUpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gbG9uZ0RheXNbZGF5T2ZXZWVrKGxvY2FsaXplZERhdGUpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImZcIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwiZlwiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgaWYgKHRva2VuTGVuZ3RoIDw9IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJlY2lzaW9uID0gMTAgKiogKDMgLSB0b2tlbkxlbmd0aCk7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3MoTWF0aC5mbG9vcihtaWxsaXNlY29uZChsb2NhbGl6ZWREYXRlKSAvIHByZWNpc2lvbiksIHRva2VuTGVuZ3RoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodG9rZW5MZW5ndGggPD0gNykge1xuICAgICAgICAgICAgICAgICAgICAvLyBKYXZhU2NyaXB0IERhdGUgb25seSBzdXBwb3J0IHByZWNpc2lvbiB0byB0aGUgbWlsbGlzZWNvbmRcbiAgICAgICAgICAgICAgICAgICAgLy8gc28gd2UgZmlsbCB0aGUgcmVzdCBvZiB0aGUgcHJlY2lzaW9uIHdpdGggMCBhcyBpZiB0aGUgZGF0ZSBkaWRuJ3QgaGF2ZVxuICAgICAgICAgICAgICAgICAgICAvLyBtaWxsaXNlY29uZHMgcHJvdmlkZWQgdG8gaXQuXG4gICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdG8gaGF2ZSB0aGUgc2FtZSBiZWhhdmlvciBhcyAuTkVUIHdoZW4gZG9pbmc6XG4gICAgICAgICAgICAgICAgICAgIC8vIERhdGVUaW1lKDEsIDIsIDMsIDQsIDUsIDYsIERhdGVUaW1lS2luZC5VdGMpLlRvU3RyaW5nKFwiZmZmZmZcIikgPT4gMDAwMDBcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IChcIlwiICsgbWlsbGlzZWNvbmQobG9jYWxpemVkRGF0ZSkpLnBhZEVuZCh0b2tlbkxlbmd0aCwgXCIwXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJGXCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcIkZcIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmICh0b2tlbkxlbmd0aCA8PSAzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByZWNpc2lvbiA9IDEwICoqICgzIC0gdG9rZW5MZW5ndGgpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IE1hdGguZmxvb3IobWlsbGlzZWNvbmQobG9jYWxpemVkRGF0ZSkgLyBwcmVjaXNpb24pO1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyh2YWx1ZSwgdG9rZW5MZW5ndGgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRva2VuTGVuZ3RoIDw9IDcpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSmF2YVNjcmlwdCBEYXRlIG9ubHkgc3VwcG9ydCBwcmVjaXNpb24gdG8gdGhlIG1pbGxpc2Vjb25kXG4gICAgICAgICAgICAgICAgICAgIC8vIHNvIHdlIGNhbid0IGdvIGJleW9uZCB0aGF0LlxuICAgICAgICAgICAgICAgICAgICAvLyBXZSBhbHNvIG5lZWQgdG8gcGFkIHN0YXJ0IHdpdGggMCBpZiB0aGUgdmFsdWUgaXMgbm90IDBcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBtaWxsaXNlY29uZChsb2NhbGl6ZWREYXRlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3ModmFsdWUsIDMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImdcIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwiZ1wiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgaWYgKHRva2VuTGVuZ3RoIDw9IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IFwiQS5ELlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJoXCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcImhcIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodG9rZW5MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGhvdXIobG9jYWxpemVkRGF0ZSkgJSAxMjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKGhvdXIobG9jYWxpemVkRGF0ZSkgJSAxMiwgMik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJIXCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcIkhcIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodG9rZW5MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGhvdXIobG9jYWxpemVkRGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyhob3VyKGxvY2FsaXplZERhdGUpLCAyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIktcIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwiS1wiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0b2tlbkxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGtpbmQobG9jYWxpemVkRGF0ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEgLyogRGF0ZUtpbmQuVVRDICovOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gXCJaXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMiAvKiBEYXRlS2luZC5Mb2NhbCAqLzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGRhdGVPZmZzZXRUb1N0cmluZyhsb2NhbGl6ZWREYXRlLmdldFRpbWV6b25lT2Zmc2V0KCkgKiAtNjAwMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDAgLyogRGF0ZUtpbmQuVW5zcGVjaWZpZWQgKi86XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwibVwiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJtXCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRva2VuTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBtaW51dGUobG9jYWxpemVkRGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyhtaW51dGUobG9jYWxpemVkRGF0ZSksIDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiTVwiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJNXCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRva2VuTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBtb250aChsb2NhbGl6ZWREYXRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKG1vbnRoKGxvY2FsaXplZERhdGUpLCAyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gc2hvcnRNb250aHNbbW9udGgobG9jYWxpemVkRGF0ZSkgLSAxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gbG9uZ01vbnRoc1ttb250aChsb2NhbGl6ZWREYXRlKSAtIDFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwic1wiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJzXCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRva2VuTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBzZWNvbmQobG9jYWxpemVkRGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyhzZWNvbmQobG9jYWxpemVkRGF0ZSksIDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwidFwiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJ0XCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRva2VuTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBsb2NhbGl6ZWREYXRlLmdldEhvdXJzKCkgPCAxMiA/IFwiQVwiIDogXCJQXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGxvY2FsaXplZERhdGUuZ2V0SG91cnMoKSA8IDEyID8gXCJBTVwiIDogXCJQTVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwieVwiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJ5XCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRva2VuTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBsb2NhbGl6ZWREYXRlLmdldEZ1bGxZZWFyKCkgJSAxMDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyhsb2NhbGl6ZWREYXRlLmdldEZ1bGxZZWFyKCkgJSAxMDAsIDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3MobG9jYWxpemVkRGF0ZS5nZXRGdWxsWWVhcigpLCAzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKGxvY2FsaXplZERhdGUuZ2V0RnVsbFllYXIoKSwgNCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyhsb2NhbGl6ZWREYXRlLmdldEZ1bGxZZWFyKCksIDUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwielwiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJ6XCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBsZXQgdXRjT2Zmc2V0VGV4dCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChraW5kKGxvY2FsaXplZERhdGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMSAvKiBEYXRlS2luZC5VVEMgKi86XG4gICAgICAgICAgICAgICAgICAgICAgICB1dGNPZmZzZXRUZXh0ID0gXCIrMDA6MDBcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDIgLyogRGF0ZUtpbmQuTG9jYWwgKi86XG4gICAgICAgICAgICAgICAgICAgICAgICB1dGNPZmZzZXRUZXh0ID0gZGF0ZU9mZnNldFRvU3RyaW5nKGxvY2FsaXplZERhdGUuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIC02MDAwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwIC8qIERhdGVLaW5kLlVuc3BlY2lmaWVkICovOlxuICAgICAgICAgICAgICAgICAgICAgICAgdXRjT2Zmc2V0VGV4dCA9IGRhdGVPZmZzZXRUb1N0cmluZyh0b0xvY2FsVGltZShsb2NhbGl6ZWREYXRlKS5nZXRUaW1lem9uZU9mZnNldCgpICogLTYwMDAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBzaWduID0gdXRjT2Zmc2V0VGV4dFswXSA9PT0gXCItXCIgPyBcIi1cIiA6IFwiK1wiO1xuICAgICAgICAgICAgICAgIGNvbnN0IGhvdXJzID0gcGFyc2VJbnQodXRjT2Zmc2V0VGV4dC5zdWJzdHJpbmcoMSwgMyksIDEwKTtcbiAgICAgICAgICAgICAgICBjb25zdCBtaW51dGVzID0gcGFyc2VJbnQodXRjT2Zmc2V0VGV4dC5zdWJzdHJpbmcoNCwgNiksIDEwKTtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRva2VuTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBgJHtzaWdufSR7aG91cnN9YDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gYCR7c2lnbn0ke3BhZFdpdGhaZXJvcyhob3VycywgMil9YDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGAke3NpZ259JHtwYWRXaXRoWmVyb3MoaG91cnMsIDIpfToke3BhZFdpdGhaZXJvcyhtaW51dGVzLCAyKX1gO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIjpcIjpcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gXCI6XCI7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zKys7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiL1wiOlxuICAgICAgICAgICAgICAgIHJlc3VsdCArPSBcIi9cIjtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MrKztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCInXCI6XG4gICAgICAgICAgICBjYXNlICdcIic6XG4gICAgICAgICAgICAgICAgY29uc3QgW3F1b3RlZFN0cmluZywgcXVvdGVkU3RyaW5nTGVuZ2h0XSA9IHBhcnNlUXVvdGVkU3RyaW5nKGZvcm1hdCwgY3Vyc29yUG9zKTtcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gcXVvdGVkU3RyaW5nO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSBxdW90ZWRTdHJpbmdMZW5naHQ7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiJVwiOlxuICAgICAgICAgICAgICAgIGNvbnN0IG5leHRDaGFyID0gcGFyc2VOZXh0Q2hhcihmb3JtYXQsIGN1cnNvclBvcyk7XG4gICAgICAgICAgICAgICAgaWYgKG5leHRDaGFyID49IDAgJiYgbmV4dENoYXIgIT09IFwiJVwiLmNoYXJDb2RlQXQoMCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IDI7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBkYXRlVG9TdHJpbmdXaXRoQ3VzdG9tRm9ybWF0KGxvY2FsaXplZERhdGUsIFN0cmluZy5mcm9tQ2hhckNvZGUobmV4dENoYXIpLCB1dGMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBmb3JtYXQgc3RyaW5nXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJcXFxcXCI6XG4gICAgICAgICAgICAgICAgY29uc3QgbmV4dENoYXIyID0gcGFyc2VOZXh0Q2hhcihmb3JtYXQsIGN1cnNvclBvcyk7XG4gICAgICAgICAgICAgICAgaWYgKG5leHRDaGFyMiA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSAyO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShuZXh0Q2hhcjIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBmb3JtYXQgc3RyaW5nXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zKys7XG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IHRva2VuO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG5leHBvcnQgZnVuY3Rpb24ga2luZCh2YWx1ZSkge1xuICAgIHJldHVybiB2YWx1ZS5raW5kIHx8IDA7XG59XG5leHBvcnQgZnVuY3Rpb24gdW5peEVwb2NoTWlsbGlzZWNvbmRzVG9UaWNrcyhtcywgb2Zmc2V0KSB7XG4gICAgcmV0dXJuIHRvSW50NjQoKChCaWdJbnQobXMpICsgNjIxMzU1OTY4MDAwMDBuKSArIEJpZ0ludChvZmZzZXQpKSAqIDEwMDAwbik7XG59XG5leHBvcnQgZnVuY3Rpb24gdGlja3NUb1VuaXhFcG9jaE1pbGxpc2Vjb25kcyh0aWNrcykge1xuICAgIHJldHVybiBOdW1iZXIoKChCaWdJbnQodGlja3MpIC8gMTAwMDBuKSAtIDYyMTM1NTk2ODAwMDAwbikpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGRhdGVPZmZzZXRUb1N0cmluZyhvZmZzZXQpIHtcbiAgICBjb25zdCBpc01pbnVzID0gb2Zmc2V0IDwgMDtcbiAgICBvZmZzZXQgPSBNYXRoLmFicyhvZmZzZXQpO1xuICAgIGNvbnN0IGhvdXJzID0gfn4ob2Zmc2V0IC8gMzYwMDAwMCk7XG4gICAgY29uc3QgbWludXRlcyA9IChvZmZzZXQgJSAzNjAwMDAwKSAvIDYwMDAwO1xuICAgIHJldHVybiAoaXNNaW51cyA/IFwiLVwiIDogXCIrXCIpICtcbiAgICAgICAgcGFkV2l0aFplcm9zKGhvdXJzLCAyKSArIFwiOlwiICtcbiAgICAgICAgcGFkV2l0aFplcm9zKG1pbnV0ZXMsIDIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGRhdGVUb0hhbGZVVENTdHJpbmcoZGF0ZSwgaGFsZikge1xuICAgIGNvbnN0IHN0ciA9IGRhdGUudG9JU09TdHJpbmcoKTtcbiAgICByZXR1cm4gaGFsZiA9PT0gXCJmaXJzdFwiXG4gICAgICAgID8gc3RyLnN1YnN0cmluZygwLCBzdHIuaW5kZXhPZihcIlRcIikpXG4gICAgICAgIDogc3RyLnN1YnN0cmluZyhzdHIuaW5kZXhPZihcIlRcIikgKyAxLCBzdHIubGVuZ3RoIC0gMSk7XG59XG5mdW5jdGlvbiBkYXRlVG9JU09TdHJpbmcoZCwgdXRjKSB7XG4gICAgaWYgKHV0Yykge1xuICAgICAgICByZXR1cm4gZC50b0lTT1N0cmluZygpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gSlMgRGF0ZSBpcyBhbHdheXMgbG9jYWxcbiAgICAgICAgY29uc3QgcHJpbnRPZmZzZXQgPSBkLmtpbmQgPT0gbnVsbCA/IHRydWUgOiBkLmtpbmQgPT09IDIgLyogRGF0ZUtpbmQuTG9jYWwgKi87XG4gICAgICAgIHJldHVybiBwYWRXaXRoWmVyb3MoZC5nZXRGdWxsWWVhcigpLCA0KSArIFwiLVwiICtcbiAgICAgICAgICAgIHBhZFdpdGhaZXJvcyhkLmdldE1vbnRoKCkgKyAxLCAyKSArIFwiLVwiICtcbiAgICAgICAgICAgIHBhZFdpdGhaZXJvcyhkLmdldERhdGUoKSwgMikgKyBcIlRcIiArXG4gICAgICAgICAgICBwYWRXaXRoWmVyb3MoZC5nZXRIb3VycygpLCAyKSArIFwiOlwiICtcbiAgICAgICAgICAgIHBhZFdpdGhaZXJvcyhkLmdldE1pbnV0ZXMoKSwgMikgKyBcIjpcIiArXG4gICAgICAgICAgICBwYWRXaXRoWmVyb3MoZC5nZXRTZWNvbmRzKCksIDIpICsgXCIuXCIgK1xuICAgICAgICAgICAgcGFkV2l0aFplcm9zKGQuZ2V0TWlsbGlzZWNvbmRzKCksIDMpICtcbiAgICAgICAgICAgIChwcmludE9mZnNldCA/IGRhdGVPZmZzZXRUb1N0cmluZyhkLmdldFRpbWV6b25lT2Zmc2V0KCkgKiAtNjAwMDApIDogXCJcIik7XG4gICAgfVxufVxuZnVuY3Rpb24gZGF0ZVRvSVNPU3RyaW5nV2l0aE9mZnNldChkYXRlV2l0aE9mZnNldCwgb2Zmc2V0KSB7XG4gICAgY29uc3Qgc3RyID0gZGF0ZVdpdGhPZmZzZXQudG9JU09TdHJpbmcoKTtcbiAgICByZXR1cm4gc3RyLnN1YnN0cmluZygwLCBzdHIubGVuZ3RoIC0gMSkgKyBkYXRlT2Zmc2V0VG9TdHJpbmcob2Zmc2V0KTtcbn1cbmZ1bmN0aW9uIGRhdGVUb1N0cmluZ1dpdGhPZmZzZXQoZGF0ZSwgZm9ybWF0KSB7XG4gICAgY29uc3QgZCA9IG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpICsgKGRhdGUub2Zmc2V0ID8/IDApKTtcbiAgICBpZiAodHlwZW9mIGZvcm1hdCAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICByZXR1cm4gZC50b0lTT1N0cmluZygpLnJlcGxhY2UoL1xcLlxcZCsvLCBcIlwiKS5yZXBsYWNlKC9bQS1aXXxcXC5cXGQrL2csIFwiIFwiKSArIGRhdGVPZmZzZXRUb1N0cmluZygoZGF0ZS5vZmZzZXQgPz8gMCkpO1xuICAgIH1cbiAgICBlbHNlIGlmIChmb3JtYXQubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIHN3aXRjaCAoZm9ybWF0KSB7XG4gICAgICAgICAgICBjYXNlIFwiRFwiOlxuICAgICAgICAgICAgY2FzZSBcImRcIjogcmV0dXJuIGRhdGVUb0hhbGZVVENTdHJpbmcoZCwgXCJmaXJzdFwiKTtcbiAgICAgICAgICAgIGNhc2UgXCJUXCI6XG4gICAgICAgICAgICBjYXNlIFwidFwiOiByZXR1cm4gZGF0ZVRvSGFsZlVUQ1N0cmluZyhkLCBcInNlY29uZFwiKTtcbiAgICAgICAgICAgIGNhc2UgXCJPXCI6XG4gICAgICAgICAgICBjYXNlIFwib1wiOiByZXR1cm4gZGF0ZVRvSVNPU3RyaW5nV2l0aE9mZnNldChkLCAoZGF0ZS5vZmZzZXQgPz8gMCkpO1xuICAgICAgICAgICAgZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKFwiVW5yZWNvZ25pemVkIERhdGUgcHJpbnQgZm9ybWF0XCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gZGF0ZVRvU3RyaW5nV2l0aEN1c3RvbUZvcm1hdChkLCBmb3JtYXQsIHRydWUpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGRhdGVUb1N0cmluZ1dpdGhLaW5kKGRhdGUsIGZvcm1hdCkge1xuICAgIGNvbnN0IHV0YyA9IGRhdGUua2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi87XG4gICAgaWYgKHR5cGVvZiBmb3JtYXQgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgcmV0dXJuIHV0YyA/IGRhdGUudG9VVENTdHJpbmcoKSA6IGRhdGUudG9Mb2NhbGVTdHJpbmcoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoZm9ybWF0Lmxlbmd0aCA9PT0gMSkge1xuICAgICAgICBzd2l0Y2ggKGZvcm1hdCkge1xuICAgICAgICAgICAgY2FzZSBcIkRcIjpcbiAgICAgICAgICAgIGNhc2UgXCJkXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHV0YyA/IGRhdGVUb0hhbGZVVENTdHJpbmcoZGF0ZSwgXCJmaXJzdFwiKSA6IGRhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKCk7XG4gICAgICAgICAgICBjYXNlIFwiVFwiOlxuICAgICAgICAgICAgY2FzZSBcInRcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gdXRjID8gZGF0ZVRvSGFsZlVUQ1N0cmluZyhkYXRlLCBcInNlY29uZFwiKSA6IGRhdGUudG9Mb2NhbGVUaW1lU3RyaW5nKCk7XG4gICAgICAgICAgICBjYXNlIFwiT1wiOlxuICAgICAgICAgICAgY2FzZSBcIm9cIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZVRvSVNPU3RyaW5nKGRhdGUsIHV0Yyk7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVucmVjb2duaXplZCBEYXRlIHByaW50IGZvcm1hdFwiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGRhdGVUb1N0cmluZ1dpdGhDdXN0b21Gb3JtYXQoZGF0ZSwgZm9ybWF0LCB1dGMpO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiB0b1N0cmluZyhkYXRlLCBmb3JtYXQsIF9wcm92aWRlcikge1xuICAgIHJldHVybiBkYXRlLm9mZnNldCAhPSBudWxsXG4gICAgICAgID8gZGF0ZVRvU3RyaW5nV2l0aE9mZnNldChkYXRlLCBmb3JtYXQpXG4gICAgICAgIDogZGF0ZVRvU3RyaW5nV2l0aEtpbmQoZGF0ZSwgZm9ybWF0KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBEYXRlVGltZSh2YWx1ZSwga2luZCkge1xuICAgIGNvbnN0IGQgPSBuZXcgRGF0ZSh2YWx1ZSk7XG4gICAgZC5raW5kID0gKGtpbmQgPT0gbnVsbCA/IDAgLyogRGF0ZUtpbmQuVW5zcGVjaWZpZWQgKi8gOiBraW5kKSB8IDA7XG4gICAgcmV0dXJuIGQ7XG59XG5leHBvcnQgZnVuY3Rpb24gZnJvbVRpY2tzKHRpY2tzLCBraW5kKSB7XG4gICAga2luZCA9IGtpbmQgIT0gbnVsbCA/IGtpbmQgOiAyIC8qIERhdGVLaW5kLkxvY2FsICovOyAvLyBiZXR0ZXIgZGVmYXVsdCB0aGFuIFVuc3BlY2lmaWVkXG4gICAgbGV0IGRhdGUgPSBEYXRlVGltZSh0aWNrc1RvVW5peEVwb2NoTWlsbGlzZWNvbmRzKHRpY2tzKSwga2luZCk7XG4gICAgLy8gVGlja3MgYXJlIGxvY2FsIHRvIG9mZnNldCAoaW4gdGhpcyBjYXNlLCBlaXRoZXIgVVRDIG9yIExvY2FsL1Vua25vd24pLlxuICAgIC8vIElmIGtpbmQgaXMgYW55dGhpbmcgYnV0IFVUQywgdGhhdCBtZWFucyB0aGF0IHRoZSB0aWNrIG51bWJlciB3YXMgbm90XG4gICAgLy8gaW4gdXRjLCB0aHVzIGdldFRpbWUoKSBjYW5ub3QgcmV0dXJuIFVUQywgYW5kIG5lZWRzIHRvIGJlIHNoaWZ0ZWQuXG4gICAgaWYgKGtpbmQgIT09IDEgLyogRGF0ZUtpbmQuVVRDICovKSB7XG4gICAgICAgIGRhdGUgPSBEYXRlVGltZShkYXRlLmdldFRpbWUoKSAtIGRhdGVPZmZzZXQoZGF0ZSksIGtpbmQpO1xuICAgIH1cbiAgICByZXR1cm4gZGF0ZTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBmcm9tRGF0ZVRpbWVPZmZzZXQoZGF0ZSwga2luZCkge1xuICAgIHN3aXRjaCAoa2luZCkge1xuICAgICAgICBjYXNlIDEgLyogRGF0ZUtpbmQuVVRDICovOiByZXR1cm4gRGF0ZVRpbWUoZGF0ZS5nZXRUaW1lKCksIDEgLyogRGF0ZUtpbmQuVVRDICovKTtcbiAgICAgICAgY2FzZSAyIC8qIERhdGVLaW5kLkxvY2FsICovOiByZXR1cm4gRGF0ZVRpbWUoZGF0ZS5nZXRUaW1lKCksIDIgLyogRGF0ZUtpbmQuTG9jYWwgKi8pO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgY29uc3QgZCA9IERhdGVUaW1lKGRhdGUuZ2V0VGltZSgpICsgKGRhdGUub2Zmc2V0ID8/IDApLCBraW5kKTtcbiAgICAgICAgICAgIHJldHVybiBEYXRlVGltZShkLmdldFRpbWUoKSAtIGRhdGVPZmZzZXQoZCksIGtpbmQpO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBnZXRUaWNrcyhkYXRlKSB7XG4gICAgcmV0dXJuIHVuaXhFcG9jaE1pbGxpc2Vjb25kc1RvVGlja3MoZGF0ZS5nZXRUaW1lKCksIGRhdGVPZmZzZXQoZGF0ZSkpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIG1pblZhbHVlKCkge1xuICAgIC8vIFRoaXMgaXMgXCIwMDAxLTAxLTAxVDAwOjAwOjAwLjAwMFpcIiwgYWN0dWFsIEpTIG1pbiB2YWx1ZSBpcyAtODY0MDAwMDAwMDAwMDAwMFxuICAgIHJldHVybiBEYXRlVGltZSgtNjIxMzU1OTY4MDAwMDAsIDAgLyogRGF0ZUtpbmQuVW5zcGVjaWZpZWQgKi8pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIG1heFZhbHVlKCkge1xuICAgIC8vIFRoaXMgaXMgXCI5OTk5LTEyLTMxVDIzOjU5OjU5Ljk5OVpcIiwgYWN0dWFsIEpTIG1heCB2YWx1ZSBpcyA4NjQwMDAwMDAwMDAwMDAwXG4gICAgcmV0dXJuIERhdGVUaW1lKDI1MzQwMjMwMDc5OTk5OSwgMCAvKiBEYXRlS2luZC5VbnNwZWNpZmllZCAqLyk7XG59XG5leHBvcnQgZnVuY3Rpb24gcGFyc2VSYXcoaW5wdXQpIHtcbiAgICBmdW5jdGlvbiBmYWlsKCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBzdHJpbmcgaXMgbm90IGEgdmFsaWQgRGF0ZTogJHtpbnB1dH1gKTtcbiAgICB9XG4gICAgaWYgKGlucHV0ID09IG51bGwgfHwgaW5wdXQudHJpbSgpID09PSBcIlwiKSB7XG4gICAgICAgIGZhaWwoKTtcbiAgICB9XG4gICAgLy8gSVNPIGRhdGVzIHdpdGhvdXQgVFogYXJlIHBhcnNlZCBhcyBVVEMuIEFkZGluZyB0aW1lIHdpdGhvdXQgVFoga2VlcHMgdGhlbSBsb2NhbC5cbiAgICBpZiAoaW5wdXQubGVuZ3RoID09PSAxMCAmJiBpbnB1dFs0XSA9PT0gXCItXCIgJiYgaW5wdXRbN10gPT09IFwiLVwiKSB7XG4gICAgICAgIGlucHV0ICs9IFwiVDAwOjAwOjAwXCI7XG4gICAgfVxuICAgIGxldCBkYXRlID0gbmV3IERhdGUoaW5wdXQpO1xuICAgIGxldCBvZmZzZXQgPSBudWxsO1xuICAgIGlmIChpc05hTihkYXRlLmdldFRpbWUoKSkpIHtcbiAgICAgICAgLy8gVHJ5IHRvIGNoZWNrIHN0cmluZ3MgSlMgRGF0ZSBjYW5ub3QgcGFyc2UgKHNlZSAjMTA0NSwgIzE0MjIpXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtbGluZS1sZW5ndGhcbiAgICAgICAgY29uc3QgbSA9IC9eXFxzKihcXGQrW15cXHdcXHM6XVxcZCtbXlxcd1xcczpdXFxkKyk/XFxzKihcXGQrOlxcZCsoPzo6XFxkKyg/OlxcLlxcZCspPyk/KT9cXHMqKFtBYVBwXVtNbV0pP1xccyooWnxbKy1dKFswMV0/XFxkKTo/KFswLTVdP1xcZCk/KT9cXHMqJC8uZXhlYyhpbnB1dCk7XG4gICAgICAgIGlmIChtICE9IG51bGwpIHtcbiAgICAgICAgICAgIGxldCBiYXNlRGF0ZTtcbiAgICAgICAgICAgIGxldCB0aW1lSW5TZWNvbmRzID0gMDtcbiAgICAgICAgICAgIGlmIChtWzJdICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0aW1lUGFydHMgPSBtWzJdLnNwbGl0KFwiOlwiKTtcbiAgICAgICAgICAgICAgICBjb25zdCBob3VyUGFydCA9IHBhcnNlSW50KHRpbWVQYXJ0c1swXSwgMTApO1xuICAgICAgICAgICAgICAgIHRpbWVJblNlY29uZHMgPVxuICAgICAgICAgICAgICAgICAgICBob3VyUGFydCAqIDM2MDAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VJbnQodGltZVBhcnRzWzFdIHx8IFwiMFwiLCAxMCkgKiA2MCArXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUZsb2F0KHRpbWVQYXJ0c1syXSB8fCBcIjBcIik7XG4gICAgICAgICAgICAgICAgaWYgKG1bM10gIT0gbnVsbCAmJiBtWzNdLnRvVXBwZXJDYXNlKCkgPT09IFwiUE1cIiAmJiBob3VyUGFydCA8IDEyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRpbWVJblNlY29uZHMgKz0gNzIwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChtWzRdICE9IG51bGwpIHsgLy8gVGhlcmUncyBhbiBvZmZzZXQsIHBhcnNlIGFzIFVUQ1xuICAgICAgICAgICAgICAgIGlmIChtWzFdICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgYmFzZURhdGUgPSBuZXcgRGF0ZShtWzFdICsgXCIgVVRDXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZCA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIGJhc2VEYXRlID0gbmV3IERhdGUoZC5nZXRVVENGdWxsWWVhcigpICsgXCIvXCIgKyAoZC5nZXRVVENNb250aCgpICsgMSkgKyBcIi9cIiArIGQuZ2V0VVRDRGF0ZSgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG1bNF0gPT09IFwiWlwiKSB7XG4gICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IFwiWlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IG9mZnNldEluTWludXRlcyA9IHBhcnNlSW50KG1bNV0sIDEwKSAqIDYwICsgcGFyc2VJbnQobVs2XSB8fCBcIjBcIiwgMTApO1xuICAgICAgICAgICAgICAgICAgICBpZiAobVs0XVswXSA9PT0gXCItXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldEluTWludXRlcyAqPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSBvZmZzZXRJbk1pbnV0ZXM7XG4gICAgICAgICAgICAgICAgICAgIHRpbWVJblNlY29uZHMgLT0gb2Zmc2V0SW5NaW51dGVzICogNjA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKG1bMV0gIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBiYXNlRGF0ZSA9IG5ldyBEYXRlKG1bMV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZCA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIGJhc2VEYXRlID0gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpICsgXCIvXCIgKyAoZC5nZXRNb250aCgpICsgMSkgKyBcIi9cIiArIGQuZ2V0RGF0ZSgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkYXRlID0gbmV3IERhdGUoYmFzZURhdGUuZ2V0VGltZSgpICsgdGltZUluU2Vjb25kcyAqIDEwMDApO1xuICAgICAgICAgICAgLy8gY29ycmVjdCBmb3IgZGF5bGlnaHQgc2F2aW5ncyB0aW1lXG4gICAgICAgICAgICBkYXRlID0gbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkgKyAoZGF0ZS5nZXRUaW1lem9uZU9mZnNldCgpIC0gYmFzZURhdGUuZ2V0VGltZXpvbmVPZmZzZXQoKSkgKiA2MDAwMCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBmYWlsKCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ2hlY2sgYWdhaW4gdGhlIGRhdGUgaXMgdmFsaWQgYWZ0ZXIgdHJhbnNmb3JtYXRpb25zLCBzZWUgIzIyMjlcbiAgICAgICAgaWYgKGlzTmFOKGRhdGUuZ2V0VGltZSgpKSkge1xuICAgICAgICAgICAgZmFpbCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBbZGF0ZSwgb2Zmc2V0XTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZShzdHIsIGRldGVjdFVUQyA9IGZhbHNlKSB7XG4gICAgY29uc3QgW2RhdGUsIG9mZnNldF0gPSBwYXJzZVJhdyhzdHIpO1xuICAgIC8vIC5ORVQgYWx3YXlzIHBhcnNlcyBEYXRlVGltZSBhcyBMb2NhbCBpZiB0aGVyZSdzIG9mZnNldCBpbmZvIChldmVuIFwiWlwiKVxuICAgIC8vIE5ld3RvbnNvZnQuSnNvbiB1c2VzIFVUQyBpZiB0aGUgb2Zmc2V0IGlzIFwiWlwiXG4gICAgY29uc3Qga2luZCA9IG9mZnNldCAhPSBudWxsXG4gICAgICAgID8gKGRldGVjdFVUQyAmJiBvZmZzZXQgPT09IFwiWlwiID8gMSAvKiBEYXRlS2luZC5VVEMgKi8gOiAyIC8qIERhdGVLaW5kLkxvY2FsICovKVxuICAgICAgICA6IDAgLyogRGF0ZUtpbmQuVW5zcGVjaWZpZWQgKi87XG4gICAgcmV0dXJuIERhdGVUaW1lKGRhdGUuZ2V0VGltZSgpLCBraW5kKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0cnlQYXJzZSh2LCBkZWZWYWx1ZSkge1xuICAgIHRyeSB7XG4gICAgICAgIGRlZlZhbHVlLmNvbnRlbnRzID0gcGFyc2Uodik7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBjYXRjaCAoX2Vycikge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZSh5ZWFyLCBtb250aCwgZGF5LCBoID0gMCwgbSA9IDAsIHMgPSAwLCBtcyA9IDAsIGtpbmQpIHtcbiAgICBjb25zdCBkYXRlID0ga2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi9cbiAgICAgICAgPyBuZXcgRGF0ZShEYXRlLlVUQyh5ZWFyLCBtb250aCAtIDEsIGRheSwgaCwgbSwgcywgbXMpKVxuICAgICAgICA6IG5ldyBEYXRlKHllYXIsIG1vbnRoIC0gMSwgZGF5LCBoLCBtLCBzLCBtcyk7XG4gICAgaWYgKHllYXIgPD0gOTkpIHtcbiAgICAgICAgaWYgKGtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovKSB7XG4gICAgICAgICAgICBkYXRlLnNldFVUQ0Z1bGxZZWFyKHllYXIsIG1vbnRoIC0gMSwgZGF5KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGRhdGUuc2V0RnVsbFllYXIoeWVhciwgbW9udGggLSAxLCBkYXkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGRhdGVWYWx1ZSA9IGRhdGUuZ2V0VGltZSgpO1xuICAgIGlmIChpc05hTihkYXRlVmFsdWUpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoZSBwYXJhbWV0ZXJzIGRlc2NyaWJlIGFuIHVucmVwcmVzZW50YWJsZSBEYXRlLlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIERhdGVUaW1lKGRhdGVWYWx1ZSwga2luZCk7XG59XG5leHBvcnQgZnVuY3Rpb24gbm93KCkge1xuICAgIHJldHVybiBEYXRlVGltZShEYXRlLm5vdygpLCAyIC8qIERhdGVLaW5kLkxvY2FsICovKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB1dGNOb3coKSB7XG4gICAgcmV0dXJuIERhdGVUaW1lKERhdGUubm93KCksIDEgLyogRGF0ZUtpbmQuVVRDICovKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b2RheSgpIHtcbiAgICByZXR1cm4gZGF0ZShub3coKSk7XG59XG5leHBvcnQgZnVuY3Rpb24gaXNMZWFwWWVhcih5ZWFyKSB7XG4gICAgcmV0dXJuIHllYXIgJSA0ID09PSAwICYmIHllYXIgJSAxMDAgIT09IDAgfHwgeWVhciAlIDQwMCA9PT0gMDtcbn1cbmV4cG9ydCBmdW5jdGlvbiBkYXlzSW5Nb250aCh5ZWFyLCBtb250aCkge1xuICAgIHJldHVybiBtb250aCA9PT0gMlxuICAgICAgICA/IChpc0xlYXBZZWFyKHllYXIpID8gMjkgOiAyOClcbiAgICAgICAgOiAobW9udGggPj0gOCA/IChtb250aCAlIDIgPT09IDAgPyAzMSA6IDMwKSA6IChtb250aCAlIDIgPT09IDAgPyAzMCA6IDMxKSk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9Vbml2ZXJzYWxUaW1lKGRhdGUpIHtcbiAgICByZXR1cm4gZGF0ZS5raW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqLyA/IGRhdGUgOiBEYXRlVGltZShkYXRlLmdldFRpbWUoKSwgMSAvKiBEYXRlS2luZC5VVEMgKi8pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvTG9jYWxUaW1lKGRhdGUpIHtcbiAgICByZXR1cm4gZGF0ZS5raW5kID09PSAyIC8qIERhdGVLaW5kLkxvY2FsICovID8gZGF0ZSA6IERhdGVUaW1lKGRhdGUuZ2V0VGltZSgpLCAyIC8qIERhdGVLaW5kLkxvY2FsICovKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBzcGVjaWZ5S2luZChkLCBraW5kKSB7XG4gICAgcmV0dXJuIGNyZWF0ZSh5ZWFyKGQpLCBtb250aChkKSwgZGF5KGQpLCBob3VyKGQpLCBtaW51dGUoZCksIHNlY29uZChkKSwgbWlsbGlzZWNvbmQoZCksIGtpbmQpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRpbWVPZkRheShkKSB7XG4gICAgcmV0dXJuIGhvdXIoZCkgKiAzNjAwMDAwXG4gICAgICAgICsgbWludXRlKGQpICogNjAwMDBcbiAgICAgICAgKyBzZWNvbmQoZCkgKiAxMDAwXG4gICAgICAgICsgbWlsbGlzZWNvbmQoZCk7XG59XG5leHBvcnQgZnVuY3Rpb24gZGF0ZShkKSB7XG4gICAgcmV0dXJuIGNyZWF0ZSh5ZWFyKGQpLCBtb250aChkKSwgZGF5KGQpLCAwLCAwLCAwLCAwLCBkLmtpbmQpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGRheShkKSB7XG4gICAgcmV0dXJuIGQua2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi8gPyBkLmdldFVUQ0RhdGUoKSA6IGQuZ2V0RGF0ZSgpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGhvdXIoZCkge1xuICAgIHJldHVybiBkLmtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovID8gZC5nZXRVVENIb3VycygpIDogZC5nZXRIb3VycygpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIG1pbGxpc2Vjb25kKGQpIHtcbiAgICByZXR1cm4gZC5raW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqLyA/IGQuZ2V0VVRDTWlsbGlzZWNvbmRzKCkgOiBkLmdldE1pbGxpc2Vjb25kcygpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIG1pbnV0ZShkKSB7XG4gICAgcmV0dXJuIGQua2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi8gPyBkLmdldFVUQ01pbnV0ZXMoKSA6IGQuZ2V0TWludXRlcygpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIG1vbnRoKGQpIHtcbiAgICByZXR1cm4gKGQua2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi8gPyBkLmdldFVUQ01vbnRoKCkgOiBkLmdldE1vbnRoKCkpICsgMTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBzZWNvbmQoZCkge1xuICAgIHJldHVybiBkLmtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovID8gZC5nZXRVVENTZWNvbmRzKCkgOiBkLmdldFNlY29uZHMoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB5ZWFyKGQpIHtcbiAgICByZXR1cm4gZC5raW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqLyA/IGQuZ2V0VVRDRnVsbFllYXIoKSA6IGQuZ2V0RnVsbFllYXIoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBkYXlPZldlZWsoZCkge1xuICAgIHJldHVybiBkLmtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovID8gZC5nZXRVVENEYXkoKSA6IGQuZ2V0RGF5KCk7XG59XG5leHBvcnQgZnVuY3Rpb24gZGF5T2ZZZWFyKGQpIHtcbiAgICBjb25zdCBfeWVhciA9IHllYXIoZCk7XG4gICAgY29uc3QgX21vbnRoID0gbW9udGgoZCk7XG4gICAgbGV0IF9kYXkgPSBkYXkoZCk7XG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPCBfbW9udGg7IGkrKykge1xuICAgICAgICBfZGF5ICs9IGRheXNJbk1vbnRoKF95ZWFyLCBpKTtcbiAgICB9XG4gICAgcmV0dXJuIF9kYXk7XG59XG5leHBvcnQgZnVuY3Rpb24gYWRkKGQsIHRzKSB7XG4gICAgY29uc3QgbmV3RGF0ZSA9IERhdGVUaW1lKGQuZ2V0VGltZSgpICsgdHMsIGQua2luZCk7XG4gICAgaWYgKGQua2luZCA9PT0gMiAvKiBEYXRlS2luZC5Mb2NhbCAqLykge1xuICAgICAgICBjb25zdCBvbGRUek9mZnNldCA9IGQuZ2V0VGltZXpvbmVPZmZzZXQoKTtcbiAgICAgICAgY29uc3QgbmV3VHpPZmZzZXQgPSBuZXdEYXRlLmdldFRpbWV6b25lT2Zmc2V0KCk7XG4gICAgICAgIHJldHVybiBvbGRUek9mZnNldCAhPT0gbmV3VHpPZmZzZXRcbiAgICAgICAgICAgID8gRGF0ZVRpbWUobmV3RGF0ZS5nZXRUaW1lKCkgKyAobmV3VHpPZmZzZXQgLSBvbGRUek9mZnNldCkgKiA2MDAwMCwgZC5raW5kKVxuICAgICAgICAgICAgOiBuZXdEYXRlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG5ld0RhdGU7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGFkZERheXMoZCwgdikge1xuICAgIHJldHVybiBhZGQoZCwgdiAqIDg2NDAwMDAwKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBhZGRIb3VycyhkLCB2KSB7XG4gICAgcmV0dXJuIGFkZChkLCB2ICogMzYwMDAwMCk7XG59XG5leHBvcnQgZnVuY3Rpb24gYWRkTWludXRlcyhkLCB2KSB7XG4gICAgcmV0dXJuIGFkZChkLCB2ICogNjAwMDApO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGFkZFNlY29uZHMoZCwgdikge1xuICAgIHJldHVybiBhZGQoZCwgdiAqIDEwMDApO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGFkZE1pbGxpc2Vjb25kcyhkLCB2KSB7XG4gICAgcmV0dXJuIGFkZChkLCB2KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBhZGRUaWNrcyhkLCB2KSB7XG4gICAgcmV0dXJuIGFkZChkLCB0b0Zsb2F0NjQodiAvIDEwMDAwbikpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGFkZFllYXJzKGQsIHYpIHtcbiAgICBjb25zdCBuZXdNb250aCA9IG1vbnRoKGQpO1xuICAgIGNvbnN0IG5ld1llYXIgPSB5ZWFyKGQpICsgdjtcbiAgICBjb25zdCBfZGF5c0luTW9udGggPSBkYXlzSW5Nb250aChuZXdZZWFyLCBuZXdNb250aCk7XG4gICAgY29uc3QgbmV3RGF5ID0gTWF0aC5taW4oX2RheXNJbk1vbnRoLCBkYXkoZCkpO1xuICAgIHJldHVybiBjcmVhdGUobmV3WWVhciwgbmV3TW9udGgsIG5ld0RheSwgaG91cihkKSwgbWludXRlKGQpLCBzZWNvbmQoZCksIG1pbGxpc2Vjb25kKGQpLCBkLmtpbmQpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGFkZE1vbnRocyhkLCB2KSB7XG4gICAgbGV0IG5ld01vbnRoID0gbW9udGgoZCkgKyB2O1xuICAgIGxldCBuZXdNb250aF8gPSAwO1xuICAgIGxldCB5ZWFyT2Zmc2V0ID0gMDtcbiAgICBpZiAobmV3TW9udGggPiAxMikge1xuICAgICAgICBuZXdNb250aF8gPSBuZXdNb250aCAlIDEyO1xuICAgICAgICB5ZWFyT2Zmc2V0ID0gTWF0aC5mbG9vcihuZXdNb250aCAvIDEyKTtcbiAgICAgICAgbmV3TW9udGggPSBuZXdNb250aF87XG4gICAgfVxuICAgIGVsc2UgaWYgKG5ld01vbnRoIDwgMSkge1xuICAgICAgICBuZXdNb250aF8gPSAxMiArIG5ld01vbnRoICUgMTI7XG4gICAgICAgIHllYXJPZmZzZXQgPSBNYXRoLmZsb29yKG5ld01vbnRoIC8gMTIpICsgKG5ld01vbnRoXyA9PT0gMTIgPyAtMSA6IDApO1xuICAgICAgICBuZXdNb250aCA9IG5ld01vbnRoXztcbiAgICB9XG4gICAgY29uc3QgbmV3WWVhciA9IHllYXIoZCkgKyB5ZWFyT2Zmc2V0O1xuICAgIGNvbnN0IF9kYXlzSW5Nb250aCA9IGRheXNJbk1vbnRoKG5ld1llYXIsIG5ld01vbnRoKTtcbiAgICBjb25zdCBuZXdEYXkgPSBNYXRoLm1pbihfZGF5c0luTW9udGgsIGRheShkKSk7XG4gICAgcmV0dXJuIGNyZWF0ZShuZXdZZWFyLCBuZXdNb250aCwgbmV3RGF5LCBob3VyKGQpLCBtaW51dGUoZCksIHNlY29uZChkKSwgbWlsbGlzZWNvbmQoZCksIGQua2luZCk7XG59XG5leHBvcnQgZnVuY3Rpb24gc3VidHJhY3QoZCwgdGhhdCkge1xuICAgIHJldHVybiB0eXBlb2YgdGhhdCA9PT0gXCJudW1iZXJcIlxuICAgICAgICA/IGFkZChkLCAtdGhhdClcbiAgICAgICAgOiBkLmdldFRpbWUoKSAtIHRoYXQuZ2V0VGltZSgpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvTG9uZ0RhdGVTdHJpbmcoZCkge1xuICAgIHJldHVybiBkLnRvRGF0ZVN0cmluZygpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvU2hvcnREYXRlU3RyaW5nKGQpIHtcbiAgICByZXR1cm4gZC50b0xvY2FsZURhdGVTdHJpbmcoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b0xvbmdUaW1lU3RyaW5nKGQpIHtcbiAgICByZXR1cm4gZC50b0xvY2FsZVRpbWVTdHJpbmcoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b1Nob3J0VGltZVN0cmluZyhkKSB7XG4gICAgcmV0dXJuIGQudG9Mb2NhbGVUaW1lU3RyaW5nKCkucmVwbGFjZSgvOlxcZFxcZCg/ITopLywgXCJcIik7XG59XG5leHBvcnQgZnVuY3Rpb24gZXF1YWxzKGQxLCBkMikge1xuICAgIHJldHVybiBkMS5nZXRUaW1lKCkgPT09IGQyLmdldFRpbWUoKTtcbn1cbmV4cG9ydCBjb25zdCBjb21wYXJlID0gY29tcGFyZURhdGVzO1xuZXhwb3J0IGNvbnN0IGNvbXBhcmVUbyA9IGNvbXBhcmVEYXRlcztcbmV4cG9ydCBmdW5jdGlvbiBvcF9BZGRpdGlvbih4LCB5KSB7XG4gICAgcmV0dXJuIGFkZCh4LCB5KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBvcF9TdWJ0cmFjdGlvbih4LCB5KSB7XG4gICAgcmV0dXJuIHN1YnRyYWN0KHgsIHkpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGlzRGF5bGlnaHRTYXZpbmdUaW1lKHgpIHtcbiAgICBjb25zdCBqYW4gPSBuZXcgRGF0ZSh4LmdldEZ1bGxZZWFyKCksIDAsIDEpO1xuICAgIGNvbnN0IGp1bCA9IG5ldyBEYXRlKHguZ2V0RnVsbFllYXIoKSwgNiwgMSk7XG4gICAgcmV0dXJuIGlzRFNUKGphbi5nZXRUaW1lem9uZU9mZnNldCgpLCBqdWwuZ2V0VGltZXpvbmVPZmZzZXQoKSwgeC5nZXRUaW1lem9uZU9mZnNldCgpKTtcbn1cbmZ1bmN0aW9uIGlzRFNUKGphbk9mZnNldCwganVsT2Zmc2V0LCB0T2Zmc2V0KSB7XG4gICAgcmV0dXJuIE1hdGgubWluKGphbk9mZnNldCwganVsT2Zmc2V0KSA9PT0gdE9mZnNldDtcbn1cbmV4cG9ydCBkZWZhdWx0IERhdGVUaW1lO1xuIiwKICAiLyoqXG4gKiBEYXRlVGltZU9mZnNldCBmdW5jdGlvbnMuXG4gKlxuICogTm90ZTogRGF0ZSBpbnN0YW5jZXMgYXJlIGFsd2F5cyBEYXRlT2JqZWN0cyBpbiBsb2NhbFxuICogdGltZXpvbmUgKGJlY2F1c2UgSlMgZGF0ZXMgYXJlIGFsbCBraW5kcyBvZiBtZXNzZWQgdXApLlxuICogQSBsb2NhbCBkYXRlIHJldHVybnMgVVRDIGVwb2NoIHdoZW4gYC5nZXRUaW1lKClgIGlzIGNhbGxlZC5cbiAqXG4gKiBCYXNpY2FsbHk7IGludmFyaWFudDogZGF0ZS5nZXRUaW1lKCkgYWx3YXlzIHJldHVybiBVVEMgdGltZS5cbiAqL1xuaW1wb3J0IHsgdG9JbnQ2NCwgdG9GbG9hdDY0IH0gZnJvbSBcIi4vQmlnSW50LmpzXCI7XG5pbXBvcnQgeyBjb21wYXJlRGF0ZXMsIGRhdGVPZmZzZXQsIHBhZFdpdGhaZXJvcyB9IGZyb20gXCIuL1V0aWwuanNcIjtcbmNvbnN0IHNob3J0RGF5cyA9IFtcbiAgICBcIlN1blwiLCBcIk1vblwiLCBcIlR1ZVwiLCBcIldlZFwiLCBcIlRodVwiLCBcIkZyaVwiLCBcIlNhdFwiXG5dO1xuY29uc3QgbG9uZ0RheXMgPSBbXG4gICAgXCJTdW5kYXlcIiwgXCJNb25kYXlcIiwgXCJUdWVzZGF5XCIsIFwiV2VkbmVzZGF5XCIsIFwiVGh1cnNkYXlcIiwgXCJGcmlkYXlcIiwgXCJTYXR1cmRheVwiXG5dO1xuY29uc3Qgc2hvcnRNb250aHMgPSBbXG4gICAgXCJKYW5cIiwgXCJGZWJcIiwgXCJNYXJcIiwgXCJBcHJcIiwgXCJNYXlcIiwgXCJKdW5cIiwgXCJKdWxcIiwgXCJBdWdcIiwgXCJTZXBcIiwgXCJPY3RcIiwgXCJOb3ZcIiwgXCJEZWNcIlxuXTtcbmNvbnN0IGxvbmdNb250aHMgPSBbXG4gICAgXCJKYW51YXJ5XCIsIFwiRmVicnVhcnlcIiwgXCJNYXJjaFwiLCBcIkFwcmlsXCIsIFwiTWF5XCIsIFwiSnVuZVwiLCBcIkp1bHlcIiwgXCJBdWd1c3RcIiwgXCJTZXB0ZW1iZXJcIiwgXCJPY3RvYmVyXCIsIFwiTm92ZW1iZXJcIiwgXCJEZWNlbWJlclwiXG5dO1xuZnVuY3Rpb24gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIHBvcywgcGF0dGVybkNoYXIpIHtcbiAgICBsZXQgdG9rZW5MZW5ndGggPSAwO1xuICAgIGxldCBpbnRlcm5hbFBvcyA9IHBvcztcbiAgICB3aGlsZSAoaW50ZXJuYWxQb3MgPCBmb3JtYXQubGVuZ3RoICYmIGZvcm1hdFtpbnRlcm5hbFBvc10gPT09IHBhdHRlcm5DaGFyKSB7XG4gICAgICAgIGludGVybmFsUG9zKys7XG4gICAgICAgIHRva2VuTGVuZ3RoKys7XG4gICAgfVxuICAgIHJldHVybiB0b2tlbkxlbmd0aDtcbn1cbmZ1bmN0aW9uIHBhcnNlTmV4dENoYXIoZm9ybWF0LCBwb3MpIHtcbiAgICBpZiAocG9zID49IGZvcm1hdC5sZW5ndGggLSAxKSB7XG4gICAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gICAgcmV0dXJuIGZvcm1hdC5jaGFyQ29kZUF0KHBvcyArIDEpO1xufVxuZnVuY3Rpb24gcGFyc2VRdW90ZWRTdHJpbmcoZm9ybWF0LCBwb3MpIHtcbiAgICBsZXQgYmVnaW5Qb3MgPSBwb3M7XG4gICAgLy8gR2V0IHRoZSBjaGFyYWN0ZXIgdXNlZCB0byBxdW90ZSB0aGUgc3RyaW5nXG4gICAgY29uc3QgcXVvdGVDaGFyID0gZm9ybWF0W3Bvc107XG4gICAgbGV0IHJlc3VsdCA9IFwiXCI7XG4gICAgbGV0IGZvdW5kUXVvdGUgPSBmYWxzZTtcbiAgICB3aGlsZSAocG9zIDwgZm9ybWF0Lmxlbmd0aCkge1xuICAgICAgICBwb3MrKztcbiAgICAgICAgY29uc3QgY3VycmVudENoYXIgPSBmb3JtYXRbcG9zXTtcbiAgICAgICAgaWYgKGN1cnJlbnRDaGFyID09PSBxdW90ZUNoYXIpIHtcbiAgICAgICAgICAgIGZvdW5kUXVvdGUgPSB0cnVlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY3VycmVudENoYXIgPT09IFwiXFxcXFwiKSB7XG4gICAgICAgICAgICBpZiAocG9zIDwgZm9ybWF0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHBvcysrO1xuICAgICAgICAgICAgICAgIHJlc3VsdCArPSBmb3JtYXRbcG9zXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFRoaXMgbWVhbnMgdGhhdCAnXFwnIGlzIHRoZSBsYXN0IGNoYXJhY3RlciBpbiB0aGUgc3RyaW5nLlxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgc3RyaW5nIGZvcm1hdFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJlc3VsdCArPSBjdXJyZW50Q2hhcjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoIWZvdW5kUXVvdGUpIHtcbiAgICAgICAgLy8gV2UgY291bGQgbm90IGZpbmQgdGhlIG1hdGNoaW5nIHF1b3RlXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBzdHJpbmcgZm9ybWF0IGNvdWxkIG5vdCBmaW5kIG1hdGNoaW5nIHF1b3RlIGZvciAke3F1b3RlQ2hhcn1gKTtcbiAgICB9XG4gICAgcmV0dXJuIFtyZXN1bHQsIHBvcyAtIGJlZ2luUG9zICsgMV07XG59XG5mdW5jdGlvbiBkYXRlVG9TdHJpbmdXaXRoQ3VzdG9tRm9ybWF0KGRhdGUsIGZvcm1hdCwgdXRjKSB7XG4gICAgbGV0IGN1cnNvclBvcyA9IDA7XG4gICAgbGV0IHRva2VuTGVuZ3RoID0gMDtcbiAgICBsZXQgcmVzdWx0ID0gXCJcIjtcbiAgICBjb25zdCBsb2NhbGl6ZWREYXRlID0gdXRjID8gRGF0ZVRpbWUoZGF0ZS5nZXRUaW1lKCksIDEgLyogRGF0ZUtpbmQuVVRDICovKSA6IGRhdGU7XG4gICAgd2hpbGUgKGN1cnNvclBvcyA8IGZvcm1hdC5sZW5ndGgpIHtcbiAgICAgICAgY29uc3QgdG9rZW4gPSBmb3JtYXRbY3Vyc29yUG9zXTtcbiAgICAgICAgc3dpdGNoICh0b2tlbikge1xuICAgICAgICAgICAgY2FzZSBcImRcIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwiZFwiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0b2tlbkxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gbG9jYWxpemVkRGF0ZS5nZXREYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyhsb2NhbGl6ZWREYXRlLmdldERhdGUoKSwgMik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHNob3J0RGF5c1tkYXlPZldlZWsobG9jYWxpemVkRGF0ZSldO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBsb25nRGF5c1tkYXlPZldlZWsobG9jYWxpemVkRGF0ZSldO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZlwiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJmXCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBpZiAodG9rZW5MZW5ndGggPD0gMykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcmVjaXNpb24gPSAxMCAqKiAoMyAtIHRva2VuTGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyhNYXRoLmZsb29yKG1pbGxpc2Vjb25kKGxvY2FsaXplZERhdGUpIC8gcHJlY2lzaW9uKSwgdG9rZW5MZW5ndGgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0b2tlbkxlbmd0aCA8PSA3KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEphdmFTY3JpcHQgRGF0ZSBvbmx5IHN1cHBvcnQgcHJlY2lzaW9uIHRvIHRoZSBtaWxsaXNlY29uZFxuICAgICAgICAgICAgICAgICAgICAvLyBzbyB3ZSBmaWxsIHRoZSByZXN0IG9mIHRoZSBwcmVjaXNpb24gd2l0aCAwIGFzIGlmIHRoZSBkYXRlIGRpZG4ndCBoYXZlXG4gICAgICAgICAgICAgICAgICAgIC8vIG1pbGxpc2Vjb25kcyBwcm92aWRlZCB0byBpdC5cbiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyB0byBoYXZlIHRoZSBzYW1lIGJlaGF2aW9yIGFzIC5ORVQgd2hlbiBkb2luZzpcbiAgICAgICAgICAgICAgICAgICAgLy8gRGF0ZVRpbWUoMSwgMiwgMywgNCwgNSwgNiwgRGF0ZVRpbWVLaW5kLlV0YykuVG9TdHJpbmcoXCJmZmZmZlwiKSA9PiAwMDAwMFxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gKFwiXCIgKyBtaWxsaXNlY29uZChsb2NhbGl6ZWREYXRlKSkucGFkRW5kKHRva2VuTGVuZ3RoLCBcIjBcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIkZcIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwiRlwiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgaWYgKHRva2VuTGVuZ3RoIDw9IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJlY2lzaW9uID0gMTAgKiogKDMgLSB0b2tlbkxlbmd0aCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gTWF0aC5mbG9vcihtaWxsaXNlY29uZChsb2NhbGl6ZWREYXRlKSAvIHByZWNpc2lvbik7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKHZhbHVlLCB0b2tlbkxlbmd0aCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodG9rZW5MZW5ndGggPD0gNykge1xuICAgICAgICAgICAgICAgICAgICAvLyBKYXZhU2NyaXB0IERhdGUgb25seSBzdXBwb3J0IHByZWNpc2lvbiB0byB0aGUgbWlsbGlzZWNvbmRcbiAgICAgICAgICAgICAgICAgICAgLy8gc28gd2UgY2FuJ3QgZ28gYmV5b25kIHRoYXQuXG4gICAgICAgICAgICAgICAgICAgIC8vIFdlIGFsc28gbmVlZCB0byBwYWQgc3RhcnQgd2l0aCAwIGlmIHRoZSB2YWx1ZSBpcyBub3QgMFxuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IG1pbGxpc2Vjb25kKGxvY2FsaXplZERhdGUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyh2YWx1ZSwgMyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZ1wiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJnXCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBpZiAodG9rZW5MZW5ndGggPD0gMikge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gXCJBLkQuXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImhcIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwiaFwiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0b2tlbkxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gaG91cihsb2NhbGl6ZWREYXRlKSAlIDEyO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3MoaG91cihsb2NhbGl6ZWREYXRlKSAlIDEyLCAyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIkhcIjpcbiAgICAgICAgICAgICAgICB0b2tlbkxlbmd0aCA9IHBhcnNlUmVwZWF0VG9rZW4oZm9ybWF0LCBjdXJzb3JQb3MsIFwiSFwiKTtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gdG9rZW5MZW5ndGg7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0b2tlbkxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gaG91cihsb2NhbGl6ZWREYXRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKGhvdXIobG9jYWxpemVkRGF0ZSksIDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiS1wiOlxuICAgICAgICAgICAgICAgIHRva2VuTGVuZ3RoID0gcGFyc2VSZXBlYXRUb2tlbihmb3JtYXQsIGN1cnNvclBvcywgXCJLXCIpO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcyArPSB0b2tlbkxlbmd0aDtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRva2VuTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoa2luZChsb2NhbGl6ZWREYXRlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMSAvKiBEYXRlS2luZC5VVEMgKi86XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBcIlpcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyIC8qIERhdGVLaW5kLkxvY2FsICovOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gZGF0ZU9mZnNldFRvU3RyaW5nKGxvY2FsaXplZERhdGUuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIC02MDAwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMCAvKiBEYXRlS2luZC5VbnNwZWNpZmllZCAqLzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJtXCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcIm1cIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodG9rZW5MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IG1pbnV0ZShsb2NhbGl6ZWREYXRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKG1pbnV0ZShsb2NhbGl6ZWREYXRlKSwgMik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJNXCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcIk1cIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodG9rZW5MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IG1vbnRoKGxvY2FsaXplZERhdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3MobW9udGgobG9jYWxpemVkRGF0ZSksIDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBzaG9ydE1vbnRoc1ttb250aChsb2NhbGl6ZWREYXRlKSAtIDFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBsb25nTW9udGhzW21vbnRoKGxvY2FsaXplZERhdGUpIC0gMV07XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJzXCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcInNcIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodG9rZW5MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHNlY29uZChsb2NhbGl6ZWREYXRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKHNlY29uZChsb2NhbGl6ZWREYXRlKSwgMik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJ0XCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcInRcIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodG9rZW5MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGxvY2FsaXplZERhdGUuZ2V0SG91cnMoKSA8IDEyID8gXCJBXCIgOiBcIlBcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gbG9jYWxpemVkRGF0ZS5nZXRIb3VycygpIDwgMTIgPyBcIkFNXCIgOiBcIlBNXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJ5XCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcInlcIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodG9rZW5MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGxvY2FsaXplZERhdGUuZ2V0RnVsbFllYXIoKSAlIDEwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKGxvY2FsaXplZERhdGUuZ2V0RnVsbFllYXIoKSAlIDEwMCwgMik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHBhZFdpdGhaZXJvcyhsb2NhbGl6ZWREYXRlLmdldEZ1bGxZZWFyKCksIDMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYWRXaXRoWmVyb3MobG9jYWxpemVkRGF0ZS5nZXRGdWxsWWVhcigpLCA0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gcGFkV2l0aFplcm9zKGxvY2FsaXplZERhdGUuZ2V0RnVsbFllYXIoKSwgNSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJ6XCI6XG4gICAgICAgICAgICAgICAgdG9rZW5MZW5ndGggPSBwYXJzZVJlcGVhdFRva2VuKGZvcm1hdCwgY3Vyc29yUG9zLCBcInpcIik7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHRva2VuTGVuZ3RoO1xuICAgICAgICAgICAgICAgIGxldCB1dGNPZmZzZXRUZXh0ID0gXCJcIjtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGtpbmQobG9jYWxpemVkRGF0ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxIC8qIERhdGVLaW5kLlVUQyAqLzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHV0Y09mZnNldFRleHQgPSBcIiswMDowMFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMiAvKiBEYXRlS2luZC5Mb2NhbCAqLzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHV0Y09mZnNldFRleHQgPSBkYXRlT2Zmc2V0VG9TdHJpbmcobG9jYWxpemVkRGF0ZS5nZXRUaW1lem9uZU9mZnNldCgpICogLTYwMDAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDAgLyogRGF0ZUtpbmQuVW5zcGVjaWZpZWQgKi86XG4gICAgICAgICAgICAgICAgICAgICAgICB1dGNPZmZzZXRUZXh0ID0gZGF0ZU9mZnNldFRvU3RyaW5nKHRvTG9jYWxUaW1lKGxvY2FsaXplZERhdGUpLmdldFRpbWV6b25lT2Zmc2V0KCkgKiAtNjAwMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHNpZ24gPSB1dGNPZmZzZXRUZXh0WzBdID09PSBcIi1cIiA/IFwiLVwiIDogXCIrXCI7XG4gICAgICAgICAgICAgICAgY29uc3QgaG91cnMgPSBwYXJzZUludCh1dGNPZmZzZXRUZXh0LnN1YnN0cmluZygxLCAzKSwgMTApO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1pbnV0ZXMgPSBwYXJzZUludCh1dGNPZmZzZXRUZXh0LnN1YnN0cmluZyg0LCA2KSwgMTApO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodG9rZW5MZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGAke3NpZ259JHtob3Vyc31gO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBgJHtzaWdufSR7cGFkV2l0aFplcm9zKGhvdXJzLCAyKX1gO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gYCR7c2lnbn0ke3BhZFdpdGhaZXJvcyhob3VycywgMil9OiR7cGFkV2l0aFplcm9zKG1pbnV0ZXMsIDIpfWA7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiOlwiOlxuICAgICAgICAgICAgICAgIHJlc3VsdCArPSBcIjpcIjtcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MrKztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCIvXCI6XG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IFwiL1wiO1xuICAgICAgICAgICAgICAgIGN1cnNvclBvcysrO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIidcIjpcbiAgICAgICAgICAgIGNhc2UgJ1wiJzpcbiAgICAgICAgICAgICAgICBjb25zdCBbcXVvdGVkU3RyaW5nLCBxdW90ZWRTdHJpbmdMZW5naHRdID0gcGFyc2VRdW90ZWRTdHJpbmcoZm9ybWF0LCBjdXJzb3JQb3MpO1xuICAgICAgICAgICAgICAgIHJlc3VsdCArPSBxdW90ZWRTdHJpbmc7XG4gICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IHF1b3RlZFN0cmluZ0xlbmdodDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCIlXCI6XG4gICAgICAgICAgICAgICAgY29uc3QgbmV4dENoYXIgPSBwYXJzZU5leHRDaGFyKGZvcm1hdCwgY3Vyc29yUG9zKTtcbiAgICAgICAgICAgICAgICBpZiAobmV4dENoYXIgPj0gMCAmJiBuZXh0Q2hhciAhPT0gXCIlXCIuY2hhckNvZGVBdCgwKSkge1xuICAgICAgICAgICAgICAgICAgICBjdXJzb3JQb3MgKz0gMjtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGRhdGVUb1N0cmluZ1dpdGhDdXN0b21Gb3JtYXQobG9jYWxpemVkRGF0ZSwgU3RyaW5nLmZyb21DaGFyQ29kZShuZXh0Q2hhciksIHV0Yyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGZvcm1hdCBzdHJpbmdcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIlxcXFxcIjpcbiAgICAgICAgICAgICAgICBjb25zdCBuZXh0Q2hhcjIgPSBwYXJzZU5leHRDaGFyKGZvcm1hdCwgY3Vyc29yUG9zKTtcbiAgICAgICAgICAgICAgICBpZiAobmV4dENoYXIyID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY3Vyc29yUG9zICs9IDI7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKG5leHRDaGFyMik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGZvcm1hdCBzdHJpbmdcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBjdXJzb3JQb3MrKztcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gdG9rZW47XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cbmV4cG9ydCBmdW5jdGlvbiBraW5kKHZhbHVlKSB7XG4gICAgcmV0dXJuIHZhbHVlLmtpbmQgfHwgMDtcbn1cbmV4cG9ydCBmdW5jdGlvbiB1bml4RXBvY2hNaWxsaXNlY29uZHNUb1RpY2tzKG1zLCBvZmZzZXQpIHtcbiAgICByZXR1cm4gdG9JbnQ2NCgoKEJpZ0ludChtcykgKyA2MjEzNTU5NjgwMDAwMG4pICsgQmlnSW50KG9mZnNldCkpICogMTAwMDBuKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0aWNrc1RvVW5peEVwb2NoTWlsbGlzZWNvbmRzKHRpY2tzKSB7XG4gICAgcmV0dXJuIE51bWJlcigoKEJpZ0ludCh0aWNrcykgLyAxMDAwMG4pIC0gNjIxMzU1OTY4MDAwMDBuKSk7XG59XG5leHBvcnQgZnVuY3Rpb24gZGF0ZU9mZnNldFRvU3RyaW5nKG9mZnNldCkge1xuICAgIGNvbnN0IGlzTWludXMgPSBvZmZzZXQgPCAwO1xuICAgIG9mZnNldCA9IE1hdGguYWJzKG9mZnNldCk7XG4gICAgY29uc3QgaG91cnMgPSB+fihvZmZzZXQgLyAzNjAwMDAwKTtcbiAgICBjb25zdCBtaW51dGVzID0gKG9mZnNldCAlIDM2MDAwMDApIC8gNjAwMDA7XG4gICAgcmV0dXJuIChpc01pbnVzID8gXCItXCIgOiBcIitcIikgK1xuICAgICAgICBwYWRXaXRoWmVyb3MoaG91cnMsIDIpICsgXCI6XCIgK1xuICAgICAgICBwYWRXaXRoWmVyb3MobWludXRlcywgMik7XG59XG5leHBvcnQgZnVuY3Rpb24gZGF0ZVRvSGFsZlVUQ1N0cmluZyhkYXRlLCBoYWxmKSB7XG4gICAgY29uc3Qgc3RyID0gZGF0ZS50b0lTT1N0cmluZygpO1xuICAgIHJldHVybiBoYWxmID09PSBcImZpcnN0XCJcbiAgICAgICAgPyBzdHIuc3Vic3RyaW5nKDAsIHN0ci5pbmRleE9mKFwiVFwiKSlcbiAgICAgICAgOiBzdHIuc3Vic3RyaW5nKHN0ci5pbmRleE9mKFwiVFwiKSArIDEsIHN0ci5sZW5ndGggLSAxKTtcbn1cbmZ1bmN0aW9uIGRhdGVUb0lTT1N0cmluZyhkLCB1dGMpIHtcbiAgICBpZiAodXRjKSB7XG4gICAgICAgIHJldHVybiBkLnRvSVNPU3RyaW5nKCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyBKUyBEYXRlIGlzIGFsd2F5cyBsb2NhbFxuICAgICAgICBjb25zdCBwcmludE9mZnNldCA9IGQua2luZCA9PSBudWxsID8gdHJ1ZSA6IGQua2luZCA9PT0gMiAvKiBEYXRlS2luZC5Mb2NhbCAqLztcbiAgICAgICAgcmV0dXJuIHBhZFdpdGhaZXJvcyhkLmdldEZ1bGxZZWFyKCksIDQpICsgXCItXCIgK1xuICAgICAgICAgICAgcGFkV2l0aFplcm9zKGQuZ2V0TW9udGgoKSArIDEsIDIpICsgXCItXCIgK1xuICAgICAgICAgICAgcGFkV2l0aFplcm9zKGQuZ2V0RGF0ZSgpLCAyKSArIFwiVFwiICtcbiAgICAgICAgICAgIHBhZFdpdGhaZXJvcyhkLmdldEhvdXJzKCksIDIpICsgXCI6XCIgK1xuICAgICAgICAgICAgcGFkV2l0aFplcm9zKGQuZ2V0TWludXRlcygpLCAyKSArIFwiOlwiICtcbiAgICAgICAgICAgIHBhZFdpdGhaZXJvcyhkLmdldFNlY29uZHMoKSwgMikgKyBcIi5cIiArXG4gICAgICAgICAgICBwYWRXaXRoWmVyb3MoZC5nZXRNaWxsaXNlY29uZHMoKSwgMykgK1xuICAgICAgICAgICAgKHByaW50T2Zmc2V0ID8gZGF0ZU9mZnNldFRvU3RyaW5nKGQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIC02MDAwMCkgOiBcIlwiKTtcbiAgICB9XG59XG5mdW5jdGlvbiBkYXRlVG9JU09TdHJpbmdXaXRoT2Zmc2V0KGRhdGVXaXRoT2Zmc2V0LCBvZmZzZXQpIHtcbiAgICBjb25zdCBzdHIgPSBkYXRlV2l0aE9mZnNldC50b0lTT1N0cmluZygpO1xuICAgIHJldHVybiBzdHIuc3Vic3RyaW5nKDAsIHN0ci5sZW5ndGggLSAxKSArIGRhdGVPZmZzZXRUb1N0cmluZyhvZmZzZXQpO1xufVxuZnVuY3Rpb24gZGF0ZVRvU3RyaW5nV2l0aE9mZnNldChkYXRlLCBmb3JtYXQpIHtcbiAgICBjb25zdCBkID0gbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkgKyAoZGF0ZS5vZmZzZXQgPz8gMCkpO1xuICAgIGlmICh0eXBlb2YgZm9ybWF0ICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHJldHVybiBkLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgvXFwuXFxkKy8sIFwiXCIpLnJlcGxhY2UoL1tBLVpdfFxcLlxcZCsvZywgXCIgXCIpICsgZGF0ZU9mZnNldFRvU3RyaW5nKChkYXRlLm9mZnNldCA/PyAwKSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGZvcm1hdC5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgc3dpdGNoIChmb3JtYXQpIHtcbiAgICAgICAgICAgIGNhc2UgXCJEXCI6XG4gICAgICAgICAgICBjYXNlIFwiZFwiOiByZXR1cm4gZGF0ZVRvSGFsZlVUQ1N0cmluZyhkLCBcImZpcnN0XCIpO1xuICAgICAgICAgICAgY2FzZSBcIlRcIjpcbiAgICAgICAgICAgIGNhc2UgXCJ0XCI6IHJldHVybiBkYXRlVG9IYWxmVVRDU3RyaW5nKGQsIFwic2Vjb25kXCIpO1xuICAgICAgICAgICAgY2FzZSBcIk9cIjpcbiAgICAgICAgICAgIGNhc2UgXCJvXCI6IHJldHVybiBkYXRlVG9JU09TdHJpbmdXaXRoT2Zmc2V0KGQsIChkYXRlLm9mZnNldCA/PyAwKSk7XG4gICAgICAgICAgICBkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoXCJVbnJlY29nbml6ZWQgRGF0ZSBwcmludCBmb3JtYXRcIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBkYXRlVG9TdHJpbmdXaXRoQ3VzdG9tRm9ybWF0KGQsIGZvcm1hdCwgdHJ1ZSk7XG4gICAgfVxufVxuZnVuY3Rpb24gZGF0ZVRvU3RyaW5nV2l0aEtpbmQoZGF0ZSwgZm9ybWF0KSB7XG4gICAgY29uc3QgdXRjID0gZGF0ZS5raW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqLztcbiAgICBpZiAodHlwZW9mIGZvcm1hdCAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICByZXR1cm4gdXRjID8gZGF0ZS50b1VUQ1N0cmluZygpIDogZGF0ZS50b0xvY2FsZVN0cmluZygpO1xuICAgIH1cbiAgICBlbHNlIGlmIChmb3JtYXQubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIHN3aXRjaCAoZm9ybWF0KSB7XG4gICAgICAgICAgICBjYXNlIFwiRFwiOlxuICAgICAgICAgICAgY2FzZSBcImRcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gdXRjID8gZGF0ZVRvSGFsZlVUQ1N0cmluZyhkYXRlLCBcImZpcnN0XCIpIDogZGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoKTtcbiAgICAgICAgICAgIGNhc2UgXCJUXCI6XG4gICAgICAgICAgICBjYXNlIFwidFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiB1dGMgPyBkYXRlVG9IYWxmVVRDU3RyaW5nKGRhdGUsIFwic2Vjb25kXCIpIDogZGF0ZS50b0xvY2FsZVRpbWVTdHJpbmcoKTtcbiAgICAgICAgICAgIGNhc2UgXCJPXCI6XG4gICAgICAgICAgICBjYXNlIFwib1wiOlxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRlVG9JU09TdHJpbmcoZGF0ZSwgdXRjKTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5yZWNvZ25pemVkIERhdGUgcHJpbnQgZm9ybWF0XCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gZGF0ZVRvU3RyaW5nV2l0aEN1c3RvbUZvcm1hdChkYXRlLCBmb3JtYXQsIHV0Yyk7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIHRvU3RyaW5nKGRhdGUsIGZvcm1hdCwgX3Byb3ZpZGVyKSB7XG4gICAgcmV0dXJuIGRhdGUub2Zmc2V0ICE9IG51bGxcbiAgICAgICAgPyBkYXRlVG9TdHJpbmdXaXRoT2Zmc2V0KGRhdGUsIGZvcm1hdClcbiAgICAgICAgOiBkYXRlVG9TdHJpbmdXaXRoS2luZChkYXRlLCBmb3JtYXQpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIERhdGVUaW1lKHZhbHVlLCBraW5kKSB7XG4gICAgY29uc3QgZCA9IG5ldyBEYXRlKHZhbHVlKTtcbiAgICBkLmtpbmQgPSAoa2luZCA9PSBudWxsID8gMCAvKiBEYXRlS2luZC5VbnNwZWNpZmllZCAqLyA6IGtpbmQpIHwgMDtcbiAgICByZXR1cm4gZDtcbn1cbmV4cG9ydCBmdW5jdGlvbiBmcm9tVGlja3ModGlja3MsIGtpbmQpIHtcbiAgICBraW5kID0ga2luZCAhPSBudWxsID8ga2luZCA6IDIgLyogRGF0ZUtpbmQuTG9jYWwgKi87IC8vIGJldHRlciBkZWZhdWx0IHRoYW4gVW5zcGVjaWZpZWRcbiAgICBsZXQgZGF0ZSA9IERhdGVUaW1lKHRpY2tzVG9Vbml4RXBvY2hNaWxsaXNlY29uZHModGlja3MpLCBraW5kKTtcbiAgICAvLyBUaWNrcyBhcmUgbG9jYWwgdG8gb2Zmc2V0IChpbiB0aGlzIGNhc2UsIGVpdGhlciBVVEMgb3IgTG9jYWwvVW5rbm93bikuXG4gICAgLy8gSWYga2luZCBpcyBhbnl0aGluZyBidXQgVVRDLCB0aGF0IG1lYW5zIHRoYXQgdGhlIHRpY2sgbnVtYmVyIHdhcyBub3RcbiAgICAvLyBpbiB1dGMsIHRodXMgZ2V0VGltZSgpIGNhbm5vdCByZXR1cm4gVVRDLCBhbmQgbmVlZHMgdG8gYmUgc2hpZnRlZC5cbiAgICBpZiAoa2luZCAhPT0gMSAvKiBEYXRlS2luZC5VVEMgKi8pIHtcbiAgICAgICAgZGF0ZSA9IERhdGVUaW1lKGRhdGUuZ2V0VGltZSgpIC0gZGF0ZU9mZnNldChkYXRlKSwga2luZCk7XG4gICAgfVxuICAgIHJldHVybiBkYXRlO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGZyb21EYXRlVGltZU9mZnNldChkYXRlLCBraW5kKSB7XG4gICAgc3dpdGNoIChraW5kKSB7XG4gICAgICAgIGNhc2UgMSAvKiBEYXRlS2luZC5VVEMgKi86IHJldHVybiBEYXRlVGltZShkYXRlLmdldFRpbWUoKSwgMSAvKiBEYXRlS2luZC5VVEMgKi8pO1xuICAgICAgICBjYXNlIDIgLyogRGF0ZUtpbmQuTG9jYWwgKi86IHJldHVybiBEYXRlVGltZShkYXRlLmdldFRpbWUoKSwgMiAvKiBEYXRlS2luZC5Mb2NhbCAqLyk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBjb25zdCBkID0gRGF0ZVRpbWUoZGF0ZS5nZXRUaW1lKCkgKyAoZGF0ZS5vZmZzZXQgPz8gMCksIGtpbmQpO1xuICAgICAgICAgICAgcmV0dXJuIERhdGVUaW1lKGQuZ2V0VGltZSgpIC0gZGF0ZU9mZnNldChkKSwga2luZCk7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGdldFRpY2tzKGRhdGUpIHtcbiAgICByZXR1cm4gdW5peEVwb2NoTWlsbGlzZWNvbmRzVG9UaWNrcyhkYXRlLmdldFRpbWUoKSwgZGF0ZU9mZnNldChkYXRlKSk7XG59XG5leHBvcnQgZnVuY3Rpb24gbWluVmFsdWUoKSB7XG4gICAgLy8gVGhpcyBpcyBcIjAwMDEtMDEtMDFUMDA6MDA6MDAuMDAwWlwiLCBhY3R1YWwgSlMgbWluIHZhbHVlIGlzIC04NjQwMDAwMDAwMDAwMDAwXG4gICAgcmV0dXJuIERhdGVUaW1lKC02MjEzNTU5NjgwMDAwMCwgMCAvKiBEYXRlS2luZC5VbnNwZWNpZmllZCAqLyk7XG59XG5leHBvcnQgZnVuY3Rpb24gbWF4VmFsdWUoKSB7XG4gICAgLy8gVGhpcyBpcyBcIjk5OTktMTItMzFUMjM6NTk6NTkuOTk5WlwiLCBhY3R1YWwgSlMgbWF4IHZhbHVlIGlzIDg2NDAwMDAwMDAwMDAwMDBcbiAgICByZXR1cm4gRGF0ZVRpbWUoMjUzNDAyMzAwNzk5OTk5LCAwIC8qIERhdGVLaW5kLlVuc3BlY2lmaWVkICovKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZVJhdyhpbnB1dCkge1xuICAgIGZ1bmN0aW9uIGZhaWwoKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIHN0cmluZyBpcyBub3QgYSB2YWxpZCBEYXRlOiAke2lucHV0fWApO1xuICAgIH1cbiAgICBpZiAoaW5wdXQgPT0gbnVsbCB8fCBpbnB1dC50cmltKCkgPT09IFwiXCIpIHtcbiAgICAgICAgZmFpbCgpO1xuICAgIH1cbiAgICAvLyBJU08gZGF0ZXMgd2l0aG91dCBUWiBhcmUgcGFyc2VkIGFzIFVUQy4gQWRkaW5nIHRpbWUgd2l0aG91dCBUWiBrZWVwcyB0aGVtIGxvY2FsLlxuICAgIGlmIChpbnB1dC5sZW5ndGggPT09IDEwICYmIGlucHV0WzRdID09PSBcIi1cIiAmJiBpbnB1dFs3XSA9PT0gXCItXCIpIHtcbiAgICAgICAgaW5wdXQgKz0gXCJUMDA6MDA6MDBcIjtcbiAgICB9XG4gICAgbGV0IGRhdGUgPSBuZXcgRGF0ZShpbnB1dCk7XG4gICAgbGV0IG9mZnNldCA9IG51bGw7XG4gICAgaWYgKGlzTmFOKGRhdGUuZ2V0VGltZSgpKSkge1xuICAgICAgICAvLyBUcnkgdG8gY2hlY2sgc3RyaW5ncyBKUyBEYXRlIGNhbm5vdCBwYXJzZSAoc2VlICMxMDQ1LCAjMTQyMilcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aFxuICAgICAgICBjb25zdCBtID0gL15cXHMqKFxcZCtbXlxcd1xcczpdXFxkK1teXFx3XFxzOl1cXGQrKT9cXHMqKFxcZCs6XFxkKyg/OjpcXGQrKD86XFwuXFxkKyk/KT8pP1xccyooW0FhUHBdW01tXSk/XFxzKihafFsrLV0oWzAxXT9cXGQpOj8oWzAtNV0/XFxkKT8pP1xccyokLy5leGVjKGlucHV0KTtcbiAgICAgICAgaWYgKG0gIT0gbnVsbCkge1xuICAgICAgICAgICAgbGV0IGJhc2VEYXRlO1xuICAgICAgICAgICAgbGV0IHRpbWVJblNlY29uZHMgPSAwO1xuICAgICAgICAgICAgaWYgKG1bMl0gIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVQYXJ0cyA9IG1bMl0uc3BsaXQoXCI6XCIpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGhvdXJQYXJ0ID0gcGFyc2VJbnQodGltZVBhcnRzWzBdLCAxMCk7XG4gICAgICAgICAgICAgICAgdGltZUluU2Vjb25kcyA9XG4gICAgICAgICAgICAgICAgICAgIGhvdXJQYXJ0ICogMzYwMCArXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUludCh0aW1lUGFydHNbMV0gfHwgXCIwXCIsIDEwKSAqIDYwICtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQodGltZVBhcnRzWzJdIHx8IFwiMFwiKTtcbiAgICAgICAgICAgICAgICBpZiAobVszXSAhPSBudWxsICYmIG1bM10udG9VcHBlckNhc2UoKSA9PT0gXCJQTVwiICYmIGhvdXJQYXJ0IDwgMTIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGltZUluU2Vjb25kcyArPSA3MjA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG1bNF0gIT0gbnVsbCkgeyAvLyBUaGVyZSdzIGFuIG9mZnNldCwgcGFyc2UgYXMgVVRDXG4gICAgICAgICAgICAgICAgaWYgKG1bMV0gIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBiYXNlRGF0ZSA9IG5ldyBEYXRlKG1bMV0gKyBcIiBVVENcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgYmFzZURhdGUgPSBuZXcgRGF0ZShkLmdldFVUQ0Z1bGxZZWFyKCkgKyBcIi9cIiArIChkLmdldFVUQ01vbnRoKCkgKyAxKSArIFwiL1wiICsgZC5nZXRVVENEYXRlKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobVs0XSA9PT0gXCJaXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gXCJaXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsZXQgb2Zmc2V0SW5NaW51dGVzID0gcGFyc2VJbnQobVs1XSwgMTApICogNjAgKyBwYXJzZUludChtWzZdIHx8IFwiMFwiLCAxMCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtWzRdWzBdID09PSBcIi1cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0SW5NaW51dGVzICo9IC0xO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IG9mZnNldEluTWludXRlcztcbiAgICAgICAgICAgICAgICAgICAgdGltZUluU2Vjb25kcyAtPSBvZmZzZXRJbk1pbnV0ZXMgKiA2MDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAobVsxXSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGJhc2VEYXRlID0gbmV3IERhdGUobVsxXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgYmFzZURhdGUgPSBuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCkgKyBcIi9cIiArIChkLmdldE1vbnRoKCkgKyAxKSArIFwiL1wiICsgZC5nZXREYXRlKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRhdGUgPSBuZXcgRGF0ZShiYXNlRGF0ZS5nZXRUaW1lKCkgKyB0aW1lSW5TZWNvbmRzICogMTAwMCk7XG4gICAgICAgICAgICAvLyBjb3JyZWN0IGZvciBkYXlsaWdodCBzYXZpbmdzIHRpbWVcbiAgICAgICAgICAgIGRhdGUgPSBuZXcgRGF0ZShkYXRlLmdldFRpbWUoKSArIChkYXRlLmdldFRpbWV6b25lT2Zmc2V0KCkgLSBiYXNlRGF0ZS5nZXRUaW1lem9uZU9mZnNldCgpKSAqIDYwMDAwKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGZhaWwoKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBDaGVjayBhZ2FpbiB0aGUgZGF0ZSBpcyB2YWxpZCBhZnRlciB0cmFuc2Zvcm1hdGlvbnMsIHNlZSAjMjIyOVxuICAgICAgICBpZiAoaXNOYU4oZGF0ZS5nZXRUaW1lKCkpKSB7XG4gICAgICAgICAgICBmYWlsKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIFtkYXRlLCBvZmZzZXRdO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlKHN0ciwgZGV0ZWN0VVRDID0gZmFsc2UpIHtcbiAgICBjb25zdCBbZGF0ZSwgb2Zmc2V0XSA9IHBhcnNlUmF3KHN0cik7XG4gICAgLy8gLk5FVCBhbHdheXMgcGFyc2VzIERhdGVUaW1lIGFzIExvY2FsIGlmIHRoZXJlJ3Mgb2Zmc2V0IGluZm8gKGV2ZW4gXCJaXCIpXG4gICAgLy8gTmV3dG9uc29mdC5Kc29uIHVzZXMgVVRDIGlmIHRoZSBvZmZzZXQgaXMgXCJaXCJcbiAgICBjb25zdCBraW5kID0gb2Zmc2V0ICE9IG51bGxcbiAgICAgICAgPyAoZGV0ZWN0VVRDICYmIG9mZnNldCA9PT0gXCJaXCIgPyAxIC8qIERhdGVLaW5kLlVUQyAqLyA6IDIgLyogRGF0ZUtpbmQuTG9jYWwgKi8pXG4gICAgICAgIDogMCAvKiBEYXRlS2luZC5VbnNwZWNpZmllZCAqLztcbiAgICByZXR1cm4gRGF0ZVRpbWUoZGF0ZS5nZXRUaW1lKCksIGtpbmQpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRyeVBhcnNlKHYsIGRlZlZhbHVlKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgZGVmVmFsdWUuY29udGVudHMgPSBwYXJzZSh2KTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGNhdGNoIChfZXJyKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlKHllYXIsIG1vbnRoLCBkYXksIGggPSAwLCBtID0gMCwgcyA9IDAsIG1zID0gMCwga2luZCkge1xuICAgIGNvbnN0IGRhdGUgPSBraW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqL1xuICAgICAgICA/IG5ldyBEYXRlKERhdGUuVVRDKHllYXIsIG1vbnRoIC0gMSwgZGF5LCBoLCBtLCBzLCBtcykpXG4gICAgICAgIDogbmV3IERhdGUoeWVhciwgbW9udGggLSAxLCBkYXksIGgsIG0sIHMsIG1zKTtcbiAgICBpZiAoeWVhciA8PSA5OSkge1xuICAgICAgICBpZiAoa2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi8pIHtcbiAgICAgICAgICAgIGRhdGUuc2V0VVRDRnVsbFllYXIoeWVhciwgbW9udGggLSAxLCBkYXkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZGF0ZS5zZXRGdWxsWWVhcih5ZWFyLCBtb250aCAtIDEsIGRheSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgZGF0ZVZhbHVlID0gZGF0ZS5nZXRUaW1lKCk7XG4gICAgaWYgKGlzTmFOKGRhdGVWYWx1ZSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlIHBhcmFtZXRlcnMgZGVzY3JpYmUgYW4gdW5yZXByZXNlbnRhYmxlIERhdGUuXCIpO1xuICAgIH1cbiAgICByZXR1cm4gRGF0ZVRpbWUoZGF0ZVZhbHVlLCBraW5kKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBub3coKSB7XG4gICAgcmV0dXJuIERhdGVUaW1lKERhdGUubm93KCksIDIgLyogRGF0ZUtpbmQuTG9jYWwgKi8pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHV0Y05vdygpIHtcbiAgICByZXR1cm4gRGF0ZVRpbWUoRGF0ZS5ub3coKSwgMSAvKiBEYXRlS2luZC5VVEMgKi8pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvZGF5KCkge1xuICAgIHJldHVybiBkYXRlKG5vdygpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpc0xlYXBZZWFyKHllYXIpIHtcbiAgICByZXR1cm4geWVhciAlIDQgPT09IDAgJiYgeWVhciAlIDEwMCAhPT0gMCB8fCB5ZWFyICUgNDAwID09PSAwO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGRheXNJbk1vbnRoKHllYXIsIG1vbnRoKSB7XG4gICAgcmV0dXJuIG1vbnRoID09PSAyXG4gICAgICAgID8gKGlzTGVhcFllYXIoeWVhcikgPyAyOSA6IDI4KVxuICAgICAgICA6IChtb250aCA+PSA4ID8gKG1vbnRoICUgMiA9PT0gMCA/IDMxIDogMzApIDogKG1vbnRoICUgMiA9PT0gMCA/IDMwIDogMzEpKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b1VuaXZlcnNhbFRpbWUoZGF0ZSkge1xuICAgIHJldHVybiBkYXRlLmtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovID8gZGF0ZSA6IERhdGVUaW1lKGRhdGUuZ2V0VGltZSgpLCAxIC8qIERhdGVLaW5kLlVUQyAqLyk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9Mb2NhbFRpbWUoZGF0ZSkge1xuICAgIHJldHVybiBkYXRlLmtpbmQgPT09IDIgLyogRGF0ZUtpbmQuTG9jYWwgKi8gPyBkYXRlIDogRGF0ZVRpbWUoZGF0ZS5nZXRUaW1lKCksIDIgLyogRGF0ZUtpbmQuTG9jYWwgKi8pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHNwZWNpZnlLaW5kKGQsIGtpbmQpIHtcbiAgICByZXR1cm4gY3JlYXRlKHllYXIoZCksIG1vbnRoKGQpLCBkYXkoZCksIGhvdXIoZCksIG1pbnV0ZShkKSwgc2Vjb25kKGQpLCBtaWxsaXNlY29uZChkKSwga2luZCk7XG59XG5leHBvcnQgZnVuY3Rpb24gdGltZU9mRGF5KGQpIHtcbiAgICByZXR1cm4gaG91cihkKSAqIDM2MDAwMDBcbiAgICAgICAgKyBtaW51dGUoZCkgKiA2MDAwMFxuICAgICAgICArIHNlY29uZChkKSAqIDEwMDBcbiAgICAgICAgKyBtaWxsaXNlY29uZChkKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBkYXRlKGQpIHtcbiAgICByZXR1cm4gY3JlYXRlKHllYXIoZCksIG1vbnRoKGQpLCBkYXkoZCksIDAsIDAsIDAsIDAsIGQua2luZCk7XG59XG5leHBvcnQgZnVuY3Rpb24gZGF5KGQpIHtcbiAgICByZXR1cm4gZC5raW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqLyA/IGQuZ2V0VVRDRGF0ZSgpIDogZC5nZXREYXRlKCk7XG59XG5leHBvcnQgZnVuY3Rpb24gaG91cihkKSB7XG4gICAgcmV0dXJuIGQua2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi8gPyBkLmdldFVUQ0hvdXJzKCkgOiBkLmdldEhvdXJzKCk7XG59XG5leHBvcnQgZnVuY3Rpb24gbWlsbGlzZWNvbmQoZCkge1xuICAgIHJldHVybiBkLmtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovID8gZC5nZXRVVENNaWxsaXNlY29uZHMoKSA6IGQuZ2V0TWlsbGlzZWNvbmRzKCk7XG59XG5leHBvcnQgZnVuY3Rpb24gbWludXRlKGQpIHtcbiAgICByZXR1cm4gZC5raW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqLyA/IGQuZ2V0VVRDTWludXRlcygpIDogZC5nZXRNaW51dGVzKCk7XG59XG5leHBvcnQgZnVuY3Rpb24gbW9udGgoZCkge1xuICAgIHJldHVybiAoZC5raW5kID09PSAxIC8qIERhdGVLaW5kLlVUQyAqLyA/IGQuZ2V0VVRDTW9udGgoKSA6IGQuZ2V0TW9udGgoKSkgKyAxO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHNlY29uZChkKSB7XG4gICAgcmV0dXJuIGQua2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi8gPyBkLmdldFVUQ1NlY29uZHMoKSA6IGQuZ2V0U2Vjb25kcygpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHllYXIoZCkge1xuICAgIHJldHVybiBkLmtpbmQgPT09IDEgLyogRGF0ZUtpbmQuVVRDICovID8gZC5nZXRVVENGdWxsWWVhcigpIDogZC5nZXRGdWxsWWVhcigpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGRheU9mV2VlayhkKSB7XG4gICAgcmV0dXJuIGQua2luZCA9PT0gMSAvKiBEYXRlS2luZC5VVEMgKi8gPyBkLmdldFVUQ0RheSgpIDogZC5nZXREYXkoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBkYXlPZlllYXIoZCkge1xuICAgIGNvbnN0IF95ZWFyID0geWVhcihkKTtcbiAgICBjb25zdCBfbW9udGggPSBtb250aChkKTtcbiAgICBsZXQgX2RheSA9IGRheShkKTtcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IF9tb250aDsgaSsrKSB7XG4gICAgICAgIF9kYXkgKz0gZGF5c0luTW9udGgoX3llYXIsIGkpO1xuICAgIH1cbiAgICByZXR1cm4gX2RheTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBhZGQoZCwgdHMpIHtcbiAgICBjb25zdCBuZXdEYXRlID0gRGF0ZVRpbWUoZC5nZXRUaW1lKCkgKyB0cywgZC5raW5kKTtcbiAgICBpZiAoZC5raW5kID09PSAyIC8qIERhdGVLaW5kLkxvY2FsICovKSB7XG4gICAgICAgIGNvbnN0IG9sZFR6T2Zmc2V0ID0gZC5nZXRUaW1lem9uZU9mZnNldCgpO1xuICAgICAgICBjb25zdCBuZXdUek9mZnNldCA9IG5ld0RhdGUuZ2V0VGltZXpvbmVPZmZzZXQoKTtcbiAgICAgICAgcmV0dXJuIG9sZFR6T2Zmc2V0ICE9PSBuZXdUek9mZnNldFxuICAgICAgICAgICAgPyBEYXRlVGltZShuZXdEYXRlLmdldFRpbWUoKSArIChuZXdUek9mZnNldCAtIG9sZFR6T2Zmc2V0KSAqIDYwMDAwLCBkLmtpbmQpXG4gICAgICAgICAgICA6IG5ld0RhdGU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gbmV3RGF0ZTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gYWRkRGF5cyhkLCB2KSB7XG4gICAgcmV0dXJuIGFkZChkLCB2ICogODY0MDAwMDApO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGFkZEhvdXJzKGQsIHYpIHtcbiAgICByZXR1cm4gYWRkKGQsIHYgKiAzNjAwMDAwKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBhZGRNaW51dGVzKGQsIHYpIHtcbiAgICByZXR1cm4gYWRkKGQsIHYgKiA2MDAwMCk7XG59XG5leHBvcnQgZnVuY3Rpb24gYWRkU2Vjb25kcyhkLCB2KSB7XG4gICAgcmV0dXJuIGFkZChkLCB2ICogMTAwMCk7XG59XG5leHBvcnQgZnVuY3Rpb24gYWRkTWlsbGlzZWNvbmRzKGQsIHYpIHtcbiAgICByZXR1cm4gYWRkKGQsIHYpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGFkZFRpY2tzKGQsIHYpIHtcbiAgICByZXR1cm4gYWRkKGQsIHRvRmxvYXQ2NCh2IC8gMTAwMDBuKSk7XG59XG5leHBvcnQgZnVuY3Rpb24gYWRkWWVhcnMoZCwgdikge1xuICAgIGNvbnN0IG5ld01vbnRoID0gbW9udGgoZCk7XG4gICAgY29uc3QgbmV3WWVhciA9IHllYXIoZCkgKyB2O1xuICAgIGNvbnN0IF9kYXlzSW5Nb250aCA9IGRheXNJbk1vbnRoKG5ld1llYXIsIG5ld01vbnRoKTtcbiAgICBjb25zdCBuZXdEYXkgPSBNYXRoLm1pbihfZGF5c0luTW9udGgsIGRheShkKSk7XG4gICAgcmV0dXJuIGNyZWF0ZShuZXdZZWFyLCBuZXdNb250aCwgbmV3RGF5LCBob3VyKGQpLCBtaW51dGUoZCksIHNlY29uZChkKSwgbWlsbGlzZWNvbmQoZCksIGQua2luZCk7XG59XG5leHBvcnQgZnVuY3Rpb24gYWRkTW9udGhzKGQsIHYpIHtcbiAgICBsZXQgbmV3TW9udGggPSBtb250aChkKSArIHY7XG4gICAgbGV0IG5ld01vbnRoXyA9IDA7XG4gICAgbGV0IHllYXJPZmZzZXQgPSAwO1xuICAgIGlmIChuZXdNb250aCA+IDEyKSB7XG4gICAgICAgIG5ld01vbnRoXyA9IG5ld01vbnRoICUgMTI7XG4gICAgICAgIHllYXJPZmZzZXQgPSBNYXRoLmZsb29yKG5ld01vbnRoIC8gMTIpO1xuICAgICAgICBuZXdNb250aCA9IG5ld01vbnRoXztcbiAgICB9XG4gICAgZWxzZSBpZiAobmV3TW9udGggPCAxKSB7XG4gICAgICAgIG5ld01vbnRoXyA9IDEyICsgbmV3TW9udGggJSAxMjtcbiAgICAgICAgeWVhck9mZnNldCA9IE1hdGguZmxvb3IobmV3TW9udGggLyAxMikgKyAobmV3TW9udGhfID09PSAxMiA/IC0xIDogMCk7XG4gICAgICAgIG5ld01vbnRoID0gbmV3TW9udGhfO1xuICAgIH1cbiAgICBjb25zdCBuZXdZZWFyID0geWVhcihkKSArIHllYXJPZmZzZXQ7XG4gICAgY29uc3QgX2RheXNJbk1vbnRoID0gZGF5c0luTW9udGgobmV3WWVhciwgbmV3TW9udGgpO1xuICAgIGNvbnN0IG5ld0RheSA9IE1hdGgubWluKF9kYXlzSW5Nb250aCwgZGF5KGQpKTtcbiAgICByZXR1cm4gY3JlYXRlKG5ld1llYXIsIG5ld01vbnRoLCBuZXdEYXksIGhvdXIoZCksIG1pbnV0ZShkKSwgc2Vjb25kKGQpLCBtaWxsaXNlY29uZChkKSwgZC5raW5kKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBzdWJ0cmFjdChkLCB0aGF0KSB7XG4gICAgcmV0dXJuIHR5cGVvZiB0aGF0ID09PSBcIm51bWJlclwiXG4gICAgICAgID8gYWRkKGQsIC10aGF0KVxuICAgICAgICA6IGQuZ2V0VGltZSgpIC0gdGhhdC5nZXRUaW1lKCk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9Mb25nRGF0ZVN0cmluZyhkKSB7XG4gICAgcmV0dXJuIGQudG9EYXRlU3RyaW5nKCk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9TaG9ydERhdGVTdHJpbmcoZCkge1xuICAgIHJldHVybiBkLnRvTG9jYWxlRGF0ZVN0cmluZygpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvTG9uZ1RpbWVTdHJpbmcoZCkge1xuICAgIHJldHVybiBkLnRvTG9jYWxlVGltZVN0cmluZygpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvU2hvcnRUaW1lU3RyaW5nKGQpIHtcbiAgICByZXR1cm4gZC50b0xvY2FsZVRpbWVTdHJpbmcoKS5yZXBsYWNlKC86XFxkXFxkKD8hOikvLCBcIlwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBlcXVhbHMoZDEsIGQyKSB7XG4gICAgcmV0dXJuIGQxLmdldFRpbWUoKSA9PT0gZDIuZ2V0VGltZSgpO1xufVxuZXhwb3J0IGNvbnN0IGNvbXBhcmUgPSBjb21wYXJlRGF0ZXM7XG5leHBvcnQgY29uc3QgY29tcGFyZVRvID0gY29tcGFyZURhdGVzO1xuZXhwb3J0IGZ1bmN0aW9uIG9wX0FkZGl0aW9uKHgsIHkpIHtcbiAgICByZXR1cm4gYWRkKHgsIHkpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIG9wX1N1YnRyYWN0aW9uKHgsIHkpIHtcbiAgICByZXR1cm4gc3VidHJhY3QoeCwgeSk7XG59XG5leHBvcnQgZnVuY3Rpb24gaXNEYXlsaWdodFNhdmluZ1RpbWUoeCkge1xuICAgIGNvbnN0IGphbiA9IG5ldyBEYXRlKHguZ2V0RnVsbFllYXIoKSwgMCwgMSk7XG4gICAgY29uc3QganVsID0gbmV3IERhdGUoeC5nZXRGdWxsWWVhcigpLCA2LCAxKTtcbiAgICByZXR1cm4gaXNEU1QoamFuLmdldFRpbWV6b25lT2Zmc2V0KCksIGp1bC5nZXRUaW1lem9uZU9mZnNldCgpLCB4LmdldFRpbWV6b25lT2Zmc2V0KCkpO1xufVxuZnVuY3Rpb24gaXNEU1QoamFuT2Zmc2V0LCBqdWxPZmZzZXQsIHRPZmZzZXQpIHtcbiAgICByZXR1cm4gTWF0aC5taW4oamFuT2Zmc2V0LCBqdWxPZmZzZXQpID09PSB0T2Zmc2V0O1xufVxuZXhwb3J0IGRlZmF1bHQgRGF0ZVRpbWU7XG4iLAogICJpbXBvcnQgeyB0b1N0cmluZyBhcyBkYXRlVG9TdHJpbmcgfSBmcm9tIFwiLi9EYXRlLmpzXCI7XG5pbXBvcnQgeyBjb21wYXJlIGFzIG51bWVyaWNDb21wYXJlLCBpc051bWVyaWMsIG11bHRpcGx5LCB0b0V4cG9uZW50aWFsLCB0b0ZpeGVkLCB0b0hleCwgdG9QcmVjaXNpb24gfSBmcm9tIFwiLi9OdW1lcmljLmpzXCI7XG5pbXBvcnQgeyBlc2NhcGUgfSBmcm9tIFwiLi9SZWdFeHAuanNcIjtcbmltcG9ydCB7IHRvU3RyaW5nIH0gZnJvbSBcIi4vVHlwZXMuanNcIjtcbmNvbnN0IGZzRm9ybWF0UmVnRXhwID0gLyhefFteJV0pJShbMCtcXC0gXSopKFxcKnxcXGQrKT8oPzpcXC4oXFxkKykpPyhcXHcpL2c7XG5jb25zdCBpbnRlcnBvbGF0ZVJlZ0V4cCA9IC8oPzooXnxbXiVdKSUoWzArXFwtIF0qKShcXGQrKT8oPzpcXC4oXFxkKykpPyhcXHcpKT8lUFxcKFxcKS9nO1xuY29uc3QgZm9ybWF0UmVnRXhwID0gL1xceyhcXGQrKSgsLT9cXGQrKT8oPzpcXDooW2EtekEtWl0pKFxcZHswLDJ9KXxcXDooLis/KSk/XFx9L2c7XG5mdW5jdGlvbiBpc0xlc3NUaGFuKHgsIHkpIHtcbiAgICByZXR1cm4gbnVtZXJpY0NvbXBhcmUoeCwgeSkgPCAwO1xufVxuZnVuY3Rpb24gY21wKHgsIHksIGljKSB7XG4gICAgZnVuY3Rpb24gaXNJZ25vcmVDYXNlKGkpIHtcbiAgICAgICAgcmV0dXJuIGkgPT09IHRydWUgfHxcbiAgICAgICAgICAgIGkgPT09IDEgLyogU3RyaW5nQ29tcGFyaXNvbi5DdXJyZW50Q3VsdHVyZUlnbm9yZUNhc2UgKi8gfHxcbiAgICAgICAgICAgIGkgPT09IDMgLyogU3RyaW5nQ29tcGFyaXNvbi5JbnZhcmlhbnRDdWx0dXJlSWdub3JlQ2FzZSAqLyB8fFxuICAgICAgICAgICAgaSA9PT0gNSAvKiBTdHJpbmdDb21wYXJpc29uLk9yZGluYWxJZ25vcmVDYXNlICovO1xuICAgIH1cbiAgICBmdW5jdGlvbiBpc09yZGluYWwoaSkge1xuICAgICAgICByZXR1cm4gaSA9PT0gNCAvKiBTdHJpbmdDb21wYXJpc29uLk9yZGluYWwgKi8gfHxcbiAgICAgICAgICAgIGkgPT09IDUgLyogU3RyaW5nQ29tcGFyaXNvbi5PcmRpbmFsSWdub3JlQ2FzZSAqLztcbiAgICB9XG4gICAgaWYgKHggPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4geSA9PSBudWxsID8gMCA6IC0xO1xuICAgIH1cbiAgICBpZiAoeSA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiAxO1xuICAgIH0gLy8gZXZlcnl0aGluZyBpcyBiaWdnZXIgdGhhbiBudWxsXG4gICAgaWYgKGlzT3JkaW5hbChpYykpIHtcbiAgICAgICAgaWYgKGlzSWdub3JlQ2FzZShpYykpIHtcbiAgICAgICAgICAgIHggPSB4LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICB5ID0geS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoeCA9PT0geSkgPyAwIDogKHggPCB5ID8gLTEgOiAxKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChpc0lnbm9yZUNhc2UoaWMpKSB7XG4gICAgICAgICAgICB4ID0geC50b0xvY2FsZUxvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgeSA9IHkudG9Mb2NhbGVMb3dlckNhc2UoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geC5sb2NhbGVDb21wYXJlKHkpO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBjb21wYXJlKC4uLmFyZ3MpIHtcbiAgICBzd2l0Y2ggKGFyZ3MubGVuZ3RoKSB7XG4gICAgICAgIGNhc2UgMjogcmV0dXJuIGNtcChhcmdzWzBdLCBhcmdzWzFdLCBmYWxzZSk7XG4gICAgICAgIGNhc2UgMzogcmV0dXJuIGNtcChhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdKTtcbiAgICAgICAgY2FzZSA0OiByZXR1cm4gY21wKGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0gPT09IHRydWUpO1xuICAgICAgICBjYXNlIDU6IHJldHVybiBjbXAoYXJnc1swXS5zdWJzdHIoYXJnc1sxXSwgYXJnc1s0XSksIGFyZ3NbMl0uc3Vic3RyKGFyZ3NbM10sIGFyZ3NbNF0pLCBmYWxzZSk7XG4gICAgICAgIGNhc2UgNjogcmV0dXJuIGNtcChhcmdzWzBdLnN1YnN0cihhcmdzWzFdLCBhcmdzWzRdKSwgYXJnc1syXS5zdWJzdHIoYXJnc1szXSwgYXJnc1s0XSksIGFyZ3NbNV0pO1xuICAgICAgICBjYXNlIDc6IHJldHVybiBjbXAoYXJnc1swXS5zdWJzdHIoYXJnc1sxXSwgYXJnc1s0XSksIGFyZ3NbMl0uc3Vic3RyKGFyZ3NbM10sIGFyZ3NbNF0pLCBhcmdzWzVdID09PSB0cnVlKTtcbiAgICAgICAgZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKFwiU3RyaW5nLmNvbXBhcmU6IFVuc3VwcG9ydGVkIG51bWJlciBvZiBwYXJhbWV0ZXJzXCIpO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBjb21wYXJlT3JkaW5hbCh4LCB5KSB7XG4gICAgcmV0dXJuIGNtcCh4LCB5LCA0IC8qIFN0cmluZ0NvbXBhcmlzb24uT3JkaW5hbCAqLyk7XG59XG5leHBvcnQgZnVuY3Rpb24gY29tcGFyZVRvKHgsIHkpIHtcbiAgICByZXR1cm4gY21wKHgsIHksIDAgLyogU3RyaW5nQ29tcGFyaXNvbi5DdXJyZW50Q3VsdHVyZSAqLyk7XG59XG5leHBvcnQgZnVuY3Rpb24gc3RhcnRzV2l0aChzdHIsIHBhdHRlcm4sIGljKSB7XG4gICAgaWYgKHN0ci5sZW5ndGggPj0gcGF0dGVybi5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIGNtcChzdHIuc3Vic3RyKDAsIHBhdHRlcm4ubGVuZ3RoKSwgcGF0dGVybiwgaWMpID09PSAwO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG5leHBvcnQgZnVuY3Rpb24gaW5kZXhPZkFueShzdHIsIGFueU9mLCAuLi5hcmdzKSB7XG4gICAgaWYgKHN0ciA9PSBudWxsIHx8IHN0ciA9PT0gXCJcIikge1xuICAgICAgICByZXR1cm4gLTE7XG4gICAgfVxuICAgIGNvbnN0IHN0YXJ0SW5kZXggPSAoYXJncy5sZW5ndGggPiAwKSA/IGFyZ3NbMF0gOiAwO1xuICAgIGlmIChzdGFydEluZGV4IDwgMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTdGFydCBpbmRleCBjYW5ub3QgYmUgbmVnYXRpdmVcIik7XG4gICAgfVxuICAgIGNvbnN0IGxlbmd0aCA9IChhcmdzLmxlbmd0aCA+IDEpID8gYXJnc1sxXSA6IHN0ci5sZW5ndGggLSBzdGFydEluZGV4O1xuICAgIGlmIChsZW5ndGggPCAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkxlbmd0aCBjYW5ub3QgYmUgbmVnYXRpdmVcIik7XG4gICAgfVxuICAgIGlmIChzdGFydEluZGV4ICsgbGVuZ3RoID4gc3RyLmxlbmd0aCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHN0YXJ0SW5kZXggYW5kIGxlbmd0aFwiKTtcbiAgICB9XG4gICAgY29uc3QgZW5kSW5kZXggPSBzdGFydEluZGV4ICsgbGVuZ3RoO1xuICAgIGNvbnN0IGFueU9mQXNTdHIgPSBcIlwiLmNvbmNhdC5hcHBseShcIlwiLCBhbnlPZik7XG4gICAgZm9yIChsZXQgaSA9IHN0YXJ0SW5kZXg7IGkgPCBlbmRJbmRleDsgaSsrKSB7XG4gICAgICAgIGlmIChhbnlPZkFzU3RyLmluZGV4T2Yoc3RyW2ldKSA+IC0xKSB7XG4gICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gLTE7XG59XG5leHBvcnQgZnVuY3Rpb24gcHJpbnRmKGlucHV0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgaW5wdXQsXG4gICAgICAgIGNvbnQ6IGZzRm9ybWF0KGlucHV0KSxcbiAgICB9O1xufVxuZXhwb3J0IGZ1bmN0aW9uIGludGVycG9sYXRlKHN0ciwgdmFsdWVzKSB7XG4gICAgbGV0IHZhbElkeCA9IDA7XG4gICAgbGV0IHN0cklkeCA9IDA7XG4gICAgbGV0IHJlc3VsdCA9IFwiXCI7XG4gICAgaW50ZXJwb2xhdGVSZWdFeHAubGFzdEluZGV4ID0gMDtcbiAgICBsZXQgbWF0Y2ggPSBpbnRlcnBvbGF0ZVJlZ0V4cC5leGVjKHN0cik7XG4gICAgd2hpbGUgKG1hdGNoKSB7XG4gICAgICAgIC8vIFRoZSBmaXJzdCBncm91cCBjb3JyZXNwb25kcyB0byB0aGUgbm8tZXNjYXBlIGNoYXIgKF58W14lXSksIHRoZSBhY3R1YWwgcGF0dGVybiBzdGFydHMgaW4gdGhlIG5leHQgY2hhclxuICAgICAgICAvLyBOb3RlOiB3ZSBkb24ndCB1c2UgbmVnYXRpdmUgbG9va2JlaGluZCBiZWNhdXNlIHNvbWUgYnJvd3NlcnMgZG9uJ3Qgc3VwcG9ydCBpdCB5ZXRcbiAgICAgICAgY29uc3QgbWF0Y2hJbmRleCA9IG1hdGNoLmluZGV4ICsgKG1hdGNoWzFdIHx8IFwiXCIpLmxlbmd0aDtcbiAgICAgICAgcmVzdWx0ICs9IHN0ci5zdWJzdHJpbmcoc3RySWR4LCBtYXRjaEluZGV4KS5yZXBsYWNlKC8lJS9nLCBcIiVcIik7XG4gICAgICAgIGNvbnN0IFssICwgZmxhZ3MsIHBhZExlbmd0aCwgcHJlY2lzaW9uLCBmb3JtYXRdID0gbWF0Y2g7XG4gICAgICAgIC8vIFNhdmUgaW50ZXJwb2xhdGVSZWdFeHAubGFzdEluZGV4IGJlZm9yZSBydW5uaW5nIGZvcm1hdFJlcGxhY2VtZW50IGJlY2F1c2UgdGhlIHZhbHVlc1xuICAgICAgICAvLyBtYXkgYWxzbyBpbnZvbHZlIGludGVycG9sYXRpb24gYW5kIG1ha2UgdXNlIG9mIGludGVycG9sYXRlUmVnRXhwIChzZWUgIzMwNzgpXG4gICAgICAgIHN0cklkeCA9IGludGVycG9sYXRlUmVnRXhwLmxhc3RJbmRleDtcbiAgICAgICAgcmVzdWx0ICs9IGZvcm1hdFJlcGxhY2VtZW50KHZhbHVlc1t2YWxJZHgrK10sIGZsYWdzLCBwYWRMZW5ndGgsIHByZWNpc2lvbiwgZm9ybWF0KTtcbiAgICAgICAgLy8gTW92ZSBpbnRlcnBvbGF0ZVJlZ0V4cC5sYXN0SW5kZXggb25lIGNoYXIgYmVoaW5kIHRvIG1ha2Ugc3VyZSB3ZSBtYXRjaCB0aGUgbm8tZXNjYXBlIGNoYXIgbmV4dCB0aW1lXG4gICAgICAgIGludGVycG9sYXRlUmVnRXhwLmxhc3RJbmRleCA9IHN0cklkeCAtIDE7XG4gICAgICAgIG1hdGNoID0gaW50ZXJwb2xhdGVSZWdFeHAuZXhlYyhzdHIpO1xuICAgIH1cbiAgICByZXN1bHQgKz0gc3RyLnN1YnN0cmluZyhzdHJJZHgpLnJlcGxhY2UoLyUlL2csIFwiJVwiKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufVxuZnVuY3Rpb24gY29udGludWVQcmludChjb250LCBhcmcpIHtcbiAgICByZXR1cm4gdHlwZW9mIGFyZyA9PT0gXCJzdHJpbmdcIiA/IGNvbnQoYXJnKSA6IGFyZy5jb250KGNvbnQpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvQ29uc29sZShhcmcpIHtcbiAgICAvLyBEb24ndCByZW1vdmUgdGhlIGxhbWJkYSBoZXJlLCBzZWUgIzEzNTdcbiAgICByZXR1cm4gY29udGludWVQcmludCgoeCkgPT4gY29uc29sZS5sb2coeCksIGFyZyk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9Db25zb2xlRXJyb3IoYXJnKSB7XG4gICAgcmV0dXJuIGNvbnRpbnVlUHJpbnQoKHgpID0+IGNvbnNvbGUuZXJyb3IoeCksIGFyZyk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9UZXh0KGFyZykge1xuICAgIHJldHVybiBjb250aW51ZVByaW50KCh4KSA9PiB4LCBhcmcpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvRmFpbChhcmcpIHtcbiAgICByZXR1cm4gY29udGludWVQcmludCgoeCkgPT4ge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoeCk7XG4gICAgfSwgYXJnKTtcbn1cbmZ1bmN0aW9uIGZvcm1hdFJlcGxhY2VtZW50KHJlcCwgZmxhZ3MsIHBhZExlbmd0aCwgcHJlY2lzaW9uLCBmb3JtYXQpIHtcbiAgICBsZXQgc2lnbiA9IFwiXCI7XG4gICAgZmxhZ3MgPSBmbGFncyB8fCBcIlwiO1xuICAgIGZvcm1hdCA9IGZvcm1hdCB8fCBcIlwiO1xuICAgIGlmIChpc051bWVyaWMocmVwKSkge1xuICAgICAgICBpZiAoZm9ybWF0LnRvTG93ZXJDYXNlKCkgIT09IFwieFwiKSB7XG4gICAgICAgICAgICBpZiAoaXNMZXNzVGhhbihyZXAsIDApKSB7XG4gICAgICAgICAgICAgICAgcmVwID0gbXVsdGlwbHkocmVwLCAtMSk7XG4gICAgICAgICAgICAgICAgc2lnbiA9IFwiLVwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGZsYWdzLmluZGV4T2YoXCIgXCIpID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgc2lnbiA9IFwiIFwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChmbGFncy5pbmRleE9mKFwiK1wiKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHNpZ24gPSBcIitcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcHJlY2lzaW9uID0gcHJlY2lzaW9uID09IG51bGwgPyBudWxsIDogcGFyc2VJbnQocHJlY2lzaW9uLCAxMCk7XG4gICAgICAgIHN3aXRjaCAoZm9ybWF0KSB7XG4gICAgICAgICAgICBjYXNlIFwiZlwiOlxuICAgICAgICAgICAgY2FzZSBcIkZcIjpcbiAgICAgICAgICAgICAgICBwcmVjaXNpb24gPSBwcmVjaXNpb24gIT0gbnVsbCA/IHByZWNpc2lvbiA6IDY7XG4gICAgICAgICAgICAgICAgcmVwID0gdG9GaXhlZChyZXAsIHByZWNpc2lvbik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZ1wiOlxuICAgICAgICAgICAgY2FzZSBcIkdcIjpcbiAgICAgICAgICAgICAgICByZXAgPSBwcmVjaXNpb24gIT0gbnVsbCA/IHRvUHJlY2lzaW9uKHJlcCwgcHJlY2lzaW9uKSA6IHRvUHJlY2lzaW9uKHJlcCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZVwiOlxuICAgICAgICAgICAgY2FzZSBcIkVcIjpcbiAgICAgICAgICAgICAgICByZXAgPSBwcmVjaXNpb24gIT0gbnVsbCA/IHRvRXhwb25lbnRpYWwocmVwLCBwcmVjaXNpb24pIDogdG9FeHBvbmVudGlhbChyZXApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInhcIjpcbiAgICAgICAgICAgICAgICByZXAgPSB0b0hleChyZXApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIlhcIjpcbiAgICAgICAgICAgICAgICByZXAgPSB0b0hleChyZXApLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OiAvLyBBT2lkXG4gICAgICAgICAgICAgICAgcmVwID0gU3RyaW5nKHJlcCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAocmVwIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgICByZXAgPSBkYXRlVG9TdHJpbmcocmVwKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJlcCA9IHRvU3RyaW5nKHJlcCk7XG4gICAgfVxuICAgIHBhZExlbmd0aCA9IHR5cGVvZiBwYWRMZW5ndGggPT09IFwibnVtYmVyXCIgPyBwYWRMZW5ndGggOiBwYXJzZUludChwYWRMZW5ndGgsIDEwKTtcbiAgICBpZiAoIWlzTmFOKHBhZExlbmd0aCkpIHtcbiAgICAgICAgY29uc3QgemVyb0ZsYWcgPSBmbGFncy5pbmRleE9mKFwiMFwiKSA+PSAwOyAvLyBVc2UgJzAnIGZvciBsZWZ0IHBhZGRpbmdcbiAgICAgICAgY29uc3QgbWludXNGbGFnID0gZmxhZ3MuaW5kZXhPZihcIi1cIikgPj0gMDsgLy8gUmlnaHQgcGFkZGluZ1xuICAgICAgICBjb25zdCBjaCA9IG1pbnVzRmxhZyB8fCAhemVyb0ZsYWcgPyBcIiBcIiA6IFwiMFwiO1xuICAgICAgICBpZiAoY2ggPT09IFwiMFwiKSB7XG4gICAgICAgICAgICByZXAgPSBwYWQocmVwLCBwYWRMZW5ndGggLSBzaWduLmxlbmd0aCwgY2gsIG1pbnVzRmxhZyk7XG4gICAgICAgICAgICByZXAgPSBzaWduICsgcmVwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVwID0gcGFkKHNpZ24gKyByZXAsIHBhZExlbmd0aCwgY2gsIG1pbnVzRmxhZyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJlcCA9IHNpZ24gKyByZXA7XG4gICAgfVxuICAgIHJldHVybiByZXA7XG59XG5mdW5jdGlvbiBjcmVhdGVQcmludGVyKGNvbnQsIF9zdHJQYXJ0cywgX21hdGNoZXMsIF9yZXN1bHQgPSBcIlwiLCBwYWRBcmcgPSAtMSkge1xuICAgIHJldHVybiAoLi4uYXJncykgPT4ge1xuICAgICAgICAvLyBNYWtlIGNvcGllcyBvZiB0aGUgdmFsdWVzIHBhc3NlZCBieSByZWZlcmVuY2UgYmVjYXVzZSB0aGUgZnVuY3Rpb24gY2FuIGJlIHVzZWQgbXVsdGlwbGUgdGltZXNcbiAgICAgICAgbGV0IHJlc3VsdCA9IF9yZXN1bHQ7XG4gICAgICAgIGNvbnN0IHN0clBhcnRzID0gX3N0clBhcnRzLnNsaWNlKCk7XG4gICAgICAgIGNvbnN0IG1hdGNoZXMgPSBfbWF0Y2hlcy5zbGljZSgpO1xuICAgICAgICBmb3IgKGNvbnN0IGFyZyBvZiBhcmdzKSB7XG4gICAgICAgICAgICBjb25zdCBbLCAsIGZsYWdzLCBfcGFkTGVuZ3RoLCBwcmVjaXNpb24sIGZvcm1hdF0gPSBtYXRjaGVzWzBdO1xuICAgICAgICAgICAgbGV0IHBhZExlbmd0aCA9IF9wYWRMZW5ndGg7XG4gICAgICAgICAgICBpZiAocGFkQXJnID49IDApIHtcbiAgICAgICAgICAgICAgICBwYWRMZW5ndGggPSBwYWRBcmc7XG4gICAgICAgICAgICAgICAgcGFkQXJnID0gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwYWRMZW5ndGggPT09IFwiKlwiKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFyZyA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm9uLW5lZ2F0aXZlIG51bWJlciByZXF1aXJlZFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcGFkQXJnID0gYXJnO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVzdWx0ICs9IHN0clBhcnRzWzBdO1xuICAgICAgICAgICAgcmVzdWx0ICs9IGZvcm1hdFJlcGxhY2VtZW50KGFyZywgZmxhZ3MsIHBhZExlbmd0aCwgcHJlY2lzaW9uLCBmb3JtYXQpO1xuICAgICAgICAgICAgc3RyUGFydHMuc3BsaWNlKDAsIDEpO1xuICAgICAgICAgICAgbWF0Y2hlcy5zcGxpY2UoMCwgMSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1hdGNoZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXN1bHQgKz0gc3RyUGFydHNbMF07XG4gICAgICAgICAgICByZXR1cm4gY29udChyZXN1bHQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZVByaW50ZXIoY29udCwgc3RyUGFydHMsIG1hdGNoZXMsIHJlc3VsdCwgcGFkQXJnKTtcbiAgICAgICAgfVxuICAgIH07XG59XG5leHBvcnQgZnVuY3Rpb24gZnNGb3JtYXQoc3RyKSB7XG4gICAgcmV0dXJuIChjb250KSA9PiB7XG4gICAgICAgIGZzRm9ybWF0UmVnRXhwLmxhc3RJbmRleCA9IDA7XG4gICAgICAgIGNvbnN0IHN0clBhcnRzID0gW107XG4gICAgICAgIGNvbnN0IG1hdGNoZXMgPSBbXTtcbiAgICAgICAgbGV0IHN0cklkeCA9IDA7XG4gICAgICAgIGxldCBtYXRjaCA9IGZzRm9ybWF0UmVnRXhwLmV4ZWMoc3RyKTtcbiAgICAgICAgd2hpbGUgKG1hdGNoKSB7XG4gICAgICAgICAgICAvLyBUaGUgZmlyc3QgZ3JvdXAgY29ycmVzcG9uZHMgdG8gdGhlIG5vLWVzY2FwZSBjaGFyIChefFteJV0pLCB0aGUgYWN0dWFsIHBhdHRlcm4gc3RhcnRzIGluIHRoZSBuZXh0IGNoYXJcbiAgICAgICAgICAgIC8vIE5vdGU6IHdlIGRvbid0IHVzZSBuZWdhdGl2ZSBsb29rYmVoaW5kIGJlY2F1c2Ugc29tZSBicm93c2VycyBkb24ndCBzdXBwb3J0IGl0IHlldFxuICAgICAgICAgICAgY29uc3QgbWF0Y2hJbmRleCA9IG1hdGNoLmluZGV4ICsgKG1hdGNoWzFdIHx8IFwiXCIpLmxlbmd0aDtcbiAgICAgICAgICAgIHN0clBhcnRzLnB1c2goc3RyLnN1YnN0cmluZyhzdHJJZHgsIG1hdGNoSW5kZXgpLnJlcGxhY2UoLyUlL2csIFwiJVwiKSk7XG4gICAgICAgICAgICBtYXRjaGVzLnB1c2gobWF0Y2gpO1xuICAgICAgICAgICAgc3RySWR4ID0gZnNGb3JtYXRSZWdFeHAubGFzdEluZGV4O1xuICAgICAgICAgICAgLy8gTGlrZXdpc2Ugd2UgbmVlZCB0byBtb3ZlIGZzRm9ybWF0UmVnRXhwLmxhc3RJbmRleCBvbmUgY2hhciBiZWhpbmQgdG8gbWFrZSBzdXJlIHdlIG1hdGNoIHRoZSBuby1lc2NhcGUgY2hhciBuZXh0IHRpbWVcbiAgICAgICAgICAgIGZzRm9ybWF0UmVnRXhwLmxhc3RJbmRleCAtPSAxO1xuICAgICAgICAgICAgbWF0Y2ggPSBmc0Zvcm1hdFJlZ0V4cC5leGVjKHN0cik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN0clBhcnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGNvbnQoc3RyLnJlcGxhY2UoLyUlL2csIFwiJVwiKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzdHJQYXJ0cy5wdXNoKHN0ci5zdWJzdHJpbmcoc3RySWR4KS5yZXBsYWNlKC8lJS9nLCBcIiVcIikpO1xuICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZVByaW50ZXIoY29udCwgc3RyUGFydHMsIG1hdGNoZXMpO1xuICAgICAgICB9XG4gICAgfTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXQoc3RyLCAuLi5hcmdzKSB7XG4gICAgbGV0IHN0cjI7XG4gICAgaWYgKHR5cGVvZiBzdHIgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgLy8gQ2FsbGVkIHdpdGggY3VsdHVyZSBpbmZvXG4gICAgICAgIHN0cjIgPSBTdHJpbmcoYXJnc1swXSk7XG4gICAgICAgIGFyZ3Muc2hpZnQoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHN0cjIgPSBzdHI7XG4gICAgfVxuICAgIHJldHVybiBzdHIyLnJlcGxhY2UoZm9ybWF0UmVnRXhwLCAoXywgaWR4LCBwYWRMZW5ndGgsIGZvcm1hdCwgcHJlY2lzaW9uLCBwYXR0ZXJuKSA9PiB7XG4gICAgICAgIGlmIChpZHggPCAwIHx8IGlkeCA+PSBhcmdzLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW5kZXggbXVzdCBiZSBncmVhdGVyIG9yIGVxdWFsIHRvIHplcm8gYW5kIGxlc3MgdGhhbiB0aGUgYXJndW1lbnRzJyBsZW5ndGguXCIpO1xuICAgICAgICB9XG4gICAgICAgIGxldCByZXAgPSBhcmdzW2lkeF07XG4gICAgICAgIGlmIChpc051bWVyaWMocmVwKSkge1xuICAgICAgICAgICAgcHJlY2lzaW9uID0gcHJlY2lzaW9uID09IG51bGwgPyBudWxsIDogcGFyc2VJbnQocHJlY2lzaW9uLCAxMCk7XG4gICAgICAgICAgICBzd2l0Y2ggKGZvcm1hdCkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJmXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcIkZcIjpcbiAgICAgICAgICAgICAgICAgICAgcHJlY2lzaW9uID0gcHJlY2lzaW9uICE9IG51bGwgPyBwcmVjaXNpb24gOiAyO1xuICAgICAgICAgICAgICAgICAgICByZXAgPSB0b0ZpeGVkKHJlcCwgcHJlY2lzaW9uKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImdcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiR1wiOlxuICAgICAgICAgICAgICAgICAgICByZXAgPSBwcmVjaXNpb24gIT0gbnVsbCA/IHRvUHJlY2lzaW9uKHJlcCwgcHJlY2lzaW9uKSA6IHRvUHJlY2lzaW9uKHJlcCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJlXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcIkVcIjpcbiAgICAgICAgICAgICAgICAgICAgcmVwID0gcHJlY2lzaW9uICE9IG51bGwgPyB0b0V4cG9uZW50aWFsKHJlcCwgcHJlY2lzaW9uKSA6IHRvRXhwb25lbnRpYWwocmVwKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcInBcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiUFwiOlxuICAgICAgICAgICAgICAgICAgICBwcmVjaXNpb24gPSBwcmVjaXNpb24gIT0gbnVsbCA/IHByZWNpc2lvbiA6IDI7XG4gICAgICAgICAgICAgICAgICAgIHJlcCA9IHRvRml4ZWQobXVsdGlwbHkocmVwLCAxMDApLCBwcmVjaXNpb24pICsgXCIgJVwiO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJEXCI6XG4gICAgICAgICAgICAgICAgICAgIHJlcCA9IHByZWNpc2lvbiAhPSBudWxsID8gcGFkTGVmdChTdHJpbmcocmVwKSwgcHJlY2lzaW9uLCBcIjBcIikgOiBTdHJpbmcocmVwKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcInhcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiWFwiOlxuICAgICAgICAgICAgICAgICAgICByZXAgPSBwcmVjaXNpb24gIT0gbnVsbCA/IHBhZExlZnQodG9IZXgocmVwKSwgcHJlY2lzaW9uLCBcIjBcIikgOiB0b0hleChyZXApO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZm9ybWF0ID09PSBcIlhcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVwID0gcmVwLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhdHRlcm4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzaWduID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcCA9IHBhdHRlcm4ucmVwbGFjZSgvKFswIyxdKykoXFwuWzAjXSspPy8sIChfLCBpbnRQYXJ0LCBkZWNpbWFsUGFydCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0xlc3NUaGFuKHJlcCwgMCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwID0gbXVsdGlwbHkocmVwLCAtMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ24gPSBcIi1cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVjaW1hbFBhcnQgPSBkZWNpbWFsUGFydCA9PSBudWxsID8gXCJcIiA6IGRlY2ltYWxQYXJ0LnN1YnN0cmluZygxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXAgPSB0b0ZpeGVkKHJlcCwgTWF0aC5tYXgoZGVjaW1hbFBhcnQubGVuZ3RoLCAwKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IFtyZXBJbnQsIHJlcERlY2ltYWxdID0gcmVwLnNwbGl0KFwiLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBEZWNpbWFsIHx8IChyZXBEZWNpbWFsID0gXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGVmdFplcm9lcyA9IGludFBhcnQucmVwbGFjZSgvLC9nLCBcIlwiKS5yZXBsYWNlKC9eIysvLCBcIlwiKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwSW50ID0gcGFkTGVmdChyZXBJbnQsIGxlZnRaZXJvZXMsIFwiMFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByaWdodFplcm9zID0gZGVjaW1hbFBhcnQucmVwbGFjZSgvIyskLywgXCJcIikubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyaWdodFplcm9zID4gcmVwRGVjaW1hbC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwRGVjaW1hbCA9IHBhZFJpZ2h0KHJlcERlY2ltYWwsIHJpZ2h0WmVyb3MsIFwiMFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmlnaHRaZXJvcyA8IHJlcERlY2ltYWwubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcERlY2ltYWwgPSByZXBEZWNpbWFsLnN1YnN0cmluZygwLCByaWdodFplcm9zKSArIHJlcERlY2ltYWwuc3Vic3RyaW5nKHJpZ2h0WmVyb3MpLnJlcGxhY2UoLzArJC8sIFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaG91c2FuZHMgc2VwYXJhdG9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGludFBhcnQuaW5kZXhPZihcIixcIikgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGkgPSByZXBJbnQubGVuZ3RoICUgMztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGhvdXNhbmRHcm91cHMgPSBNYXRoLmZsb29yKHJlcEludC5sZW5ndGggLyAzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHRob3VzYW5kcyA9IGkgPiAwID8gcmVwSW50LnN1YnN0cigwLCBpKSArICh0aG91c2FuZEdyb3VwcyA+IDAgPyBcIixcIiA6IFwiXCIpIDogXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aG91c2FuZEdyb3VwczsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aG91c2FuZHMgKz0gcmVwSW50LnN1YnN0cihpICsgaiAqIDMsIDMpICsgKGogPCB0aG91c2FuZEdyb3VwcyAtIDEgPyBcIixcIiA6IFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcEludCA9IHRob3VzYW5kcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcERlY2ltYWwubGVuZ3RoID4gMCA/IHJlcEludCArIFwiLlwiICsgcmVwRGVjaW1hbCA6IHJlcEludDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVwID0gc2lnbiArIHJlcDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHJlcCBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgICAgICAgIHJlcCA9IGRhdGVUb1N0cmluZyhyZXAsIHBhdHRlcm4gfHwgZm9ybWF0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJlcCA9IHRvU3RyaW5nKHJlcCk7XG4gICAgICAgIH1cbiAgICAgICAgcGFkTGVuZ3RoID0gcGFyc2VJbnQoKHBhZExlbmd0aCB8fCBcIiBcIikuc3Vic3RyaW5nKDEpLCAxMCk7XG4gICAgICAgIGlmICghaXNOYU4ocGFkTGVuZ3RoKSkge1xuICAgICAgICAgICAgcmVwID0gcGFkKFN0cmluZyhyZXApLCBNYXRoLmFicyhwYWRMZW5ndGgpLCBcIiBcIiwgcGFkTGVuZ3RoIDwgMCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlcDtcbiAgICB9KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBlbmRzV2l0aChzdHIsIHNlYXJjaCkge1xuICAgIGNvbnN0IGlkeCA9IHN0ci5sYXN0SW5kZXhPZihzZWFyY2gpO1xuICAgIHJldHVybiBpZHggPj0gMCAmJiBpZHggPT09IHN0ci5sZW5ndGggLSBzZWFyY2gubGVuZ3RoO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGluaXRpYWxpemUobiwgZikge1xuICAgIGlmIChuIDwgMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTdHJpbmcgbGVuZ3RoIG11c3QgYmUgbm9uLW5lZ2F0aXZlXCIpO1xuICAgIH1cbiAgICBjb25zdCB4cyA9IG5ldyBBcnJheShuKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG47IGkrKykge1xuICAgICAgICB4c1tpXSA9IGYoaSk7XG4gICAgfVxuICAgIHJldHVybiB4cy5qb2luKFwiXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGluc2VydChzdHIsIHN0YXJ0SW5kZXgsIHZhbHVlKSB7XG4gICAgaWYgKHN0YXJ0SW5kZXggPCAwIHx8IHN0YXJ0SW5kZXggPiBzdHIubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcInN0YXJ0SW5kZXggaXMgbmVnYXRpdmUgb3IgZ3JlYXRlciB0aGFuIHRoZSBsZW5ndGggb2YgdGhpcyBpbnN0YW5jZS5cIik7XG4gICAgfVxuICAgIHJldHVybiBzdHIuc3Vic3RyaW5nKDAsIHN0YXJ0SW5kZXgpICsgdmFsdWUgKyBzdHIuc3Vic3RyaW5nKHN0YXJ0SW5kZXgpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGlzTnVsbE9yRW1wdHkoc3RyKSB7XG4gICAgcmV0dXJuIHR5cGVvZiBzdHIgIT09IFwic3RyaW5nXCIgfHwgc3RyLmxlbmd0aCA9PT0gMDtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpc051bGxPcldoaXRlU3BhY2Uoc3RyKSB7XG4gICAgcmV0dXJuIHR5cGVvZiBzdHIgIT09IFwic3RyaW5nXCIgfHwgL15cXHMqJC8udGVzdChzdHIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGNvbmNhdCguLi54cykge1xuICAgIHJldHVybiB4cy5tYXAoKHgpID0+IFN0cmluZyh4KSkuam9pbihcIlwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBqb2luKGRlbGltaXRlciwgeHMpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheSh4cykpIHtcbiAgICAgICAgcmV0dXJuIHhzLmpvaW4oZGVsaW1pdGVyKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKHhzKS5qb2luKGRlbGltaXRlcik7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGpvaW5XaXRoSW5kaWNlcyhkZWxpbWl0ZXIsIHhzLCBzdGFydEluZGV4LCBjb3VudCkge1xuICAgIGNvbnN0IGVuZEluZGV4UGx1c09uZSA9IHN0YXJ0SW5kZXggKyBjb3VudDtcbiAgICBpZiAoZW5kSW5kZXhQbHVzT25lID4geHMubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkluZGV4IGFuZCBjb3VudCBtdXN0IHJlZmVyIHRvIGEgbG9jYXRpb24gd2l0aGluIHRoZSBidWZmZXIuXCIpO1xuICAgIH1cbiAgICByZXR1cm4geHMuc2xpY2Uoc3RhcnRJbmRleCwgZW5kSW5kZXhQbHVzT25lKS5qb2luKGRlbGltaXRlcik7XG59XG5mdW5jdGlvbiBub3RTdXBwb3J0ZWQobmFtZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIlRoZSBlbnZpcm9ubWVudCBkb2Vzbid0IHN1cHBvcnQgJ1wiICsgbmFtZSArIFwiJywgcGxlYXNlIHVzZSBhIHBvbHlmaWxsLlwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b0Jhc2U2NFN0cmluZyhpbkFycmF5KSB7XG4gICAgbGV0IHN0ciA9IFwiXCI7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbkFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHN0ciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGluQXJyYXlbaV0pO1xuICAgIH1cbiAgICByZXR1cm4gdHlwZW9mIGJ0b2EgPT09IFwiZnVuY3Rpb25cIiA/IGJ0b2Eoc3RyKSA6IG5vdFN1cHBvcnRlZChcImJ0b2FcIik7XG59XG5leHBvcnQgZnVuY3Rpb24gZnJvbUJhc2U2NFN0cmluZyhiNjRFbmNvZGVkKSB7XG4gICAgY29uc3QgYmluYXJ5ID0gdHlwZW9mIGF0b2IgPT09IFwiZnVuY3Rpb25cIiA/IGF0b2IoYjY0RW5jb2RlZCkgOiBub3RTdXBwb3J0ZWQoXCJhdG9iXCIpO1xuICAgIGNvbnN0IGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYmluYXJ5Lmxlbmd0aCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBiaW5hcnkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgYnl0ZXNbaV0gPSBiaW5hcnkuY2hhckNvZGVBdChpKTtcbiAgICB9XG4gICAgcmV0dXJuIGJ5dGVzO1xufVxuZnVuY3Rpb24gcGFkKHN0ciwgbGVuLCBjaCwgaXNSaWdodCkge1xuICAgIGNoID0gY2ggfHwgXCIgXCI7XG4gICAgbGVuID0gbGVuIC0gc3RyLmxlbmd0aDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIHN0ciA9IGlzUmlnaHQgPyBzdHIgKyBjaCA6IGNoICsgc3RyO1xuICAgIH1cbiAgICByZXR1cm4gc3RyO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHBhZExlZnQoc3RyLCBsZW4sIGNoKSB7XG4gICAgcmV0dXJuIHBhZChzdHIsIGxlbiwgY2gpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHBhZFJpZ2h0KHN0ciwgbGVuLCBjaCkge1xuICAgIHJldHVybiBwYWQoc3RyLCBsZW4sIGNoLCB0cnVlKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiByZW1vdmUoc3RyLCBzdGFydEluZGV4LCBjb3VudCkge1xuICAgIGlmIChzdGFydEluZGV4ID49IHN0ci5sZW5ndGgpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwic3RhcnRJbmRleCBtdXN0IGJlIGxlc3MgdGhhbiBsZW5ndGggb2Ygc3RyaW5nXCIpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGNvdW50ID09PSBcIm51bWJlclwiICYmIChzdGFydEluZGV4ICsgY291bnQpID4gc3RyLmxlbmd0aCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbmRleCBhbmQgY291bnQgbXVzdCByZWZlciB0byBhIGxvY2F0aW9uIHdpdGhpbiB0aGUgc3RyaW5nLlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIHN0ci5zbGljZSgwLCBzdGFydEluZGV4KSArICh0eXBlb2YgY291bnQgPT09IFwibnVtYmVyXCIgPyBzdHIuc3Vic3RyKHN0YXJ0SW5kZXggKyBjb3VudCkgOiBcIlwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiByZXBsYWNlKHN0ciwgc2VhcmNoLCByZXBsYWNlKSB7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKG5ldyBSZWdFeHAoZXNjYXBlKHNlYXJjaCksIFwiZ1wiKSwgcmVwbGFjZSk7XG59XG5leHBvcnQgZnVuY3Rpb24gcmVwbGljYXRlKG4sIHgpIHtcbiAgICByZXR1cm4gaW5pdGlhbGl6ZShuLCAoKSA9PiB4KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBnZXRDaGFyQXRJbmRleChpbnB1dCwgaW5kZXgpIHtcbiAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49IGlucHV0Lmxlbmd0aCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbmRleCB3YXMgb3V0c2lkZSB0aGUgYm91bmRzIG9mIHRoZSBhcnJheS5cIik7XG4gICAgfVxuICAgIHJldHVybiBpbnB1dFtpbmRleF07XG59XG5leHBvcnQgZnVuY3Rpb24gc3BsaXQoc3RyLCBzcGxpdHRlcnMsIGNvdW50LCBvcHRpb25zKSB7XG4gICAgY291bnQgPSB0eXBlb2YgY291bnQgPT09IFwibnVtYmVyXCIgPyBjb3VudCA6IHVuZGVmaW5lZDtcbiAgICBvcHRpb25zID0gdHlwZW9mIG9wdGlvbnMgPT09IFwibnVtYmVyXCIgPyBvcHRpb25zIDogMDtcbiAgICBpZiAoY291bnQgJiYgY291bnQgPCAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNvdW50IGNhbm5vdCBiZSBsZXNzIHRoYW4gemVyb1wiKTtcbiAgICB9XG4gICAgaWYgKGNvdW50ID09PSAwKSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgY29uc3QgcmVtb3ZlRW1wdHkgPSAob3B0aW9ucyAmIDEpID09PSAxO1xuICAgIGNvbnN0IHRyaW0gPSAob3B0aW9ucyAmIDIpID09PSAyO1xuICAgIHNwbGl0dGVycyA9IHNwbGl0dGVycyB8fCBbXTtcbiAgICBzcGxpdHRlcnMgPSBzcGxpdHRlcnMuZmlsdGVyKHggPT4geCkubWFwKGVzY2FwZSk7XG4gICAgc3BsaXR0ZXJzID0gc3BsaXR0ZXJzLmxlbmd0aCA+IDAgPyBzcGxpdHRlcnMgOiBbXCJcXFxcc1wiXTtcbiAgICBjb25zdCBzcGxpdHMgPSBbXTtcbiAgICBjb25zdCByZWcgPSBuZXcgUmVnRXhwKHNwbGl0dGVycy5qb2luKFwifFwiKSwgXCJnXCIpO1xuICAgIGxldCBmaW5kU3BsaXRzID0gdHJ1ZTtcbiAgICBsZXQgaSA9IDA7XG4gICAgZG8ge1xuICAgICAgICBjb25zdCBtYXRjaCA9IHJlZy5leGVjKHN0cik7XG4gICAgICAgIGlmIChtYXRjaCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgY29uc3QgY2FuZGlkYXRlID0gdHJpbSA/IHN0ci5zdWJzdHJpbmcoaSkudHJpbSgpIDogc3RyLnN1YnN0cmluZyhpKTtcbiAgICAgICAgICAgIGlmICghcmVtb3ZlRW1wdHkgfHwgY2FuZGlkYXRlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBzcGxpdHMucHVzaChjYW5kaWRhdGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZmluZFNwbGl0cyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgY2FuZGlkYXRlID0gdHJpbSA/IHN0ci5zdWJzdHJpbmcoaSwgbWF0Y2guaW5kZXgpLnRyaW0oKSA6IHN0ci5zdWJzdHJpbmcoaSwgbWF0Y2guaW5kZXgpO1xuICAgICAgICAgICAgaWYgKCFyZW1vdmVFbXB0eSB8fCBjYW5kaWRhdGUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGlmIChjb3VudCAhPSBudWxsICYmIHNwbGl0cy5sZW5ndGggKyAxID09PSBjb3VudCkge1xuICAgICAgICAgICAgICAgICAgICBzcGxpdHMucHVzaCh0cmltID8gc3RyLnN1YnN0cmluZyhpKS50cmltKCkgOiBzdHIuc3Vic3RyaW5nKGkpKTtcbiAgICAgICAgICAgICAgICAgICAgZmluZFNwbGl0cyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc3BsaXRzLnB1c2goY2FuZGlkYXRlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpID0gcmVnLmxhc3RJbmRleDtcbiAgICAgICAgfVxuICAgIH0gd2hpbGUgKGZpbmRTcGxpdHMpO1xuICAgIHJldHVybiBzcGxpdHM7XG59XG5leHBvcnQgZnVuY3Rpb24gdHJpbShzdHIsIC4uLmNoYXJzKSB7XG4gICAgaWYgKGNoYXJzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gc3RyLnRyaW0oKTtcbiAgICB9XG4gICAgY29uc3QgcGF0dGVybiA9IFwiW1wiICsgZXNjYXBlKGNoYXJzLmpvaW4oXCJcIikpICsgXCJdK1wiO1xuICAgIHJldHVybiBzdHIucmVwbGFjZShuZXcgUmVnRXhwKFwiXlwiICsgcGF0dGVybiksIFwiXCIpLnJlcGxhY2UobmV3IFJlZ0V4cChwYXR0ZXJuICsgXCIkXCIpLCBcIlwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0cmltU3RhcnQoc3RyLCAuLi5jaGFycykge1xuICAgIHJldHVybiBjaGFycy5sZW5ndGggPT09IDBcbiAgICAgICAgPyBzdHIudHJpbVN0YXJ0KClcbiAgICAgICAgOiBzdHIucmVwbGFjZShuZXcgUmVnRXhwKFwiXltcIiArIGVzY2FwZShjaGFycy5qb2luKFwiXCIpKSArIFwiXStcIiksIFwiXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRyaW1FbmQoc3RyLCAuLi5jaGFycykge1xuICAgIHJldHVybiBjaGFycy5sZW5ndGggPT09IDBcbiAgICAgICAgPyBzdHIudHJpbUVuZCgpXG4gICAgICAgIDogc3RyLnJlcGxhY2UobmV3IFJlZ0V4cChcIltcIiArIGVzY2FwZShjaGFycy5qb2luKFwiXCIpKSArIFwiXSskXCIpLCBcIlwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBmaWx0ZXIocHJlZCwgeCkge1xuICAgIHJldHVybiB4LnNwbGl0KFwiXCIpLmZpbHRlcigoYykgPT4gcHJlZChjKSkuam9pbihcIlwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBzdWJzdHJpbmcoc3RyLCBzdGFydEluZGV4LCBsZW5ndGgpIHtcbiAgICBpZiAoKHN0YXJ0SW5kZXggKyAobGVuZ3RoIHx8IDApID4gc3RyLmxlbmd0aCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBzdGFydEluZGV4IGFuZC9vciBsZW5ndGhcIik7XG4gICAgfVxuICAgIHJldHVybiBsZW5ndGggIT0gbnVsbCA/IHN0ci5zdWJzdHIoc3RhcnRJbmRleCwgbGVuZ3RoKSA6IHN0ci5zdWJzdHIoc3RhcnRJbmRleCk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9DaGFyQXJyYXkyKHN0ciwgc3RhcnRJbmRleCwgbGVuZ3RoKSB7XG4gICAgcmV0dXJuIHN1YnN0cmluZyhzdHIsIHN0YXJ0SW5kZXgsIGxlbmd0aCkuc3BsaXQoXCJcIik7XG59XG5leHBvcnQgZnVuY3Rpb24gZm10KHN0cnMsIC4uLmFyZ3MpIHtcbiAgICByZXR1cm4gKHsgc3RycywgYXJncyB9KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBmbXRXaXRoKGZtdHMpIHtcbiAgICByZXR1cm4gKHN0cnMsIC4uLmFyZ3MpID0+ICh7IHN0cnMsIGFyZ3MsIGZtdHMgfSk7XG59XG5leHBvcnQgZnVuY3Rpb24gZ2V0Rm9ybWF0KHMpIHtcbiAgICByZXR1cm4gcy5mbXRzXG4gICAgICAgID8gcy5zdHJzLnJlZHVjZSgoYWNjLCBuZXdQYXJ0LCBpbmRleCkgPT4gYWNjICsgYHske1N0cmluZyhpbmRleCAtIDEpICsgcy5mbXRzW2luZGV4IC0gMV19fWAgKyBuZXdQYXJ0KVxuICAgICAgICA6IHMuc3Rycy5yZWR1Y2UoKGFjYywgbmV3UGFydCwgaW5kZXgpID0+IGFjYyArIGB7JHtpbmRleCAtIDF9fWAgKyBuZXdQYXJ0KTtcbn1cbiIsCiAgImltcG9ydCB7IHRvU3RyaW5nIGFzIGRhdGVUb1N0cmluZyB9IGZyb20gXCIuL0RhdGUuanNcIjtcbmltcG9ydCB7IGNvbXBhcmUgYXMgbnVtZXJpY0NvbXBhcmUsIGlzTnVtZXJpYywgbXVsdGlwbHksIHRvRXhwb25lbnRpYWwsIHRvRml4ZWQsIHRvSGV4LCB0b1ByZWNpc2lvbiB9IGZyb20gXCIuL051bWVyaWMuanNcIjtcbmltcG9ydCB7IGVzY2FwZSB9IGZyb20gXCIuL1JlZ0V4cC5qc1wiO1xuaW1wb3J0IHsgdG9TdHJpbmcgfSBmcm9tIFwiLi9UeXBlcy5qc1wiO1xuY29uc3QgZnNGb3JtYXRSZWdFeHAgPSAvKF58W14lXSklKFswK1xcLSBdKikoXFwqfFxcZCspPyg/OlxcLihcXGQrKSk/KFxcdykvZztcbmNvbnN0IGludGVycG9sYXRlUmVnRXhwID0gLyg/OihefFteJV0pJShbMCtcXC0gXSopKFxcZCspPyg/OlxcLihcXGQrKSk/KFxcdykpPyVQXFwoXFwpL2c7XG5jb25zdCBmb3JtYXRSZWdFeHAgPSAvXFx7KFxcZCspKCwtP1xcZCspPyg/OlxcOihbYS16QS1aXSkoXFxkezAsMn0pfFxcOiguKz8pKT9cXH0vZztcbmZ1bmN0aW9uIGlzTGVzc1RoYW4oeCwgeSkge1xuICAgIHJldHVybiBudW1lcmljQ29tcGFyZSh4LCB5KSA8IDA7XG59XG5mdW5jdGlvbiBjbXAoeCwgeSwgaWMpIHtcbiAgICBmdW5jdGlvbiBpc0lnbm9yZUNhc2UoaSkge1xuICAgICAgICByZXR1cm4gaSA9PT0gdHJ1ZSB8fFxuICAgICAgICAgICAgaSA9PT0gMSAvKiBTdHJpbmdDb21wYXJpc29uLkN1cnJlbnRDdWx0dXJlSWdub3JlQ2FzZSAqLyB8fFxuICAgICAgICAgICAgaSA9PT0gMyAvKiBTdHJpbmdDb21wYXJpc29uLkludmFyaWFudEN1bHR1cmVJZ25vcmVDYXNlICovIHx8XG4gICAgICAgICAgICBpID09PSA1IC8qIFN0cmluZ0NvbXBhcmlzb24uT3JkaW5hbElnbm9yZUNhc2UgKi87XG4gICAgfVxuICAgIGZ1bmN0aW9uIGlzT3JkaW5hbChpKSB7XG4gICAgICAgIHJldHVybiBpID09PSA0IC8qIFN0cmluZ0NvbXBhcmlzb24uT3JkaW5hbCAqLyB8fFxuICAgICAgICAgICAgaSA9PT0gNSAvKiBTdHJpbmdDb21wYXJpc29uLk9yZGluYWxJZ25vcmVDYXNlICovO1xuICAgIH1cbiAgICBpZiAoeCA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiB5ID09IG51bGwgPyAwIDogLTE7XG4gICAgfVxuICAgIGlmICh5ID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIDE7XG4gICAgfSAvLyBldmVyeXRoaW5nIGlzIGJpZ2dlciB0aGFuIG51bGxcbiAgICBpZiAoaXNPcmRpbmFsKGljKSkge1xuICAgICAgICBpZiAoaXNJZ25vcmVDYXNlKGljKSkge1xuICAgICAgICAgICAgeCA9IHgudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIHkgPSB5LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICh4ID09PSB5KSA/IDAgOiAoeCA8IHkgPyAtMSA6IDEpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKGlzSWdub3JlQ2FzZShpYykpIHtcbiAgICAgICAgICAgIHggPSB4LnRvTG9jYWxlTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICB5ID0geS50b0xvY2FsZUxvd2VyQ2FzZSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB4LmxvY2FsZUNvbXBhcmUoeSk7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBhcmUoLi4uYXJncykge1xuICAgIHN3aXRjaCAoYXJncy5sZW5ndGgpIHtcbiAgICAgICAgY2FzZSAyOiByZXR1cm4gY21wKGFyZ3NbMF0sIGFyZ3NbMV0sIGZhbHNlKTtcbiAgICAgICAgY2FzZSAzOiByZXR1cm4gY21wKGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0pO1xuICAgICAgICBjYXNlIDQ6IHJldHVybiBjbXAoYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSA9PT0gdHJ1ZSk7XG4gICAgICAgIGNhc2UgNTogcmV0dXJuIGNtcChhcmdzWzBdLnN1YnN0cihhcmdzWzFdLCBhcmdzWzRdKSwgYXJnc1syXS5zdWJzdHIoYXJnc1szXSwgYXJnc1s0XSksIGZhbHNlKTtcbiAgICAgICAgY2FzZSA2OiByZXR1cm4gY21wKGFyZ3NbMF0uc3Vic3RyKGFyZ3NbMV0sIGFyZ3NbNF0pLCBhcmdzWzJdLnN1YnN0cihhcmdzWzNdLCBhcmdzWzRdKSwgYXJnc1s1XSk7XG4gICAgICAgIGNhc2UgNzogcmV0dXJuIGNtcChhcmdzWzBdLnN1YnN0cihhcmdzWzFdLCBhcmdzWzRdKSwgYXJnc1syXS5zdWJzdHIoYXJnc1szXSwgYXJnc1s0XSksIGFyZ3NbNV0gPT09IHRydWUpO1xuICAgICAgICBkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoXCJTdHJpbmcuY29tcGFyZTogVW5zdXBwb3J0ZWQgbnVtYmVyIG9mIHBhcmFtZXRlcnNcIik7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBhcmVPcmRpbmFsKHgsIHkpIHtcbiAgICByZXR1cm4gY21wKHgsIHksIDQgLyogU3RyaW5nQ29tcGFyaXNvbi5PcmRpbmFsICovKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBjb21wYXJlVG8oeCwgeSkge1xuICAgIHJldHVybiBjbXAoeCwgeSwgMCAvKiBTdHJpbmdDb21wYXJpc29uLkN1cnJlbnRDdWx0dXJlICovKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBzdGFydHNXaXRoKHN0ciwgcGF0dGVybiwgaWMpIHtcbiAgICBpZiAoc3RyLmxlbmd0aCA+PSBwYXR0ZXJuLmxlbmd0aCkge1xuICAgICAgICByZXR1cm4gY21wKHN0ci5zdWJzdHIoMCwgcGF0dGVybi5sZW5ndGgpLCBwYXR0ZXJuLCBpYykgPT09IDA7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpbmRleE9mQW55KHN0ciwgYW55T2YsIC4uLmFyZ3MpIHtcbiAgICBpZiAoc3RyID09IG51bGwgfHwgc3RyID09PSBcIlwiKSB7XG4gICAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gICAgY29uc3Qgc3RhcnRJbmRleCA9IChhcmdzLmxlbmd0aCA+IDApID8gYXJnc1swXSA6IDA7XG4gICAgaWYgKHN0YXJ0SW5kZXggPCAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlN0YXJ0IGluZGV4IGNhbm5vdCBiZSBuZWdhdGl2ZVwiKTtcbiAgICB9XG4gICAgY29uc3QgbGVuZ3RoID0gKGFyZ3MubGVuZ3RoID4gMSkgPyBhcmdzWzFdIDogc3RyLmxlbmd0aCAtIHN0YXJ0SW5kZXg7XG4gICAgaWYgKGxlbmd0aCA8IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTGVuZ3RoIGNhbm5vdCBiZSBuZWdhdGl2ZVwiKTtcbiAgICB9XG4gICAgaWYgKHN0YXJ0SW5kZXggKyBsZW5ndGggPiBzdHIubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgc3RhcnRJbmRleCBhbmQgbGVuZ3RoXCIpO1xuICAgIH1cbiAgICBjb25zdCBlbmRJbmRleCA9IHN0YXJ0SW5kZXggKyBsZW5ndGg7XG4gICAgY29uc3QgYW55T2ZBc1N0ciA9IFwiXCIuY29uY2F0LmFwcGx5KFwiXCIsIGFueU9mKTtcbiAgICBmb3IgKGxldCBpID0gc3RhcnRJbmRleDsgaSA8IGVuZEluZGV4OyBpKyspIHtcbiAgICAgICAgaWYgKGFueU9mQXNTdHIuaW5kZXhPZihzdHJbaV0pID4gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiAtMTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBwcmludGYoaW5wdXQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBpbnB1dCxcbiAgICAgICAgY29udDogZnNGb3JtYXQoaW5wdXQpLFxuICAgIH07XG59XG5leHBvcnQgZnVuY3Rpb24gaW50ZXJwb2xhdGUoc3RyLCB2YWx1ZXMpIHtcbiAgICBsZXQgdmFsSWR4ID0gMDtcbiAgICBsZXQgc3RySWR4ID0gMDtcbiAgICBsZXQgcmVzdWx0ID0gXCJcIjtcbiAgICBpbnRlcnBvbGF0ZVJlZ0V4cC5sYXN0SW5kZXggPSAwO1xuICAgIGxldCBtYXRjaCA9IGludGVycG9sYXRlUmVnRXhwLmV4ZWMoc3RyKTtcbiAgICB3aGlsZSAobWF0Y2gpIHtcbiAgICAgICAgLy8gVGhlIGZpcnN0IGdyb3VwIGNvcnJlc3BvbmRzIHRvIHRoZSBuby1lc2NhcGUgY2hhciAoXnxbXiVdKSwgdGhlIGFjdHVhbCBwYXR0ZXJuIHN0YXJ0cyBpbiB0aGUgbmV4dCBjaGFyXG4gICAgICAgIC8vIE5vdGU6IHdlIGRvbid0IHVzZSBuZWdhdGl2ZSBsb29rYmVoaW5kIGJlY2F1c2Ugc29tZSBicm93c2VycyBkb24ndCBzdXBwb3J0IGl0IHlldFxuICAgICAgICBjb25zdCBtYXRjaEluZGV4ID0gbWF0Y2guaW5kZXggKyAobWF0Y2hbMV0gfHwgXCJcIikubGVuZ3RoO1xuICAgICAgICByZXN1bHQgKz0gc3RyLnN1YnN0cmluZyhzdHJJZHgsIG1hdGNoSW5kZXgpLnJlcGxhY2UoLyUlL2csIFwiJVwiKTtcbiAgICAgICAgY29uc3QgWywgLCBmbGFncywgcGFkTGVuZ3RoLCBwcmVjaXNpb24sIGZvcm1hdF0gPSBtYXRjaDtcbiAgICAgICAgLy8gU2F2ZSBpbnRlcnBvbGF0ZVJlZ0V4cC5sYXN0SW5kZXggYmVmb3JlIHJ1bm5pbmcgZm9ybWF0UmVwbGFjZW1lbnQgYmVjYXVzZSB0aGUgdmFsdWVzXG4gICAgICAgIC8vIG1heSBhbHNvIGludm9sdmUgaW50ZXJwb2xhdGlvbiBhbmQgbWFrZSB1c2Ugb2YgaW50ZXJwb2xhdGVSZWdFeHAgKHNlZSAjMzA3OClcbiAgICAgICAgc3RySWR4ID0gaW50ZXJwb2xhdGVSZWdFeHAubGFzdEluZGV4O1xuICAgICAgICByZXN1bHQgKz0gZm9ybWF0UmVwbGFjZW1lbnQodmFsdWVzW3ZhbElkeCsrXSwgZmxhZ3MsIHBhZExlbmd0aCwgcHJlY2lzaW9uLCBmb3JtYXQpO1xuICAgICAgICAvLyBNb3ZlIGludGVycG9sYXRlUmVnRXhwLmxhc3RJbmRleCBvbmUgY2hhciBiZWhpbmQgdG8gbWFrZSBzdXJlIHdlIG1hdGNoIHRoZSBuby1lc2NhcGUgY2hhciBuZXh0IHRpbWVcbiAgICAgICAgaW50ZXJwb2xhdGVSZWdFeHAubGFzdEluZGV4ID0gc3RySWR4IC0gMTtcbiAgICAgICAgbWF0Y2ggPSBpbnRlcnBvbGF0ZVJlZ0V4cC5leGVjKHN0cik7XG4gICAgfVxuICAgIHJlc3VsdCArPSBzdHIuc3Vic3RyaW5nKHN0cklkeCkucmVwbGFjZSgvJSUvZywgXCIlXCIpO1xuICAgIHJldHVybiByZXN1bHQ7XG59XG5mdW5jdGlvbiBjb250aW51ZVByaW50KGNvbnQsIGFyZykge1xuICAgIHJldHVybiB0eXBlb2YgYXJnID09PSBcInN0cmluZ1wiID8gY29udChhcmcpIDogYXJnLmNvbnQoY29udCk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9Db25zb2xlKGFyZykge1xuICAgIC8vIERvbid0IHJlbW92ZSB0aGUgbGFtYmRhIGhlcmUsIHNlZSAjMTM1N1xuICAgIHJldHVybiBjb250aW51ZVByaW50KCh4KSA9PiBjb25zb2xlLmxvZyh4KSwgYXJnKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b0NvbnNvbGVFcnJvcihhcmcpIHtcbiAgICByZXR1cm4gY29udGludWVQcmludCgoeCkgPT4gY29uc29sZS5lcnJvcih4KSwgYXJnKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b1RleHQoYXJnKSB7XG4gICAgcmV0dXJuIGNvbnRpbnVlUHJpbnQoKHgpID0+IHgsIGFyZyk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9GYWlsKGFyZykge1xuICAgIHJldHVybiBjb250aW51ZVByaW50KCh4KSA9PiB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcih4KTtcbiAgICB9LCBhcmcpO1xufVxuZnVuY3Rpb24gZm9ybWF0UmVwbGFjZW1lbnQocmVwLCBmbGFncywgcGFkTGVuZ3RoLCBwcmVjaXNpb24sIGZvcm1hdCkge1xuICAgIGxldCBzaWduID0gXCJcIjtcbiAgICBmbGFncyA9IGZsYWdzIHx8IFwiXCI7XG4gICAgZm9ybWF0ID0gZm9ybWF0IHx8IFwiXCI7XG4gICAgaWYgKGlzTnVtZXJpYyhyZXApKSB7XG4gICAgICAgIGlmIChmb3JtYXQudG9Mb3dlckNhc2UoKSAhPT0gXCJ4XCIpIHtcbiAgICAgICAgICAgIGlmIChpc0xlc3NUaGFuKHJlcCwgMCkpIHtcbiAgICAgICAgICAgICAgICByZXAgPSBtdWx0aXBseShyZXAsIC0xKTtcbiAgICAgICAgICAgICAgICBzaWduID0gXCItXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoZmxhZ3MuaW5kZXhPZihcIiBcIikgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICBzaWduID0gXCIgXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGZsYWdzLmluZGV4T2YoXCIrXCIpID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgc2lnbiA9IFwiK1wiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBwcmVjaXNpb24gPSBwcmVjaXNpb24gPT0gbnVsbCA/IG51bGwgOiBwYXJzZUludChwcmVjaXNpb24sIDEwKTtcbiAgICAgICAgc3dpdGNoIChmb3JtYXQpIHtcbiAgICAgICAgICAgIGNhc2UgXCJmXCI6XG4gICAgICAgICAgICBjYXNlIFwiRlwiOlxuICAgICAgICAgICAgICAgIHByZWNpc2lvbiA9IHByZWNpc2lvbiAhPSBudWxsID8gcHJlY2lzaW9uIDogNjtcbiAgICAgICAgICAgICAgICByZXAgPSB0b0ZpeGVkKHJlcCwgcHJlY2lzaW9uKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJnXCI6XG4gICAgICAgICAgICBjYXNlIFwiR1wiOlxuICAgICAgICAgICAgICAgIHJlcCA9IHByZWNpc2lvbiAhPSBudWxsID8gdG9QcmVjaXNpb24ocmVwLCBwcmVjaXNpb24pIDogdG9QcmVjaXNpb24ocmVwKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJlXCI6XG4gICAgICAgICAgICBjYXNlIFwiRVwiOlxuICAgICAgICAgICAgICAgIHJlcCA9IHByZWNpc2lvbiAhPSBudWxsID8gdG9FeHBvbmVudGlhbChyZXAsIHByZWNpc2lvbikgOiB0b0V4cG9uZW50aWFsKHJlcCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwieFwiOlxuICAgICAgICAgICAgICAgIHJlcCA9IHRvSGV4KHJlcCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiWFwiOlxuICAgICAgICAgICAgICAgIHJlcCA9IHRvSGV4KHJlcCkudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6IC8vIEFPaWRcbiAgICAgICAgICAgICAgICByZXAgPSBTdHJpbmcocmVwKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmIChyZXAgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICAgIHJlcCA9IGRhdGVUb1N0cmluZyhyZXApO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmVwID0gdG9TdHJpbmcocmVwKTtcbiAgICB9XG4gICAgcGFkTGVuZ3RoID0gdHlwZW9mIHBhZExlbmd0aCA9PT0gXCJudW1iZXJcIiA/IHBhZExlbmd0aCA6IHBhcnNlSW50KHBhZExlbmd0aCwgMTApO1xuICAgIGlmICghaXNOYU4ocGFkTGVuZ3RoKSkge1xuICAgICAgICBjb25zdCB6ZXJvRmxhZyA9IGZsYWdzLmluZGV4T2YoXCIwXCIpID49IDA7IC8vIFVzZSAnMCcgZm9yIGxlZnQgcGFkZGluZ1xuICAgICAgICBjb25zdCBtaW51c0ZsYWcgPSBmbGFncy5pbmRleE9mKFwiLVwiKSA+PSAwOyAvLyBSaWdodCBwYWRkaW5nXG4gICAgICAgIGNvbnN0IGNoID0gbWludXNGbGFnIHx8ICF6ZXJvRmxhZyA/IFwiIFwiIDogXCIwXCI7XG4gICAgICAgIGlmIChjaCA9PT0gXCIwXCIpIHtcbiAgICAgICAgICAgIHJlcCA9IHBhZChyZXAsIHBhZExlbmd0aCAtIHNpZ24ubGVuZ3RoLCBjaCwgbWludXNGbGFnKTtcbiAgICAgICAgICAgIHJlcCA9IHNpZ24gKyByZXA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXAgPSBwYWQoc2lnbiArIHJlcCwgcGFkTGVuZ3RoLCBjaCwgbWludXNGbGFnKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmVwID0gc2lnbiArIHJlcDtcbiAgICB9XG4gICAgcmV0dXJuIHJlcDtcbn1cbmZ1bmN0aW9uIGNyZWF0ZVByaW50ZXIoY29udCwgX3N0clBhcnRzLCBfbWF0Y2hlcywgX3Jlc3VsdCA9IFwiXCIsIHBhZEFyZyA9IC0xKSB7XG4gICAgcmV0dXJuICguLi5hcmdzKSA9PiB7XG4gICAgICAgIC8vIE1ha2UgY29waWVzIG9mIHRoZSB2YWx1ZXMgcGFzc2VkIGJ5IHJlZmVyZW5jZSBiZWNhdXNlIHRoZSBmdW5jdGlvbiBjYW4gYmUgdXNlZCBtdWx0aXBsZSB0aW1lc1xuICAgICAgICBsZXQgcmVzdWx0ID0gX3Jlc3VsdDtcbiAgICAgICAgY29uc3Qgc3RyUGFydHMgPSBfc3RyUGFydHMuc2xpY2UoKTtcbiAgICAgICAgY29uc3QgbWF0Y2hlcyA9IF9tYXRjaGVzLnNsaWNlKCk7XG4gICAgICAgIGZvciAoY29uc3QgYXJnIG9mIGFyZ3MpIHtcbiAgICAgICAgICAgIGNvbnN0IFssICwgZmxhZ3MsIF9wYWRMZW5ndGgsIHByZWNpc2lvbiwgZm9ybWF0XSA9IG1hdGNoZXNbMF07XG4gICAgICAgICAgICBsZXQgcGFkTGVuZ3RoID0gX3BhZExlbmd0aDtcbiAgICAgICAgICAgIGlmIChwYWRBcmcgPj0gMCkge1xuICAgICAgICAgICAgICAgIHBhZExlbmd0aCA9IHBhZEFyZztcbiAgICAgICAgICAgICAgICBwYWRBcmcgPSAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHBhZExlbmd0aCA9PT0gXCIqXCIpIHtcbiAgICAgICAgICAgICAgICBpZiAoYXJnIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJOb24tbmVnYXRpdmUgbnVtYmVyIHJlcXVpcmVkXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBwYWRBcmcgPSBhcmc7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXN1bHQgKz0gc3RyUGFydHNbMF07XG4gICAgICAgICAgICByZXN1bHQgKz0gZm9ybWF0UmVwbGFjZW1lbnQoYXJnLCBmbGFncywgcGFkTGVuZ3RoLCBwcmVjaXNpb24sIGZvcm1hdCk7XG4gICAgICAgICAgICBzdHJQYXJ0cy5zcGxpY2UoMCwgMSk7XG4gICAgICAgICAgICBtYXRjaGVzLnNwbGljZSgwLCAxKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobWF0Y2hlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJlc3VsdCArPSBzdHJQYXJ0c1swXTtcbiAgICAgICAgICAgIHJldHVybiBjb250KHJlc3VsdCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlUHJpbnRlcihjb250LCBzdHJQYXJ0cywgbWF0Y2hlcywgcmVzdWx0LCBwYWRBcmcpO1xuICAgICAgICB9XG4gICAgfTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBmc0Zvcm1hdChzdHIpIHtcbiAgICByZXR1cm4gKGNvbnQpID0+IHtcbiAgICAgICAgZnNGb3JtYXRSZWdFeHAubGFzdEluZGV4ID0gMDtcbiAgICAgICAgY29uc3Qgc3RyUGFydHMgPSBbXTtcbiAgICAgICAgY29uc3QgbWF0Y2hlcyA9IFtdO1xuICAgICAgICBsZXQgc3RySWR4ID0gMDtcbiAgICAgICAgbGV0IG1hdGNoID0gZnNGb3JtYXRSZWdFeHAuZXhlYyhzdHIpO1xuICAgICAgICB3aGlsZSAobWF0Y2gpIHtcbiAgICAgICAgICAgIC8vIFRoZSBmaXJzdCBncm91cCBjb3JyZXNwb25kcyB0byB0aGUgbm8tZXNjYXBlIGNoYXIgKF58W14lXSksIHRoZSBhY3R1YWwgcGF0dGVybiBzdGFydHMgaW4gdGhlIG5leHQgY2hhclxuICAgICAgICAgICAgLy8gTm90ZTogd2UgZG9uJ3QgdXNlIG5lZ2F0aXZlIGxvb2tiZWhpbmQgYmVjYXVzZSBzb21lIGJyb3dzZXJzIGRvbid0IHN1cHBvcnQgaXQgeWV0XG4gICAgICAgICAgICBjb25zdCBtYXRjaEluZGV4ID0gbWF0Y2guaW5kZXggKyAobWF0Y2hbMV0gfHwgXCJcIikubGVuZ3RoO1xuICAgICAgICAgICAgc3RyUGFydHMucHVzaChzdHIuc3Vic3RyaW5nKHN0cklkeCwgbWF0Y2hJbmRleCkucmVwbGFjZSgvJSUvZywgXCIlXCIpKTtcbiAgICAgICAgICAgIG1hdGNoZXMucHVzaChtYXRjaCk7XG4gICAgICAgICAgICBzdHJJZHggPSBmc0Zvcm1hdFJlZ0V4cC5sYXN0SW5kZXg7XG4gICAgICAgICAgICAvLyBMaWtld2lzZSB3ZSBuZWVkIHRvIG1vdmUgZnNGb3JtYXRSZWdFeHAubGFzdEluZGV4IG9uZSBjaGFyIGJlaGluZCB0byBtYWtlIHN1cmUgd2UgbWF0Y2ggdGhlIG5vLWVzY2FwZSBjaGFyIG5leHQgdGltZVxuICAgICAgICAgICAgZnNGb3JtYXRSZWdFeHAubGFzdEluZGV4IC09IDE7XG4gICAgICAgICAgICBtYXRjaCA9IGZzRm9ybWF0UmVnRXhwLmV4ZWMoc3RyKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3RyUGFydHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gY29udChzdHIucmVwbGFjZSgvJSUvZywgXCIlXCIpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHN0clBhcnRzLnB1c2goc3RyLnN1YnN0cmluZyhzdHJJZHgpLnJlcGxhY2UoLyUlL2csIFwiJVwiKSk7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlUHJpbnRlcihjb250LCBzdHJQYXJ0cywgbWF0Y2hlcyk7XG4gICAgICAgIH1cbiAgICB9O1xufVxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdChzdHIsIC4uLmFyZ3MpIHtcbiAgICBsZXQgc3RyMjtcbiAgICBpZiAodHlwZW9mIHN0ciA9PT0gXCJvYmplY3RcIikge1xuICAgICAgICAvLyBDYWxsZWQgd2l0aCBjdWx0dXJlIGluZm9cbiAgICAgICAgc3RyMiA9IFN0cmluZyhhcmdzWzBdKTtcbiAgICAgICAgYXJncy5zaGlmdCgpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgc3RyMiA9IHN0cjtcbiAgICB9XG4gICAgcmV0dXJuIHN0cjIucmVwbGFjZShmb3JtYXRSZWdFeHAsIChfLCBpZHgsIHBhZExlbmd0aCwgZm9ybWF0LCBwcmVjaXNpb24sIHBhdHRlcm4pID0+IHtcbiAgICAgICAgaWYgKGlkeCA8IDAgfHwgaWR4ID49IGFyZ3MubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbmRleCBtdXN0IGJlIGdyZWF0ZXIgb3IgZXF1YWwgdG8gemVybyBhbmQgbGVzcyB0aGFuIHRoZSBhcmd1bWVudHMnIGxlbmd0aC5cIik7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHJlcCA9IGFyZ3NbaWR4XTtcbiAgICAgICAgaWYgKGlzTnVtZXJpYyhyZXApKSB7XG4gICAgICAgICAgICBwcmVjaXNpb24gPSBwcmVjaXNpb24gPT0gbnVsbCA/IG51bGwgOiBwYXJzZUludChwcmVjaXNpb24sIDEwKTtcbiAgICAgICAgICAgIHN3aXRjaCAoZm9ybWF0KSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcImZcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiRlwiOlxuICAgICAgICAgICAgICAgICAgICBwcmVjaXNpb24gPSBwcmVjaXNpb24gIT0gbnVsbCA/IHByZWNpc2lvbiA6IDI7XG4gICAgICAgICAgICAgICAgICAgIHJlcCA9IHRvRml4ZWQocmVwLCBwcmVjaXNpb24pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZ1wiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJHXCI6XG4gICAgICAgICAgICAgICAgICAgIHJlcCA9IHByZWNpc2lvbiAhPSBudWxsID8gdG9QcmVjaXNpb24ocmVwLCBwcmVjaXNpb24pIDogdG9QcmVjaXNpb24ocmVwKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImVcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiRVwiOlxuICAgICAgICAgICAgICAgICAgICByZXAgPSBwcmVjaXNpb24gIT0gbnVsbCA/IHRvRXhwb25lbnRpYWwocmVwLCBwcmVjaXNpb24pIDogdG9FeHBvbmVudGlhbChyZXApO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwicFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJQXCI6XG4gICAgICAgICAgICAgICAgICAgIHByZWNpc2lvbiA9IHByZWNpc2lvbiAhPSBudWxsID8gcHJlY2lzaW9uIDogMjtcbiAgICAgICAgICAgICAgICAgICAgcmVwID0gdG9GaXhlZChtdWx0aXBseShyZXAsIDEwMCksIHByZWNpc2lvbikgKyBcIiAlXCI7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcIkRcIjpcbiAgICAgICAgICAgICAgICAgICAgcmVwID0gcHJlY2lzaW9uICE9IG51bGwgPyBwYWRMZWZ0KFN0cmluZyhyZXApLCBwcmVjaXNpb24sIFwiMFwiKSA6IFN0cmluZyhyZXApO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwieFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJYXCI6XG4gICAgICAgICAgICAgICAgICAgIHJlcCA9IHByZWNpc2lvbiAhPSBudWxsID8gcGFkTGVmdCh0b0hleChyZXApLCBwcmVjaXNpb24sIFwiMFwiKSA6IHRvSGV4KHJlcCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmb3JtYXQgPT09IFwiWFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXAgPSByZXAudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBpZiAocGF0dGVybikge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHNpZ24gPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVwID0gcGF0dGVybi5yZXBsYWNlKC8oWzAjLF0rKShcXC5bMCNdKyk/LywgKF8sIGludFBhcnQsIGRlY2ltYWxQYXJ0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzTGVzc1RoYW4ocmVwLCAwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXAgPSBtdWx0aXBseShyZXAsIC0xKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbiA9IFwiLVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWNpbWFsUGFydCA9IGRlY2ltYWxQYXJ0ID09IG51bGwgPyBcIlwiIDogZGVjaW1hbFBhcnQuc3Vic3RyaW5nKDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcCA9IHRvRml4ZWQocmVwLCBNYXRoLm1heChkZWNpbWFsUGFydC5sZW5ndGgsIDApKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgW3JlcEludCwgcmVwRGVjaW1hbF0gPSByZXAuc3BsaXQoXCIuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcERlY2ltYWwgfHwgKHJlcERlY2ltYWwgPSBcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsZWZ0WmVyb2VzID0gaW50UGFydC5yZXBsYWNlKC8sL2csIFwiXCIpLnJlcGxhY2UoL14jKy8sIFwiXCIpLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBJbnQgPSBwYWRMZWZ0KHJlcEludCwgbGVmdFplcm9lcywgXCIwXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJpZ2h0WmVyb3MgPSBkZWNpbWFsUGFydC5yZXBsYWNlKC8jKyQvLCBcIlwiKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJpZ2h0WmVyb3MgPiByZXBEZWNpbWFsLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBEZWNpbWFsID0gcGFkUmlnaHQocmVwRGVjaW1hbCwgcmlnaHRaZXJvcywgXCIwXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyaWdodFplcm9zIDwgcmVwRGVjaW1hbC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwRGVjaW1hbCA9IHJlcERlY2ltYWwuc3Vic3RyaW5nKDAsIHJpZ2h0WmVyb3MpICsgcmVwRGVjaW1hbC5zdWJzdHJpbmcocmlnaHRaZXJvcykucmVwbGFjZSgvMCskLywgXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRob3VzYW5kcyBzZXBhcmF0b3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW50UGFydC5pbmRleE9mKFwiLFwiKSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9IHJlcEludC5sZW5ndGggJSAzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0aG91c2FuZEdyb3VwcyA9IE1hdGguZmxvb3IocmVwSW50Lmxlbmd0aCAvIDMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdGhvdXNhbmRzID0gaSA+IDAgPyByZXBJbnQuc3Vic3RyKDAsIGkpICsgKHRob3VzYW5kR3JvdXBzID4gMCA/IFwiLFwiIDogXCJcIikgOiBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRob3VzYW5kR3JvdXBzOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRob3VzYW5kcyArPSByZXBJbnQuc3Vic3RyKGkgKyBqICogMywgMykgKyAoaiA8IHRob3VzYW5kR3JvdXBzIC0gMSA/IFwiLFwiIDogXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwSW50ID0gdGhvdXNhbmRzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVwRGVjaW1hbC5sZW5ndGggPiAwID8gcmVwSW50ICsgXCIuXCIgKyByZXBEZWNpbWFsIDogcmVwSW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXAgPSBzaWduICsgcmVwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVwIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgICAgICAgcmVwID0gZGF0ZVRvU3RyaW5nKHJlcCwgcGF0dGVybiB8fCBmb3JtYXQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVwID0gdG9TdHJpbmcocmVwKTtcbiAgICAgICAgfVxuICAgICAgICBwYWRMZW5ndGggPSBwYXJzZUludCgocGFkTGVuZ3RoIHx8IFwiIFwiKS5zdWJzdHJpbmcoMSksIDEwKTtcbiAgICAgICAgaWYgKCFpc05hTihwYWRMZW5ndGgpKSB7XG4gICAgICAgICAgICByZXAgPSBwYWQoU3RyaW5nKHJlcCksIE1hdGguYWJzKHBhZExlbmd0aCksIFwiIFwiLCBwYWRMZW5ndGggPCAwKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVwO1xuICAgIH0pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGVuZHNXaXRoKHN0ciwgc2VhcmNoKSB7XG4gICAgY29uc3QgaWR4ID0gc3RyLmxhc3RJbmRleE9mKHNlYXJjaCk7XG4gICAgcmV0dXJuIGlkeCA+PSAwICYmIGlkeCA9PT0gc3RyLmxlbmd0aCAtIHNlYXJjaC5sZW5ndGg7XG59XG5leHBvcnQgZnVuY3Rpb24gaW5pdGlhbGl6ZShuLCBmKSB7XG4gICAgaWYgKG4gPCAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlN0cmluZyBsZW5ndGggbXVzdCBiZSBub24tbmVnYXRpdmVcIik7XG4gICAgfVxuICAgIGNvbnN0IHhzID0gbmV3IEFycmF5KG4pO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgIHhzW2ldID0gZihpKTtcbiAgICB9XG4gICAgcmV0dXJuIHhzLmpvaW4oXCJcIik7XG59XG5leHBvcnQgZnVuY3Rpb24gaW5zZXJ0KHN0ciwgc3RhcnRJbmRleCwgdmFsdWUpIHtcbiAgICBpZiAoc3RhcnRJbmRleCA8IDAgfHwgc3RhcnRJbmRleCA+IHN0ci5sZW5ndGgpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwic3RhcnRJbmRleCBpcyBuZWdhdGl2ZSBvciBncmVhdGVyIHRoYW4gdGhlIGxlbmd0aCBvZiB0aGlzIGluc3RhbmNlLlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIHN0ci5zdWJzdHJpbmcoMCwgc3RhcnRJbmRleCkgKyB2YWx1ZSArIHN0ci5zdWJzdHJpbmcoc3RhcnRJbmRleCk7XG59XG5leHBvcnQgZnVuY3Rpb24gaXNOdWxsT3JFbXB0eShzdHIpIHtcbiAgICByZXR1cm4gdHlwZW9mIHN0ciAhPT0gXCJzdHJpbmdcIiB8fCBzdHIubGVuZ3RoID09PSAwO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGlzTnVsbE9yV2hpdGVTcGFjZShzdHIpIHtcbiAgICByZXR1cm4gdHlwZW9mIHN0ciAhPT0gXCJzdHJpbmdcIiB8fCAvXlxccyokLy50ZXN0KHN0cik7XG59XG5leHBvcnQgZnVuY3Rpb24gY29uY2F0KC4uLnhzKSB7XG4gICAgcmV0dXJuIHhzLm1hcCgoeCkgPT4gU3RyaW5nKHgpKS5qb2luKFwiXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGpvaW4oZGVsaW1pdGVyLCB4cykge1xuICAgIGlmIChBcnJheS5pc0FycmF5KHhzKSkge1xuICAgICAgICByZXR1cm4geHMuam9pbihkZWxpbWl0ZXIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20oeHMpLmpvaW4oZGVsaW1pdGVyKTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gam9pbldpdGhJbmRpY2VzKGRlbGltaXRlciwgeHMsIHN0YXJ0SW5kZXgsIGNvdW50KSB7XG4gICAgY29uc3QgZW5kSW5kZXhQbHVzT25lID0gc3RhcnRJbmRleCArIGNvdW50O1xuICAgIGlmIChlbmRJbmRleFBsdXNPbmUgPiB4cy5sZW5ndGgpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW5kZXggYW5kIGNvdW50IG11c3QgcmVmZXIgdG8gYSBsb2NhdGlvbiB3aXRoaW4gdGhlIGJ1ZmZlci5cIik7XG4gICAgfVxuICAgIHJldHVybiB4cy5zbGljZShzdGFydEluZGV4LCBlbmRJbmRleFBsdXNPbmUpLmpvaW4oZGVsaW1pdGVyKTtcbn1cbmZ1bmN0aW9uIG5vdFN1cHBvcnRlZChuYW1lKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlIGVudmlyb25tZW50IGRvZXNuJ3Qgc3VwcG9ydCAnXCIgKyBuYW1lICsgXCInLCBwbGVhc2UgdXNlIGEgcG9seWZpbGwuXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvQmFzZTY0U3RyaW5nKGluQXJyYXkpIHtcbiAgICBsZXQgc3RyID0gXCJcIjtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGluQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoaW5BcnJheVtpXSk7XG4gICAgfVxuICAgIHJldHVybiB0eXBlb2YgYnRvYSA9PT0gXCJmdW5jdGlvblwiID8gYnRvYShzdHIpIDogbm90U3VwcG9ydGVkKFwiYnRvYVwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBmcm9tQmFzZTY0U3RyaW5nKGI2NEVuY29kZWQpIHtcbiAgICBjb25zdCBiaW5hcnkgPSB0eXBlb2YgYXRvYiA9PT0gXCJmdW5jdGlvblwiID8gYXRvYihiNjRFbmNvZGVkKSA6IG5vdFN1cHBvcnRlZChcImF0b2JcIik7XG4gICAgY29uc3QgYnl0ZXMgPSBuZXcgVWludDhBcnJheShiaW5hcnkubGVuZ3RoKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJpbmFyeS5sZW5ndGg7IGkrKykge1xuICAgICAgICBieXRlc1tpXSA9IGJpbmFyeS5jaGFyQ29kZUF0KGkpO1xuICAgIH1cbiAgICByZXR1cm4gYnl0ZXM7XG59XG5mdW5jdGlvbiBwYWQoc3RyLCBsZW4sIGNoLCBpc1JpZ2h0KSB7XG4gICAgY2ggPSBjaCB8fCBcIiBcIjtcbiAgICBsZW4gPSBsZW4gLSBzdHIubGVuZ3RoO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgc3RyID0gaXNSaWdodCA/IHN0ciArIGNoIDogY2ggKyBzdHI7XG4gICAgfVxuICAgIHJldHVybiBzdHI7XG59XG5leHBvcnQgZnVuY3Rpb24gcGFkTGVmdChzdHIsIGxlbiwgY2gpIHtcbiAgICByZXR1cm4gcGFkKHN0ciwgbGVuLCBjaCk7XG59XG5leHBvcnQgZnVuY3Rpb24gcGFkUmlnaHQoc3RyLCBsZW4sIGNoKSB7XG4gICAgcmV0dXJuIHBhZChzdHIsIGxlbiwgY2gsIHRydWUpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZShzdHIsIHN0YXJ0SW5kZXgsIGNvdW50KSB7XG4gICAgaWYgKHN0YXJ0SW5kZXggPj0gc3RyLmxlbmd0aCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJzdGFydEluZGV4IG11c3QgYmUgbGVzcyB0aGFuIGxlbmd0aCBvZiBzdHJpbmdcIik7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgY291bnQgPT09IFwibnVtYmVyXCIgJiYgKHN0YXJ0SW5kZXggKyBjb3VudCkgPiBzdHIubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkluZGV4IGFuZCBjb3VudCBtdXN0IHJlZmVyIHRvIGEgbG9jYXRpb24gd2l0aGluIHRoZSBzdHJpbmcuXCIpO1xuICAgIH1cbiAgICByZXR1cm4gc3RyLnNsaWNlKDAsIHN0YXJ0SW5kZXgpICsgKHR5cGVvZiBjb3VudCA9PT0gXCJudW1iZXJcIiA/IHN0ci5zdWJzdHIoc3RhcnRJbmRleCArIGNvdW50KSA6IFwiXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHJlcGxhY2Uoc3RyLCBzZWFyY2gsIHJlcGxhY2UpIHtcbiAgICByZXR1cm4gc3RyLnJlcGxhY2UobmV3IFJlZ0V4cChlc2NhcGUoc2VhcmNoKSwgXCJnXCIpLCByZXBsYWNlKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiByZXBsaWNhdGUobiwgeCkge1xuICAgIHJldHVybiBpbml0aWFsaXplKG4sICgpID0+IHgpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGdldENoYXJBdEluZGV4KGlucHV0LCBpbmRleCkge1xuICAgIGlmIChpbmRleCA8IDAgfHwgaW5kZXggPj0gaW5wdXQubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkluZGV4IHdhcyBvdXRzaWRlIHRoZSBib3VuZHMgb2YgdGhlIGFycmF5LlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIGlucHV0W2luZGV4XTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBzcGxpdChzdHIsIHNwbGl0dGVycywgY291bnQsIG9wdGlvbnMpIHtcbiAgICBjb3VudCA9IHR5cGVvZiBjb3VudCA9PT0gXCJudW1iZXJcIiA/IGNvdW50IDogdW5kZWZpbmVkO1xuICAgIG9wdGlvbnMgPSB0eXBlb2Ygb3B0aW9ucyA9PT0gXCJudW1iZXJcIiA/IG9wdGlvbnMgOiAwO1xuICAgIGlmIChjb3VudCAmJiBjb3VudCA8IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ291bnQgY2Fubm90IGJlIGxlc3MgdGhhbiB6ZXJvXCIpO1xuICAgIH1cbiAgICBpZiAoY291bnQgPT09IDApIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICBjb25zdCByZW1vdmVFbXB0eSA9IChvcHRpb25zICYgMSkgPT09IDE7XG4gICAgY29uc3QgdHJpbSA9IChvcHRpb25zICYgMikgPT09IDI7XG4gICAgc3BsaXR0ZXJzID0gc3BsaXR0ZXJzIHx8IFtdO1xuICAgIHNwbGl0dGVycyA9IHNwbGl0dGVycy5maWx0ZXIoeCA9PiB4KS5tYXAoZXNjYXBlKTtcbiAgICBzcGxpdHRlcnMgPSBzcGxpdHRlcnMubGVuZ3RoID4gMCA/IHNwbGl0dGVycyA6IFtcIlxcXFxzXCJdO1xuICAgIGNvbnN0IHNwbGl0cyA9IFtdO1xuICAgIGNvbnN0IHJlZyA9IG5ldyBSZWdFeHAoc3BsaXR0ZXJzLmpvaW4oXCJ8XCIpLCBcImdcIik7XG4gICAgbGV0IGZpbmRTcGxpdHMgPSB0cnVlO1xuICAgIGxldCBpID0gMDtcbiAgICBkbyB7XG4gICAgICAgIGNvbnN0IG1hdGNoID0gcmVnLmV4ZWMoc3RyKTtcbiAgICAgICAgaWYgKG1hdGNoID09PSBudWxsKSB7XG4gICAgICAgICAgICBjb25zdCBjYW5kaWRhdGUgPSB0cmltID8gc3RyLnN1YnN0cmluZyhpKS50cmltKCkgOiBzdHIuc3Vic3RyaW5nKGkpO1xuICAgICAgICAgICAgaWYgKCFyZW1vdmVFbXB0eSB8fCBjYW5kaWRhdGUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHNwbGl0cy5wdXNoKGNhbmRpZGF0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmaW5kU3BsaXRzID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBjYW5kaWRhdGUgPSB0cmltID8gc3RyLnN1YnN0cmluZyhpLCBtYXRjaC5pbmRleCkudHJpbSgpIDogc3RyLnN1YnN0cmluZyhpLCBtYXRjaC5pbmRleCk7XG4gICAgICAgICAgICBpZiAoIXJlbW92ZUVtcHR5IHx8IGNhbmRpZGF0ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvdW50ICE9IG51bGwgJiYgc3BsaXRzLmxlbmd0aCArIDEgPT09IGNvdW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHNwbGl0cy5wdXNoKHRyaW0gPyBzdHIuc3Vic3RyaW5nKGkpLnRyaW0oKSA6IHN0ci5zdWJzdHJpbmcoaSkpO1xuICAgICAgICAgICAgICAgICAgICBmaW5kU3BsaXRzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzcGxpdHMucHVzaChjYW5kaWRhdGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGkgPSByZWcubGFzdEluZGV4O1xuICAgICAgICB9XG4gICAgfSB3aGlsZSAoZmluZFNwbGl0cyk7XG4gICAgcmV0dXJuIHNwbGl0cztcbn1cbmV4cG9ydCBmdW5jdGlvbiB0cmltKHN0ciwgLi4uY2hhcnMpIHtcbiAgICBpZiAoY2hhcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBzdHIudHJpbSgpO1xuICAgIH1cbiAgICBjb25zdCBwYXR0ZXJuID0gXCJbXCIgKyBlc2NhcGUoY2hhcnMuam9pbihcIlwiKSkgKyBcIl0rXCI7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKG5ldyBSZWdFeHAoXCJeXCIgKyBwYXR0ZXJuKSwgXCJcIikucmVwbGFjZShuZXcgUmVnRXhwKHBhdHRlcm4gKyBcIiRcIiksIFwiXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRyaW1TdGFydChzdHIsIC4uLmNoYXJzKSB7XG4gICAgcmV0dXJuIGNoYXJzLmxlbmd0aCA9PT0gMFxuICAgICAgICA/IHN0ci50cmltU3RhcnQoKVxuICAgICAgICA6IHN0ci5yZXBsYWNlKG5ldyBSZWdFeHAoXCJeW1wiICsgZXNjYXBlKGNoYXJzLmpvaW4oXCJcIikpICsgXCJdK1wiKSwgXCJcIik7XG59XG5leHBvcnQgZnVuY3Rpb24gdHJpbUVuZChzdHIsIC4uLmNoYXJzKSB7XG4gICAgcmV0dXJuIGNoYXJzLmxlbmd0aCA9PT0gMFxuICAgICAgICA/IHN0ci50cmltRW5kKClcbiAgICAgICAgOiBzdHIucmVwbGFjZShuZXcgUmVnRXhwKFwiW1wiICsgZXNjYXBlKGNoYXJzLmpvaW4oXCJcIikpICsgXCJdKyRcIiksIFwiXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGZpbHRlcihwcmVkLCB4KSB7XG4gICAgcmV0dXJuIHguc3BsaXQoXCJcIikuZmlsdGVyKChjKSA9PiBwcmVkKGMpKS5qb2luKFwiXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHN1YnN0cmluZyhzdHIsIHN0YXJ0SW5kZXgsIGxlbmd0aCkge1xuICAgIGlmICgoc3RhcnRJbmRleCArIChsZW5ndGggfHwgMCkgPiBzdHIubGVuZ3RoKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHN0YXJ0SW5kZXggYW5kL29yIGxlbmd0aFwiKTtcbiAgICB9XG4gICAgcmV0dXJuIGxlbmd0aCAhPSBudWxsID8gc3RyLnN1YnN0cihzdGFydEluZGV4LCBsZW5ndGgpIDogc3RyLnN1YnN0cihzdGFydEluZGV4KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b0NoYXJBcnJheTIoc3RyLCBzdGFydEluZGV4LCBsZW5ndGgpIHtcbiAgICByZXR1cm4gc3Vic3RyaW5nKHN0ciwgc3RhcnRJbmRleCwgbGVuZ3RoKS5zcGxpdChcIlwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBmbXQoc3RycywgLi4uYXJncykge1xuICAgIHJldHVybiAoeyBzdHJzLCBhcmdzIH0pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGZtdFdpdGgoZm10cykge1xuICAgIHJldHVybiAoc3RycywgLi4uYXJncykgPT4gKHsgc3RycywgYXJncywgZm10cyB9KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBnZXRGb3JtYXQocykge1xuICAgIHJldHVybiBzLmZtdHNcbiAgICAgICAgPyBzLnN0cnMucmVkdWNlKChhY2MsIG5ld1BhcnQsIGluZGV4KSA9PiBhY2MgKyBgeyR7U3RyaW5nKGluZGV4IC0gMSkgKyBzLmZtdHNbaW5kZXggLSAxXX19YCArIG5ld1BhcnQpXG4gICAgICAgIDogcy5zdHJzLnJlZHVjZSgoYWNjLCBuZXdQYXJ0LCBpbmRleCkgPT4gYWNjICsgYHske2luZGV4IC0gMX19YCArIG5ld1BhcnQpO1xufVxuIiwKICAiaW1wb3J0IHsgdG9TdHJpbmcgYXMgZGF0ZVRvU3RyaW5nIH0gZnJvbSBcIi4vRGF0ZS5qc1wiO1xuaW1wb3J0IHsgY29tcGFyZSBhcyBudW1lcmljQ29tcGFyZSwgaXNOdW1lcmljLCBtdWx0aXBseSwgdG9FeHBvbmVudGlhbCwgdG9GaXhlZCwgdG9IZXgsIHRvUHJlY2lzaW9uIH0gZnJvbSBcIi4vTnVtZXJpYy5qc1wiO1xuaW1wb3J0IHsgZXNjYXBlIH0gZnJvbSBcIi4vUmVnRXhwLmpzXCI7XG5pbXBvcnQgeyB0b1N0cmluZyB9IGZyb20gXCIuL1R5cGVzLmpzXCI7XG5jb25zdCBmc0Zvcm1hdFJlZ0V4cCA9IC8oXnxbXiVdKSUoWzArXFwtIF0qKShcXCp8XFxkKyk/KD86XFwuKFxcZCspKT8oXFx3KS9nO1xuY29uc3QgaW50ZXJwb2xhdGVSZWdFeHAgPSAvKD86KF58W14lXSklKFswK1xcLSBdKikoXFxkKyk/KD86XFwuKFxcZCspKT8oXFx3KSk/JVBcXChcXCkvZztcbmNvbnN0IGZvcm1hdFJlZ0V4cCA9IC9cXHsoXFxkKykoLC0/XFxkKyk/KD86XFw6KFthLXpBLVpdKShcXGR7MCwyfSl8XFw6KC4rPykpP1xcfS9nO1xuZnVuY3Rpb24gaXNMZXNzVGhhbih4LCB5KSB7XG4gICAgcmV0dXJuIG51bWVyaWNDb21wYXJlKHgsIHkpIDwgMDtcbn1cbmZ1bmN0aW9uIGNtcCh4LCB5LCBpYykge1xuICAgIGZ1bmN0aW9uIGlzSWdub3JlQ2FzZShpKSB7XG4gICAgICAgIHJldHVybiBpID09PSB0cnVlIHx8XG4gICAgICAgICAgICBpID09PSAxIC8qIFN0cmluZ0NvbXBhcmlzb24uQ3VycmVudEN1bHR1cmVJZ25vcmVDYXNlICovIHx8XG4gICAgICAgICAgICBpID09PSAzIC8qIFN0cmluZ0NvbXBhcmlzb24uSW52YXJpYW50Q3VsdHVyZUlnbm9yZUNhc2UgKi8gfHxcbiAgICAgICAgICAgIGkgPT09IDUgLyogU3RyaW5nQ29tcGFyaXNvbi5PcmRpbmFsSWdub3JlQ2FzZSAqLztcbiAgICB9XG4gICAgZnVuY3Rpb24gaXNPcmRpbmFsKGkpIHtcbiAgICAgICAgcmV0dXJuIGkgPT09IDQgLyogU3RyaW5nQ29tcGFyaXNvbi5PcmRpbmFsICovIHx8XG4gICAgICAgICAgICBpID09PSA1IC8qIFN0cmluZ0NvbXBhcmlzb24uT3JkaW5hbElnbm9yZUNhc2UgKi87XG4gICAgfVxuICAgIGlmICh4ID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHkgPT0gbnVsbCA/IDAgOiAtMTtcbiAgICB9XG4gICAgaWYgKHkgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gMTtcbiAgICB9IC8vIGV2ZXJ5dGhpbmcgaXMgYmlnZ2VyIHRoYW4gbnVsbFxuICAgIGlmIChpc09yZGluYWwoaWMpKSB7XG4gICAgICAgIGlmIChpc0lnbm9yZUNhc2UoaWMpKSB7XG4gICAgICAgICAgICB4ID0geC50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgeSA9IHkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKHggPT09IHkpID8gMCA6ICh4IDwgeSA/IC0xIDogMSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAoaXNJZ25vcmVDYXNlKGljKSkge1xuICAgICAgICAgICAgeCA9IHgudG9Mb2NhbGVMb3dlckNhc2UoKTtcbiAgICAgICAgICAgIHkgPSB5LnRvTG9jYWxlTG93ZXJDYXNlKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHgubG9jYWxlQ29tcGFyZSh5KTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gY29tcGFyZSguLi5hcmdzKSB7XG4gICAgc3dpdGNoIChhcmdzLmxlbmd0aCkge1xuICAgICAgICBjYXNlIDI6IHJldHVybiBjbXAoYXJnc1swXSwgYXJnc1sxXSwgZmFsc2UpO1xuICAgICAgICBjYXNlIDM6IHJldHVybiBjbXAoYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSk7XG4gICAgICAgIGNhc2UgNDogcmV0dXJuIGNtcChhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdID09PSB0cnVlKTtcbiAgICAgICAgY2FzZSA1OiByZXR1cm4gY21wKGFyZ3NbMF0uc3Vic3RyKGFyZ3NbMV0sIGFyZ3NbNF0pLCBhcmdzWzJdLnN1YnN0cihhcmdzWzNdLCBhcmdzWzRdKSwgZmFsc2UpO1xuICAgICAgICBjYXNlIDY6IHJldHVybiBjbXAoYXJnc1swXS5zdWJzdHIoYXJnc1sxXSwgYXJnc1s0XSksIGFyZ3NbMl0uc3Vic3RyKGFyZ3NbM10sIGFyZ3NbNF0pLCBhcmdzWzVdKTtcbiAgICAgICAgY2FzZSA3OiByZXR1cm4gY21wKGFyZ3NbMF0uc3Vic3RyKGFyZ3NbMV0sIGFyZ3NbNF0pLCBhcmdzWzJdLnN1YnN0cihhcmdzWzNdLCBhcmdzWzRdKSwgYXJnc1s1XSA9PT0gdHJ1ZSk7XG4gICAgICAgIGRlZmF1bHQ6IHRocm93IG5ldyBFcnJvcihcIlN0cmluZy5jb21wYXJlOiBVbnN1cHBvcnRlZCBudW1iZXIgb2YgcGFyYW1ldGVyc1wiKTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gY29tcGFyZU9yZGluYWwoeCwgeSkge1xuICAgIHJldHVybiBjbXAoeCwgeSwgNCAvKiBTdHJpbmdDb21wYXJpc29uLk9yZGluYWwgKi8pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBhcmVUbyh4LCB5KSB7XG4gICAgcmV0dXJuIGNtcCh4LCB5LCAwIC8qIFN0cmluZ0NvbXBhcmlzb24uQ3VycmVudEN1bHR1cmUgKi8pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHN0YXJ0c1dpdGgoc3RyLCBwYXR0ZXJuLCBpYykge1xuICAgIGlmIChzdHIubGVuZ3RoID49IHBhdHRlcm4ubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBjbXAoc3RyLnN1YnN0cigwLCBwYXR0ZXJuLmxlbmd0aCksIHBhdHRlcm4sIGljKSA9PT0gMDtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGluZGV4T2ZBbnkoc3RyLCBhbnlPZiwgLi4uYXJncykge1xuICAgIGlmIChzdHIgPT0gbnVsbCB8fCBzdHIgPT09IFwiXCIpIHtcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIH1cbiAgICBjb25zdCBzdGFydEluZGV4ID0gKGFyZ3MubGVuZ3RoID4gMCkgPyBhcmdzWzBdIDogMDtcbiAgICBpZiAoc3RhcnRJbmRleCA8IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3RhcnQgaW5kZXggY2Fubm90IGJlIG5lZ2F0aXZlXCIpO1xuICAgIH1cbiAgICBjb25zdCBsZW5ndGggPSAoYXJncy5sZW5ndGggPiAxKSA/IGFyZ3NbMV0gOiBzdHIubGVuZ3RoIC0gc3RhcnRJbmRleDtcbiAgICBpZiAobGVuZ3RoIDwgMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJMZW5ndGggY2Fubm90IGJlIG5lZ2F0aXZlXCIpO1xuICAgIH1cbiAgICBpZiAoc3RhcnRJbmRleCArIGxlbmd0aCA+IHN0ci5sZW5ndGgpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBzdGFydEluZGV4IGFuZCBsZW5ndGhcIik7XG4gICAgfVxuICAgIGNvbnN0IGVuZEluZGV4ID0gc3RhcnRJbmRleCArIGxlbmd0aDtcbiAgICBjb25zdCBhbnlPZkFzU3RyID0gXCJcIi5jb25jYXQuYXBwbHkoXCJcIiwgYW55T2YpO1xuICAgIGZvciAobGV0IGkgPSBzdGFydEluZGV4OyBpIDwgZW5kSW5kZXg7IGkrKykge1xuICAgICAgICBpZiAoYW55T2ZBc1N0ci5pbmRleE9mKHN0cltpXSkgPiAtMSkge1xuICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIC0xO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHByaW50ZihpbnB1dCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIGlucHV0LFxuICAgICAgICBjb250OiBmc0Zvcm1hdChpbnB1dCksXG4gICAgfTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpbnRlcnBvbGF0ZShzdHIsIHZhbHVlcykge1xuICAgIGxldCB2YWxJZHggPSAwO1xuICAgIGxldCBzdHJJZHggPSAwO1xuICAgIGxldCByZXN1bHQgPSBcIlwiO1xuICAgIGludGVycG9sYXRlUmVnRXhwLmxhc3RJbmRleCA9IDA7XG4gICAgbGV0IG1hdGNoID0gaW50ZXJwb2xhdGVSZWdFeHAuZXhlYyhzdHIpO1xuICAgIHdoaWxlIChtYXRjaCkge1xuICAgICAgICAvLyBUaGUgZmlyc3QgZ3JvdXAgY29ycmVzcG9uZHMgdG8gdGhlIG5vLWVzY2FwZSBjaGFyIChefFteJV0pLCB0aGUgYWN0dWFsIHBhdHRlcm4gc3RhcnRzIGluIHRoZSBuZXh0IGNoYXJcbiAgICAgICAgLy8gTm90ZTogd2UgZG9uJ3QgdXNlIG5lZ2F0aXZlIGxvb2tiZWhpbmQgYmVjYXVzZSBzb21lIGJyb3dzZXJzIGRvbid0IHN1cHBvcnQgaXQgeWV0XG4gICAgICAgIGNvbnN0IG1hdGNoSW5kZXggPSBtYXRjaC5pbmRleCArIChtYXRjaFsxXSB8fCBcIlwiKS5sZW5ndGg7XG4gICAgICAgIHJlc3VsdCArPSBzdHIuc3Vic3RyaW5nKHN0cklkeCwgbWF0Y2hJbmRleCkucmVwbGFjZSgvJSUvZywgXCIlXCIpO1xuICAgICAgICBjb25zdCBbLCAsIGZsYWdzLCBwYWRMZW5ndGgsIHByZWNpc2lvbiwgZm9ybWF0XSA9IG1hdGNoO1xuICAgICAgICAvLyBTYXZlIGludGVycG9sYXRlUmVnRXhwLmxhc3RJbmRleCBiZWZvcmUgcnVubmluZyBmb3JtYXRSZXBsYWNlbWVudCBiZWNhdXNlIHRoZSB2YWx1ZXNcbiAgICAgICAgLy8gbWF5IGFsc28gaW52b2x2ZSBpbnRlcnBvbGF0aW9uIGFuZCBtYWtlIHVzZSBvZiBpbnRlcnBvbGF0ZVJlZ0V4cCAoc2VlICMzMDc4KVxuICAgICAgICBzdHJJZHggPSBpbnRlcnBvbGF0ZVJlZ0V4cC5sYXN0SW5kZXg7XG4gICAgICAgIHJlc3VsdCArPSBmb3JtYXRSZXBsYWNlbWVudCh2YWx1ZXNbdmFsSWR4KytdLCBmbGFncywgcGFkTGVuZ3RoLCBwcmVjaXNpb24sIGZvcm1hdCk7XG4gICAgICAgIC8vIE1vdmUgaW50ZXJwb2xhdGVSZWdFeHAubGFzdEluZGV4IG9uZSBjaGFyIGJlaGluZCB0byBtYWtlIHN1cmUgd2UgbWF0Y2ggdGhlIG5vLWVzY2FwZSBjaGFyIG5leHQgdGltZVxuICAgICAgICBpbnRlcnBvbGF0ZVJlZ0V4cC5sYXN0SW5kZXggPSBzdHJJZHggLSAxO1xuICAgICAgICBtYXRjaCA9IGludGVycG9sYXRlUmVnRXhwLmV4ZWMoc3RyKTtcbiAgICB9XG4gICAgcmVzdWx0ICs9IHN0ci5zdWJzdHJpbmcoc3RySWR4KS5yZXBsYWNlKC8lJS9nLCBcIiVcIik7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cbmZ1bmN0aW9uIGNvbnRpbnVlUHJpbnQoY29udCwgYXJnKSB7XG4gICAgcmV0dXJuIHR5cGVvZiBhcmcgPT09IFwic3RyaW5nXCIgPyBjb250KGFyZykgOiBhcmcuY29udChjb250KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b0NvbnNvbGUoYXJnKSB7XG4gICAgLy8gRG9uJ3QgcmVtb3ZlIHRoZSBsYW1iZGEgaGVyZSwgc2VlICMxMzU3XG4gICAgcmV0dXJuIGNvbnRpbnVlUHJpbnQoKHgpID0+IGNvbnNvbGUubG9nKHgpLCBhcmcpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvQ29uc29sZUVycm9yKGFyZykge1xuICAgIHJldHVybiBjb250aW51ZVByaW50KCh4KSA9PiBjb25zb2xlLmVycm9yKHgpLCBhcmcpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvVGV4dChhcmcpIHtcbiAgICByZXR1cm4gY29udGludWVQcmludCgoeCkgPT4geCwgYXJnKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b0ZhaWwoYXJnKSB7XG4gICAgcmV0dXJuIGNvbnRpbnVlUHJpbnQoKHgpID0+IHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKHgpO1xuICAgIH0sIGFyZyk7XG59XG5mdW5jdGlvbiBmb3JtYXRSZXBsYWNlbWVudChyZXAsIGZsYWdzLCBwYWRMZW5ndGgsIHByZWNpc2lvbiwgZm9ybWF0KSB7XG4gICAgbGV0IHNpZ24gPSBcIlwiO1xuICAgIGZsYWdzID0gZmxhZ3MgfHwgXCJcIjtcbiAgICBmb3JtYXQgPSBmb3JtYXQgfHwgXCJcIjtcbiAgICBpZiAoaXNOdW1lcmljKHJlcCkpIHtcbiAgICAgICAgaWYgKGZvcm1hdC50b0xvd2VyQ2FzZSgpICE9PSBcInhcIikge1xuICAgICAgICAgICAgaWYgKGlzTGVzc1RoYW4ocmVwLCAwKSkge1xuICAgICAgICAgICAgICAgIHJlcCA9IG11bHRpcGx5KHJlcCwgLTEpO1xuICAgICAgICAgICAgICAgIHNpZ24gPSBcIi1cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChmbGFncy5pbmRleE9mKFwiIFwiKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHNpZ24gPSBcIiBcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZmxhZ3MuaW5kZXhPZihcIitcIikgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICBzaWduID0gXCIrXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHByZWNpc2lvbiA9IHByZWNpc2lvbiA9PSBudWxsID8gbnVsbCA6IHBhcnNlSW50KHByZWNpc2lvbiwgMTApO1xuICAgICAgICBzd2l0Y2ggKGZvcm1hdCkge1xuICAgICAgICAgICAgY2FzZSBcImZcIjpcbiAgICAgICAgICAgIGNhc2UgXCJGXCI6XG4gICAgICAgICAgICAgICAgcHJlY2lzaW9uID0gcHJlY2lzaW9uICE9IG51bGwgPyBwcmVjaXNpb24gOiA2O1xuICAgICAgICAgICAgICAgIHJlcCA9IHRvRml4ZWQocmVwLCBwcmVjaXNpb24pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImdcIjpcbiAgICAgICAgICAgIGNhc2UgXCJHXCI6XG4gICAgICAgICAgICAgICAgcmVwID0gcHJlY2lzaW9uICE9IG51bGwgPyB0b1ByZWNpc2lvbihyZXAsIHByZWNpc2lvbikgOiB0b1ByZWNpc2lvbihyZXApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImVcIjpcbiAgICAgICAgICAgIGNhc2UgXCJFXCI6XG4gICAgICAgICAgICAgICAgcmVwID0gcHJlY2lzaW9uICE9IG51bGwgPyB0b0V4cG9uZW50aWFsKHJlcCwgcHJlY2lzaW9uKSA6IHRvRXhwb25lbnRpYWwocmVwKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJ4XCI6XG4gICAgICAgICAgICAgICAgcmVwID0gdG9IZXgocmVwKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJYXCI6XG4gICAgICAgICAgICAgICAgcmVwID0gdG9IZXgocmVwKS50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDogLy8gQU9pZFxuICAgICAgICAgICAgICAgIHJlcCA9IFN0cmluZyhyZXApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKHJlcCBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgICAgcmVwID0gZGF0ZVRvU3RyaW5nKHJlcCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXAgPSB0b1N0cmluZyhyZXApO1xuICAgIH1cbiAgICBwYWRMZW5ndGggPSB0eXBlb2YgcGFkTGVuZ3RoID09PSBcIm51bWJlclwiID8gcGFkTGVuZ3RoIDogcGFyc2VJbnQocGFkTGVuZ3RoLCAxMCk7XG4gICAgaWYgKCFpc05hTihwYWRMZW5ndGgpKSB7XG4gICAgICAgIGNvbnN0IHplcm9GbGFnID0gZmxhZ3MuaW5kZXhPZihcIjBcIikgPj0gMDsgLy8gVXNlICcwJyBmb3IgbGVmdCBwYWRkaW5nXG4gICAgICAgIGNvbnN0IG1pbnVzRmxhZyA9IGZsYWdzLmluZGV4T2YoXCItXCIpID49IDA7IC8vIFJpZ2h0IHBhZGRpbmdcbiAgICAgICAgY29uc3QgY2ggPSBtaW51c0ZsYWcgfHwgIXplcm9GbGFnID8gXCIgXCIgOiBcIjBcIjtcbiAgICAgICAgaWYgKGNoID09PSBcIjBcIikge1xuICAgICAgICAgICAgcmVwID0gcGFkKHJlcCwgcGFkTGVuZ3RoIC0gc2lnbi5sZW5ndGgsIGNoLCBtaW51c0ZsYWcpO1xuICAgICAgICAgICAgcmVwID0gc2lnbiArIHJlcDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJlcCA9IHBhZChzaWduICsgcmVwLCBwYWRMZW5ndGgsIGNoLCBtaW51c0ZsYWcpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXAgPSBzaWduICsgcmVwO1xuICAgIH1cbiAgICByZXR1cm4gcmVwO1xufVxuZnVuY3Rpb24gY3JlYXRlUHJpbnRlcihjb250LCBfc3RyUGFydHMsIF9tYXRjaGVzLCBfcmVzdWx0ID0gXCJcIiwgcGFkQXJnID0gLTEpIHtcbiAgICByZXR1cm4gKC4uLmFyZ3MpID0+IHtcbiAgICAgICAgLy8gTWFrZSBjb3BpZXMgb2YgdGhlIHZhbHVlcyBwYXNzZWQgYnkgcmVmZXJlbmNlIGJlY2F1c2UgdGhlIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIG11bHRpcGxlIHRpbWVzXG4gICAgICAgIGxldCByZXN1bHQgPSBfcmVzdWx0O1xuICAgICAgICBjb25zdCBzdHJQYXJ0cyA9IF9zdHJQYXJ0cy5zbGljZSgpO1xuICAgICAgICBjb25zdCBtYXRjaGVzID0gX21hdGNoZXMuc2xpY2UoKTtcbiAgICAgICAgZm9yIChjb25zdCBhcmcgb2YgYXJncykge1xuICAgICAgICAgICAgY29uc3QgWywgLCBmbGFncywgX3BhZExlbmd0aCwgcHJlY2lzaW9uLCBmb3JtYXRdID0gbWF0Y2hlc1swXTtcbiAgICAgICAgICAgIGxldCBwYWRMZW5ndGggPSBfcGFkTGVuZ3RoO1xuICAgICAgICAgICAgaWYgKHBhZEFyZyA+PSAwKSB7XG4gICAgICAgICAgICAgICAgcGFkTGVuZ3RoID0gcGFkQXJnO1xuICAgICAgICAgICAgICAgIHBhZEFyZyA9IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocGFkTGVuZ3RoID09PSBcIipcIikge1xuICAgICAgICAgICAgICAgIGlmIChhcmcgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vbi1uZWdhdGl2ZSBudW1iZXIgcmVxdWlyZWRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHBhZEFyZyA9IGFyZztcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc3VsdCArPSBzdHJQYXJ0c1swXTtcbiAgICAgICAgICAgIHJlc3VsdCArPSBmb3JtYXRSZXBsYWNlbWVudChhcmcsIGZsYWdzLCBwYWRMZW5ndGgsIHByZWNpc2lvbiwgZm9ybWF0KTtcbiAgICAgICAgICAgIHN0clBhcnRzLnNwbGljZSgwLCAxKTtcbiAgICAgICAgICAgIG1hdGNoZXMuc3BsaWNlKDAsIDEpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChtYXRjaGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmVzdWx0ICs9IHN0clBhcnRzWzBdO1xuICAgICAgICAgICAgcmV0dXJuIGNvbnQocmVzdWx0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBjcmVhdGVQcmludGVyKGNvbnQsIHN0clBhcnRzLCBtYXRjaGVzLCByZXN1bHQsIHBhZEFyZyk7XG4gICAgICAgIH1cbiAgICB9O1xufVxuZXhwb3J0IGZ1bmN0aW9uIGZzRm9ybWF0KHN0cikge1xuICAgIHJldHVybiAoY29udCkgPT4ge1xuICAgICAgICBmc0Zvcm1hdFJlZ0V4cC5sYXN0SW5kZXggPSAwO1xuICAgICAgICBjb25zdCBzdHJQYXJ0cyA9IFtdO1xuICAgICAgICBjb25zdCBtYXRjaGVzID0gW107XG4gICAgICAgIGxldCBzdHJJZHggPSAwO1xuICAgICAgICBsZXQgbWF0Y2ggPSBmc0Zvcm1hdFJlZ0V4cC5leGVjKHN0cik7XG4gICAgICAgIHdoaWxlIChtYXRjaCkge1xuICAgICAgICAgICAgLy8gVGhlIGZpcnN0IGdyb3VwIGNvcnJlc3BvbmRzIHRvIHRoZSBuby1lc2NhcGUgY2hhciAoXnxbXiVdKSwgdGhlIGFjdHVhbCBwYXR0ZXJuIHN0YXJ0cyBpbiB0aGUgbmV4dCBjaGFyXG4gICAgICAgICAgICAvLyBOb3RlOiB3ZSBkb24ndCB1c2UgbmVnYXRpdmUgbG9va2JlaGluZCBiZWNhdXNlIHNvbWUgYnJvd3NlcnMgZG9uJ3Qgc3VwcG9ydCBpdCB5ZXRcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoSW5kZXggPSBtYXRjaC5pbmRleCArIChtYXRjaFsxXSB8fCBcIlwiKS5sZW5ndGg7XG4gICAgICAgICAgICBzdHJQYXJ0cy5wdXNoKHN0ci5zdWJzdHJpbmcoc3RySWR4LCBtYXRjaEluZGV4KS5yZXBsYWNlKC8lJS9nLCBcIiVcIikpO1xuICAgICAgICAgICAgbWF0Y2hlcy5wdXNoKG1hdGNoKTtcbiAgICAgICAgICAgIHN0cklkeCA9IGZzRm9ybWF0UmVnRXhwLmxhc3RJbmRleDtcbiAgICAgICAgICAgIC8vIExpa2V3aXNlIHdlIG5lZWQgdG8gbW92ZSBmc0Zvcm1hdFJlZ0V4cC5sYXN0SW5kZXggb25lIGNoYXIgYmVoaW5kIHRvIG1ha2Ugc3VyZSB3ZSBtYXRjaCB0aGUgbm8tZXNjYXBlIGNoYXIgbmV4dCB0aW1lXG4gICAgICAgICAgICBmc0Zvcm1hdFJlZ0V4cC5sYXN0SW5kZXggLT0gMTtcbiAgICAgICAgICAgIG1hdGNoID0gZnNGb3JtYXRSZWdFeHAuZXhlYyhzdHIpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzdHJQYXJ0cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBjb250KHN0ci5yZXBsYWNlKC8lJS9nLCBcIiVcIikpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc3RyUGFydHMucHVzaChzdHIuc3Vic3RyaW5nKHN0cklkeCkucmVwbGFjZSgvJSUvZywgXCIlXCIpKTtcbiAgICAgICAgICAgIHJldHVybiBjcmVhdGVQcmludGVyKGNvbnQsIHN0clBhcnRzLCBtYXRjaGVzKTtcbiAgICAgICAgfVxuICAgIH07XG59XG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0KHN0ciwgLi4uYXJncykge1xuICAgIGxldCBzdHIyO1xuICAgIGlmICh0eXBlb2Ygc3RyID09PSBcIm9iamVjdFwiKSB7XG4gICAgICAgIC8vIENhbGxlZCB3aXRoIGN1bHR1cmUgaW5mb1xuICAgICAgICBzdHIyID0gU3RyaW5nKGFyZ3NbMF0pO1xuICAgICAgICBhcmdzLnNoaWZ0KCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBzdHIyID0gc3RyO1xuICAgIH1cbiAgICByZXR1cm4gc3RyMi5yZXBsYWNlKGZvcm1hdFJlZ0V4cCwgKF8sIGlkeCwgcGFkTGVuZ3RoLCBmb3JtYXQsIHByZWNpc2lvbiwgcGF0dGVybikgPT4ge1xuICAgICAgICBpZiAoaWR4IDwgMCB8fCBpZHggPj0gYXJncy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkluZGV4IG11c3QgYmUgZ3JlYXRlciBvciBlcXVhbCB0byB6ZXJvIGFuZCBsZXNzIHRoYW4gdGhlIGFyZ3VtZW50cycgbGVuZ3RoLlwiKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgcmVwID0gYXJnc1tpZHhdO1xuICAgICAgICBpZiAoaXNOdW1lcmljKHJlcCkpIHtcbiAgICAgICAgICAgIHByZWNpc2lvbiA9IHByZWNpc2lvbiA9PSBudWxsID8gbnVsbCA6IHBhcnNlSW50KHByZWNpc2lvbiwgMTApO1xuICAgICAgICAgICAgc3dpdGNoIChmb3JtYXQpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiZlwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJGXCI6XG4gICAgICAgICAgICAgICAgICAgIHByZWNpc2lvbiA9IHByZWNpc2lvbiAhPSBudWxsID8gcHJlY2lzaW9uIDogMjtcbiAgICAgICAgICAgICAgICAgICAgcmVwID0gdG9GaXhlZChyZXAsIHByZWNpc2lvbik7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJnXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcIkdcIjpcbiAgICAgICAgICAgICAgICAgICAgcmVwID0gcHJlY2lzaW9uICE9IG51bGwgPyB0b1ByZWNpc2lvbihyZXAsIHByZWNpc2lvbikgOiB0b1ByZWNpc2lvbihyZXApO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZVwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJFXCI6XG4gICAgICAgICAgICAgICAgICAgIHJlcCA9IHByZWNpc2lvbiAhPSBudWxsID8gdG9FeHBvbmVudGlhbChyZXAsIHByZWNpc2lvbikgOiB0b0V4cG9uZW50aWFsKHJlcCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJwXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcIlBcIjpcbiAgICAgICAgICAgICAgICAgICAgcHJlY2lzaW9uID0gcHJlY2lzaW9uICE9IG51bGwgPyBwcmVjaXNpb24gOiAyO1xuICAgICAgICAgICAgICAgICAgICByZXAgPSB0b0ZpeGVkKG11bHRpcGx5KHJlcCwgMTAwKSwgcHJlY2lzaW9uKSArIFwiICVcIjtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiRFwiOlxuICAgICAgICAgICAgICAgICAgICByZXAgPSBwcmVjaXNpb24gIT0gbnVsbCA/IHBhZExlZnQoU3RyaW5nKHJlcCksIHByZWNpc2lvbiwgXCIwXCIpIDogU3RyaW5nKHJlcCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJ4XCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcIlhcIjpcbiAgICAgICAgICAgICAgICAgICAgcmVwID0gcHJlY2lzaW9uICE9IG51bGwgPyBwYWRMZWZ0KHRvSGV4KHJlcCksIHByZWNpc2lvbiwgXCIwXCIpIDogdG9IZXgocmVwKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZvcm1hdCA9PT0gXCJYXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcCA9IHJlcC50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXR0ZXJuKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgc2lnbiA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXAgPSBwYXR0ZXJuLnJlcGxhY2UoLyhbMCMsXSspKFxcLlswI10rKT8vLCAoXywgaW50UGFydCwgZGVjaW1hbFBhcnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNMZXNzVGhhbihyZXAsIDApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcCA9IG11bHRpcGx5KHJlcCwgLTEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaWduID0gXCItXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlY2ltYWxQYXJ0ID0gZGVjaW1hbFBhcnQgPT0gbnVsbCA/IFwiXCIgOiBkZWNpbWFsUGFydC5zdWJzdHJpbmcoMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwID0gdG9GaXhlZChyZXAsIE1hdGgubWF4KGRlY2ltYWxQYXJ0Lmxlbmd0aCwgMCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBbcmVwSW50LCByZXBEZWNpbWFsXSA9IHJlcC5zcGxpdChcIi5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwRGVjaW1hbCB8fCAocmVwRGVjaW1hbCA9IFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxlZnRaZXJvZXMgPSBpbnRQYXJ0LnJlcGxhY2UoLywvZywgXCJcIikucmVwbGFjZSgvXiMrLywgXCJcIikubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcEludCA9IHBhZExlZnQocmVwSW50LCBsZWZ0WmVyb2VzLCBcIjBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmlnaHRaZXJvcyA9IGRlY2ltYWxQYXJ0LnJlcGxhY2UoLyMrJC8sIFwiXCIpLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmlnaHRaZXJvcyA+IHJlcERlY2ltYWwubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcERlY2ltYWwgPSBwYWRSaWdodChyZXBEZWNpbWFsLCByaWdodFplcm9zLCBcIjBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJpZ2h0WmVyb3MgPCByZXBEZWNpbWFsLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBEZWNpbWFsID0gcmVwRGVjaW1hbC5zdWJzdHJpbmcoMCwgcmlnaHRaZXJvcykgKyByZXBEZWNpbWFsLnN1YnN0cmluZyhyaWdodFplcm9zKS5yZXBsYWNlKC8wKyQvLCBcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhvdXNhbmRzIHNlcGFyYXRvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnRQYXJ0LmluZGV4T2YoXCIsXCIpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gcmVwSW50Lmxlbmd0aCAlIDM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRob3VzYW5kR3JvdXBzID0gTWF0aC5mbG9vcihyZXBJbnQubGVuZ3RoIC8gMyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0aG91c2FuZHMgPSBpID4gMCA/IHJlcEludC5zdWJzdHIoMCwgaSkgKyAodGhvdXNhbmRHcm91cHMgPiAwID8gXCIsXCIgOiBcIlwiKSA6IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhvdXNhbmRHcm91cHM7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhvdXNhbmRzICs9IHJlcEludC5zdWJzdHIoaSArIGogKiAzLCAzKSArIChqIDwgdGhvdXNhbmRHcm91cHMgLSAxID8gXCIsXCIgOiBcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBJbnQgPSB0aG91c2FuZHM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXBEZWNpbWFsLmxlbmd0aCA+IDAgPyByZXBJbnQgKyBcIi5cIiArIHJlcERlY2ltYWwgOiByZXBJbnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcCA9IHNpZ24gKyByZXA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChyZXAgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICAgICAgICByZXAgPSBkYXRlVG9TdHJpbmcocmVwLCBwYXR0ZXJuIHx8IGZvcm1hdCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXAgPSB0b1N0cmluZyhyZXApO1xuICAgICAgICB9XG4gICAgICAgIHBhZExlbmd0aCA9IHBhcnNlSW50KChwYWRMZW5ndGggfHwgXCIgXCIpLnN1YnN0cmluZygxKSwgMTApO1xuICAgICAgICBpZiAoIWlzTmFOKHBhZExlbmd0aCkpIHtcbiAgICAgICAgICAgIHJlcCA9IHBhZChTdHJpbmcocmVwKSwgTWF0aC5hYnMocGFkTGVuZ3RoKSwgXCIgXCIsIHBhZExlbmd0aCA8IDApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXA7XG4gICAgfSk7XG59XG5leHBvcnQgZnVuY3Rpb24gZW5kc1dpdGgoc3RyLCBzZWFyY2gpIHtcbiAgICBjb25zdCBpZHggPSBzdHIubGFzdEluZGV4T2Yoc2VhcmNoKTtcbiAgICByZXR1cm4gaWR4ID49IDAgJiYgaWR4ID09PSBzdHIubGVuZ3RoIC0gc2VhcmNoLmxlbmd0aDtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpbml0aWFsaXplKG4sIGYpIHtcbiAgICBpZiAobiA8IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3RyaW5nIGxlbmd0aCBtdXN0IGJlIG5vbi1uZWdhdGl2ZVwiKTtcbiAgICB9XG4gICAgY29uc3QgeHMgPSBuZXcgQXJyYXkobik7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHtcbiAgICAgICAgeHNbaV0gPSBmKGkpO1xuICAgIH1cbiAgICByZXR1cm4geHMuam9pbihcIlwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpbnNlcnQoc3RyLCBzdGFydEluZGV4LCB2YWx1ZSkge1xuICAgIGlmIChzdGFydEluZGV4IDwgMCB8fCBzdGFydEluZGV4ID4gc3RyLmxlbmd0aCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJzdGFydEluZGV4IGlzIG5lZ2F0aXZlIG9yIGdyZWF0ZXIgdGhhbiB0aGUgbGVuZ3RoIG9mIHRoaXMgaW5zdGFuY2UuXCIpO1xuICAgIH1cbiAgICByZXR1cm4gc3RyLnN1YnN0cmluZygwLCBzdGFydEluZGV4KSArIHZhbHVlICsgc3RyLnN1YnN0cmluZyhzdGFydEluZGV4KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpc051bGxPckVtcHR5KHN0cikge1xuICAgIHJldHVybiB0eXBlb2Ygc3RyICE9PSBcInN0cmluZ1wiIHx8IHN0ci5sZW5ndGggPT09IDA7XG59XG5leHBvcnQgZnVuY3Rpb24gaXNOdWxsT3JXaGl0ZVNwYWNlKHN0cikge1xuICAgIHJldHVybiB0eXBlb2Ygc3RyICE9PSBcInN0cmluZ1wiIHx8IC9eXFxzKiQvLnRlc3Qoc3RyKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBjb25jYXQoLi4ueHMpIHtcbiAgICByZXR1cm4geHMubWFwKCh4KSA9PiBTdHJpbmcoeCkpLmpvaW4oXCJcIik7XG59XG5leHBvcnQgZnVuY3Rpb24gam9pbihkZWxpbWl0ZXIsIHhzKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoeHMpKSB7XG4gICAgICAgIHJldHVybiB4cy5qb2luKGRlbGltaXRlcik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh4cykuam9pbihkZWxpbWl0ZXIpO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBqb2luV2l0aEluZGljZXMoZGVsaW1pdGVyLCB4cywgc3RhcnRJbmRleCwgY291bnQpIHtcbiAgICBjb25zdCBlbmRJbmRleFBsdXNPbmUgPSBzdGFydEluZGV4ICsgY291bnQ7XG4gICAgaWYgKGVuZEluZGV4UGx1c09uZSA+IHhzLmxlbmd0aCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbmRleCBhbmQgY291bnQgbXVzdCByZWZlciB0byBhIGxvY2F0aW9uIHdpdGhpbiB0aGUgYnVmZmVyLlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIHhzLnNsaWNlKHN0YXJ0SW5kZXgsIGVuZEluZGV4UGx1c09uZSkuam9pbihkZWxpbWl0ZXIpO1xufVxuZnVuY3Rpb24gbm90U3VwcG9ydGVkKG5hbWUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgZW52aXJvbm1lbnQgZG9lc24ndCBzdXBwb3J0ICdcIiArIG5hbWUgKyBcIicsIHBsZWFzZSB1c2UgYSBwb2x5ZmlsbC5cIik7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9CYXNlNjRTdHJpbmcoaW5BcnJheSkge1xuICAgIGxldCBzdHIgPSBcIlwiO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5BcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgICBzdHIgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShpbkFycmF5W2ldKTtcbiAgICB9XG4gICAgcmV0dXJuIHR5cGVvZiBidG9hID09PSBcImZ1bmN0aW9uXCIgPyBidG9hKHN0cikgOiBub3RTdXBwb3J0ZWQoXCJidG9hXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGZyb21CYXNlNjRTdHJpbmcoYjY0RW5jb2RlZCkge1xuICAgIGNvbnN0IGJpbmFyeSA9IHR5cGVvZiBhdG9iID09PSBcImZ1bmN0aW9uXCIgPyBhdG9iKGI2NEVuY29kZWQpIDogbm90U3VwcG9ydGVkKFwiYXRvYlwiKTtcbiAgICBjb25zdCBieXRlcyA9IG5ldyBVaW50OEFycmF5KGJpbmFyeS5sZW5ndGgpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmluYXJ5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGJ5dGVzW2ldID0gYmluYXJ5LmNoYXJDb2RlQXQoaSk7XG4gICAgfVxuICAgIHJldHVybiBieXRlcztcbn1cbmZ1bmN0aW9uIHBhZChzdHIsIGxlbiwgY2gsIGlzUmlnaHQpIHtcbiAgICBjaCA9IGNoIHx8IFwiIFwiO1xuICAgIGxlbiA9IGxlbiAtIHN0ci5sZW5ndGg7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICBzdHIgPSBpc1JpZ2h0ID8gc3RyICsgY2ggOiBjaCArIHN0cjtcbiAgICB9XG4gICAgcmV0dXJuIHN0cjtcbn1cbmV4cG9ydCBmdW5jdGlvbiBwYWRMZWZ0KHN0ciwgbGVuLCBjaCkge1xuICAgIHJldHVybiBwYWQoc3RyLCBsZW4sIGNoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBwYWRSaWdodChzdHIsIGxlbiwgY2gpIHtcbiAgICByZXR1cm4gcGFkKHN0ciwgbGVuLCBjaCwgdHJ1ZSk7XG59XG5leHBvcnQgZnVuY3Rpb24gcmVtb3ZlKHN0ciwgc3RhcnRJbmRleCwgY291bnQpIHtcbiAgICBpZiAoc3RhcnRJbmRleCA+PSBzdHIubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcInN0YXJ0SW5kZXggbXVzdCBiZSBsZXNzIHRoYW4gbGVuZ3RoIG9mIHN0cmluZ1wiKTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBjb3VudCA9PT0gXCJudW1iZXJcIiAmJiAoc3RhcnRJbmRleCArIGNvdW50KSA+IHN0ci5sZW5ndGgpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW5kZXggYW5kIGNvdW50IG11c3QgcmVmZXIgdG8gYSBsb2NhdGlvbiB3aXRoaW4gdGhlIHN0cmluZy5cIik7XG4gICAgfVxuICAgIHJldHVybiBzdHIuc2xpY2UoMCwgc3RhcnRJbmRleCkgKyAodHlwZW9mIGNvdW50ID09PSBcIm51bWJlclwiID8gc3RyLnN1YnN0cihzdGFydEluZGV4ICsgY291bnQpIDogXCJcIik7XG59XG5leHBvcnQgZnVuY3Rpb24gcmVwbGFjZShzdHIsIHNlYXJjaCwgcmVwbGFjZSkge1xuICAgIHJldHVybiBzdHIucmVwbGFjZShuZXcgUmVnRXhwKGVzY2FwZShzZWFyY2gpLCBcImdcIiksIHJlcGxhY2UpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHJlcGxpY2F0ZShuLCB4KSB7XG4gICAgcmV0dXJuIGluaXRpYWxpemUobiwgKCkgPT4geCk7XG59XG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2hhckF0SW5kZXgoaW5wdXQsIGluZGV4KSB7XG4gICAgaWYgKGluZGV4IDwgMCB8fCBpbmRleCA+PSBpbnB1dC5sZW5ndGgpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW5kZXggd2FzIG91dHNpZGUgdGhlIGJvdW5kcyBvZiB0aGUgYXJyYXkuXCIpO1xuICAgIH1cbiAgICByZXR1cm4gaW5wdXRbaW5kZXhdO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHNwbGl0KHN0ciwgc3BsaXR0ZXJzLCBjb3VudCwgb3B0aW9ucykge1xuICAgIGNvdW50ID0gdHlwZW9mIGNvdW50ID09PSBcIm51bWJlclwiID8gY291bnQgOiB1bmRlZmluZWQ7XG4gICAgb3B0aW9ucyA9IHR5cGVvZiBvcHRpb25zID09PSBcIm51bWJlclwiID8gb3B0aW9ucyA6IDA7XG4gICAgaWYgKGNvdW50ICYmIGNvdW50IDwgMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb3VudCBjYW5ub3QgYmUgbGVzcyB0aGFuIHplcm9cIik7XG4gICAgfVxuICAgIGlmIChjb3VudCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIGNvbnN0IHJlbW92ZUVtcHR5ID0gKG9wdGlvbnMgJiAxKSA9PT0gMTtcbiAgICBjb25zdCB0cmltID0gKG9wdGlvbnMgJiAyKSA9PT0gMjtcbiAgICBzcGxpdHRlcnMgPSBzcGxpdHRlcnMgfHwgW107XG4gICAgc3BsaXR0ZXJzID0gc3BsaXR0ZXJzLmZpbHRlcih4ID0+IHgpLm1hcChlc2NhcGUpO1xuICAgIHNwbGl0dGVycyA9IHNwbGl0dGVycy5sZW5ndGggPiAwID8gc3BsaXR0ZXJzIDogW1wiXFxcXHNcIl07XG4gICAgY29uc3Qgc3BsaXRzID0gW107XG4gICAgY29uc3QgcmVnID0gbmV3IFJlZ0V4cChzcGxpdHRlcnMuam9pbihcInxcIiksIFwiZ1wiKTtcbiAgICBsZXQgZmluZFNwbGl0cyA9IHRydWU7XG4gICAgbGV0IGkgPSAwO1xuICAgIGRvIHtcbiAgICAgICAgY29uc3QgbWF0Y2ggPSByZWcuZXhlYyhzdHIpO1xuICAgICAgICBpZiAobWF0Y2ggPT09IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnN0IGNhbmRpZGF0ZSA9IHRyaW0gPyBzdHIuc3Vic3RyaW5nKGkpLnRyaW0oKSA6IHN0ci5zdWJzdHJpbmcoaSk7XG4gICAgICAgICAgICBpZiAoIXJlbW92ZUVtcHR5IHx8IGNhbmRpZGF0ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgc3BsaXRzLnB1c2goY2FuZGlkYXRlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpbmRTcGxpdHMgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGNhbmRpZGF0ZSA9IHRyaW0gPyBzdHIuc3Vic3RyaW5nKGksIG1hdGNoLmluZGV4KS50cmltKCkgOiBzdHIuc3Vic3RyaW5nKGksIG1hdGNoLmluZGV4KTtcbiAgICAgICAgICAgIGlmICghcmVtb3ZlRW1wdHkgfHwgY2FuZGlkYXRlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBpZiAoY291bnQgIT0gbnVsbCAmJiBzcGxpdHMubGVuZ3RoICsgMSA9PT0gY291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgc3BsaXRzLnB1c2godHJpbSA/IHN0ci5zdWJzdHJpbmcoaSkudHJpbSgpIDogc3RyLnN1YnN0cmluZyhpKSk7XG4gICAgICAgICAgICAgICAgICAgIGZpbmRTcGxpdHMgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNwbGl0cy5wdXNoKGNhbmRpZGF0ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaSA9IHJlZy5sYXN0SW5kZXg7XG4gICAgICAgIH1cbiAgICB9IHdoaWxlIChmaW5kU3BsaXRzKTtcbiAgICByZXR1cm4gc3BsaXRzO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRyaW0oc3RyLCAuLi5jaGFycykge1xuICAgIGlmIChjaGFycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHN0ci50cmltKCk7XG4gICAgfVxuICAgIGNvbnN0IHBhdHRlcm4gPSBcIltcIiArIGVzY2FwZShjaGFycy5qb2luKFwiXCIpKSArIFwiXStcIjtcbiAgICByZXR1cm4gc3RyLnJlcGxhY2UobmV3IFJlZ0V4cChcIl5cIiArIHBhdHRlcm4pLCBcIlwiKS5yZXBsYWNlKG5ldyBSZWdFeHAocGF0dGVybiArIFwiJFwiKSwgXCJcIik7XG59XG5leHBvcnQgZnVuY3Rpb24gdHJpbVN0YXJ0KHN0ciwgLi4uY2hhcnMpIHtcbiAgICByZXR1cm4gY2hhcnMubGVuZ3RoID09PSAwXG4gICAgICAgID8gc3RyLnRyaW1TdGFydCgpXG4gICAgICAgIDogc3RyLnJlcGxhY2UobmV3IFJlZ0V4cChcIl5bXCIgKyBlc2NhcGUoY2hhcnMuam9pbihcIlwiKSkgKyBcIl0rXCIpLCBcIlwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0cmltRW5kKHN0ciwgLi4uY2hhcnMpIHtcbiAgICByZXR1cm4gY2hhcnMubGVuZ3RoID09PSAwXG4gICAgICAgID8gc3RyLnRyaW1FbmQoKVxuICAgICAgICA6IHN0ci5yZXBsYWNlKG5ldyBSZWdFeHAoXCJbXCIgKyBlc2NhcGUoY2hhcnMuam9pbihcIlwiKSkgKyBcIl0rJFwiKSwgXCJcIik7XG59XG5leHBvcnQgZnVuY3Rpb24gZmlsdGVyKHByZWQsIHgpIHtcbiAgICByZXR1cm4geC5zcGxpdChcIlwiKS5maWx0ZXIoKGMpID0+IHByZWQoYykpLmpvaW4oXCJcIik7XG59XG5leHBvcnQgZnVuY3Rpb24gc3Vic3RyaW5nKHN0ciwgc3RhcnRJbmRleCwgbGVuZ3RoKSB7XG4gICAgaWYgKChzdGFydEluZGV4ICsgKGxlbmd0aCB8fCAwKSA+IHN0ci5sZW5ndGgpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgc3RhcnRJbmRleCBhbmQvb3IgbGVuZ3RoXCIpO1xuICAgIH1cbiAgICByZXR1cm4gbGVuZ3RoICE9IG51bGwgPyBzdHIuc3Vic3RyKHN0YXJ0SW5kZXgsIGxlbmd0aCkgOiBzdHIuc3Vic3RyKHN0YXJ0SW5kZXgpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvQ2hhckFycmF5MihzdHIsIHN0YXJ0SW5kZXgsIGxlbmd0aCkge1xuICAgIHJldHVybiBzdWJzdHJpbmcoc3RyLCBzdGFydEluZGV4LCBsZW5ndGgpLnNwbGl0KFwiXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGZtdChzdHJzLCAuLi5hcmdzKSB7XG4gICAgcmV0dXJuICh7IHN0cnMsIGFyZ3MgfSk7XG59XG5leHBvcnQgZnVuY3Rpb24gZm10V2l0aChmbXRzKSB7XG4gICAgcmV0dXJuIChzdHJzLCAuLi5hcmdzKSA9PiAoeyBzdHJzLCBhcmdzLCBmbXRzIH0pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGdldEZvcm1hdChzKSB7XG4gICAgcmV0dXJuIHMuZm10c1xuICAgICAgICA/IHMuc3Rycy5yZWR1Y2UoKGFjYywgbmV3UGFydCwgaW5kZXgpID0+IGFjYyArIGB7JHtTdHJpbmcoaW5kZXggLSAxKSArIHMuZm10c1tpbmRleCAtIDFdfX1gICsgbmV3UGFydClcbiAgICAgICAgOiBzLnN0cnMucmVkdWNlKChhY2MsIG5ld1BhcnQsIGluZGV4KSA9PiBhY2MgKyBgeyR7aW5kZXggLSAxfX1gICsgbmV3UGFydCk7XG59XG4iLAogICJpbXBvcnQgeyB0b1N0cmluZyBhcyBkYXRlVG9TdHJpbmcgfSBmcm9tIFwiLi9EYXRlLmpzXCI7XG5pbXBvcnQgeyBjb21wYXJlIGFzIG51bWVyaWNDb21wYXJlLCBpc051bWVyaWMsIG11bHRpcGx5LCB0b0V4cG9uZW50aWFsLCB0b0ZpeGVkLCB0b0hleCwgdG9QcmVjaXNpb24gfSBmcm9tIFwiLi9OdW1lcmljLmpzXCI7XG5pbXBvcnQgeyBlc2NhcGUgfSBmcm9tIFwiLi9SZWdFeHAuanNcIjtcbmltcG9ydCB7IHRvU3RyaW5nIH0gZnJvbSBcIi4vVHlwZXMuanNcIjtcbmNvbnN0IGZzRm9ybWF0UmVnRXhwID0gLyhefFteJV0pJShbMCtcXC0gXSopKFxcKnxcXGQrKT8oPzpcXC4oXFxkKykpPyhcXHcpL2c7XG5jb25zdCBpbnRlcnBvbGF0ZVJlZ0V4cCA9IC8oPzooXnxbXiVdKSUoWzArXFwtIF0qKShcXGQrKT8oPzpcXC4oXFxkKykpPyhcXHcpKT8lUFxcKFxcKS9nO1xuY29uc3QgZm9ybWF0UmVnRXhwID0gL1xceyhcXGQrKSgsLT9cXGQrKT8oPzpcXDooW2EtekEtWl0pKFxcZHswLDJ9KXxcXDooLis/KSk/XFx9L2c7XG5mdW5jdGlvbiBpc0xlc3NUaGFuKHgsIHkpIHtcbiAgICByZXR1cm4gbnVtZXJpY0NvbXBhcmUoeCwgeSkgPCAwO1xufVxuZnVuY3Rpb24gY21wKHgsIHksIGljKSB7XG4gICAgZnVuY3Rpb24gaXNJZ25vcmVDYXNlKGkpIHtcbiAgICAgICAgcmV0dXJuIGkgPT09IHRydWUgfHxcbiAgICAgICAgICAgIGkgPT09IDEgLyogU3RyaW5nQ29tcGFyaXNvbi5DdXJyZW50Q3VsdHVyZUlnbm9yZUNhc2UgKi8gfHxcbiAgICAgICAgICAgIGkgPT09IDMgLyogU3RyaW5nQ29tcGFyaXNvbi5JbnZhcmlhbnRDdWx0dXJlSWdub3JlQ2FzZSAqLyB8fFxuICAgICAgICAgICAgaSA9PT0gNSAvKiBTdHJpbmdDb21wYXJpc29uLk9yZGluYWxJZ25vcmVDYXNlICovO1xuICAgIH1cbiAgICBmdW5jdGlvbiBpc09yZGluYWwoaSkge1xuICAgICAgICByZXR1cm4gaSA9PT0gNCAvKiBTdHJpbmdDb21wYXJpc29uLk9yZGluYWwgKi8gfHxcbiAgICAgICAgICAgIGkgPT09IDUgLyogU3RyaW5nQ29tcGFyaXNvbi5PcmRpbmFsSWdub3JlQ2FzZSAqLztcbiAgICB9XG4gICAgaWYgKHggPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4geSA9PSBudWxsID8gMCA6IC0xO1xuICAgIH1cbiAgICBpZiAoeSA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiAxO1xuICAgIH0gLy8gZXZlcnl0aGluZyBpcyBiaWdnZXIgdGhhbiBudWxsXG4gICAgaWYgKGlzT3JkaW5hbChpYykpIHtcbiAgICAgICAgaWYgKGlzSWdub3JlQ2FzZShpYykpIHtcbiAgICAgICAgICAgIHggPSB4LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICB5ID0geS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoeCA9PT0geSkgPyAwIDogKHggPCB5ID8gLTEgOiAxKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChpc0lnbm9yZUNhc2UoaWMpKSB7XG4gICAgICAgICAgICB4ID0geC50b0xvY2FsZUxvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgeSA9IHkudG9Mb2NhbGVMb3dlckNhc2UoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geC5sb2NhbGVDb21wYXJlKHkpO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBjb21wYXJlKC4uLmFyZ3MpIHtcbiAgICBzd2l0Y2ggKGFyZ3MubGVuZ3RoKSB7XG4gICAgICAgIGNhc2UgMjogcmV0dXJuIGNtcChhcmdzWzBdLCBhcmdzWzFdLCBmYWxzZSk7XG4gICAgICAgIGNhc2UgMzogcmV0dXJuIGNtcChhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdKTtcbiAgICAgICAgY2FzZSA0OiByZXR1cm4gY21wKGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0gPT09IHRydWUpO1xuICAgICAgICBjYXNlIDU6IHJldHVybiBjbXAoYXJnc1swXS5zdWJzdHIoYXJnc1sxXSwgYXJnc1s0XSksIGFyZ3NbMl0uc3Vic3RyKGFyZ3NbM10sIGFyZ3NbNF0pLCBmYWxzZSk7XG4gICAgICAgIGNhc2UgNjogcmV0dXJuIGNtcChhcmdzWzBdLnN1YnN0cihhcmdzWzFdLCBhcmdzWzRdKSwgYXJnc1syXS5zdWJzdHIoYXJnc1szXSwgYXJnc1s0XSksIGFyZ3NbNV0pO1xuICAgICAgICBjYXNlIDc6IHJldHVybiBjbXAoYXJnc1swXS5zdWJzdHIoYXJnc1sxXSwgYXJnc1s0XSksIGFyZ3NbMl0uc3Vic3RyKGFyZ3NbM10sIGFyZ3NbNF0pLCBhcmdzWzVdID09PSB0cnVlKTtcbiAgICAgICAgZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKFwiU3RyaW5nLmNvbXBhcmU6IFVuc3VwcG9ydGVkIG51bWJlciBvZiBwYXJhbWV0ZXJzXCIpO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBjb21wYXJlT3JkaW5hbCh4LCB5KSB7XG4gICAgcmV0dXJuIGNtcCh4LCB5LCA0IC8qIFN0cmluZ0NvbXBhcmlzb24uT3JkaW5hbCAqLyk7XG59XG5leHBvcnQgZnVuY3Rpb24gY29tcGFyZVRvKHgsIHkpIHtcbiAgICByZXR1cm4gY21wKHgsIHksIDAgLyogU3RyaW5nQ29tcGFyaXNvbi5DdXJyZW50Q3VsdHVyZSAqLyk7XG59XG5leHBvcnQgZnVuY3Rpb24gc3RhcnRzV2l0aChzdHIsIHBhdHRlcm4sIGljKSB7XG4gICAgaWYgKHN0ci5sZW5ndGggPj0gcGF0dGVybi5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIGNtcChzdHIuc3Vic3RyKDAsIHBhdHRlcm4ubGVuZ3RoKSwgcGF0dGVybiwgaWMpID09PSAwO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG5leHBvcnQgZnVuY3Rpb24gaW5kZXhPZkFueShzdHIsIGFueU9mLCAuLi5hcmdzKSB7XG4gICAgaWYgKHN0ciA9PSBudWxsIHx8IHN0ciA9PT0gXCJcIikge1xuICAgICAgICByZXR1cm4gLTE7XG4gICAgfVxuICAgIGNvbnN0IHN0YXJ0SW5kZXggPSAoYXJncy5sZW5ndGggPiAwKSA/IGFyZ3NbMF0gOiAwO1xuICAgIGlmIChzdGFydEluZGV4IDwgMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTdGFydCBpbmRleCBjYW5ub3QgYmUgbmVnYXRpdmVcIik7XG4gICAgfVxuICAgIGNvbnN0IGxlbmd0aCA9IChhcmdzLmxlbmd0aCA+IDEpID8gYXJnc1sxXSA6IHN0ci5sZW5ndGggLSBzdGFydEluZGV4O1xuICAgIGlmIChsZW5ndGggPCAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkxlbmd0aCBjYW5ub3QgYmUgbmVnYXRpdmVcIik7XG4gICAgfVxuICAgIGlmIChzdGFydEluZGV4ICsgbGVuZ3RoID4gc3RyLmxlbmd0aCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHN0YXJ0SW5kZXggYW5kIGxlbmd0aFwiKTtcbiAgICB9XG4gICAgY29uc3QgZW5kSW5kZXggPSBzdGFydEluZGV4ICsgbGVuZ3RoO1xuICAgIGNvbnN0IGFueU9mQXNTdHIgPSBcIlwiLmNvbmNhdC5hcHBseShcIlwiLCBhbnlPZik7XG4gICAgZm9yIChsZXQgaSA9IHN0YXJ0SW5kZXg7IGkgPCBlbmRJbmRleDsgaSsrKSB7XG4gICAgICAgIGlmIChhbnlPZkFzU3RyLmluZGV4T2Yoc3RyW2ldKSA+IC0xKSB7XG4gICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gLTE7XG59XG5leHBvcnQgZnVuY3Rpb24gcHJpbnRmKGlucHV0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgaW5wdXQsXG4gICAgICAgIGNvbnQ6IGZzRm9ybWF0KGlucHV0KSxcbiAgICB9O1xufVxuZXhwb3J0IGZ1bmN0aW9uIGludGVycG9sYXRlKHN0ciwgdmFsdWVzKSB7XG4gICAgbGV0IHZhbElkeCA9IDA7XG4gICAgbGV0IHN0cklkeCA9IDA7XG4gICAgbGV0IHJlc3VsdCA9IFwiXCI7XG4gICAgaW50ZXJwb2xhdGVSZWdFeHAubGFzdEluZGV4ID0gMDtcbiAgICBsZXQgbWF0Y2ggPSBpbnRlcnBvbGF0ZVJlZ0V4cC5leGVjKHN0cik7XG4gICAgd2hpbGUgKG1hdGNoKSB7XG4gICAgICAgIC8vIFRoZSBmaXJzdCBncm91cCBjb3JyZXNwb25kcyB0byB0aGUgbm8tZXNjYXBlIGNoYXIgKF58W14lXSksIHRoZSBhY3R1YWwgcGF0dGVybiBzdGFydHMgaW4gdGhlIG5leHQgY2hhclxuICAgICAgICAvLyBOb3RlOiB3ZSBkb24ndCB1c2UgbmVnYXRpdmUgbG9va2JlaGluZCBiZWNhdXNlIHNvbWUgYnJvd3NlcnMgZG9uJ3Qgc3VwcG9ydCBpdCB5ZXRcbiAgICAgICAgY29uc3QgbWF0Y2hJbmRleCA9IG1hdGNoLmluZGV4ICsgKG1hdGNoWzFdIHx8IFwiXCIpLmxlbmd0aDtcbiAgICAgICAgcmVzdWx0ICs9IHN0ci5zdWJzdHJpbmcoc3RySWR4LCBtYXRjaEluZGV4KS5yZXBsYWNlKC8lJS9nLCBcIiVcIik7XG4gICAgICAgIGNvbnN0IFssICwgZmxhZ3MsIHBhZExlbmd0aCwgcHJlY2lzaW9uLCBmb3JtYXRdID0gbWF0Y2g7XG4gICAgICAgIC8vIFNhdmUgaW50ZXJwb2xhdGVSZWdFeHAubGFzdEluZGV4IGJlZm9yZSBydW5uaW5nIGZvcm1hdFJlcGxhY2VtZW50IGJlY2F1c2UgdGhlIHZhbHVlc1xuICAgICAgICAvLyBtYXkgYWxzbyBpbnZvbHZlIGludGVycG9sYXRpb24gYW5kIG1ha2UgdXNlIG9mIGludGVycG9sYXRlUmVnRXhwIChzZWUgIzMwNzgpXG4gICAgICAgIHN0cklkeCA9IGludGVycG9sYXRlUmVnRXhwLmxhc3RJbmRleDtcbiAgICAgICAgcmVzdWx0ICs9IGZvcm1hdFJlcGxhY2VtZW50KHZhbHVlc1t2YWxJZHgrK10sIGZsYWdzLCBwYWRMZW5ndGgsIHByZWNpc2lvbiwgZm9ybWF0KTtcbiAgICAgICAgLy8gTW92ZSBpbnRlcnBvbGF0ZVJlZ0V4cC5sYXN0SW5kZXggb25lIGNoYXIgYmVoaW5kIHRvIG1ha2Ugc3VyZSB3ZSBtYXRjaCB0aGUgbm8tZXNjYXBlIGNoYXIgbmV4dCB0aW1lXG4gICAgICAgIGludGVycG9sYXRlUmVnRXhwLmxhc3RJbmRleCA9IHN0cklkeCAtIDE7XG4gICAgICAgIG1hdGNoID0gaW50ZXJwb2xhdGVSZWdFeHAuZXhlYyhzdHIpO1xuICAgIH1cbiAgICByZXN1bHQgKz0gc3RyLnN1YnN0cmluZyhzdHJJZHgpLnJlcGxhY2UoLyUlL2csIFwiJVwiKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufVxuZnVuY3Rpb24gY29udGludWVQcmludChjb250LCBhcmcpIHtcbiAgICByZXR1cm4gdHlwZW9mIGFyZyA9PT0gXCJzdHJpbmdcIiA/IGNvbnQoYXJnKSA6IGFyZy5jb250KGNvbnQpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvQ29uc29sZShhcmcpIHtcbiAgICAvLyBEb24ndCByZW1vdmUgdGhlIGxhbWJkYSBoZXJlLCBzZWUgIzEzNTdcbiAgICByZXR1cm4gY29udGludWVQcmludCgoeCkgPT4gY29uc29sZS5sb2coeCksIGFyZyk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9Db25zb2xlRXJyb3IoYXJnKSB7XG4gICAgcmV0dXJuIGNvbnRpbnVlUHJpbnQoKHgpID0+IGNvbnNvbGUuZXJyb3IoeCksIGFyZyk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9UZXh0KGFyZykge1xuICAgIHJldHVybiBjb250aW51ZVByaW50KCh4KSA9PiB4LCBhcmcpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvRmFpbChhcmcpIHtcbiAgICByZXR1cm4gY29udGludWVQcmludCgoeCkgPT4ge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoeCk7XG4gICAgfSwgYXJnKTtcbn1cbmZ1bmN0aW9uIGZvcm1hdFJlcGxhY2VtZW50KHJlcCwgZmxhZ3MsIHBhZExlbmd0aCwgcHJlY2lzaW9uLCBmb3JtYXQpIHtcbiAgICBsZXQgc2lnbiA9IFwiXCI7XG4gICAgZmxhZ3MgPSBmbGFncyB8fCBcIlwiO1xuICAgIGZvcm1hdCA9IGZvcm1hdCB8fCBcIlwiO1xuICAgIGlmIChpc051bWVyaWMocmVwKSkge1xuICAgICAgICBpZiAoZm9ybWF0LnRvTG93ZXJDYXNlKCkgIT09IFwieFwiKSB7XG4gICAgICAgICAgICBpZiAoaXNMZXNzVGhhbihyZXAsIDApKSB7XG4gICAgICAgICAgICAgICAgcmVwID0gbXVsdGlwbHkocmVwLCAtMSk7XG4gICAgICAgICAgICAgICAgc2lnbiA9IFwiLVwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGZsYWdzLmluZGV4T2YoXCIgXCIpID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgc2lnbiA9IFwiIFwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChmbGFncy5pbmRleE9mKFwiK1wiKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHNpZ24gPSBcIitcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcHJlY2lzaW9uID0gcHJlY2lzaW9uID09IG51bGwgPyBudWxsIDogcGFyc2VJbnQocHJlY2lzaW9uLCAxMCk7XG4gICAgICAgIHN3aXRjaCAoZm9ybWF0KSB7XG4gICAgICAgICAgICBjYXNlIFwiZlwiOlxuICAgICAgICAgICAgY2FzZSBcIkZcIjpcbiAgICAgICAgICAgICAgICBwcmVjaXNpb24gPSBwcmVjaXNpb24gIT0gbnVsbCA/IHByZWNpc2lvbiA6IDY7XG4gICAgICAgICAgICAgICAgcmVwID0gdG9GaXhlZChyZXAsIHByZWNpc2lvbik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZ1wiOlxuICAgICAgICAgICAgY2FzZSBcIkdcIjpcbiAgICAgICAgICAgICAgICByZXAgPSBwcmVjaXNpb24gIT0gbnVsbCA/IHRvUHJlY2lzaW9uKHJlcCwgcHJlY2lzaW9uKSA6IHRvUHJlY2lzaW9uKHJlcCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZVwiOlxuICAgICAgICAgICAgY2FzZSBcIkVcIjpcbiAgICAgICAgICAgICAgICByZXAgPSBwcmVjaXNpb24gIT0gbnVsbCA/IHRvRXhwb25lbnRpYWwocmVwLCBwcmVjaXNpb24pIDogdG9FeHBvbmVudGlhbChyZXApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInhcIjpcbiAgICAgICAgICAgICAgICByZXAgPSB0b0hleChyZXApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIlhcIjpcbiAgICAgICAgICAgICAgICByZXAgPSB0b0hleChyZXApLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OiAvLyBBT2lkXG4gICAgICAgICAgICAgICAgcmVwID0gU3RyaW5nKHJlcCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAocmVwIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgICByZXAgPSBkYXRlVG9TdHJpbmcocmVwKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJlcCA9IHRvU3RyaW5nKHJlcCk7XG4gICAgfVxuICAgIHBhZExlbmd0aCA9IHR5cGVvZiBwYWRMZW5ndGggPT09IFwibnVtYmVyXCIgPyBwYWRMZW5ndGggOiBwYXJzZUludChwYWRMZW5ndGgsIDEwKTtcbiAgICBpZiAoIWlzTmFOKHBhZExlbmd0aCkpIHtcbiAgICAgICAgY29uc3QgemVyb0ZsYWcgPSBmbGFncy5pbmRleE9mKFwiMFwiKSA+PSAwOyAvLyBVc2UgJzAnIGZvciBsZWZ0IHBhZGRpbmdcbiAgICAgICAgY29uc3QgbWludXNGbGFnID0gZmxhZ3MuaW5kZXhPZihcIi1cIikgPj0gMDsgLy8gUmlnaHQgcGFkZGluZ1xuICAgICAgICBjb25zdCBjaCA9IG1pbnVzRmxhZyB8fCAhemVyb0ZsYWcgPyBcIiBcIiA6IFwiMFwiO1xuICAgICAgICBpZiAoY2ggPT09IFwiMFwiKSB7XG4gICAgICAgICAgICByZXAgPSBwYWQocmVwLCBwYWRMZW5ndGggLSBzaWduLmxlbmd0aCwgY2gsIG1pbnVzRmxhZyk7XG4gICAgICAgICAgICByZXAgPSBzaWduICsgcmVwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVwID0gcGFkKHNpZ24gKyByZXAsIHBhZExlbmd0aCwgY2gsIG1pbnVzRmxhZyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJlcCA9IHNpZ24gKyByZXA7XG4gICAgfVxuICAgIHJldHVybiByZXA7XG59XG5mdW5jdGlvbiBjcmVhdGVQcmludGVyKGNvbnQsIF9zdHJQYXJ0cywgX21hdGNoZXMsIF9yZXN1bHQgPSBcIlwiLCBwYWRBcmcgPSAtMSkge1xuICAgIHJldHVybiAoLi4uYXJncykgPT4ge1xuICAgICAgICAvLyBNYWtlIGNvcGllcyBvZiB0aGUgdmFsdWVzIHBhc3NlZCBieSByZWZlcmVuY2UgYmVjYXVzZSB0aGUgZnVuY3Rpb24gY2FuIGJlIHVzZWQgbXVsdGlwbGUgdGltZXNcbiAgICAgICAgbGV0IHJlc3VsdCA9IF9yZXN1bHQ7XG4gICAgICAgIGNvbnN0IHN0clBhcnRzID0gX3N0clBhcnRzLnNsaWNlKCk7XG4gICAgICAgIGNvbnN0IG1hdGNoZXMgPSBfbWF0Y2hlcy5zbGljZSgpO1xuICAgICAgICBmb3IgKGNvbnN0IGFyZyBvZiBhcmdzKSB7XG4gICAgICAgICAgICBjb25zdCBbLCAsIGZsYWdzLCBfcGFkTGVuZ3RoLCBwcmVjaXNpb24sIGZvcm1hdF0gPSBtYXRjaGVzWzBdO1xuICAgICAgICAgICAgbGV0IHBhZExlbmd0aCA9IF9wYWRMZW5ndGg7XG4gICAgICAgICAgICBpZiAocGFkQXJnID49IDApIHtcbiAgICAgICAgICAgICAgICBwYWRMZW5ndGggPSBwYWRBcmc7XG4gICAgICAgICAgICAgICAgcGFkQXJnID0gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwYWRMZW5ndGggPT09IFwiKlwiKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFyZyA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm9uLW5lZ2F0aXZlIG51bWJlciByZXF1aXJlZFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcGFkQXJnID0gYXJnO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVzdWx0ICs9IHN0clBhcnRzWzBdO1xuICAgICAgICAgICAgcmVzdWx0ICs9IGZvcm1hdFJlcGxhY2VtZW50KGFyZywgZmxhZ3MsIHBhZExlbmd0aCwgcHJlY2lzaW9uLCBmb3JtYXQpO1xuICAgICAgICAgICAgc3RyUGFydHMuc3BsaWNlKDAsIDEpO1xuICAgICAgICAgICAgbWF0Y2hlcy5zcGxpY2UoMCwgMSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1hdGNoZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXN1bHQgKz0gc3RyUGFydHNbMF07XG4gICAgICAgICAgICByZXR1cm4gY29udChyZXN1bHQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZVByaW50ZXIoY29udCwgc3RyUGFydHMsIG1hdGNoZXMsIHJlc3VsdCwgcGFkQXJnKTtcbiAgICAgICAgfVxuICAgIH07XG59XG5leHBvcnQgZnVuY3Rpb24gZnNGb3JtYXQoc3RyKSB7XG4gICAgcmV0dXJuIChjb250KSA9PiB7XG4gICAgICAgIGZzRm9ybWF0UmVnRXhwLmxhc3RJbmRleCA9IDA7XG4gICAgICAgIGNvbnN0IHN0clBhcnRzID0gW107XG4gICAgICAgIGNvbnN0IG1hdGNoZXMgPSBbXTtcbiAgICAgICAgbGV0IHN0cklkeCA9IDA7XG4gICAgICAgIGxldCBtYXRjaCA9IGZzRm9ybWF0UmVnRXhwLmV4ZWMoc3RyKTtcbiAgICAgICAgd2hpbGUgKG1hdGNoKSB7XG4gICAgICAgICAgICAvLyBUaGUgZmlyc3QgZ3JvdXAgY29ycmVzcG9uZHMgdG8gdGhlIG5vLWVzY2FwZSBjaGFyIChefFteJV0pLCB0aGUgYWN0dWFsIHBhdHRlcm4gc3RhcnRzIGluIHRoZSBuZXh0IGNoYXJcbiAgICAgICAgICAgIC8vIE5vdGU6IHdlIGRvbid0IHVzZSBuZWdhdGl2ZSBsb29rYmVoaW5kIGJlY2F1c2Ugc29tZSBicm93c2VycyBkb24ndCBzdXBwb3J0IGl0IHlldFxuICAgICAgICAgICAgY29uc3QgbWF0Y2hJbmRleCA9IG1hdGNoLmluZGV4ICsgKG1hdGNoWzFdIHx8IFwiXCIpLmxlbmd0aDtcbiAgICAgICAgICAgIHN0clBhcnRzLnB1c2goc3RyLnN1YnN0cmluZyhzdHJJZHgsIG1hdGNoSW5kZXgpLnJlcGxhY2UoLyUlL2csIFwiJVwiKSk7XG4gICAgICAgICAgICBtYXRjaGVzLnB1c2gobWF0Y2gpO1xuICAgICAgICAgICAgc3RySWR4ID0gZnNGb3JtYXRSZWdFeHAubGFzdEluZGV4O1xuICAgICAgICAgICAgLy8gTGlrZXdpc2Ugd2UgbmVlZCB0byBtb3ZlIGZzRm9ybWF0UmVnRXhwLmxhc3RJbmRleCBvbmUgY2hhciBiZWhpbmQgdG8gbWFrZSBzdXJlIHdlIG1hdGNoIHRoZSBuby1lc2NhcGUgY2hhciBuZXh0IHRpbWVcbiAgICAgICAgICAgIGZzRm9ybWF0UmVnRXhwLmxhc3RJbmRleCAtPSAxO1xuICAgICAgICAgICAgbWF0Y2ggPSBmc0Zvcm1hdFJlZ0V4cC5leGVjKHN0cik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN0clBhcnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGNvbnQoc3RyLnJlcGxhY2UoLyUlL2csIFwiJVwiKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzdHJQYXJ0cy5wdXNoKHN0ci5zdWJzdHJpbmcoc3RySWR4KS5yZXBsYWNlKC8lJS9nLCBcIiVcIikpO1xuICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZVByaW50ZXIoY29udCwgc3RyUGFydHMsIG1hdGNoZXMpO1xuICAgICAgICB9XG4gICAgfTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXQoc3RyLCAuLi5hcmdzKSB7XG4gICAgbGV0IHN0cjI7XG4gICAgaWYgKHR5cGVvZiBzdHIgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgLy8gQ2FsbGVkIHdpdGggY3VsdHVyZSBpbmZvXG4gICAgICAgIHN0cjIgPSBTdHJpbmcoYXJnc1swXSk7XG4gICAgICAgIGFyZ3Muc2hpZnQoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHN0cjIgPSBzdHI7XG4gICAgfVxuICAgIHJldHVybiBzdHIyLnJlcGxhY2UoZm9ybWF0UmVnRXhwLCAoXywgaWR4LCBwYWRMZW5ndGgsIGZvcm1hdCwgcHJlY2lzaW9uLCBwYXR0ZXJuKSA9PiB7XG4gICAgICAgIGlmIChpZHggPCAwIHx8IGlkeCA+PSBhcmdzLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW5kZXggbXVzdCBiZSBncmVhdGVyIG9yIGVxdWFsIHRvIHplcm8gYW5kIGxlc3MgdGhhbiB0aGUgYXJndW1lbnRzJyBsZW5ndGguXCIpO1xuICAgICAgICB9XG4gICAgICAgIGxldCByZXAgPSBhcmdzW2lkeF07XG4gICAgICAgIGlmIChpc051bWVyaWMocmVwKSkge1xuICAgICAgICAgICAgcHJlY2lzaW9uID0gcHJlY2lzaW9uID09IG51bGwgPyBudWxsIDogcGFyc2VJbnQocHJlY2lzaW9uLCAxMCk7XG4gICAgICAgICAgICBzd2l0Y2ggKGZvcm1hdCkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJmXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcIkZcIjpcbiAgICAgICAgICAgICAgICAgICAgcHJlY2lzaW9uID0gcHJlY2lzaW9uICE9IG51bGwgPyBwcmVjaXNpb24gOiAyO1xuICAgICAgICAgICAgICAgICAgICByZXAgPSB0b0ZpeGVkKHJlcCwgcHJlY2lzaW9uKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImdcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiR1wiOlxuICAgICAgICAgICAgICAgICAgICByZXAgPSBwcmVjaXNpb24gIT0gbnVsbCA/IHRvUHJlY2lzaW9uKHJlcCwgcHJlY2lzaW9uKSA6IHRvUHJlY2lzaW9uKHJlcCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJlXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcIkVcIjpcbiAgICAgICAgICAgICAgICAgICAgcmVwID0gcHJlY2lzaW9uICE9IG51bGwgPyB0b0V4cG9uZW50aWFsKHJlcCwgcHJlY2lzaW9uKSA6IHRvRXhwb25lbnRpYWwocmVwKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcInBcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiUFwiOlxuICAgICAgICAgICAgICAgICAgICBwcmVjaXNpb24gPSBwcmVjaXNpb24gIT0gbnVsbCA/IHByZWNpc2lvbiA6IDI7XG4gICAgICAgICAgICAgICAgICAgIHJlcCA9IHRvRml4ZWQobXVsdGlwbHkocmVwLCAxMDApLCBwcmVjaXNpb24pICsgXCIgJVwiO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJEXCI6XG4gICAgICAgICAgICAgICAgICAgIHJlcCA9IHByZWNpc2lvbiAhPSBudWxsID8gcGFkTGVmdChTdHJpbmcocmVwKSwgcHJlY2lzaW9uLCBcIjBcIikgOiBTdHJpbmcocmVwKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcInhcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiWFwiOlxuICAgICAgICAgICAgICAgICAgICByZXAgPSBwcmVjaXNpb24gIT0gbnVsbCA/IHBhZExlZnQodG9IZXgocmVwKSwgcHJlY2lzaW9uLCBcIjBcIikgOiB0b0hleChyZXApO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZm9ybWF0ID09PSBcIlhcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVwID0gcmVwLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhdHRlcm4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzaWduID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcCA9IHBhdHRlcm4ucmVwbGFjZSgvKFswIyxdKykoXFwuWzAjXSspPy8sIChfLCBpbnRQYXJ0LCBkZWNpbWFsUGFydCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0xlc3NUaGFuKHJlcCwgMCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwID0gbXVsdGlwbHkocmVwLCAtMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ24gPSBcIi1cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVjaW1hbFBhcnQgPSBkZWNpbWFsUGFydCA9PSBudWxsID8gXCJcIiA6IGRlY2ltYWxQYXJ0LnN1YnN0cmluZygxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXAgPSB0b0ZpeGVkKHJlcCwgTWF0aC5tYXgoZGVjaW1hbFBhcnQubGVuZ3RoLCAwKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IFtyZXBJbnQsIHJlcERlY2ltYWxdID0gcmVwLnNwbGl0KFwiLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBEZWNpbWFsIHx8IChyZXBEZWNpbWFsID0gXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGVmdFplcm9lcyA9IGludFBhcnQucmVwbGFjZSgvLC9nLCBcIlwiKS5yZXBsYWNlKC9eIysvLCBcIlwiKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwSW50ID0gcGFkTGVmdChyZXBJbnQsIGxlZnRaZXJvZXMsIFwiMFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByaWdodFplcm9zID0gZGVjaW1hbFBhcnQucmVwbGFjZSgvIyskLywgXCJcIikubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyaWdodFplcm9zID4gcmVwRGVjaW1hbC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwRGVjaW1hbCA9IHBhZFJpZ2h0KHJlcERlY2ltYWwsIHJpZ2h0WmVyb3MsIFwiMFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmlnaHRaZXJvcyA8IHJlcERlY2ltYWwubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcERlY2ltYWwgPSByZXBEZWNpbWFsLnN1YnN0cmluZygwLCByaWdodFplcm9zKSArIHJlcERlY2ltYWwuc3Vic3RyaW5nKHJpZ2h0WmVyb3MpLnJlcGxhY2UoLzArJC8sIFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaG91c2FuZHMgc2VwYXJhdG9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGludFBhcnQuaW5kZXhPZihcIixcIikgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGkgPSByZXBJbnQubGVuZ3RoICUgMztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGhvdXNhbmRHcm91cHMgPSBNYXRoLmZsb29yKHJlcEludC5sZW5ndGggLyAzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHRob3VzYW5kcyA9IGkgPiAwID8gcmVwSW50LnN1YnN0cigwLCBpKSArICh0aG91c2FuZEdyb3VwcyA+IDAgPyBcIixcIiA6IFwiXCIpIDogXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aG91c2FuZEdyb3VwczsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aG91c2FuZHMgKz0gcmVwSW50LnN1YnN0cihpICsgaiAqIDMsIDMpICsgKGogPCB0aG91c2FuZEdyb3VwcyAtIDEgPyBcIixcIiA6IFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcEludCA9IHRob3VzYW5kcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcERlY2ltYWwubGVuZ3RoID4gMCA/IHJlcEludCArIFwiLlwiICsgcmVwRGVjaW1hbCA6IHJlcEludDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVwID0gc2lnbiArIHJlcDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHJlcCBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgICAgICAgIHJlcCA9IGRhdGVUb1N0cmluZyhyZXAsIHBhdHRlcm4gfHwgZm9ybWF0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJlcCA9IHRvU3RyaW5nKHJlcCk7XG4gICAgICAgIH1cbiAgICAgICAgcGFkTGVuZ3RoID0gcGFyc2VJbnQoKHBhZExlbmd0aCB8fCBcIiBcIikuc3Vic3RyaW5nKDEpLCAxMCk7XG4gICAgICAgIGlmICghaXNOYU4ocGFkTGVuZ3RoKSkge1xuICAgICAgICAgICAgcmVwID0gcGFkKFN0cmluZyhyZXApLCBNYXRoLmFicyhwYWRMZW5ndGgpLCBcIiBcIiwgcGFkTGVuZ3RoIDwgMCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlcDtcbiAgICB9KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBlbmRzV2l0aChzdHIsIHNlYXJjaCkge1xuICAgIGNvbnN0IGlkeCA9IHN0ci5sYXN0SW5kZXhPZihzZWFyY2gpO1xuICAgIHJldHVybiBpZHggPj0gMCAmJiBpZHggPT09IHN0ci5sZW5ndGggLSBzZWFyY2gubGVuZ3RoO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGluaXRpYWxpemUobiwgZikge1xuICAgIGlmIChuIDwgMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTdHJpbmcgbGVuZ3RoIG11c3QgYmUgbm9uLW5lZ2F0aXZlXCIpO1xuICAgIH1cbiAgICBjb25zdCB4cyA9IG5ldyBBcnJheShuKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG47IGkrKykge1xuICAgICAgICB4c1tpXSA9IGYoaSk7XG4gICAgfVxuICAgIHJldHVybiB4cy5qb2luKFwiXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGluc2VydChzdHIsIHN0YXJ0SW5kZXgsIHZhbHVlKSB7XG4gICAgaWYgKHN0YXJ0SW5kZXggPCAwIHx8IHN0YXJ0SW5kZXggPiBzdHIubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcInN0YXJ0SW5kZXggaXMgbmVnYXRpdmUgb3IgZ3JlYXRlciB0aGFuIHRoZSBsZW5ndGggb2YgdGhpcyBpbnN0YW5jZS5cIik7XG4gICAgfVxuICAgIHJldHVybiBzdHIuc3Vic3RyaW5nKDAsIHN0YXJ0SW5kZXgpICsgdmFsdWUgKyBzdHIuc3Vic3RyaW5nKHN0YXJ0SW5kZXgpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGlzTnVsbE9yRW1wdHkoc3RyKSB7XG4gICAgcmV0dXJuIHR5cGVvZiBzdHIgIT09IFwic3RyaW5nXCIgfHwgc3RyLmxlbmd0aCA9PT0gMDtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpc051bGxPcldoaXRlU3BhY2Uoc3RyKSB7XG4gICAgcmV0dXJuIHR5cGVvZiBzdHIgIT09IFwic3RyaW5nXCIgfHwgL15cXHMqJC8udGVzdChzdHIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGNvbmNhdCguLi54cykge1xuICAgIHJldHVybiB4cy5tYXAoKHgpID0+IFN0cmluZyh4KSkuam9pbihcIlwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBqb2luKGRlbGltaXRlciwgeHMpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheSh4cykpIHtcbiAgICAgICAgcmV0dXJuIHhzLmpvaW4oZGVsaW1pdGVyKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKHhzKS5qb2luKGRlbGltaXRlcik7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGpvaW5XaXRoSW5kaWNlcyhkZWxpbWl0ZXIsIHhzLCBzdGFydEluZGV4LCBjb3VudCkge1xuICAgIGNvbnN0IGVuZEluZGV4UGx1c09uZSA9IHN0YXJ0SW5kZXggKyBjb3VudDtcbiAgICBpZiAoZW5kSW5kZXhQbHVzT25lID4geHMubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkluZGV4IGFuZCBjb3VudCBtdXN0IHJlZmVyIHRvIGEgbG9jYXRpb24gd2l0aGluIHRoZSBidWZmZXIuXCIpO1xuICAgIH1cbiAgICByZXR1cm4geHMuc2xpY2Uoc3RhcnRJbmRleCwgZW5kSW5kZXhQbHVzT25lKS5qb2luKGRlbGltaXRlcik7XG59XG5mdW5jdGlvbiBub3RTdXBwb3J0ZWQobmFtZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIlRoZSBlbnZpcm9ubWVudCBkb2Vzbid0IHN1cHBvcnQgJ1wiICsgbmFtZSArIFwiJywgcGxlYXNlIHVzZSBhIHBvbHlmaWxsLlwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b0Jhc2U2NFN0cmluZyhpbkFycmF5KSB7XG4gICAgbGV0IHN0ciA9IFwiXCI7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbkFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHN0ciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGluQXJyYXlbaV0pO1xuICAgIH1cbiAgICByZXR1cm4gdHlwZW9mIGJ0b2EgPT09IFwiZnVuY3Rpb25cIiA/IGJ0b2Eoc3RyKSA6IG5vdFN1cHBvcnRlZChcImJ0b2FcIik7XG59XG5leHBvcnQgZnVuY3Rpb24gZnJvbUJhc2U2NFN0cmluZyhiNjRFbmNvZGVkKSB7XG4gICAgY29uc3QgYmluYXJ5ID0gdHlwZW9mIGF0b2IgPT09IFwiZnVuY3Rpb25cIiA/IGF0b2IoYjY0RW5jb2RlZCkgOiBub3RTdXBwb3J0ZWQoXCJhdG9iXCIpO1xuICAgIGNvbnN0IGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYmluYXJ5Lmxlbmd0aCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBiaW5hcnkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgYnl0ZXNbaV0gPSBiaW5hcnkuY2hhckNvZGVBdChpKTtcbiAgICB9XG4gICAgcmV0dXJuIGJ5dGVzO1xufVxuZnVuY3Rpb24gcGFkKHN0ciwgbGVuLCBjaCwgaXNSaWdodCkge1xuICAgIGNoID0gY2ggfHwgXCIgXCI7XG4gICAgbGVuID0gbGVuIC0gc3RyLmxlbmd0aDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIHN0ciA9IGlzUmlnaHQgPyBzdHIgKyBjaCA6IGNoICsgc3RyO1xuICAgIH1cbiAgICByZXR1cm4gc3RyO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHBhZExlZnQoc3RyLCBsZW4sIGNoKSB7XG4gICAgcmV0dXJuIHBhZChzdHIsIGxlbiwgY2gpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHBhZFJpZ2h0KHN0ciwgbGVuLCBjaCkge1xuICAgIHJldHVybiBwYWQoc3RyLCBsZW4sIGNoLCB0cnVlKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiByZW1vdmUoc3RyLCBzdGFydEluZGV4LCBjb3VudCkge1xuICAgIGlmIChzdGFydEluZGV4ID49IHN0ci5sZW5ndGgpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwic3RhcnRJbmRleCBtdXN0IGJlIGxlc3MgdGhhbiBsZW5ndGggb2Ygc3RyaW5nXCIpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGNvdW50ID09PSBcIm51bWJlclwiICYmIChzdGFydEluZGV4ICsgY291bnQpID4gc3RyLmxlbmd0aCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbmRleCBhbmQgY291bnQgbXVzdCByZWZlciB0byBhIGxvY2F0aW9uIHdpdGhpbiB0aGUgc3RyaW5nLlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIHN0ci5zbGljZSgwLCBzdGFydEluZGV4KSArICh0eXBlb2YgY291bnQgPT09IFwibnVtYmVyXCIgPyBzdHIuc3Vic3RyKHN0YXJ0SW5kZXggKyBjb3VudCkgOiBcIlwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiByZXBsYWNlKHN0ciwgc2VhcmNoLCByZXBsYWNlKSB7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKG5ldyBSZWdFeHAoZXNjYXBlKHNlYXJjaCksIFwiZ1wiKSwgcmVwbGFjZSk7XG59XG5leHBvcnQgZnVuY3Rpb24gcmVwbGljYXRlKG4sIHgpIHtcbiAgICByZXR1cm4gaW5pdGlhbGl6ZShuLCAoKSA9PiB4KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBnZXRDaGFyQXRJbmRleChpbnB1dCwgaW5kZXgpIHtcbiAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49IGlucHV0Lmxlbmd0aCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbmRleCB3YXMgb3V0c2lkZSB0aGUgYm91bmRzIG9mIHRoZSBhcnJheS5cIik7XG4gICAgfVxuICAgIHJldHVybiBpbnB1dFtpbmRleF07XG59XG5leHBvcnQgZnVuY3Rpb24gc3BsaXQoc3RyLCBzcGxpdHRlcnMsIGNvdW50LCBvcHRpb25zKSB7XG4gICAgY291bnQgPSB0eXBlb2YgY291bnQgPT09IFwibnVtYmVyXCIgPyBjb3VudCA6IHVuZGVmaW5lZDtcbiAgICBvcHRpb25zID0gdHlwZW9mIG9wdGlvbnMgPT09IFwibnVtYmVyXCIgPyBvcHRpb25zIDogMDtcbiAgICBpZiAoY291bnQgJiYgY291bnQgPCAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNvdW50IGNhbm5vdCBiZSBsZXNzIHRoYW4gemVyb1wiKTtcbiAgICB9XG4gICAgaWYgKGNvdW50ID09PSAwKSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgY29uc3QgcmVtb3ZlRW1wdHkgPSAob3B0aW9ucyAmIDEpID09PSAxO1xuICAgIGNvbnN0IHRyaW0gPSAob3B0aW9ucyAmIDIpID09PSAyO1xuICAgIHNwbGl0dGVycyA9IHNwbGl0dGVycyB8fCBbXTtcbiAgICBzcGxpdHRlcnMgPSBzcGxpdHRlcnMuZmlsdGVyKHggPT4geCkubWFwKGVzY2FwZSk7XG4gICAgc3BsaXR0ZXJzID0gc3BsaXR0ZXJzLmxlbmd0aCA+IDAgPyBzcGxpdHRlcnMgOiBbXCJcXFxcc1wiXTtcbiAgICBjb25zdCBzcGxpdHMgPSBbXTtcbiAgICBjb25zdCByZWcgPSBuZXcgUmVnRXhwKHNwbGl0dGVycy5qb2luKFwifFwiKSwgXCJnXCIpO1xuICAgIGxldCBmaW5kU3BsaXRzID0gdHJ1ZTtcbiAgICBsZXQgaSA9IDA7XG4gICAgZG8ge1xuICAgICAgICBjb25zdCBtYXRjaCA9IHJlZy5leGVjKHN0cik7XG4gICAgICAgIGlmIChtYXRjaCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgY29uc3QgY2FuZGlkYXRlID0gdHJpbSA/IHN0ci5zdWJzdHJpbmcoaSkudHJpbSgpIDogc3RyLnN1YnN0cmluZyhpKTtcbiAgICAgICAgICAgIGlmICghcmVtb3ZlRW1wdHkgfHwgY2FuZGlkYXRlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBzcGxpdHMucHVzaChjYW5kaWRhdGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZmluZFNwbGl0cyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgY2FuZGlkYXRlID0gdHJpbSA/IHN0ci5zdWJzdHJpbmcoaSwgbWF0Y2guaW5kZXgpLnRyaW0oKSA6IHN0ci5zdWJzdHJpbmcoaSwgbWF0Y2guaW5kZXgpO1xuICAgICAgICAgICAgaWYgKCFyZW1vdmVFbXB0eSB8fCBjYW5kaWRhdGUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGlmIChjb3VudCAhPSBudWxsICYmIHNwbGl0cy5sZW5ndGggKyAxID09PSBjb3VudCkge1xuICAgICAgICAgICAgICAgICAgICBzcGxpdHMucHVzaCh0cmltID8gc3RyLnN1YnN0cmluZyhpKS50cmltKCkgOiBzdHIuc3Vic3RyaW5nKGkpKTtcbiAgICAgICAgICAgICAgICAgICAgZmluZFNwbGl0cyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc3BsaXRzLnB1c2goY2FuZGlkYXRlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpID0gcmVnLmxhc3RJbmRleDtcbiAgICAgICAgfVxuICAgIH0gd2hpbGUgKGZpbmRTcGxpdHMpO1xuICAgIHJldHVybiBzcGxpdHM7XG59XG5leHBvcnQgZnVuY3Rpb24gdHJpbShzdHIsIC4uLmNoYXJzKSB7XG4gICAgaWYgKGNoYXJzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gc3RyLnRyaW0oKTtcbiAgICB9XG4gICAgY29uc3QgcGF0dGVybiA9IFwiW1wiICsgZXNjYXBlKGNoYXJzLmpvaW4oXCJcIikpICsgXCJdK1wiO1xuICAgIHJldHVybiBzdHIucmVwbGFjZShuZXcgUmVnRXhwKFwiXlwiICsgcGF0dGVybiksIFwiXCIpLnJlcGxhY2UobmV3IFJlZ0V4cChwYXR0ZXJuICsgXCIkXCIpLCBcIlwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0cmltU3RhcnQoc3RyLCAuLi5jaGFycykge1xuICAgIHJldHVybiBjaGFycy5sZW5ndGggPT09IDBcbiAgICAgICAgPyBzdHIudHJpbVN0YXJ0KClcbiAgICAgICAgOiBzdHIucmVwbGFjZShuZXcgUmVnRXhwKFwiXltcIiArIGVzY2FwZShjaGFycy5qb2luKFwiXCIpKSArIFwiXStcIiksIFwiXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRyaW1FbmQoc3RyLCAuLi5jaGFycykge1xuICAgIHJldHVybiBjaGFycy5sZW5ndGggPT09IDBcbiAgICAgICAgPyBzdHIudHJpbUVuZCgpXG4gICAgICAgIDogc3RyLnJlcGxhY2UobmV3IFJlZ0V4cChcIltcIiArIGVzY2FwZShjaGFycy5qb2luKFwiXCIpKSArIFwiXSskXCIpLCBcIlwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBmaWx0ZXIocHJlZCwgeCkge1xuICAgIHJldHVybiB4LnNwbGl0KFwiXCIpLmZpbHRlcigoYykgPT4gcHJlZChjKSkuam9pbihcIlwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBzdWJzdHJpbmcoc3RyLCBzdGFydEluZGV4LCBsZW5ndGgpIHtcbiAgICBpZiAoKHN0YXJ0SW5kZXggKyAobGVuZ3RoIHx8IDApID4gc3RyLmxlbmd0aCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBzdGFydEluZGV4IGFuZC9vciBsZW5ndGhcIik7XG4gICAgfVxuICAgIHJldHVybiBsZW5ndGggIT0gbnVsbCA/IHN0ci5zdWJzdHIoc3RhcnRJbmRleCwgbGVuZ3RoKSA6IHN0ci5zdWJzdHIoc3RhcnRJbmRleCk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9DaGFyQXJyYXkyKHN0ciwgc3RhcnRJbmRleCwgbGVuZ3RoKSB7XG4gICAgcmV0dXJuIHN1YnN0cmluZyhzdHIsIHN0YXJ0SW5kZXgsIGxlbmd0aCkuc3BsaXQoXCJcIik7XG59XG5leHBvcnQgZnVuY3Rpb24gZm10KHN0cnMsIC4uLmFyZ3MpIHtcbiAgICByZXR1cm4gKHsgc3RycywgYXJncyB9KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBmbXRXaXRoKGZtdHMpIHtcbiAgICByZXR1cm4gKHN0cnMsIC4uLmFyZ3MpID0+ICh7IHN0cnMsIGFyZ3MsIGZtdHMgfSk7XG59XG5leHBvcnQgZnVuY3Rpb24gZ2V0Rm9ybWF0KHMpIHtcbiAgICByZXR1cm4gcy5mbXRzXG4gICAgICAgID8gcy5zdHJzLnJlZHVjZSgoYWNjLCBuZXdQYXJ0LCBpbmRleCkgPT4gYWNjICsgYHske1N0cmluZyhpbmRleCAtIDEpICsgcy5mbXRzW2luZGV4IC0gMV19fWAgKyBuZXdQYXJ0KVxuICAgICAgICA6IHMuc3Rycy5yZWR1Y2UoKGFjYywgbmV3UGFydCwgaW5kZXgpID0+IGFjYyArIGB7JHtpbmRleCAtIDF9fWAgKyBuZXdQYXJ0KTtcbn1cbiIsCiAgImltcG9ydCB7IHRvU3RyaW5nIGFzIGRhdGVUb1N0cmluZyB9IGZyb20gXCIuL0RhdGUuanNcIjtcbmltcG9ydCB7IGNvbXBhcmUgYXMgbnVtZXJpY0NvbXBhcmUsIGlzTnVtZXJpYywgbXVsdGlwbHksIHRvRXhwb25lbnRpYWwsIHRvRml4ZWQsIHRvSGV4LCB0b1ByZWNpc2lvbiB9IGZyb20gXCIuL051bWVyaWMuanNcIjtcbmltcG9ydCB7IGVzY2FwZSB9IGZyb20gXCIuL1JlZ0V4cC5qc1wiO1xuaW1wb3J0IHsgdG9TdHJpbmcgfSBmcm9tIFwiLi9UeXBlcy5qc1wiO1xuY29uc3QgZnNGb3JtYXRSZWdFeHAgPSAvKF58W14lXSklKFswK1xcLSBdKikoXFwqfFxcZCspPyg/OlxcLihcXGQrKSk/KFxcdykvZztcbmNvbnN0IGludGVycG9sYXRlUmVnRXhwID0gLyg/OihefFteJV0pJShbMCtcXC0gXSopKFxcZCspPyg/OlxcLihcXGQrKSk/KFxcdykpPyVQXFwoXFwpL2c7XG5jb25zdCBmb3JtYXRSZWdFeHAgPSAvXFx7KFxcZCspKCwtP1xcZCspPyg/OlxcOihbYS16QS1aXSkoXFxkezAsMn0pfFxcOiguKz8pKT9cXH0vZztcbmZ1bmN0aW9uIGlzTGVzc1RoYW4oeCwgeSkge1xuICAgIHJldHVybiBudW1lcmljQ29tcGFyZSh4LCB5KSA8IDA7XG59XG5mdW5jdGlvbiBjbXAoeCwgeSwgaWMpIHtcbiAgICBmdW5jdGlvbiBpc0lnbm9yZUNhc2UoaSkge1xuICAgICAgICByZXR1cm4gaSA9PT0gdHJ1ZSB8fFxuICAgICAgICAgICAgaSA9PT0gMSAvKiBTdHJpbmdDb21wYXJpc29uLkN1cnJlbnRDdWx0dXJlSWdub3JlQ2FzZSAqLyB8fFxuICAgICAgICAgICAgaSA9PT0gMyAvKiBTdHJpbmdDb21wYXJpc29uLkludmFyaWFudEN1bHR1cmVJZ25vcmVDYXNlICovIHx8XG4gICAgICAgICAgICBpID09PSA1IC8qIFN0cmluZ0NvbXBhcmlzb24uT3JkaW5hbElnbm9yZUNhc2UgKi87XG4gICAgfVxuICAgIGZ1bmN0aW9uIGlzT3JkaW5hbChpKSB7XG4gICAgICAgIHJldHVybiBpID09PSA0IC8qIFN0cmluZ0NvbXBhcmlzb24uT3JkaW5hbCAqLyB8fFxuICAgICAgICAgICAgaSA9PT0gNSAvKiBTdHJpbmdDb21wYXJpc29uLk9yZGluYWxJZ25vcmVDYXNlICovO1xuICAgIH1cbiAgICBpZiAoeCA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiB5ID09IG51bGwgPyAwIDogLTE7XG4gICAgfVxuICAgIGlmICh5ID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIDE7XG4gICAgfSAvLyBldmVyeXRoaW5nIGlzIGJpZ2dlciB0aGFuIG51bGxcbiAgICBpZiAoaXNPcmRpbmFsKGljKSkge1xuICAgICAgICBpZiAoaXNJZ25vcmVDYXNlKGljKSkge1xuICAgICAgICAgICAgeCA9IHgudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIHkgPSB5LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICh4ID09PSB5KSA/IDAgOiAoeCA8IHkgPyAtMSA6IDEpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKGlzSWdub3JlQ2FzZShpYykpIHtcbiAgICAgICAgICAgIHggPSB4LnRvTG9jYWxlTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICB5ID0geS50b0xvY2FsZUxvd2VyQ2FzZSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB4LmxvY2FsZUNvbXBhcmUoeSk7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBhcmUoLi4uYXJncykge1xuICAgIHN3aXRjaCAoYXJncy5sZW5ndGgpIHtcbiAgICAgICAgY2FzZSAyOiByZXR1cm4gY21wKGFyZ3NbMF0sIGFyZ3NbMV0sIGZhbHNlKTtcbiAgICAgICAgY2FzZSAzOiByZXR1cm4gY21wKGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0pO1xuICAgICAgICBjYXNlIDQ6IHJldHVybiBjbXAoYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSA9PT0gdHJ1ZSk7XG4gICAgICAgIGNhc2UgNTogcmV0dXJuIGNtcChhcmdzWzBdLnN1YnN0cihhcmdzWzFdLCBhcmdzWzRdKSwgYXJnc1syXS5zdWJzdHIoYXJnc1szXSwgYXJnc1s0XSksIGZhbHNlKTtcbiAgICAgICAgY2FzZSA2OiByZXR1cm4gY21wKGFyZ3NbMF0uc3Vic3RyKGFyZ3NbMV0sIGFyZ3NbNF0pLCBhcmdzWzJdLnN1YnN0cihhcmdzWzNdLCBhcmdzWzRdKSwgYXJnc1s1XSk7XG4gICAgICAgIGNhc2UgNzogcmV0dXJuIGNtcChhcmdzWzBdLnN1YnN0cihhcmdzWzFdLCBhcmdzWzRdKSwgYXJnc1syXS5zdWJzdHIoYXJnc1szXSwgYXJnc1s0XSksIGFyZ3NbNV0gPT09IHRydWUpO1xuICAgICAgICBkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoXCJTdHJpbmcuY29tcGFyZTogVW5zdXBwb3J0ZWQgbnVtYmVyIG9mIHBhcmFtZXRlcnNcIik7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBhcmVPcmRpbmFsKHgsIHkpIHtcbiAgICByZXR1cm4gY21wKHgsIHksIDQgLyogU3RyaW5nQ29tcGFyaXNvbi5PcmRpbmFsICovKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBjb21wYXJlVG8oeCwgeSkge1xuICAgIHJldHVybiBjbXAoeCwgeSwgMCAvKiBTdHJpbmdDb21wYXJpc29uLkN1cnJlbnRDdWx0dXJlICovKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBzdGFydHNXaXRoKHN0ciwgcGF0dGVybiwgaWMpIHtcbiAgICBpZiAoc3RyLmxlbmd0aCA+PSBwYXR0ZXJuLmxlbmd0aCkge1xuICAgICAgICByZXR1cm4gY21wKHN0ci5zdWJzdHIoMCwgcGF0dGVybi5sZW5ndGgpLCBwYXR0ZXJuLCBpYykgPT09IDA7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpbmRleE9mQW55KHN0ciwgYW55T2YsIC4uLmFyZ3MpIHtcbiAgICBpZiAoc3RyID09IG51bGwgfHwgc3RyID09PSBcIlwiKSB7XG4gICAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gICAgY29uc3Qgc3RhcnRJbmRleCA9IChhcmdzLmxlbmd0aCA+IDApID8gYXJnc1swXSA6IDA7XG4gICAgaWYgKHN0YXJ0SW5kZXggPCAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlN0YXJ0IGluZGV4IGNhbm5vdCBiZSBuZWdhdGl2ZVwiKTtcbiAgICB9XG4gICAgY29uc3QgbGVuZ3RoID0gKGFyZ3MubGVuZ3RoID4gMSkgPyBhcmdzWzFdIDogc3RyLmxlbmd0aCAtIHN0YXJ0SW5kZXg7XG4gICAgaWYgKGxlbmd0aCA8IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTGVuZ3RoIGNhbm5vdCBiZSBuZWdhdGl2ZVwiKTtcbiAgICB9XG4gICAgaWYgKHN0YXJ0SW5kZXggKyBsZW5ndGggPiBzdHIubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgc3RhcnRJbmRleCBhbmQgbGVuZ3RoXCIpO1xuICAgIH1cbiAgICBjb25zdCBlbmRJbmRleCA9IHN0YXJ0SW5kZXggKyBsZW5ndGg7XG4gICAgY29uc3QgYW55T2ZBc1N0ciA9IFwiXCIuY29uY2F0LmFwcGx5KFwiXCIsIGFueU9mKTtcbiAgICBmb3IgKGxldCBpID0gc3RhcnRJbmRleDsgaSA8IGVuZEluZGV4OyBpKyspIHtcbiAgICAgICAgaWYgKGFueU9mQXNTdHIuaW5kZXhPZihzdHJbaV0pID4gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiAtMTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBwcmludGYoaW5wdXQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBpbnB1dCxcbiAgICAgICAgY29udDogZnNGb3JtYXQoaW5wdXQpLFxuICAgIH07XG59XG5leHBvcnQgZnVuY3Rpb24gaW50ZXJwb2xhdGUoc3RyLCB2YWx1ZXMpIHtcbiAgICBsZXQgdmFsSWR4ID0gMDtcbiAgICBsZXQgc3RySWR4ID0gMDtcbiAgICBsZXQgcmVzdWx0ID0gXCJcIjtcbiAgICBpbnRlcnBvbGF0ZVJlZ0V4cC5sYXN0SW5kZXggPSAwO1xuICAgIGxldCBtYXRjaCA9IGludGVycG9sYXRlUmVnRXhwLmV4ZWMoc3RyKTtcbiAgICB3aGlsZSAobWF0Y2gpIHtcbiAgICAgICAgLy8gVGhlIGZpcnN0IGdyb3VwIGNvcnJlc3BvbmRzIHRvIHRoZSBuby1lc2NhcGUgY2hhciAoXnxbXiVdKSwgdGhlIGFjdHVhbCBwYXR0ZXJuIHN0YXJ0cyBpbiB0aGUgbmV4dCBjaGFyXG4gICAgICAgIC8vIE5vdGU6IHdlIGRvbid0IHVzZSBuZWdhdGl2ZSBsb29rYmVoaW5kIGJlY2F1c2Ugc29tZSBicm93c2VycyBkb24ndCBzdXBwb3J0IGl0IHlldFxuICAgICAgICBjb25zdCBtYXRjaEluZGV4ID0gbWF0Y2guaW5kZXggKyAobWF0Y2hbMV0gfHwgXCJcIikubGVuZ3RoO1xuICAgICAgICByZXN1bHQgKz0gc3RyLnN1YnN0cmluZyhzdHJJZHgsIG1hdGNoSW5kZXgpLnJlcGxhY2UoLyUlL2csIFwiJVwiKTtcbiAgICAgICAgY29uc3QgWywgLCBmbGFncywgcGFkTGVuZ3RoLCBwcmVjaXNpb24sIGZvcm1hdF0gPSBtYXRjaDtcbiAgICAgICAgLy8gU2F2ZSBpbnRlcnBvbGF0ZVJlZ0V4cC5sYXN0SW5kZXggYmVmb3JlIHJ1bm5pbmcgZm9ybWF0UmVwbGFjZW1lbnQgYmVjYXVzZSB0aGUgdmFsdWVzXG4gICAgICAgIC8vIG1heSBhbHNvIGludm9sdmUgaW50ZXJwb2xhdGlvbiBhbmQgbWFrZSB1c2Ugb2YgaW50ZXJwb2xhdGVSZWdFeHAgKHNlZSAjMzA3OClcbiAgICAgICAgc3RySWR4ID0gaW50ZXJwb2xhdGVSZWdFeHAubGFzdEluZGV4O1xuICAgICAgICByZXN1bHQgKz0gZm9ybWF0UmVwbGFjZW1lbnQodmFsdWVzW3ZhbElkeCsrXSwgZmxhZ3MsIHBhZExlbmd0aCwgcHJlY2lzaW9uLCBmb3JtYXQpO1xuICAgICAgICAvLyBNb3ZlIGludGVycG9sYXRlUmVnRXhwLmxhc3RJbmRleCBvbmUgY2hhciBiZWhpbmQgdG8gbWFrZSBzdXJlIHdlIG1hdGNoIHRoZSBuby1lc2NhcGUgY2hhciBuZXh0IHRpbWVcbiAgICAgICAgaW50ZXJwb2xhdGVSZWdFeHAubGFzdEluZGV4ID0gc3RySWR4IC0gMTtcbiAgICAgICAgbWF0Y2ggPSBpbnRlcnBvbGF0ZVJlZ0V4cC5leGVjKHN0cik7XG4gICAgfVxuICAgIHJlc3VsdCArPSBzdHIuc3Vic3RyaW5nKHN0cklkeCkucmVwbGFjZSgvJSUvZywgXCIlXCIpO1xuICAgIHJldHVybiByZXN1bHQ7XG59XG5mdW5jdGlvbiBjb250aW51ZVByaW50KGNvbnQsIGFyZykge1xuICAgIHJldHVybiB0eXBlb2YgYXJnID09PSBcInN0cmluZ1wiID8gY29udChhcmcpIDogYXJnLmNvbnQoY29udCk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9Db25zb2xlKGFyZykge1xuICAgIC8vIERvbid0IHJlbW92ZSB0aGUgbGFtYmRhIGhlcmUsIHNlZSAjMTM1N1xuICAgIHJldHVybiBjb250aW51ZVByaW50KCh4KSA9PiBjb25zb2xlLmxvZyh4KSwgYXJnKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b0NvbnNvbGVFcnJvcihhcmcpIHtcbiAgICByZXR1cm4gY29udGludWVQcmludCgoeCkgPT4gY29uc29sZS5lcnJvcih4KSwgYXJnKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b1RleHQoYXJnKSB7XG4gICAgcmV0dXJuIGNvbnRpbnVlUHJpbnQoKHgpID0+IHgsIGFyZyk7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9GYWlsKGFyZykge1xuICAgIHJldHVybiBjb250aW51ZVByaW50KCh4KSA9PiB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcih4KTtcbiAgICB9LCBhcmcpO1xufVxuZnVuY3Rpb24gZm9ybWF0UmVwbGFjZW1lbnQocmVwLCBmbGFncywgcGFkTGVuZ3RoLCBwcmVjaXNpb24sIGZvcm1hdCkge1xuICAgIGxldCBzaWduID0gXCJcIjtcbiAgICBmbGFncyA9IGZsYWdzIHx8IFwiXCI7XG4gICAgZm9ybWF0ID0gZm9ybWF0IHx8IFwiXCI7XG4gICAgaWYgKGlzTnVtZXJpYyhyZXApKSB7XG4gICAgICAgIGlmIChmb3JtYXQudG9Mb3dlckNhc2UoKSAhPT0gXCJ4XCIpIHtcbiAgICAgICAgICAgIGlmIChpc0xlc3NUaGFuKHJlcCwgMCkpIHtcbiAgICAgICAgICAgICAgICByZXAgPSBtdWx0aXBseShyZXAsIC0xKTtcbiAgICAgICAgICAgICAgICBzaWduID0gXCItXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoZmxhZ3MuaW5kZXhPZihcIiBcIikgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICBzaWduID0gXCIgXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGZsYWdzLmluZGV4T2YoXCIrXCIpID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgc2lnbiA9IFwiK1wiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBwcmVjaXNpb24gPSBwcmVjaXNpb24gPT0gbnVsbCA/IG51bGwgOiBwYXJzZUludChwcmVjaXNpb24sIDEwKTtcbiAgICAgICAgc3dpdGNoIChmb3JtYXQpIHtcbiAgICAgICAgICAgIGNhc2UgXCJmXCI6XG4gICAgICAgICAgICBjYXNlIFwiRlwiOlxuICAgICAgICAgICAgICAgIHByZWNpc2lvbiA9IHByZWNpc2lvbiAhPSBudWxsID8gcHJlY2lzaW9uIDogNjtcbiAgICAgICAgICAgICAgICByZXAgPSB0b0ZpeGVkKHJlcCwgcHJlY2lzaW9uKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJnXCI6XG4gICAgICAgICAgICBjYXNlIFwiR1wiOlxuICAgICAgICAgICAgICAgIHJlcCA9IHByZWNpc2lvbiAhPSBudWxsID8gdG9QcmVjaXNpb24ocmVwLCBwcmVjaXNpb24pIDogdG9QcmVjaXNpb24ocmVwKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJlXCI6XG4gICAgICAgICAgICBjYXNlIFwiRVwiOlxuICAgICAgICAgICAgICAgIHJlcCA9IHByZWNpc2lvbiAhPSBudWxsID8gdG9FeHBvbmVudGlhbChyZXAsIHByZWNpc2lvbikgOiB0b0V4cG9uZW50aWFsKHJlcCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwieFwiOlxuICAgICAgICAgICAgICAgIHJlcCA9IHRvSGV4KHJlcCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiWFwiOlxuICAgICAgICAgICAgICAgIHJlcCA9IHRvSGV4KHJlcCkudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6IC8vIEFPaWRcbiAgICAgICAgICAgICAgICByZXAgPSBTdHJpbmcocmVwKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmIChyZXAgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICAgIHJlcCA9IGRhdGVUb1N0cmluZyhyZXApO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmVwID0gdG9TdHJpbmcocmVwKTtcbiAgICB9XG4gICAgcGFkTGVuZ3RoID0gdHlwZW9mIHBhZExlbmd0aCA9PT0gXCJudW1iZXJcIiA/IHBhZExlbmd0aCA6IHBhcnNlSW50KHBhZExlbmd0aCwgMTApO1xuICAgIGlmICghaXNOYU4ocGFkTGVuZ3RoKSkge1xuICAgICAgICBjb25zdCB6ZXJvRmxhZyA9IGZsYWdzLmluZGV4T2YoXCIwXCIpID49IDA7IC8vIFVzZSAnMCcgZm9yIGxlZnQgcGFkZGluZ1xuICAgICAgICBjb25zdCBtaW51c0ZsYWcgPSBmbGFncy5pbmRleE9mKFwiLVwiKSA+PSAwOyAvLyBSaWdodCBwYWRkaW5nXG4gICAgICAgIGNvbnN0IGNoID0gbWludXNGbGFnIHx8ICF6ZXJvRmxhZyA/IFwiIFwiIDogXCIwXCI7XG4gICAgICAgIGlmIChjaCA9PT0gXCIwXCIpIHtcbiAgICAgICAgICAgIHJlcCA9IHBhZChyZXAsIHBhZExlbmd0aCAtIHNpZ24ubGVuZ3RoLCBjaCwgbWludXNGbGFnKTtcbiAgICAgICAgICAgIHJlcCA9IHNpZ24gKyByZXA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXAgPSBwYWQoc2lnbiArIHJlcCwgcGFkTGVuZ3RoLCBjaCwgbWludXNGbGFnKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmVwID0gc2lnbiArIHJlcDtcbiAgICB9XG4gICAgcmV0dXJuIHJlcDtcbn1cbmZ1bmN0aW9uIGNyZWF0ZVByaW50ZXIoY29udCwgX3N0clBhcnRzLCBfbWF0Y2hlcywgX3Jlc3VsdCA9IFwiXCIsIHBhZEFyZyA9IC0xKSB7XG4gICAgcmV0dXJuICguLi5hcmdzKSA9PiB7XG4gICAgICAgIC8vIE1ha2UgY29waWVzIG9mIHRoZSB2YWx1ZXMgcGFzc2VkIGJ5IHJlZmVyZW5jZSBiZWNhdXNlIHRoZSBmdW5jdGlvbiBjYW4gYmUgdXNlZCBtdWx0aXBsZSB0aW1lc1xuICAgICAgICBsZXQgcmVzdWx0ID0gX3Jlc3VsdDtcbiAgICAgICAgY29uc3Qgc3RyUGFydHMgPSBfc3RyUGFydHMuc2xpY2UoKTtcbiAgICAgICAgY29uc3QgbWF0Y2hlcyA9IF9tYXRjaGVzLnNsaWNlKCk7XG4gICAgICAgIGZvciAoY29uc3QgYXJnIG9mIGFyZ3MpIHtcbiAgICAgICAgICAgIGNvbnN0IFssICwgZmxhZ3MsIF9wYWRMZW5ndGgsIHByZWNpc2lvbiwgZm9ybWF0XSA9IG1hdGNoZXNbMF07XG4gICAgICAgICAgICBsZXQgcGFkTGVuZ3RoID0gX3BhZExlbmd0aDtcbiAgICAgICAgICAgIGlmIChwYWRBcmcgPj0gMCkge1xuICAgICAgICAgICAgICAgIHBhZExlbmd0aCA9IHBhZEFyZztcbiAgICAgICAgICAgICAgICBwYWRBcmcgPSAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHBhZExlbmd0aCA9PT0gXCIqXCIpIHtcbiAgICAgICAgICAgICAgICBpZiAoYXJnIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJOb24tbmVnYXRpdmUgbnVtYmVyIHJlcXVpcmVkXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBwYWRBcmcgPSBhcmc7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXN1bHQgKz0gc3RyUGFydHNbMF07XG4gICAgICAgICAgICByZXN1bHQgKz0gZm9ybWF0UmVwbGFjZW1lbnQoYXJnLCBmbGFncywgcGFkTGVuZ3RoLCBwcmVjaXNpb24sIGZvcm1hdCk7XG4gICAgICAgICAgICBzdHJQYXJ0cy5zcGxpY2UoMCwgMSk7XG4gICAgICAgICAgICBtYXRjaGVzLnNwbGljZSgwLCAxKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobWF0Y2hlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJlc3VsdCArPSBzdHJQYXJ0c1swXTtcbiAgICAgICAgICAgIHJldHVybiBjb250KHJlc3VsdCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlUHJpbnRlcihjb250LCBzdHJQYXJ0cywgbWF0Y2hlcywgcmVzdWx0LCBwYWRBcmcpO1xuICAgICAgICB9XG4gICAgfTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBmc0Zvcm1hdChzdHIpIHtcbiAgICByZXR1cm4gKGNvbnQpID0+IHtcbiAgICAgICAgZnNGb3JtYXRSZWdFeHAubGFzdEluZGV4ID0gMDtcbiAgICAgICAgY29uc3Qgc3RyUGFydHMgPSBbXTtcbiAgICAgICAgY29uc3QgbWF0Y2hlcyA9IFtdO1xuICAgICAgICBsZXQgc3RySWR4ID0gMDtcbiAgICAgICAgbGV0IG1hdGNoID0gZnNGb3JtYXRSZWdFeHAuZXhlYyhzdHIpO1xuICAgICAgICB3aGlsZSAobWF0Y2gpIHtcbiAgICAgICAgICAgIC8vIFRoZSBmaXJzdCBncm91cCBjb3JyZXNwb25kcyB0byB0aGUgbm8tZXNjYXBlIGNoYXIgKF58W14lXSksIHRoZSBhY3R1YWwgcGF0dGVybiBzdGFydHMgaW4gdGhlIG5leHQgY2hhclxuICAgICAgICAgICAgLy8gTm90ZTogd2UgZG9uJ3QgdXNlIG5lZ2F0aXZlIGxvb2tiZWhpbmQgYmVjYXVzZSBzb21lIGJyb3dzZXJzIGRvbid0IHN1cHBvcnQgaXQgeWV0XG4gICAgICAgICAgICBjb25zdCBtYXRjaEluZGV4ID0gbWF0Y2guaW5kZXggKyAobWF0Y2hbMV0gfHwgXCJcIikubGVuZ3RoO1xuICAgICAgICAgICAgc3RyUGFydHMucHVzaChzdHIuc3Vic3RyaW5nKHN0cklkeCwgbWF0Y2hJbmRleCkucmVwbGFjZSgvJSUvZywgXCIlXCIpKTtcbiAgICAgICAgICAgIG1hdGNoZXMucHVzaChtYXRjaCk7XG4gICAgICAgICAgICBzdHJJZHggPSBmc0Zvcm1hdFJlZ0V4cC5sYXN0SW5kZXg7XG4gICAgICAgICAgICAvLyBMaWtld2lzZSB3ZSBuZWVkIHRvIG1vdmUgZnNGb3JtYXRSZWdFeHAubGFzdEluZGV4IG9uZSBjaGFyIGJlaGluZCB0byBtYWtlIHN1cmUgd2UgbWF0Y2ggdGhlIG5vLWVzY2FwZSBjaGFyIG5leHQgdGltZVxuICAgICAgICAgICAgZnNGb3JtYXRSZWdFeHAubGFzdEluZGV4IC09IDE7XG4gICAgICAgICAgICBtYXRjaCA9IGZzRm9ybWF0UmVnRXhwLmV4ZWMoc3RyKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3RyUGFydHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gY29udChzdHIucmVwbGFjZSgvJSUvZywgXCIlXCIpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHN0clBhcnRzLnB1c2goc3RyLnN1YnN0cmluZyhzdHJJZHgpLnJlcGxhY2UoLyUlL2csIFwiJVwiKSk7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlUHJpbnRlcihjb250LCBzdHJQYXJ0cywgbWF0Y2hlcyk7XG4gICAgICAgIH1cbiAgICB9O1xufVxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdChzdHIsIC4uLmFyZ3MpIHtcbiAgICBsZXQgc3RyMjtcbiAgICBpZiAodHlwZW9mIHN0ciA9PT0gXCJvYmplY3RcIikge1xuICAgICAgICAvLyBDYWxsZWQgd2l0aCBjdWx0dXJlIGluZm9cbiAgICAgICAgc3RyMiA9IFN0cmluZyhhcmdzWzBdKTtcbiAgICAgICAgYXJncy5zaGlmdCgpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgc3RyMiA9IHN0cjtcbiAgICB9XG4gICAgcmV0dXJuIHN0cjIucmVwbGFjZShmb3JtYXRSZWdFeHAsIChfLCBpZHgsIHBhZExlbmd0aCwgZm9ybWF0LCBwcmVjaXNpb24sIHBhdHRlcm4pID0+IHtcbiAgICAgICAgaWYgKGlkeCA8IDAgfHwgaWR4ID49IGFyZ3MubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbmRleCBtdXN0IGJlIGdyZWF0ZXIgb3IgZXF1YWwgdG8gemVybyBhbmQgbGVzcyB0aGFuIHRoZSBhcmd1bWVudHMnIGxlbmd0aC5cIik7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHJlcCA9IGFyZ3NbaWR4XTtcbiAgICAgICAgaWYgKGlzTnVtZXJpYyhyZXApKSB7XG4gICAgICAgICAgICBwcmVjaXNpb24gPSBwcmVjaXNpb24gPT0gbnVsbCA/IG51bGwgOiBwYXJzZUludChwcmVjaXNpb24sIDEwKTtcbiAgICAgICAgICAgIHN3aXRjaCAoZm9ybWF0KSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcImZcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiRlwiOlxuICAgICAgICAgICAgICAgICAgICBwcmVjaXNpb24gPSBwcmVjaXNpb24gIT0gbnVsbCA/IHByZWNpc2lvbiA6IDI7XG4gICAgICAgICAgICAgICAgICAgIHJlcCA9IHRvRml4ZWQocmVwLCBwcmVjaXNpb24pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZ1wiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJHXCI6XG4gICAgICAgICAgICAgICAgICAgIHJlcCA9IHByZWNpc2lvbiAhPSBudWxsID8gdG9QcmVjaXNpb24ocmVwLCBwcmVjaXNpb24pIDogdG9QcmVjaXNpb24ocmVwKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImVcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiRVwiOlxuICAgICAgICAgICAgICAgICAgICByZXAgPSBwcmVjaXNpb24gIT0gbnVsbCA/IHRvRXhwb25lbnRpYWwocmVwLCBwcmVjaXNpb24pIDogdG9FeHBvbmVudGlhbChyZXApO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwicFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJQXCI6XG4gICAgICAgICAgICAgICAgICAgIHByZWNpc2lvbiA9IHByZWNpc2lvbiAhPSBudWxsID8gcHJlY2lzaW9uIDogMjtcbiAgICAgICAgICAgICAgICAgICAgcmVwID0gdG9GaXhlZChtdWx0aXBseShyZXAsIDEwMCksIHByZWNpc2lvbikgKyBcIiAlXCI7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJkXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcIkRcIjpcbiAgICAgICAgICAgICAgICAgICAgcmVwID0gcHJlY2lzaW9uICE9IG51bGwgPyBwYWRMZWZ0KFN0cmluZyhyZXApLCBwcmVjaXNpb24sIFwiMFwiKSA6IFN0cmluZyhyZXApO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwieFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJYXCI6XG4gICAgICAgICAgICAgICAgICAgIHJlcCA9IHByZWNpc2lvbiAhPSBudWxsID8gcGFkTGVmdCh0b0hleChyZXApLCBwcmVjaXNpb24sIFwiMFwiKSA6IHRvSGV4KHJlcCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmb3JtYXQgPT09IFwiWFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXAgPSByZXAudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBpZiAocGF0dGVybikge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHNpZ24gPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVwID0gcGF0dGVybi5yZXBsYWNlKC8oWzAjLF0rKShcXC5bMCNdKyk/LywgKF8sIGludFBhcnQsIGRlY2ltYWxQYXJ0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzTGVzc1RoYW4ocmVwLCAwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXAgPSBtdWx0aXBseShyZXAsIC0xKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbiA9IFwiLVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWNpbWFsUGFydCA9IGRlY2ltYWxQYXJ0ID09IG51bGwgPyBcIlwiIDogZGVjaW1hbFBhcnQuc3Vic3RyaW5nKDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcCA9IHRvRml4ZWQocmVwLCBNYXRoLm1heChkZWNpbWFsUGFydC5sZW5ndGgsIDApKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgW3JlcEludCwgcmVwRGVjaW1hbF0gPSByZXAuc3BsaXQoXCIuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcERlY2ltYWwgfHwgKHJlcERlY2ltYWwgPSBcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsZWZ0WmVyb2VzID0gaW50UGFydC5yZXBsYWNlKC8sL2csIFwiXCIpLnJlcGxhY2UoL14jKy8sIFwiXCIpLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBJbnQgPSBwYWRMZWZ0KHJlcEludCwgbGVmdFplcm9lcywgXCIwXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJpZ2h0WmVyb3MgPSBkZWNpbWFsUGFydC5yZXBsYWNlKC8jKyQvLCBcIlwiKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJpZ2h0WmVyb3MgPiByZXBEZWNpbWFsLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBEZWNpbWFsID0gcGFkUmlnaHQocmVwRGVjaW1hbCwgcmlnaHRaZXJvcywgXCIwXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyaWdodFplcm9zIDwgcmVwRGVjaW1hbC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwRGVjaW1hbCA9IHJlcERlY2ltYWwuc3Vic3RyaW5nKDAsIHJpZ2h0WmVyb3MpICsgcmVwRGVjaW1hbC5zdWJzdHJpbmcocmlnaHRaZXJvcykucmVwbGFjZSgvMCskLywgXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRob3VzYW5kcyBzZXBhcmF0b3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW50UGFydC5pbmRleE9mKFwiLFwiKSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9IHJlcEludC5sZW5ndGggJSAzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0aG91c2FuZEdyb3VwcyA9IE1hdGguZmxvb3IocmVwSW50Lmxlbmd0aCAvIDMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdGhvdXNhbmRzID0gaSA+IDAgPyByZXBJbnQuc3Vic3RyKDAsIGkpICsgKHRob3VzYW5kR3JvdXBzID4gMCA/IFwiLFwiIDogXCJcIikgOiBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRob3VzYW5kR3JvdXBzOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRob3VzYW5kcyArPSByZXBJbnQuc3Vic3RyKGkgKyBqICogMywgMykgKyAoaiA8IHRob3VzYW5kR3JvdXBzIC0gMSA/IFwiLFwiIDogXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwSW50ID0gdGhvdXNhbmRzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVwRGVjaW1hbC5sZW5ndGggPiAwID8gcmVwSW50ICsgXCIuXCIgKyByZXBEZWNpbWFsIDogcmVwSW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXAgPSBzaWduICsgcmVwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVwIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgICAgICAgcmVwID0gZGF0ZVRvU3RyaW5nKHJlcCwgcGF0dGVybiB8fCBmb3JtYXQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVwID0gdG9TdHJpbmcocmVwKTtcbiAgICAgICAgfVxuICAgICAgICBwYWRMZW5ndGggPSBwYXJzZUludCgocGFkTGVuZ3RoIHx8IFwiIFwiKS5zdWJzdHJpbmcoMSksIDEwKTtcbiAgICAgICAgaWYgKCFpc05hTihwYWRMZW5ndGgpKSB7XG4gICAgICAgICAgICByZXAgPSBwYWQoU3RyaW5nKHJlcCksIE1hdGguYWJzKHBhZExlbmd0aCksIFwiIFwiLCBwYWRMZW5ndGggPCAwKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVwO1xuICAgIH0pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGVuZHNXaXRoKHN0ciwgc2VhcmNoKSB7XG4gICAgY29uc3QgaWR4ID0gc3RyLmxhc3RJbmRleE9mKHNlYXJjaCk7XG4gICAgcmV0dXJuIGlkeCA+PSAwICYmIGlkeCA9PT0gc3RyLmxlbmd0aCAtIHNlYXJjaC5sZW5ndGg7XG59XG5leHBvcnQgZnVuY3Rpb24gaW5pdGlhbGl6ZShuLCBmKSB7XG4gICAgaWYgKG4gPCAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlN0cmluZyBsZW5ndGggbXVzdCBiZSBub24tbmVnYXRpdmVcIik7XG4gICAgfVxuICAgIGNvbnN0IHhzID0gbmV3IEFycmF5KG4pO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgIHhzW2ldID0gZihpKTtcbiAgICB9XG4gICAgcmV0dXJuIHhzLmpvaW4oXCJcIik7XG59XG5leHBvcnQgZnVuY3Rpb24gaW5zZXJ0KHN0ciwgc3RhcnRJbmRleCwgdmFsdWUpIHtcbiAgICBpZiAoc3RhcnRJbmRleCA8IDAgfHwgc3RhcnRJbmRleCA+IHN0ci5sZW5ndGgpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwic3RhcnRJbmRleCBpcyBuZWdhdGl2ZSBvciBncmVhdGVyIHRoYW4gdGhlIGxlbmd0aCBvZiB0aGlzIGluc3RhbmNlLlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIHN0ci5zdWJzdHJpbmcoMCwgc3RhcnRJbmRleCkgKyB2YWx1ZSArIHN0ci5zdWJzdHJpbmcoc3RhcnRJbmRleCk7XG59XG5leHBvcnQgZnVuY3Rpb24gaXNOdWxsT3JFbXB0eShzdHIpIHtcbiAgICByZXR1cm4gdHlwZW9mIHN0ciAhPT0gXCJzdHJpbmdcIiB8fCBzdHIubGVuZ3RoID09PSAwO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGlzTnVsbE9yV2hpdGVTcGFjZShzdHIpIHtcbiAgICByZXR1cm4gdHlwZW9mIHN0ciAhPT0gXCJzdHJpbmdcIiB8fCAvXlxccyokLy50ZXN0KHN0cik7XG59XG5leHBvcnQgZnVuY3Rpb24gY29uY2F0KC4uLnhzKSB7XG4gICAgcmV0dXJuIHhzLm1hcCgoeCkgPT4gU3RyaW5nKHgpKS5qb2luKFwiXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGpvaW4oZGVsaW1pdGVyLCB4cykge1xuICAgIGlmIChBcnJheS5pc0FycmF5KHhzKSkge1xuICAgICAgICByZXR1cm4geHMuam9pbihkZWxpbWl0ZXIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20oeHMpLmpvaW4oZGVsaW1pdGVyKTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gam9pbldpdGhJbmRpY2VzKGRlbGltaXRlciwgeHMsIHN0YXJ0SW5kZXgsIGNvdW50KSB7XG4gICAgY29uc3QgZW5kSW5kZXhQbHVzT25lID0gc3RhcnRJbmRleCArIGNvdW50O1xuICAgIGlmIChlbmRJbmRleFBsdXNPbmUgPiB4cy5sZW5ndGgpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW5kZXggYW5kIGNvdW50IG11c3QgcmVmZXIgdG8gYSBsb2NhdGlvbiB3aXRoaW4gdGhlIGJ1ZmZlci5cIik7XG4gICAgfVxuICAgIHJldHVybiB4cy5zbGljZShzdGFydEluZGV4LCBlbmRJbmRleFBsdXNPbmUpLmpvaW4oZGVsaW1pdGVyKTtcbn1cbmZ1bmN0aW9uIG5vdFN1cHBvcnRlZChuYW1lKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlIGVudmlyb25tZW50IGRvZXNuJ3Qgc3VwcG9ydCAnXCIgKyBuYW1lICsgXCInLCBwbGVhc2UgdXNlIGEgcG9seWZpbGwuXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvQmFzZTY0U3RyaW5nKGluQXJyYXkpIHtcbiAgICBsZXQgc3RyID0gXCJcIjtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGluQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoaW5BcnJheVtpXSk7XG4gICAgfVxuICAgIHJldHVybiB0eXBlb2YgYnRvYSA9PT0gXCJmdW5jdGlvblwiID8gYnRvYShzdHIpIDogbm90U3VwcG9ydGVkKFwiYnRvYVwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBmcm9tQmFzZTY0U3RyaW5nKGI2NEVuY29kZWQpIHtcbiAgICBjb25zdCBiaW5hcnkgPSB0eXBlb2YgYXRvYiA9PT0gXCJmdW5jdGlvblwiID8gYXRvYihiNjRFbmNvZGVkKSA6IG5vdFN1cHBvcnRlZChcImF0b2JcIik7XG4gICAgY29uc3QgYnl0ZXMgPSBuZXcgVWludDhBcnJheShiaW5hcnkubGVuZ3RoKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJpbmFyeS5sZW5ndGg7IGkrKykge1xuICAgICAgICBieXRlc1tpXSA9IGJpbmFyeS5jaGFyQ29kZUF0KGkpO1xuICAgIH1cbiAgICByZXR1cm4gYnl0ZXM7XG59XG5mdW5jdGlvbiBwYWQoc3RyLCBsZW4sIGNoLCBpc1JpZ2h0KSB7XG4gICAgY2ggPSBjaCB8fCBcIiBcIjtcbiAgICBsZW4gPSBsZW4gLSBzdHIubGVuZ3RoO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgc3RyID0gaXNSaWdodCA/IHN0ciArIGNoIDogY2ggKyBzdHI7XG4gICAgfVxuICAgIHJldHVybiBzdHI7XG59XG5leHBvcnQgZnVuY3Rpb24gcGFkTGVmdChzdHIsIGxlbiwgY2gpIHtcbiAgICByZXR1cm4gcGFkKHN0ciwgbGVuLCBjaCk7XG59XG5leHBvcnQgZnVuY3Rpb24gcGFkUmlnaHQoc3RyLCBsZW4sIGNoKSB7XG4gICAgcmV0dXJuIHBhZChzdHIsIGxlbiwgY2gsIHRydWUpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZShzdHIsIHN0YXJ0SW5kZXgsIGNvdW50KSB7XG4gICAgaWYgKHN0YXJ0SW5kZXggPj0gc3RyLmxlbmd0aCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJzdGFydEluZGV4IG11c3QgYmUgbGVzcyB0aGFuIGxlbmd0aCBvZiBzdHJpbmdcIik7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgY291bnQgPT09IFwibnVtYmVyXCIgJiYgKHN0YXJ0SW5kZXggKyBjb3VudCkgPiBzdHIubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkluZGV4IGFuZCBjb3VudCBtdXN0IHJlZmVyIHRvIGEgbG9jYXRpb24gd2l0aGluIHRoZSBzdHJpbmcuXCIpO1xuICAgIH1cbiAgICByZXR1cm4gc3RyLnNsaWNlKDAsIHN0YXJ0SW5kZXgpICsgKHR5cGVvZiBjb3VudCA9PT0gXCJudW1iZXJcIiA/IHN0ci5zdWJzdHIoc3RhcnRJbmRleCArIGNvdW50KSA6IFwiXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHJlcGxhY2Uoc3RyLCBzZWFyY2gsIHJlcGxhY2UpIHtcbiAgICByZXR1cm4gc3RyLnJlcGxhY2UobmV3IFJlZ0V4cChlc2NhcGUoc2VhcmNoKSwgXCJnXCIpLCByZXBsYWNlKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiByZXBsaWNhdGUobiwgeCkge1xuICAgIHJldHVybiBpbml0aWFsaXplKG4sICgpID0+IHgpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGdldENoYXJBdEluZGV4KGlucHV0LCBpbmRleCkge1xuICAgIGlmIChpbmRleCA8IDAgfHwgaW5kZXggPj0gaW5wdXQubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkluZGV4IHdhcyBvdXRzaWRlIHRoZSBib3VuZHMgb2YgdGhlIGFycmF5LlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIGlucHV0W2luZGV4XTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBzcGxpdChzdHIsIHNwbGl0dGVycywgY291bnQsIG9wdGlvbnMpIHtcbiAgICBjb3VudCA9IHR5cGVvZiBjb3VudCA9PT0gXCJudW1iZXJcIiA/IGNvdW50IDogdW5kZWZpbmVkO1xuICAgIG9wdGlvbnMgPSB0eXBlb2Ygb3B0aW9ucyA9PT0gXCJudW1iZXJcIiA/IG9wdGlvbnMgOiAwO1xuICAgIGlmIChjb3VudCAmJiBjb3VudCA8IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ291bnQgY2Fubm90IGJlIGxlc3MgdGhhbiB6ZXJvXCIpO1xuICAgIH1cbiAgICBpZiAoY291bnQgPT09IDApIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICBjb25zdCByZW1vdmVFbXB0eSA9IChvcHRpb25zICYgMSkgPT09IDE7XG4gICAgY29uc3QgdHJpbSA9IChvcHRpb25zICYgMikgPT09IDI7XG4gICAgc3BsaXR0ZXJzID0gc3BsaXR0ZXJzIHx8IFtdO1xuICAgIHNwbGl0dGVycyA9IHNwbGl0dGVycy5maWx0ZXIoeCA9PiB4KS5tYXAoZXNjYXBlKTtcbiAgICBzcGxpdHRlcnMgPSBzcGxpdHRlcnMubGVuZ3RoID4gMCA/IHNwbGl0dGVycyA6IFtcIlxcXFxzXCJdO1xuICAgIGNvbnN0IHNwbGl0cyA9IFtdO1xuICAgIGNvbnN0IHJlZyA9IG5ldyBSZWdFeHAoc3BsaXR0ZXJzLmpvaW4oXCJ8XCIpLCBcImdcIik7XG4gICAgbGV0IGZpbmRTcGxpdHMgPSB0cnVlO1xuICAgIGxldCBpID0gMDtcbiAgICBkbyB7XG4gICAgICAgIGNvbnN0IG1hdGNoID0gcmVnLmV4ZWMoc3RyKTtcbiAgICAgICAgaWYgKG1hdGNoID09PSBudWxsKSB7XG4gICAgICAgICAgICBjb25zdCBjYW5kaWRhdGUgPSB0cmltID8gc3RyLnN1YnN0cmluZyhpKS50cmltKCkgOiBzdHIuc3Vic3RyaW5nKGkpO1xuICAgICAgICAgICAgaWYgKCFyZW1vdmVFbXB0eSB8fCBjYW5kaWRhdGUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHNwbGl0cy5wdXNoKGNhbmRpZGF0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmaW5kU3BsaXRzID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBjYW5kaWRhdGUgPSB0cmltID8gc3RyLnN1YnN0cmluZyhpLCBtYXRjaC5pbmRleCkudHJpbSgpIDogc3RyLnN1YnN0cmluZyhpLCBtYXRjaC5pbmRleCk7XG4gICAgICAgICAgICBpZiAoIXJlbW92ZUVtcHR5IHx8IGNhbmRpZGF0ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvdW50ICE9IG51bGwgJiYgc3BsaXRzLmxlbmd0aCArIDEgPT09IGNvdW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHNwbGl0cy5wdXNoKHRyaW0gPyBzdHIuc3Vic3RyaW5nKGkpLnRyaW0oKSA6IHN0ci5zdWJzdHJpbmcoaSkpO1xuICAgICAgICAgICAgICAgICAgICBmaW5kU3BsaXRzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzcGxpdHMucHVzaChjYW5kaWRhdGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGkgPSByZWcubGFzdEluZGV4O1xuICAgICAgICB9XG4gICAgfSB3aGlsZSAoZmluZFNwbGl0cyk7XG4gICAgcmV0dXJuIHNwbGl0cztcbn1cbmV4cG9ydCBmdW5jdGlvbiB0cmltKHN0ciwgLi4uY2hhcnMpIHtcbiAgICBpZiAoY2hhcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBzdHIudHJpbSgpO1xuICAgIH1cbiAgICBjb25zdCBwYXR0ZXJuID0gXCJbXCIgKyBlc2NhcGUoY2hhcnMuam9pbihcIlwiKSkgKyBcIl0rXCI7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKG5ldyBSZWdFeHAoXCJeXCIgKyBwYXR0ZXJuKSwgXCJcIikucmVwbGFjZShuZXcgUmVnRXhwKHBhdHRlcm4gKyBcIiRcIiksIFwiXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRyaW1TdGFydChzdHIsIC4uLmNoYXJzKSB7XG4gICAgcmV0dXJuIGNoYXJzLmxlbmd0aCA9PT0gMFxuICAgICAgICA/IHN0ci50cmltU3RhcnQoKVxuICAgICAgICA6IHN0ci5yZXBsYWNlKG5ldyBSZWdFeHAoXCJeW1wiICsgZXNjYXBlKGNoYXJzLmpvaW4oXCJcIikpICsgXCJdK1wiKSwgXCJcIik7XG59XG5leHBvcnQgZnVuY3Rpb24gdHJpbUVuZChzdHIsIC4uLmNoYXJzKSB7XG4gICAgcmV0dXJuIGNoYXJzLmxlbmd0aCA9PT0gMFxuICAgICAgICA/IHN0ci50cmltRW5kKClcbiAgICAgICAgOiBzdHIucmVwbGFjZShuZXcgUmVnRXhwKFwiW1wiICsgZXNjYXBlKGNoYXJzLmpvaW4oXCJcIikpICsgXCJdKyRcIiksIFwiXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGZpbHRlcihwcmVkLCB4KSB7XG4gICAgcmV0dXJuIHguc3BsaXQoXCJcIikuZmlsdGVyKChjKSA9PiBwcmVkKGMpKS5qb2luKFwiXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHN1YnN0cmluZyhzdHIsIHN0YXJ0SW5kZXgsIGxlbmd0aCkge1xuICAgIGlmICgoc3RhcnRJbmRleCArIChsZW5ndGggfHwgMCkgPiBzdHIubGVuZ3RoKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHN0YXJ0SW5kZXggYW5kL29yIGxlbmd0aFwiKTtcbiAgICB9XG4gICAgcmV0dXJuIGxlbmd0aCAhPSBudWxsID8gc3RyLnN1YnN0cihzdGFydEluZGV4LCBsZW5ndGgpIDogc3RyLnN1YnN0cihzdGFydEluZGV4KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b0NoYXJBcnJheTIoc3RyLCBzdGFydEluZGV4LCBsZW5ndGgpIHtcbiAgICByZXR1cm4gc3Vic3RyaW5nKHN0ciwgc3RhcnRJbmRleCwgbGVuZ3RoKS5zcGxpdChcIlwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBmbXQoc3RycywgLi4uYXJncykge1xuICAgIHJldHVybiAoeyBzdHJzLCBhcmdzIH0pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGZtdFdpdGgoZm10cykge1xuICAgIHJldHVybiAoc3RycywgLi4uYXJncykgPT4gKHsgc3RycywgYXJncywgZm10cyB9KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBnZXRGb3JtYXQocykge1xuICAgIHJldHVybiBzLmZtdHNcbiAgICAgICAgPyBzLnN0cnMucmVkdWNlKChhY2MsIG5ld1BhcnQsIGluZGV4KSA9PiBhY2MgKyBgeyR7U3RyaW5nKGluZGV4IC0gMSkgKyBzLmZtdHNbaW5kZXggLSAxXX19YCArIG5ld1BhcnQpXG4gICAgICAgIDogcy5zdHJzLnJlZHVjZSgoYWNjLCBuZXdQYXJ0LCBpbmRleCkgPT4gYWNjICsgYHske2luZGV4IC0gMX19YCArIG5ld1BhcnQpO1xufVxuIiwKICAiaW1wb3J0IHsgdG9TdHJpbmcgYXMgZGF0ZVRvU3RyaW5nIH0gZnJvbSBcIi4vRGF0ZS5qc1wiO1xuaW1wb3J0IHsgY29tcGFyZSBhcyBudW1lcmljQ29tcGFyZSwgaXNOdW1lcmljLCBtdWx0aXBseSwgdG9FeHBvbmVudGlhbCwgdG9GaXhlZCwgdG9IZXgsIHRvUHJlY2lzaW9uIH0gZnJvbSBcIi4vTnVtZXJpYy5qc1wiO1xuaW1wb3J0IHsgZXNjYXBlIH0gZnJvbSBcIi4vUmVnRXhwLmpzXCI7XG5pbXBvcnQgeyB0b1N0cmluZyB9IGZyb20gXCIuL1R5cGVzLmpzXCI7XG5jb25zdCBmc0Zvcm1hdFJlZ0V4cCA9IC8oXnxbXiVdKSUoWzArXFwtIF0qKShcXCp8XFxkKyk/KD86XFwuKFxcZCspKT8oXFx3KS9nO1xuY29uc3QgaW50ZXJwb2xhdGVSZWdFeHAgPSAvKD86KF58W14lXSklKFswK1xcLSBdKikoXFxkKyk/KD86XFwuKFxcZCspKT8oXFx3KSk/JVBcXChcXCkvZztcbmNvbnN0IGZvcm1hdFJlZ0V4cCA9IC9cXHsoXFxkKykoLC0/XFxkKyk/KD86XFw6KFthLXpBLVpdKShcXGR7MCwyfSl8XFw6KC4rPykpP1xcfS9nO1xuZnVuY3Rpb24gaXNMZXNzVGhhbih4LCB5KSB7XG4gICAgcmV0dXJuIG51bWVyaWNDb21wYXJlKHgsIHkpIDwgMDtcbn1cbmZ1bmN0aW9uIGNtcCh4LCB5LCBpYykge1xuICAgIGZ1bmN0aW9uIGlzSWdub3JlQ2FzZShpKSB7XG4gICAgICAgIHJldHVybiBpID09PSB0cnVlIHx8XG4gICAgICAgICAgICBpID09PSAxIC8qIFN0cmluZ0NvbXBhcmlzb24uQ3VycmVudEN1bHR1cmVJZ25vcmVDYXNlICovIHx8XG4gICAgICAgICAgICBpID09PSAzIC8qIFN0cmluZ0NvbXBhcmlzb24uSW52YXJpYW50Q3VsdHVyZUlnbm9yZUNhc2UgKi8gfHxcbiAgICAgICAgICAgIGkgPT09IDUgLyogU3RyaW5nQ29tcGFyaXNvbi5PcmRpbmFsSWdub3JlQ2FzZSAqLztcbiAgICB9XG4gICAgZnVuY3Rpb24gaXNPcmRpbmFsKGkpIHtcbiAgICAgICAgcmV0dXJuIGkgPT09IDQgLyogU3RyaW5nQ29tcGFyaXNvbi5PcmRpbmFsICovIHx8XG4gICAgICAgICAgICBpID09PSA1IC8qIFN0cmluZ0NvbXBhcmlzb24uT3JkaW5hbElnbm9yZUNhc2UgKi87XG4gICAgfVxuICAgIGlmICh4ID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHkgPT0gbnVsbCA/IDAgOiAtMTtcbiAgICB9XG4gICAgaWYgKHkgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gMTtcbiAgICB9IC8vIGV2ZXJ5dGhpbmcgaXMgYmlnZ2VyIHRoYW4gbnVsbFxuICAgIGlmIChpc09yZGluYWwoaWMpKSB7XG4gICAgICAgIGlmIChpc0lnbm9yZUNhc2UoaWMpKSB7XG4gICAgICAgICAgICB4ID0geC50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgeSA9IHkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKHggPT09IHkpID8gMCA6ICh4IDwgeSA/IC0xIDogMSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAoaXNJZ25vcmVDYXNlKGljKSkge1xuICAgICAgICAgICAgeCA9IHgudG9Mb2NhbGVMb3dlckNhc2UoKTtcbiAgICAgICAgICAgIHkgPSB5LnRvTG9jYWxlTG93ZXJDYXNlKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHgubG9jYWxlQ29tcGFyZSh5KTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gY29tcGFyZSguLi5hcmdzKSB7XG4gICAgc3dpdGNoIChhcmdzLmxlbmd0aCkge1xuICAgICAgICBjYXNlIDI6IHJldHVybiBjbXAoYXJnc1swXSwgYXJnc1sxXSwgZmFsc2UpO1xuICAgICAgICBjYXNlIDM6IHJldHVybiBjbXAoYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSk7XG4gICAgICAgIGNhc2UgNDogcmV0dXJuIGNtcChhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdID09PSB0cnVlKTtcbiAgICAgICAgY2FzZSA1OiByZXR1cm4gY21wKGFyZ3NbMF0uc3Vic3RyKGFyZ3NbMV0sIGFyZ3NbNF0pLCBhcmdzWzJdLnN1YnN0cihhcmdzWzNdLCBhcmdzWzRdKSwgZmFsc2UpO1xuICAgICAgICBjYXNlIDY6IHJldHVybiBjbXAoYXJnc1swXS5zdWJzdHIoYXJnc1sxXSwgYXJnc1s0XSksIGFyZ3NbMl0uc3Vic3RyKGFyZ3NbM10sIGFyZ3NbNF0pLCBhcmdzWzVdKTtcbiAgICAgICAgY2FzZSA3OiByZXR1cm4gY21wKGFyZ3NbMF0uc3Vic3RyKGFyZ3NbMV0sIGFyZ3NbNF0pLCBhcmdzWzJdLnN1YnN0cihhcmdzWzNdLCBhcmdzWzRdKSwgYXJnc1s1XSA9PT0gdHJ1ZSk7XG4gICAgICAgIGRlZmF1bHQ6IHRocm93IG5ldyBFcnJvcihcIlN0cmluZy5jb21wYXJlOiBVbnN1cHBvcnRlZCBudW1iZXIgb2YgcGFyYW1ldGVyc1wiKTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gY29tcGFyZU9yZGluYWwoeCwgeSkge1xuICAgIHJldHVybiBjbXAoeCwgeSwgNCAvKiBTdHJpbmdDb21wYXJpc29uLk9yZGluYWwgKi8pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBhcmVUbyh4LCB5KSB7XG4gICAgcmV0dXJuIGNtcCh4LCB5LCAwIC8qIFN0cmluZ0NvbXBhcmlzb24uQ3VycmVudEN1bHR1cmUgKi8pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHN0YXJ0c1dpdGgoc3RyLCBwYXR0ZXJuLCBpYykge1xuICAgIGlmIChzdHIubGVuZ3RoID49IHBhdHRlcm4ubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBjbXAoc3RyLnN1YnN0cigwLCBwYXR0ZXJuLmxlbmd0aCksIHBhdHRlcm4sIGljKSA9PT0gMDtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGluZGV4T2ZBbnkoc3RyLCBhbnlPZiwgLi4uYXJncykge1xuICAgIGlmIChzdHIgPT0gbnVsbCB8fCBzdHIgPT09IFwiXCIpIHtcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIH1cbiAgICBjb25zdCBzdGFydEluZGV4ID0gKGFyZ3MubGVuZ3RoID4gMCkgPyBhcmdzWzBdIDogMDtcbiAgICBpZiAoc3RhcnRJbmRleCA8IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3RhcnQgaW5kZXggY2Fubm90IGJlIG5lZ2F0aXZlXCIpO1xuICAgIH1cbiAgICBjb25zdCBsZW5ndGggPSAoYXJncy5sZW5ndGggPiAxKSA/IGFyZ3NbMV0gOiBzdHIubGVuZ3RoIC0gc3RhcnRJbmRleDtcbiAgICBpZiAobGVuZ3RoIDwgMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJMZW5ndGggY2Fubm90IGJlIG5lZ2F0aXZlXCIpO1xuICAgIH1cbiAgICBpZiAoc3RhcnRJbmRleCArIGxlbmd0aCA+IHN0ci5sZW5ndGgpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBzdGFydEluZGV4IGFuZCBsZW5ndGhcIik7XG4gICAgfVxuICAgIGNvbnN0IGVuZEluZGV4ID0gc3RhcnRJbmRleCArIGxlbmd0aDtcbiAgICBjb25zdCBhbnlPZkFzU3RyID0gXCJcIi5jb25jYXQuYXBwbHkoXCJcIiwgYW55T2YpO1xuICAgIGZvciAobGV0IGkgPSBzdGFydEluZGV4OyBpIDwgZW5kSW5kZXg7IGkrKykge1xuICAgICAgICBpZiAoYW55T2ZBc1N0ci5pbmRleE9mKHN0cltpXSkgPiAtMSkge1xuICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIC0xO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHByaW50ZihpbnB1dCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIGlucHV0LFxuICAgICAgICBjb250OiBmc0Zvcm1hdChpbnB1dCksXG4gICAgfTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpbnRlcnBvbGF0ZShzdHIsIHZhbHVlcykge1xuICAgIGxldCB2YWxJZHggPSAwO1xuICAgIGxldCBzdHJJZHggPSAwO1xuICAgIGxldCByZXN1bHQgPSBcIlwiO1xuICAgIGludGVycG9sYXRlUmVnRXhwLmxhc3RJbmRleCA9IDA7XG4gICAgbGV0IG1hdGNoID0gaW50ZXJwb2xhdGVSZWdFeHAuZXhlYyhzdHIpO1xuICAgIHdoaWxlIChtYXRjaCkge1xuICAgICAgICAvLyBUaGUgZmlyc3QgZ3JvdXAgY29ycmVzcG9uZHMgdG8gdGhlIG5vLWVzY2FwZSBjaGFyIChefFteJV0pLCB0aGUgYWN0dWFsIHBhdHRlcm4gc3RhcnRzIGluIHRoZSBuZXh0IGNoYXJcbiAgICAgICAgLy8gTm90ZTogd2UgZG9uJ3QgdXNlIG5lZ2F0aXZlIGxvb2tiZWhpbmQgYmVjYXVzZSBzb21lIGJyb3dzZXJzIGRvbid0IHN1cHBvcnQgaXQgeWV0XG4gICAgICAgIGNvbnN0IG1hdGNoSW5kZXggPSBtYXRjaC5pbmRleCArIChtYXRjaFsxXSB8fCBcIlwiKS5sZW5ndGg7XG4gICAgICAgIHJlc3VsdCArPSBzdHIuc3Vic3RyaW5nKHN0cklkeCwgbWF0Y2hJbmRleCkucmVwbGFjZSgvJSUvZywgXCIlXCIpO1xuICAgICAgICBjb25zdCBbLCAsIGZsYWdzLCBwYWRMZW5ndGgsIHByZWNpc2lvbiwgZm9ybWF0XSA9IG1hdGNoO1xuICAgICAgICAvLyBTYXZlIGludGVycG9sYXRlUmVnRXhwLmxhc3RJbmRleCBiZWZvcmUgcnVubmluZyBmb3JtYXRSZXBsYWNlbWVudCBiZWNhdXNlIHRoZSB2YWx1ZXNcbiAgICAgICAgLy8gbWF5IGFsc28gaW52b2x2ZSBpbnRlcnBvbGF0aW9uIGFuZCBtYWtlIHVzZSBvZiBpbnRlcnBvbGF0ZVJlZ0V4cCAoc2VlICMzMDc4KVxuICAgICAgICBzdHJJZHggPSBpbnRlcnBvbGF0ZVJlZ0V4cC5sYXN0SW5kZXg7XG4gICAgICAgIHJlc3VsdCArPSBmb3JtYXRSZXBsYWNlbWVudCh2YWx1ZXNbdmFsSWR4KytdLCBmbGFncywgcGFkTGVuZ3RoLCBwcmVjaXNpb24sIGZvcm1hdCk7XG4gICAgICAgIC8vIE1vdmUgaW50ZXJwb2xhdGVSZWdFeHAubGFzdEluZGV4IG9uZSBjaGFyIGJlaGluZCB0byBtYWtlIHN1cmUgd2UgbWF0Y2ggdGhlIG5vLWVzY2FwZSBjaGFyIG5leHQgdGltZVxuICAgICAgICBpbnRlcnBvbGF0ZVJlZ0V4cC5sYXN0SW5kZXggPSBzdHJJZHggLSAxO1xuICAgICAgICBtYXRjaCA9IGludGVycG9sYXRlUmVnRXhwLmV4ZWMoc3RyKTtcbiAgICB9XG4gICAgcmVzdWx0ICs9IHN0ci5zdWJzdHJpbmcoc3RySWR4KS5yZXBsYWNlKC8lJS9nLCBcIiVcIik7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cbmZ1bmN0aW9uIGNvbnRpbnVlUHJpbnQoY29udCwgYXJnKSB7XG4gICAgcmV0dXJuIHR5cGVvZiBhcmcgPT09IFwic3RyaW5nXCIgPyBjb250KGFyZykgOiBhcmcuY29udChjb250KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b0NvbnNvbGUoYXJnKSB7XG4gICAgLy8gRG9uJ3QgcmVtb3ZlIHRoZSBsYW1iZGEgaGVyZSwgc2VlICMxMzU3XG4gICAgcmV0dXJuIGNvbnRpbnVlUHJpbnQoKHgpID0+IGNvbnNvbGUubG9nKHgpLCBhcmcpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvQ29uc29sZUVycm9yKGFyZykge1xuICAgIHJldHVybiBjb250aW51ZVByaW50KCh4KSA9PiBjb25zb2xlLmVycm9yKHgpLCBhcmcpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvVGV4dChhcmcpIHtcbiAgICByZXR1cm4gY29udGludWVQcmludCgoeCkgPT4geCwgYXJnKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b0ZhaWwoYXJnKSB7XG4gICAgcmV0dXJuIGNvbnRpbnVlUHJpbnQoKHgpID0+IHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKHgpO1xuICAgIH0sIGFyZyk7XG59XG5mdW5jdGlvbiBmb3JtYXRSZXBsYWNlbWVudChyZXAsIGZsYWdzLCBwYWRMZW5ndGgsIHByZWNpc2lvbiwgZm9ybWF0KSB7XG4gICAgbGV0IHNpZ24gPSBcIlwiO1xuICAgIGZsYWdzID0gZmxhZ3MgfHwgXCJcIjtcbiAgICBmb3JtYXQgPSBmb3JtYXQgfHwgXCJcIjtcbiAgICBpZiAoaXNOdW1lcmljKHJlcCkpIHtcbiAgICAgICAgaWYgKGZvcm1hdC50b0xvd2VyQ2FzZSgpICE9PSBcInhcIikge1xuICAgICAgICAgICAgaWYgKGlzTGVzc1RoYW4ocmVwLCAwKSkge1xuICAgICAgICAgICAgICAgIHJlcCA9IG11bHRpcGx5KHJlcCwgLTEpO1xuICAgICAgICAgICAgICAgIHNpZ24gPSBcIi1cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChmbGFncy5pbmRleE9mKFwiIFwiKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHNpZ24gPSBcIiBcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZmxhZ3MuaW5kZXhPZihcIitcIikgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICBzaWduID0gXCIrXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHByZWNpc2lvbiA9IHByZWNpc2lvbiA9PSBudWxsID8gbnVsbCA6IHBhcnNlSW50KHByZWNpc2lvbiwgMTApO1xuICAgICAgICBzd2l0Y2ggKGZvcm1hdCkge1xuICAgICAgICAgICAgY2FzZSBcImZcIjpcbiAgICAgICAgICAgIGNhc2UgXCJGXCI6XG4gICAgICAgICAgICAgICAgcHJlY2lzaW9uID0gcHJlY2lzaW9uICE9IG51bGwgPyBwcmVjaXNpb24gOiA2O1xuICAgICAgICAgICAgICAgIHJlcCA9IHRvRml4ZWQocmVwLCBwcmVjaXNpb24pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImdcIjpcbiAgICAgICAgICAgIGNhc2UgXCJHXCI6XG4gICAgICAgICAgICAgICAgcmVwID0gcHJlY2lzaW9uICE9IG51bGwgPyB0b1ByZWNpc2lvbihyZXAsIHByZWNpc2lvbikgOiB0b1ByZWNpc2lvbihyZXApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImVcIjpcbiAgICAgICAgICAgIGNhc2UgXCJFXCI6XG4gICAgICAgICAgICAgICAgcmVwID0gcHJlY2lzaW9uICE9IG51bGwgPyB0b0V4cG9uZW50aWFsKHJlcCwgcHJlY2lzaW9uKSA6IHRvRXhwb25lbnRpYWwocmVwKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJ4XCI6XG4gICAgICAgICAgICAgICAgcmVwID0gdG9IZXgocmVwKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJYXCI6XG4gICAgICAgICAgICAgICAgcmVwID0gdG9IZXgocmVwKS50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDogLy8gQU9pZFxuICAgICAgICAgICAgICAgIHJlcCA9IFN0cmluZyhyZXApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKHJlcCBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgICAgcmVwID0gZGF0ZVRvU3RyaW5nKHJlcCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXAgPSB0b1N0cmluZyhyZXApO1xuICAgIH1cbiAgICBwYWRMZW5ndGggPSB0eXBlb2YgcGFkTGVuZ3RoID09PSBcIm51bWJlclwiID8gcGFkTGVuZ3RoIDogcGFyc2VJbnQocGFkTGVuZ3RoLCAxMCk7XG4gICAgaWYgKCFpc05hTihwYWRMZW5ndGgpKSB7XG4gICAgICAgIGNvbnN0IHplcm9GbGFnID0gZmxhZ3MuaW5kZXhPZihcIjBcIikgPj0gMDsgLy8gVXNlICcwJyBmb3IgbGVmdCBwYWRkaW5nXG4gICAgICAgIGNvbnN0IG1pbnVzRmxhZyA9IGZsYWdzLmluZGV4T2YoXCItXCIpID49IDA7IC8vIFJpZ2h0IHBhZGRpbmdcbiAgICAgICAgY29uc3QgY2ggPSBtaW51c0ZsYWcgfHwgIXplcm9GbGFnID8gXCIgXCIgOiBcIjBcIjtcbiAgICAgICAgaWYgKGNoID09PSBcIjBcIikge1xuICAgICAgICAgICAgcmVwID0gcGFkKHJlcCwgcGFkTGVuZ3RoIC0gc2lnbi5sZW5ndGgsIGNoLCBtaW51c0ZsYWcpO1xuICAgICAgICAgICAgcmVwID0gc2lnbiArIHJlcDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJlcCA9IHBhZChzaWduICsgcmVwLCBwYWRMZW5ndGgsIGNoLCBtaW51c0ZsYWcpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXAgPSBzaWduICsgcmVwO1xuICAgIH1cbiAgICByZXR1cm4gcmVwO1xufVxuZnVuY3Rpb24gY3JlYXRlUHJpbnRlcihjb250LCBfc3RyUGFydHMsIF9tYXRjaGVzLCBfcmVzdWx0ID0gXCJcIiwgcGFkQXJnID0gLTEpIHtcbiAgICByZXR1cm4gKC4uLmFyZ3MpID0+IHtcbiAgICAgICAgLy8gTWFrZSBjb3BpZXMgb2YgdGhlIHZhbHVlcyBwYXNzZWQgYnkgcmVmZXJlbmNlIGJlY2F1c2UgdGhlIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIG11bHRpcGxlIHRpbWVzXG4gICAgICAgIGxldCByZXN1bHQgPSBfcmVzdWx0O1xuICAgICAgICBjb25zdCBzdHJQYXJ0cyA9IF9zdHJQYXJ0cy5zbGljZSgpO1xuICAgICAgICBjb25zdCBtYXRjaGVzID0gX21hdGNoZXMuc2xpY2UoKTtcbiAgICAgICAgZm9yIChjb25zdCBhcmcgb2YgYXJncykge1xuICAgICAgICAgICAgY29uc3QgWywgLCBmbGFncywgX3BhZExlbmd0aCwgcHJlY2lzaW9uLCBmb3JtYXRdID0gbWF0Y2hlc1swXTtcbiAgICAgICAgICAgIGxldCBwYWRMZW5ndGggPSBfcGFkTGVuZ3RoO1xuICAgICAgICAgICAgaWYgKHBhZEFyZyA+PSAwKSB7XG4gICAgICAgICAgICAgICAgcGFkTGVuZ3RoID0gcGFkQXJnO1xuICAgICAgICAgICAgICAgIHBhZEFyZyA9IC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocGFkTGVuZ3RoID09PSBcIipcIikge1xuICAgICAgICAgICAgICAgIGlmIChhcmcgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vbi1uZWdhdGl2ZSBudW1iZXIgcmVxdWlyZWRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHBhZEFyZyA9IGFyZztcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc3VsdCArPSBzdHJQYXJ0c1swXTtcbiAgICAgICAgICAgIHJlc3VsdCArPSBmb3JtYXRSZXBsYWNlbWVudChhcmcsIGZsYWdzLCBwYWRMZW5ndGgsIHByZWNpc2lvbiwgZm9ybWF0KTtcbiAgICAgICAgICAgIHN0clBhcnRzLnNwbGljZSgwLCAxKTtcbiAgICAgICAgICAgIG1hdGNoZXMuc3BsaWNlKDAsIDEpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChtYXRjaGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmVzdWx0ICs9IHN0clBhcnRzWzBdO1xuICAgICAgICAgICAgcmV0dXJuIGNvbnQocmVzdWx0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBjcmVhdGVQcmludGVyKGNvbnQsIHN0clBhcnRzLCBtYXRjaGVzLCByZXN1bHQsIHBhZEFyZyk7XG4gICAgICAgIH1cbiAgICB9O1xufVxuZXhwb3J0IGZ1bmN0aW9uIGZzRm9ybWF0KHN0cikge1xuICAgIHJldHVybiAoY29udCkgPT4ge1xuICAgICAgICBmc0Zvcm1hdFJlZ0V4cC5sYXN0SW5kZXggPSAwO1xuICAgICAgICBjb25zdCBzdHJQYXJ0cyA9IFtdO1xuICAgICAgICBjb25zdCBtYXRjaGVzID0gW107XG4gICAgICAgIGxldCBzdHJJZHggPSAwO1xuICAgICAgICBsZXQgbWF0Y2ggPSBmc0Zvcm1hdFJlZ0V4cC5leGVjKHN0cik7XG4gICAgICAgIHdoaWxlIChtYXRjaCkge1xuICAgICAgICAgICAgLy8gVGhlIGZpcnN0IGdyb3VwIGNvcnJlc3BvbmRzIHRvIHRoZSBuby1lc2NhcGUgY2hhciAoXnxbXiVdKSwgdGhlIGFjdHVhbCBwYXR0ZXJuIHN0YXJ0cyBpbiB0aGUgbmV4dCBjaGFyXG4gICAgICAgICAgICAvLyBOb3RlOiB3ZSBkb24ndCB1c2UgbmVnYXRpdmUgbG9va2JlaGluZCBiZWNhdXNlIHNvbWUgYnJvd3NlcnMgZG9uJ3Qgc3VwcG9ydCBpdCB5ZXRcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoSW5kZXggPSBtYXRjaC5pbmRleCArIChtYXRjaFsxXSB8fCBcIlwiKS5sZW5ndGg7XG4gICAgICAgICAgICBzdHJQYXJ0cy5wdXNoKHN0ci5zdWJzdHJpbmcoc3RySWR4LCBtYXRjaEluZGV4KS5yZXBsYWNlKC8lJS9nLCBcIiVcIikpO1xuICAgICAgICAgICAgbWF0Y2hlcy5wdXNoKG1hdGNoKTtcbiAgICAgICAgICAgIHN0cklkeCA9IGZzRm9ybWF0UmVnRXhwLmxhc3RJbmRleDtcbiAgICAgICAgICAgIC8vIExpa2V3aXNlIHdlIG5lZWQgdG8gbW92ZSBmc0Zvcm1hdFJlZ0V4cC5sYXN0SW5kZXggb25lIGNoYXIgYmVoaW5kIHRvIG1ha2Ugc3VyZSB3ZSBtYXRjaCB0aGUgbm8tZXNjYXBlIGNoYXIgbmV4dCB0aW1lXG4gICAgICAgICAgICBmc0Zvcm1hdFJlZ0V4cC5sYXN0SW5kZXggLT0gMTtcbiAgICAgICAgICAgIG1hdGNoID0gZnNGb3JtYXRSZWdFeHAuZXhlYyhzdHIpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzdHJQYXJ0cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBjb250KHN0ci5yZXBsYWNlKC8lJS9nLCBcIiVcIikpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc3RyUGFydHMucHVzaChzdHIuc3Vic3RyaW5nKHN0cklkeCkucmVwbGFjZSgvJSUvZywgXCIlXCIpKTtcbiAgICAgICAgICAgIHJldHVybiBjcmVhdGVQcmludGVyKGNvbnQsIHN0clBhcnRzLCBtYXRjaGVzKTtcbiAgICAgICAgfVxuICAgIH07XG59XG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0KHN0ciwgLi4uYXJncykge1xuICAgIGxldCBzdHIyO1xuICAgIGlmICh0eXBlb2Ygc3RyID09PSBcIm9iamVjdFwiKSB7XG4gICAgICAgIC8vIENhbGxlZCB3aXRoIGN1bHR1cmUgaW5mb1xuICAgICAgICBzdHIyID0gU3RyaW5nKGFyZ3NbMF0pO1xuICAgICAgICBhcmdzLnNoaWZ0KCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBzdHIyID0gc3RyO1xuICAgIH1cbiAgICByZXR1cm4gc3RyMi5yZXBsYWNlKGZvcm1hdFJlZ0V4cCwgKF8sIGlkeCwgcGFkTGVuZ3RoLCBmb3JtYXQsIHByZWNpc2lvbiwgcGF0dGVybikgPT4ge1xuICAgICAgICBpZiAoaWR4IDwgMCB8fCBpZHggPj0gYXJncy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkluZGV4IG11c3QgYmUgZ3JlYXRlciBvciBlcXVhbCB0byB6ZXJvIGFuZCBsZXNzIHRoYW4gdGhlIGFyZ3VtZW50cycgbGVuZ3RoLlwiKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgcmVwID0gYXJnc1tpZHhdO1xuICAgICAgICBpZiAoaXNOdW1lcmljKHJlcCkpIHtcbiAgICAgICAgICAgIHByZWNpc2lvbiA9IHByZWNpc2lvbiA9PSBudWxsID8gbnVsbCA6IHBhcnNlSW50KHByZWNpc2lvbiwgMTApO1xuICAgICAgICAgICAgc3dpdGNoIChmb3JtYXQpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiZlwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJGXCI6XG4gICAgICAgICAgICAgICAgICAgIHByZWNpc2lvbiA9IHByZWNpc2lvbiAhPSBudWxsID8gcHJlY2lzaW9uIDogMjtcbiAgICAgICAgICAgICAgICAgICAgcmVwID0gdG9GaXhlZChyZXAsIHByZWNpc2lvbik7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJnXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcIkdcIjpcbiAgICAgICAgICAgICAgICAgICAgcmVwID0gcHJlY2lzaW9uICE9IG51bGwgPyB0b1ByZWNpc2lvbihyZXAsIHByZWNpc2lvbikgOiB0b1ByZWNpc2lvbihyZXApO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZVwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJFXCI6XG4gICAgICAgICAgICAgICAgICAgIHJlcCA9IHByZWNpc2lvbiAhPSBudWxsID8gdG9FeHBvbmVudGlhbChyZXAsIHByZWNpc2lvbikgOiB0b0V4cG9uZW50aWFsKHJlcCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJwXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcIlBcIjpcbiAgICAgICAgICAgICAgICAgICAgcHJlY2lzaW9uID0gcHJlY2lzaW9uICE9IG51bGwgPyBwcmVjaXNpb24gOiAyO1xuICAgICAgICAgICAgICAgICAgICByZXAgPSB0b0ZpeGVkKG11bHRpcGx5KHJlcCwgMTAwKSwgcHJlY2lzaW9uKSArIFwiICVcIjtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImRcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiRFwiOlxuICAgICAgICAgICAgICAgICAgICByZXAgPSBwcmVjaXNpb24gIT0gbnVsbCA/IHBhZExlZnQoU3RyaW5nKHJlcCksIHByZWNpc2lvbiwgXCIwXCIpIDogU3RyaW5nKHJlcCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJ4XCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcIlhcIjpcbiAgICAgICAgICAgICAgICAgICAgcmVwID0gcHJlY2lzaW9uICE9IG51bGwgPyBwYWRMZWZ0KHRvSGV4KHJlcCksIHByZWNpc2lvbiwgXCIwXCIpIDogdG9IZXgocmVwKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZvcm1hdCA9PT0gXCJYXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcCA9IHJlcC50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXR0ZXJuKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgc2lnbiA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXAgPSBwYXR0ZXJuLnJlcGxhY2UoLyhbMCMsXSspKFxcLlswI10rKT8vLCAoXywgaW50UGFydCwgZGVjaW1hbFBhcnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNMZXNzVGhhbihyZXAsIDApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcCA9IG11bHRpcGx5KHJlcCwgLTEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaWduID0gXCItXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlY2ltYWxQYXJ0ID0gZGVjaW1hbFBhcnQgPT0gbnVsbCA/IFwiXCIgOiBkZWNpbWFsUGFydC5zdWJzdHJpbmcoMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwID0gdG9GaXhlZChyZXAsIE1hdGgubWF4KGRlY2ltYWxQYXJ0Lmxlbmd0aCwgMCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBbcmVwSW50LCByZXBEZWNpbWFsXSA9IHJlcC5zcGxpdChcIi5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwRGVjaW1hbCB8fCAocmVwRGVjaW1hbCA9IFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxlZnRaZXJvZXMgPSBpbnRQYXJ0LnJlcGxhY2UoLywvZywgXCJcIikucmVwbGFjZSgvXiMrLywgXCJcIikubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcEludCA9IHBhZExlZnQocmVwSW50LCBsZWZ0WmVyb2VzLCBcIjBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmlnaHRaZXJvcyA9IGRlY2ltYWxQYXJ0LnJlcGxhY2UoLyMrJC8sIFwiXCIpLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmlnaHRaZXJvcyA+IHJlcERlY2ltYWwubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcERlY2ltYWwgPSBwYWRSaWdodChyZXBEZWNpbWFsLCByaWdodFplcm9zLCBcIjBcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJpZ2h0WmVyb3MgPCByZXBEZWNpbWFsLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBEZWNpbWFsID0gcmVwRGVjaW1hbC5zdWJzdHJpbmcoMCwgcmlnaHRaZXJvcykgKyByZXBEZWNpbWFsLnN1YnN0cmluZyhyaWdodFplcm9zKS5yZXBsYWNlKC8wKyQvLCBcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhvdXNhbmRzIHNlcGFyYXRvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnRQYXJ0LmluZGV4T2YoXCIsXCIpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gcmVwSW50Lmxlbmd0aCAlIDM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRob3VzYW5kR3JvdXBzID0gTWF0aC5mbG9vcihyZXBJbnQubGVuZ3RoIC8gMyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0aG91c2FuZHMgPSBpID4gMCA/IHJlcEludC5zdWJzdHIoMCwgaSkgKyAodGhvdXNhbmRHcm91cHMgPiAwID8gXCIsXCIgOiBcIlwiKSA6IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhvdXNhbmRHcm91cHM7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhvdXNhbmRzICs9IHJlcEludC5zdWJzdHIoaSArIGogKiAzLCAzKSArIChqIDwgdGhvdXNhbmRHcm91cHMgLSAxID8gXCIsXCIgOiBcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBJbnQgPSB0aG91c2FuZHM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXBEZWNpbWFsLmxlbmd0aCA+IDAgPyByZXBJbnQgKyBcIi5cIiArIHJlcERlY2ltYWwgOiByZXBJbnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcCA9IHNpZ24gKyByZXA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChyZXAgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICAgICAgICByZXAgPSBkYXRlVG9TdHJpbmcocmVwLCBwYXR0ZXJuIHx8IGZvcm1hdCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXAgPSB0b1N0cmluZyhyZXApO1xuICAgICAgICB9XG4gICAgICAgIHBhZExlbmd0aCA9IHBhcnNlSW50KChwYWRMZW5ndGggfHwgXCIgXCIpLnN1YnN0cmluZygxKSwgMTApO1xuICAgICAgICBpZiAoIWlzTmFOKHBhZExlbmd0aCkpIHtcbiAgICAgICAgICAgIHJlcCA9IHBhZChTdHJpbmcocmVwKSwgTWF0aC5hYnMocGFkTGVuZ3RoKSwgXCIgXCIsIHBhZExlbmd0aCA8IDApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXA7XG4gICAgfSk7XG59XG5leHBvcnQgZnVuY3Rpb24gZW5kc1dpdGgoc3RyLCBzZWFyY2gpIHtcbiAgICBjb25zdCBpZHggPSBzdHIubGFzdEluZGV4T2Yoc2VhcmNoKTtcbiAgICByZXR1cm4gaWR4ID49IDAgJiYgaWR4ID09PSBzdHIubGVuZ3RoIC0gc2VhcmNoLmxlbmd0aDtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpbml0aWFsaXplKG4sIGYpIHtcbiAgICBpZiAobiA8IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3RyaW5nIGxlbmd0aCBtdXN0IGJlIG5vbi1uZWdhdGl2ZVwiKTtcbiAgICB9XG4gICAgY29uc3QgeHMgPSBuZXcgQXJyYXkobik7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHtcbiAgICAgICAgeHNbaV0gPSBmKGkpO1xuICAgIH1cbiAgICByZXR1cm4geHMuam9pbihcIlwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpbnNlcnQoc3RyLCBzdGFydEluZGV4LCB2YWx1ZSkge1xuICAgIGlmIChzdGFydEluZGV4IDwgMCB8fCBzdGFydEluZGV4ID4gc3RyLmxlbmd0aCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJzdGFydEluZGV4IGlzIG5lZ2F0aXZlIG9yIGdyZWF0ZXIgdGhhbiB0aGUgbGVuZ3RoIG9mIHRoaXMgaW5zdGFuY2UuXCIpO1xuICAgIH1cbiAgICByZXR1cm4gc3RyLnN1YnN0cmluZygwLCBzdGFydEluZGV4KSArIHZhbHVlICsgc3RyLnN1YnN0cmluZyhzdGFydEluZGV4KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpc051bGxPckVtcHR5KHN0cikge1xuICAgIHJldHVybiB0eXBlb2Ygc3RyICE9PSBcInN0cmluZ1wiIHx8IHN0ci5sZW5ndGggPT09IDA7XG59XG5leHBvcnQgZnVuY3Rpb24gaXNOdWxsT3JXaGl0ZVNwYWNlKHN0cikge1xuICAgIHJldHVybiB0eXBlb2Ygc3RyICE9PSBcInN0cmluZ1wiIHx8IC9eXFxzKiQvLnRlc3Qoc3RyKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBjb25jYXQoLi4ueHMpIHtcbiAgICByZXR1cm4geHMubWFwKCh4KSA9PiBTdHJpbmcoeCkpLmpvaW4oXCJcIik7XG59XG5leHBvcnQgZnVuY3Rpb24gam9pbihkZWxpbWl0ZXIsIHhzKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoeHMpKSB7XG4gICAgICAgIHJldHVybiB4cy5qb2luKGRlbGltaXRlcik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh4cykuam9pbihkZWxpbWl0ZXIpO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBqb2luV2l0aEluZGljZXMoZGVsaW1pdGVyLCB4cywgc3RhcnRJbmRleCwgY291bnQpIHtcbiAgICBjb25zdCBlbmRJbmRleFBsdXNPbmUgPSBzdGFydEluZGV4ICsgY291bnQ7XG4gICAgaWYgKGVuZEluZGV4UGx1c09uZSA+IHhzLmxlbmd0aCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbmRleCBhbmQgY291bnQgbXVzdCByZWZlciB0byBhIGxvY2F0aW9uIHdpdGhpbiB0aGUgYnVmZmVyLlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIHhzLnNsaWNlKHN0YXJ0SW5kZXgsIGVuZEluZGV4UGx1c09uZSkuam9pbihkZWxpbWl0ZXIpO1xufVxuZnVuY3Rpb24gbm90U3VwcG9ydGVkKG5hbWUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgZW52aXJvbm1lbnQgZG9lc24ndCBzdXBwb3J0ICdcIiArIG5hbWUgKyBcIicsIHBsZWFzZSB1c2UgYSBwb2x5ZmlsbC5cIik7XG59XG5leHBvcnQgZnVuY3Rpb24gdG9CYXNlNjRTdHJpbmcoaW5BcnJheSkge1xuICAgIGxldCBzdHIgPSBcIlwiO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5BcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgICBzdHIgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShpbkFycmF5W2ldKTtcbiAgICB9XG4gICAgcmV0dXJuIHR5cGVvZiBidG9hID09PSBcImZ1bmN0aW9uXCIgPyBidG9hKHN0cikgOiBub3RTdXBwb3J0ZWQoXCJidG9hXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGZyb21CYXNlNjRTdHJpbmcoYjY0RW5jb2RlZCkge1xuICAgIGNvbnN0IGJpbmFyeSA9IHR5cGVvZiBhdG9iID09PSBcImZ1bmN0aW9uXCIgPyBhdG9iKGI2NEVuY29kZWQpIDogbm90U3VwcG9ydGVkKFwiYXRvYlwiKTtcbiAgICBjb25zdCBieXRlcyA9IG5ldyBVaW50OEFycmF5KGJpbmFyeS5sZW5ndGgpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmluYXJ5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGJ5dGVzW2ldID0gYmluYXJ5LmNoYXJDb2RlQXQoaSk7XG4gICAgfVxuICAgIHJldHVybiBieXRlcztcbn1cbmZ1bmN0aW9uIHBhZChzdHIsIGxlbiwgY2gsIGlzUmlnaHQpIHtcbiAgICBjaCA9IGNoIHx8IFwiIFwiO1xuICAgIGxlbiA9IGxlbiAtIHN0ci5sZW5ndGg7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICBzdHIgPSBpc1JpZ2h0ID8gc3RyICsgY2ggOiBjaCArIHN0cjtcbiAgICB9XG4gICAgcmV0dXJuIHN0cjtcbn1cbmV4cG9ydCBmdW5jdGlvbiBwYWRMZWZ0KHN0ciwgbGVuLCBjaCkge1xuICAgIHJldHVybiBwYWQoc3RyLCBsZW4sIGNoKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBwYWRSaWdodChzdHIsIGxlbiwgY2gpIHtcbiAgICByZXR1cm4gcGFkKHN0ciwgbGVuLCBjaCwgdHJ1ZSk7XG59XG5leHBvcnQgZnVuY3Rpb24gcmVtb3ZlKHN0ciwgc3RhcnRJbmRleCwgY291bnQpIHtcbiAgICBpZiAoc3RhcnRJbmRleCA+PSBzdHIubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcInN0YXJ0SW5kZXggbXVzdCBiZSBsZXNzIHRoYW4gbGVuZ3RoIG9mIHN0cmluZ1wiKTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBjb3VudCA9PT0gXCJudW1iZXJcIiAmJiAoc3RhcnRJbmRleCArIGNvdW50KSA+IHN0ci5sZW5ndGgpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW5kZXggYW5kIGNvdW50IG11c3QgcmVmZXIgdG8gYSBsb2NhdGlvbiB3aXRoaW4gdGhlIHN0cmluZy5cIik7XG4gICAgfVxuICAgIHJldHVybiBzdHIuc2xpY2UoMCwgc3RhcnRJbmRleCkgKyAodHlwZW9mIGNvdW50ID09PSBcIm51bWJlclwiID8gc3RyLnN1YnN0cihzdGFydEluZGV4ICsgY291bnQpIDogXCJcIik7XG59XG5leHBvcnQgZnVuY3Rpb24gcmVwbGFjZShzdHIsIHNlYXJjaCwgcmVwbGFjZSkge1xuICAgIHJldHVybiBzdHIucmVwbGFjZShuZXcgUmVnRXhwKGVzY2FwZShzZWFyY2gpLCBcImdcIiksIHJlcGxhY2UpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHJlcGxpY2F0ZShuLCB4KSB7XG4gICAgcmV0dXJuIGluaXRpYWxpemUobiwgKCkgPT4geCk7XG59XG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2hhckF0SW5kZXgoaW5wdXQsIGluZGV4KSB7XG4gICAgaWYgKGluZGV4IDwgMCB8fCBpbmRleCA+PSBpbnB1dC5sZW5ndGgpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW5kZXggd2FzIG91dHNpZGUgdGhlIGJvdW5kcyBvZiB0aGUgYXJyYXkuXCIpO1xuICAgIH1cbiAgICByZXR1cm4gaW5wdXRbaW5kZXhdO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHNwbGl0KHN0ciwgc3BsaXR0ZXJzLCBjb3VudCwgb3B0aW9ucykge1xuICAgIGNvdW50ID0gdHlwZW9mIGNvdW50ID09PSBcIm51bWJlclwiID8gY291bnQgOiB1bmRlZmluZWQ7XG4gICAgb3B0aW9ucyA9IHR5cGVvZiBvcHRpb25zID09PSBcIm51bWJlclwiID8gb3B0aW9ucyA6IDA7XG4gICAgaWYgKGNvdW50ICYmIGNvdW50IDwgMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb3VudCBjYW5ub3QgYmUgbGVzcyB0aGFuIHplcm9cIik7XG4gICAgfVxuICAgIGlmIChjb3VudCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIGNvbnN0IHJlbW92ZUVtcHR5ID0gKG9wdGlvbnMgJiAxKSA9PT0gMTtcbiAgICBjb25zdCB0cmltID0gKG9wdGlvbnMgJiAyKSA9PT0gMjtcbiAgICBzcGxpdHRlcnMgPSBzcGxpdHRlcnMgfHwgW107XG4gICAgc3BsaXR0ZXJzID0gc3BsaXR0ZXJzLmZpbHRlcih4ID0+IHgpLm1hcChlc2NhcGUpO1xuICAgIHNwbGl0dGVycyA9IHNwbGl0dGVycy5sZW5ndGggPiAwID8gc3BsaXR0ZXJzIDogW1wiXFxcXHNcIl07XG4gICAgY29uc3Qgc3BsaXRzID0gW107XG4gICAgY29uc3QgcmVnID0gbmV3IFJlZ0V4cChzcGxpdHRlcnMuam9pbihcInxcIiksIFwiZ1wiKTtcbiAgICBsZXQgZmluZFNwbGl0cyA9IHRydWU7XG4gICAgbGV0IGkgPSAwO1xuICAgIGRvIHtcbiAgICAgICAgY29uc3QgbWF0Y2ggPSByZWcuZXhlYyhzdHIpO1xuICAgICAgICBpZiAobWF0Y2ggPT09IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnN0IGNhbmRpZGF0ZSA9IHRyaW0gPyBzdHIuc3Vic3RyaW5nKGkpLnRyaW0oKSA6IHN0ci5zdWJzdHJpbmcoaSk7XG4gICAgICAgICAgICBpZiAoIXJlbW92ZUVtcHR5IHx8IGNhbmRpZGF0ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgc3BsaXRzLnB1c2goY2FuZGlkYXRlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpbmRTcGxpdHMgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGNhbmRpZGF0ZSA9IHRyaW0gPyBzdHIuc3Vic3RyaW5nKGksIG1hdGNoLmluZGV4KS50cmltKCkgOiBzdHIuc3Vic3RyaW5nKGksIG1hdGNoLmluZGV4KTtcbiAgICAgICAgICAgIGlmICghcmVtb3ZlRW1wdHkgfHwgY2FuZGlkYXRlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBpZiAoY291bnQgIT0gbnVsbCAmJiBzcGxpdHMubGVuZ3RoICsgMSA9PT0gY291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgc3BsaXRzLnB1c2godHJpbSA/IHN0ci5zdWJzdHJpbmcoaSkudHJpbSgpIDogc3RyLnN1YnN0cmluZyhpKSk7XG4gICAgICAgICAgICAgICAgICAgIGZpbmRTcGxpdHMgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNwbGl0cy5wdXNoKGNhbmRpZGF0ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaSA9IHJlZy5sYXN0SW5kZXg7XG4gICAgICAgIH1cbiAgICB9IHdoaWxlIChmaW5kU3BsaXRzKTtcbiAgICByZXR1cm4gc3BsaXRzO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRyaW0oc3RyLCAuLi5jaGFycykge1xuICAgIGlmIChjaGFycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHN0ci50cmltKCk7XG4gICAgfVxuICAgIGNvbnN0IHBhdHRlcm4gPSBcIltcIiArIGVzY2FwZShjaGFycy5qb2luKFwiXCIpKSArIFwiXStcIjtcbiAgICByZXR1cm4gc3RyLnJlcGxhY2UobmV3IFJlZ0V4cChcIl5cIiArIHBhdHRlcm4pLCBcIlwiKS5yZXBsYWNlKG5ldyBSZWdFeHAocGF0dGVybiArIFwiJFwiKSwgXCJcIik7XG59XG5leHBvcnQgZnVuY3Rpb24gdHJpbVN0YXJ0KHN0ciwgLi4uY2hhcnMpIHtcbiAgICByZXR1cm4gY2hhcnMubGVuZ3RoID09PSAwXG4gICAgICAgID8gc3RyLnRyaW1TdGFydCgpXG4gICAgICAgIDogc3RyLnJlcGxhY2UobmV3IFJlZ0V4cChcIl5bXCIgKyBlc2NhcGUoY2hhcnMuam9pbihcIlwiKSkgKyBcIl0rXCIpLCBcIlwiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0cmltRW5kKHN0ciwgLi4uY2hhcnMpIHtcbiAgICByZXR1cm4gY2hhcnMubGVuZ3RoID09PSAwXG4gICAgICAgID8gc3RyLnRyaW1FbmQoKVxuICAgICAgICA6IHN0ci5yZXBsYWNlKG5ldyBSZWdFeHAoXCJbXCIgKyBlc2NhcGUoY2hhcnMuam9pbihcIlwiKSkgKyBcIl0rJFwiKSwgXCJcIik7XG59XG5leHBvcnQgZnVuY3Rpb24gZmlsdGVyKHByZWQsIHgpIHtcbiAgICByZXR1cm4geC5zcGxpdChcIlwiKS5maWx0ZXIoKGMpID0+IHByZWQoYykpLmpvaW4oXCJcIik7XG59XG5leHBvcnQgZnVuY3Rpb24gc3Vic3RyaW5nKHN0ciwgc3RhcnRJbmRleCwgbGVuZ3RoKSB7XG4gICAgaWYgKChzdGFydEluZGV4ICsgKGxlbmd0aCB8fCAwKSA+IHN0ci5sZW5ndGgpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgc3RhcnRJbmRleCBhbmQvb3IgbGVuZ3RoXCIpO1xuICAgIH1cbiAgICByZXR1cm4gbGVuZ3RoICE9IG51bGwgPyBzdHIuc3Vic3RyKHN0YXJ0SW5kZXgsIGxlbmd0aCkgOiBzdHIuc3Vic3RyKHN0YXJ0SW5kZXgpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHRvQ2hhckFycmF5MihzdHIsIHN0YXJ0SW5kZXgsIGxlbmd0aCkge1xuICAgIHJldHVybiBzdWJzdHJpbmcoc3RyLCBzdGFydEluZGV4LCBsZW5ndGgpLnNwbGl0KFwiXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGZtdChzdHJzLCAuLi5hcmdzKSB7XG4gICAgcmV0dXJuICh7IHN0cnMsIGFyZ3MgfSk7XG59XG5leHBvcnQgZnVuY3Rpb24gZm10V2l0aChmbXRzKSB7XG4gICAgcmV0dXJuIChzdHJzLCAuLi5hcmdzKSA9PiAoeyBzdHJzLCBhcmdzLCBmbXRzIH0pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGdldEZvcm1hdChzKSB7XG4gICAgcmV0dXJuIHMuZm10c1xuICAgICAgICA/IHMuc3Rycy5yZWR1Y2UoKGFjYywgbmV3UGFydCwgaW5kZXgpID0+IGFjYyArIGB7JHtTdHJpbmcoaW5kZXggLSAxKSArIHMuZm10c1tpbmRleCAtIDFdfX1gICsgbmV3UGFydClcbiAgICAgICAgOiBzLnN0cnMucmVkdWNlKChhY2MsIG5ld1BhcnQsIGluZGV4KSA9PiBhY2MgKyBgeyR7aW5kZXggLSAxfX1gICsgbmV3UGFydCk7XG59XG4iLAogICJpbXBvcnQgeyBwcmludGYsIHRvQ29uc29sZSB9IGZyb20gXCIuL2ZhYmxlX21vZHVsZXMvZmFibGUtbGlicmFyeS1qcy40LjE0LjAvU3RyaW5nLmpzXCI7XG5cbmV4cG9ydCBmdW5jdGlvbiBoZWxsbyhhLCBiKSB7XG4gICAgdG9Db25zb2xlKHByaW50ZihcImhlbGxvLCAlcywgJXNcIikpKGEpKGIpO1xufVxuXG5oZWxsbyhcIm1pc3RlclwiLCBcImludGVyZXN0aW5nXCIpO1xuXG4iCiAgXSwKICAibWFwcGluZ3MiOiAiO0FBQ08sU0FBUyxTQUFTLENBQUMsR0FBRztBQUN6QixnQkFBYyxNQUFNLG1CQUFtQixNQUFNLFlBQVksSUFBSTtBQUFBO0FBRTFELFNBQVMsT0FBTyxDQUFDLEdBQUcsR0FBRztBQUMxQixhQUFXLE1BQU0sVUFBVTtBQUN2QixXQUFPLElBQUksS0FBSSxJQUFNLElBQUksSUFBSSxJQUFJO0FBQUEsRUFDckMsa0JBQ2dCLE1BQU0sVUFBVTtBQUM1QixXQUFPLElBQUksS0FBSSxJQUFNLElBQUksSUFBSSxJQUFJO0FBQUEsRUFDckMsT0FDSztBQUNELFdBQU8sRUFBRSxVQUFVLENBQUM7QUFBQTtBQUFBO0FBR3JCLFNBQVMsUUFBUSxDQUFDLEdBQUcsR0FBRztBQUMzQixhQUFXLE1BQU0sVUFBVTtBQUN2QixXQUFPLElBQUk7QUFBQSxFQUNmLGtCQUNnQixNQUFNLFVBQVU7QUFDNUIsV0FBTyxJQUFJLE9BQU8sQ0FBQztBQUFBLEVBQ3ZCLE9BQ0s7QUFDRCxXQUFPLEVBQUUsUUFBUSxFQUFFLFNBQVMsQ0FBQztBQUFBO0FBQUE7QUFHOUIsU0FBUyxPQUFPLENBQUMsR0FBRyxJQUFJO0FBQzNCLGFBQVcsTUFBTSxVQUFVO0FBQ3ZCLFdBQU8sRUFBRSxRQUFRLEVBQUU7QUFBQSxFQUN2QixrQkFDZ0IsTUFBTSxVQUFVO0FBQzVCLFdBQU87QUFBQSxFQUNYLE9BQ0s7QUFDRCxXQUFPLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRTtBQUFBO0FBQUE7QUFHOUIsU0FBUyxXQUFXLENBQUMsR0FBRyxJQUFJO0FBQy9CLGFBQVcsTUFBTSxVQUFVO0FBQ3ZCLFdBQU8sRUFBRSxZQUFZLEVBQUU7QUFBQSxFQUMzQixrQkFDZ0IsTUFBTSxVQUFVO0FBQzVCLFdBQU87QUFBQSxFQUNYLE9BQ0s7QUFDRCxXQUFPLEVBQUUsUUFBUSxFQUFFLFlBQVksRUFBRTtBQUFBO0FBQUE7QUFHbEMsU0FBUyxhQUFhLENBQUMsR0FBRyxJQUFJO0FBQ2pDLGFBQVcsTUFBTSxVQUFVO0FBQ3ZCLFdBQU8sRUFBRSxjQUFjLEVBQUU7QUFBQSxFQUM3QixrQkFDZ0IsTUFBTSxVQUFVO0FBQzVCLFdBQU87QUFBQSxFQUNYLE9BQ0s7QUFDRCxXQUFPLEVBQUUsUUFBUSxFQUFFLGNBQWMsRUFBRTtBQUFBO0FBQUE7QUFHcEMsU0FBUyxLQUFLLENBQUMsR0FBRztBQUNyQixhQUFXLE1BQU0sVUFBVTtBQUN2QixZQUFRLE9BQU8sQ0FBQyxNQUFNLEdBQUcsU0FBUyxFQUFFO0FBQUEsRUFDeEMsa0JBQ2dCLE1BQU0sVUFBVTtBQUU1QixXQUFPLE9BQU8sUUFBUSxJQUFJLENBQUMsRUFBRSxTQUFTLEVBQUU7QUFBQSxFQUM1QyxPQUNLO0FBQ0QsV0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNO0FBQUE7QUFBQTtBQXBFMUIsSUFBTSxTQUFTLE9BQU8sU0FBUzs7O0FDZ0svQixTQUFTLFlBQVksQ0FBQyxHQUFHLFFBQVE7QUFDcEMsU0FBTyxFQUFFLFNBQVMsRUFBRSxFQUFFLFNBQVMsUUFBUSxHQUFHO0FBQUE7OztBQ2hLdkMsU0FBUyxXQUFXLENBQUMsTUFBTTtBQUM5QixNQUFJLFFBQVE7QUFDWixNQUFJLE1BQU07QUFDVixhQUFXLEtBQUssTUFBTTtBQUNsQixRQUFJLFVBQVUsR0FBRztBQUNiLGFBQU8sU0FBUyxDQUFDO0FBQUEsSUFDckIsV0FDUyxVQUFVLEtBQUs7QUFDcEIsYUFBTztBQUNQO0FBQUEsSUFDSixPQUNLO0FBQ0QsYUFBTyxPQUFPLFNBQVMsQ0FBQztBQUFBO0FBRTVCO0FBQUEsRUFDSjtBQUNBLFNBQU8sTUFBTTtBQUFBO0FBRVYsU0FBUyxRQUFRLENBQUMsR0FBRyxZQUFZLEdBQUc7QUFDdkMsTUFBSSxLQUFLLGVBQWUsTUFBTSxVQUFVO0FBQ3BDLGVBQVcsRUFBRSxhQUFhLFlBQVk7QUFDbEMsYUFBTyxFQUFFLFNBQVM7QUFBQSxJQUN0QixXQUNTLE9BQU8sWUFBWSxHQUFHO0FBQzNCLGFBQU8sWUFBWSxDQUFDO0FBQUEsSUFDeEIsT0FDSztBQUNELFlBQU0sT0FBTyxPQUFPLGVBQWUsQ0FBQyxHQUFHO0FBQ3ZDLGFBQU8sU0FBUyxVQUFVLFlBQVksS0FFaEMsT0FBTyxPQUFPLFFBQVEsQ0FBQyxFQUFFLElBQUksRUFBRSxHQUFHLE9BQU8sSUFBSSxRQUFRLFNBQVMsR0FBRyxZQUFZLENBQUMsQ0FBQyxFQUFFLEtBQUssTUFBTSxJQUFJLE9BQ2hHLE1BQU0sUUFBUTtBQUFBO0FBQUEsRUFFNUI7QUFDQSxTQUFPLE9BQU8sQ0FBQztBQUFBOzs7QUNabkIsSUFBUywyQkFBZ0IsQ0FBQyxRQUFRLEtBQUssYUFBYTtBQUNoRCxNQUFJLGNBQWM7QUFDbEIsTUFBSSxjQUFjO0FBQ2xCLFNBQU8sY0FBYyxPQUFPLFVBQVUsT0FBTyxpQkFBaUIsYUFBYTtBQUN2RTtBQUNBO0FBQUEsRUFDSjtBQUNBLFNBQU87QUFBQTtBQUVYLElBQVMsd0JBQWEsQ0FBQyxRQUFRLEtBQUs7QUFDaEMsTUFBSSxPQUFPLE9BQU8sU0FBUyxHQUFHO0FBQzFCLFlBQU87QUFBQSxFQUNYO0FBQ0EsU0FBTyxPQUFPLFdBQVcsTUFBTSxDQUFDO0FBQUE7QUFFcEMsSUFBUyw0QkFBaUIsQ0FBQyxRQUFRLEtBQUs7QUFDcEMsTUFBSSxXQUFXO0FBRWYsUUFBTSxZQUFZLE9BQU87QUFDekIsTUFBSSxTQUFTO0FBQ2IsTUFBSSxhQUFhO0FBQ2pCLFNBQU8sTUFBTSxPQUFPLFFBQVE7QUFDeEI7QUFDQSxVQUFNLGNBQWMsT0FBTztBQUMzQixRQUFJLGdCQUFnQixXQUFXO0FBQzNCLG1CQUFhO0FBQ2I7QUFBQSxJQUNKLFdBQ1MsZ0JBQWdCLE1BQU07QUFDM0IsVUFBSSxNQUFNLE9BQU8sUUFBUTtBQUNyQjtBQUNBLGtCQUFVLE9BQU87QUFBQSxNQUNyQixPQUNLO0FBRUQsY0FBTSxJQUFJLE1BQU0sdUJBQXVCO0FBQUE7QUFBQSxJQUUvQyxPQUNLO0FBQ0QsZ0JBQVU7QUFBQTtBQUFBLEVBRWxCO0FBQ0EsT0FBSyxZQUFZO0FBRWIsVUFBTSxJQUFJLE1BQU0sMkRBQTJELFdBQVc7QUFBQSxFQUMxRjtBQUNBLFNBQU8sQ0FBQyxRQUFRLE1BQU0sV0FBVyxDQUFDO0FBQUE7QUFFdEMsSUFBUyx1Q0FBNEIsQ0FBQyxNQUFNLFFBQVEsS0FBSztBQUNyRCxNQUFJLFlBQVk7QUFDaEIsTUFBSSxjQUFjO0FBQ2xCLE1BQUksU0FBUztBQUNiLFFBQU0sZ0JBQWdCLE1BQU0sU0FBUyxLQUFLLFFBQVEsR0FBRyxDQUFvQixJQUFJO0FBQzdFLFNBQU8sWUFBWSxPQUFPLFFBQVE7QUFDOUIsVUFBTSxRQUFRLE9BQU87QUFDckIsWUFBUTtBQUFBLFdBQ0M7QUFDRCxzQkFBYyxpQkFBaUIsUUFBUSxXQUFXLEdBQUc7QUFDckQscUJBQWE7QUFDYixnQkFBUTtBQUFBLGVBQ0M7QUFDRCxzQkFBVSxjQUFjLFFBQVE7QUFDaEM7QUFBQSxlQUNDO0FBQ0Qsc0JBQVUsYUFBYSxjQUFjLFFBQVEsR0FBRyxDQUFDO0FBQ2pEO0FBQUEsZUFDQztBQUNELHNCQUFVLFVBQVUsVUFBVSxhQUFhO0FBQzNDO0FBQUEsZUFDQztBQUNELHNCQUFVLFNBQVMsVUFBVSxhQUFhO0FBQzFDO0FBQUE7QUFFQTtBQUFBO0FBRVI7QUFBQSxXQUNDO0FBQ0Qsc0JBQWMsaUJBQWlCLFFBQVEsV0FBVyxHQUFHO0FBQ3JELHFCQUFhO0FBQ2IsWUFBSSxlQUFlLEdBQUc7QUFDbEIsZ0JBQU0sWUFBWSxPQUFPLElBQUk7QUFDN0Isb0JBQVUsYUFBYSxLQUFLLE1BQU0sWUFBWSxhQUFhLElBQUksU0FBUyxHQUFHLFdBQVc7QUFBQSxRQUMxRixXQUNTLGVBQWUsR0FBRztBQU12QixxQkFBVyxLQUFLLFlBQVksYUFBYSxHQUFHLE9BQU8sYUFBYSxHQUFHO0FBQUEsUUFDdkU7QUFDQTtBQUFBLFdBQ0M7QUFDRCxzQkFBYyxpQkFBaUIsUUFBUSxXQUFXLEdBQUc7QUFDckQscUJBQWE7QUFDYixZQUFJLGVBQWUsR0FBRztBQUNsQixnQkFBTSxZQUFZLE9BQU8sSUFBSTtBQUM3QixnQkFBTSxRQUFRLEtBQUssTUFBTSxZQUFZLGFBQWEsSUFBSSxTQUFTO0FBQy9ELGNBQUksU0FBUyxHQUFHO0FBQ1osc0JBQVUsYUFBYSxPQUFPLFdBQVc7QUFBQSxVQUM3QztBQUFBLFFBQ0osV0FDUyxlQUFlLEdBQUc7QUFJdkIsZ0JBQU0sUUFBUSxZQUFZLGFBQWE7QUFDdkMsY0FBSSxTQUFTLEdBQUc7QUFDWixzQkFBVSxhQUFhLE9BQU8sQ0FBQztBQUFBLFVBQ25DO0FBQUEsUUFDSjtBQUNBO0FBQUEsV0FDQztBQUNELHNCQUFjLGlCQUFpQixRQUFRLFdBQVcsR0FBRztBQUNyRCxxQkFBYTtBQUNiLFlBQUksZUFBZSxHQUFHO0FBQ2xCLG9CQUFVO0FBQUEsUUFDZDtBQUNBO0FBQUEsV0FDQztBQUNELHNCQUFjLGlCQUFpQixRQUFRLFdBQVcsR0FBRztBQUNyRCxxQkFBYTtBQUNiLGdCQUFRO0FBQUEsZUFDQztBQUNELHNCQUFVLEtBQUssYUFBYSxJQUFJO0FBQ2hDO0FBQUEsZUFDQztBQUNELHNCQUFVLGFBQWEsS0FBSyxhQUFhLElBQUksSUFBSSxDQUFDO0FBQ2xEO0FBQUE7QUFFQTtBQUFBO0FBRVI7QUFBQSxXQUNDO0FBQ0Qsc0JBQWMsaUJBQWlCLFFBQVEsV0FBVyxHQUFHO0FBQ3JELHFCQUFhO0FBQ2IsZ0JBQVE7QUFBQSxlQUNDO0FBQ0Qsc0JBQVUsS0FBSyxhQUFhO0FBQzVCO0FBQUEsZUFDQztBQUNELHNCQUFVLGFBQWEsS0FBSyxhQUFhLEdBQUcsQ0FBQztBQUM3QztBQUFBO0FBRUE7QUFBQTtBQUVSO0FBQUEsV0FDQztBQUNELHNCQUFjLGlCQUFpQixRQUFRLFdBQVcsR0FBRztBQUNyRCxxQkFBYTtBQUNiLGdCQUFRO0FBQUEsZUFDQztBQUNELG9CQUFRLEtBQUssYUFBYTtBQUFBLG1CQUNqQjtBQUNELDBCQUFVO0FBQ1Y7QUFBQSxtQkFDQztBQUNELDBCQUFVLG1CQUFtQixjQUFjLGtCQUFrQixLQUFJLEtBQU07QUFDdkU7QUFBQSxtQkFDQztBQUNEO0FBQUE7QUFFUjtBQUFBO0FBRUE7QUFBQTtBQUVSO0FBQUEsV0FDQztBQUNELHNCQUFjLGlCQUFpQixRQUFRLFdBQVcsR0FBRztBQUNyRCxxQkFBYTtBQUNiLGdCQUFRO0FBQUEsZUFDQztBQUNELHNCQUFVLE9BQU8sYUFBYTtBQUM5QjtBQUFBLGVBQ0M7QUFDRCxzQkFBVSxhQUFhLE9BQU8sYUFBYSxHQUFHLENBQUM7QUFDL0M7QUFBQTtBQUVBO0FBQUE7QUFFUjtBQUFBLFdBQ0M7QUFDRCxzQkFBYyxpQkFBaUIsUUFBUSxXQUFXLEdBQUc7QUFDckQscUJBQWE7QUFDYixnQkFBUTtBQUFBLGVBQ0M7QUFDRCxzQkFBVSxNQUFNLGFBQWE7QUFDN0I7QUFBQSxlQUNDO0FBQ0Qsc0JBQVUsYUFBYSxNQUFNLGFBQWEsR0FBRyxDQUFDO0FBQzlDO0FBQUEsZUFDQztBQUNELHNCQUFVLFlBQVksTUFBTSxhQUFhLElBQUk7QUFDN0M7QUFBQSxlQUNDO0FBQ0Qsc0JBQVUsV0FBVyxNQUFNLGFBQWEsSUFBSTtBQUM1QztBQUFBO0FBRUE7QUFBQTtBQUVSO0FBQUEsV0FDQztBQUNELHNCQUFjLGlCQUFpQixRQUFRLFdBQVcsR0FBRztBQUNyRCxxQkFBYTtBQUNiLGdCQUFRO0FBQUEsZUFDQztBQUNELHNCQUFVLE9BQU8sYUFBYTtBQUM5QjtBQUFBLGVBQ0M7QUFDRCxzQkFBVSxhQUFhLE9BQU8sYUFBYSxHQUFHLENBQUM7QUFDL0M7QUFBQTtBQUVBO0FBQUE7QUFFUjtBQUFBLFdBQ0M7QUFDRCxzQkFBYyxpQkFBaUIsUUFBUSxXQUFXLEdBQUc7QUFDckQscUJBQWE7QUFDYixnQkFBUTtBQUFBLGVBQ0M7QUFDRCxzQkFBVSxjQUFjLFNBQVMsSUFBSSxLQUFLLE1BQU07QUFDaEQ7QUFBQSxlQUNDO0FBQ0Qsc0JBQVUsY0FBYyxTQUFTLElBQUksS0FBSyxPQUFPO0FBQ2pEO0FBQUE7QUFFQTtBQUFBO0FBRVI7QUFBQSxXQUNDO0FBQ0Qsc0JBQWMsaUJBQWlCLFFBQVEsV0FBVyxHQUFHO0FBQ3JELHFCQUFhO0FBQ2IsZ0JBQVE7QUFBQSxlQUNDO0FBQ0Qsc0JBQVUsY0FBYyxZQUFZLElBQUk7QUFDeEM7QUFBQSxlQUNDO0FBQ0Qsc0JBQVUsYUFBYSxjQUFjLFlBQVksSUFBSSxLQUFLLENBQUM7QUFDM0Q7QUFBQSxlQUNDO0FBQ0Qsc0JBQVUsYUFBYSxjQUFjLFlBQVksR0FBRyxDQUFDO0FBQ3JEO0FBQUEsZUFDQztBQUNELHNCQUFVLGFBQWEsY0FBYyxZQUFZLEdBQUcsQ0FBQztBQUNyRDtBQUFBLGVBQ0M7QUFDRCxzQkFBVSxhQUFhLGNBQWMsWUFBWSxHQUFHLENBQUM7QUFDckQ7QUFBQTtBQUVBO0FBQUE7QUFFUjtBQUFBLFdBQ0M7QUFDRCxzQkFBYyxpQkFBaUIsUUFBUSxXQUFXLEdBQUc7QUFDckQscUJBQWE7QUFDYixZQUFJLGdCQUFnQjtBQUNwQixnQkFBUSxLQUFLLGFBQWE7QUFBQSxlQUNqQjtBQUNELDRCQUFnQjtBQUNoQjtBQUFBLGVBQ0M7QUFDRCw0QkFBZ0IsbUJBQW1CLGNBQWMsa0JBQWtCLEtBQUksS0FBTTtBQUM3RTtBQUFBLGVBQ0M7QUFDRCw0QkFBZ0IsbUJBQW1CLFlBQVksYUFBYSxFQUFFLGtCQUFrQixLQUFJLEtBQU07QUFDMUY7QUFBQTtBQUVSLGNBQU0sT0FBTyxjQUFjLE9BQU8sTUFBTSxNQUFNO0FBQzlDLGNBQU0sUUFBUSxTQUFTLGNBQWMsVUFBVSxHQUFHLENBQUMsR0FBRyxFQUFFO0FBQ3hELGNBQU0sVUFBVSxTQUFTLGNBQWMsVUFBVSxHQUFHLENBQUMsR0FBRyxFQUFFO0FBQzFELGdCQUFRO0FBQUEsZUFDQztBQUNELHNCQUFVLEdBQUcsT0FBTztBQUNwQjtBQUFBLGVBQ0M7QUFDRCxzQkFBVSxHQUFHLE9BQU8sYUFBYSxPQUFPLENBQUM7QUFDekM7QUFBQTtBQUVBLHNCQUFVLEdBQUcsT0FBTyxhQUFhLE9BQU8sQ0FBQyxLQUFLLGFBQWEsU0FBUyxDQUFDO0FBQ3JFO0FBQUE7QUFFUjtBQUFBLFdBQ0M7QUFDRCxrQkFBVTtBQUNWO0FBQ0E7QUFBQSxXQUNDO0FBQ0Qsa0JBQVU7QUFDVjtBQUNBO0FBQUEsV0FDQztBQUFBLFdBQ0E7QUFDRCxlQUFPLGNBQWMsc0JBQXNCLGtCQUFrQixRQUFRLFNBQVM7QUFDOUUsa0JBQVU7QUFDVixxQkFBYTtBQUNiO0FBQUEsV0FDQztBQUNELGNBQU0sV0FBVyxjQUFjLFFBQVEsU0FBUztBQUNoRCxZQUFJLFlBQVksS0FBSyxhQUFhLElBQUksV0FBVyxDQUFDLEdBQUc7QUFDakQsdUJBQWE7QUFDYixvQkFBVSw2QkFBNkIsZUFBZSxPQUFPLGFBQWEsUUFBUSxHQUFHLEdBQUc7QUFBQSxRQUM1RixPQUNLO0FBQ0QsZ0JBQU0sSUFBSSxNQUFNLHVCQUF1QjtBQUFBO0FBRTNDO0FBQUEsV0FDQztBQUNELGNBQU0sWUFBWSxjQUFjLFFBQVEsU0FBUztBQUNqRCxZQUFJLGFBQWEsR0FBRztBQUNoQix1QkFBYTtBQUNiLG9CQUFVLE9BQU8sYUFBYSxTQUFTO0FBQUEsUUFDM0MsT0FDSztBQUNELGdCQUFNLElBQUksTUFBTSx1QkFBdUI7QUFBQTtBQUUzQztBQUFBO0FBRUE7QUFDQSxrQkFBVTtBQUNWO0FBQUE7QUFBQSxFQUVaO0FBQ0EsU0FBTztBQUFBO0FBRUosU0FBUyxJQUFJLENBQUMsT0FBTztBQUN4QixTQUFPLE1BQU0sUUFBUTtBQUFBOzs7QUNyVnpCLElBQVMscUJBQVUsQ0FBQyxHQUFHLEdBQUc7QUFDdEIsU0FBTyxRQUFlLEdBQUcsQ0FBQyxJQUFJO0FBQUE7OztBQ04zQixTQUFTLEtBQUssQ0FBQyxHQUFHLEdBQUc7QUFDeEIsWUFBVSxPQUFPLGVBQWUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDO0FBQUE7QUFHM0MsTUFBTSxVQUFVLGFBQWE7IiwKICAiZGVidWdJZCI6ICI1QUJDRTc1QUM0RjA1QUQ2NjQ3NTZlMjE2NDc1NmUyMSIsCiAgIm5hbWVzIjogW10KfQ==
